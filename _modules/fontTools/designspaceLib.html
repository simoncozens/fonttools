

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.designspaceLib &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>fontTools.designspaceLib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.designspaceLib</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.loggingTools</span> <span class="k">import</span> <span class="n">LogMixin</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">posixpath</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">etree</span> <span class="k">as</span> <span class="n">ET</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">plistlib</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    designSpaceDocument</span>

<span class="sd">    - read and write designspace files</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;DesignSpaceDocumentError&#39;</span><span class="p">,</span> <span class="s1">&#39;DesignSpaceDocument&#39;</span><span class="p">,</span> <span class="s1">&#39;SourceDescriptor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;InstanceDescriptor&#39;</span><span class="p">,</span> <span class="s1">&#39;AxisDescriptor&#39;</span><span class="p">,</span> <span class="s1">&#39;RuleDescriptor&#39;</span><span class="p">,</span> <span class="s1">&#39;BaseDocReader&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BaseDocWriter&#39;</span>
<span class="p">]</span>

<span class="c1"># ElementTree allows to find namespace-prefixed elements, but not attributes</span>
<span class="c1"># so we have to do it ourselves for &#39;xml:lang&#39;</span>
<span class="n">XML_NS</span> <span class="o">=</span> <span class="s2">&quot;{http://www.w3.org/XML/1998/namespace}&quot;</span>
<span class="n">XML_LANG</span> <span class="o">=</span> <span class="n">XML_NS</span> <span class="o">+</span> <span class="s2">&quot;lang&quot;</span>


<span class="k">def</span> <span class="nf">posix</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize paths using forward slash to work also on Windows.&quot;&quot;&quot;</span>
    <span class="n">new_path</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
        <span class="c1"># The above transformation loses absolute paths</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">new_path</span>
    <span class="k">return</span> <span class="n">new_path</span>


<span class="k">def</span> <span class="nf">posixpath_property</span><span class="p">(</span><span class="n">private_name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Normal getter</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">private_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># The setter rewrites paths using forward slashes</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">posix</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">private_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>


<div class="viewcode-block" id="DesignSpaceDocumentError"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocumentError">[docs]</a><span class="k">class</span> <span class="nc">DesignSpaceDocumentError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
            <span class="s2">&quot;: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">AsDictMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;asdict&quot;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;asdict&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span>
                <span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">d</span>


<span class="k">class</span> <span class="nc">SimpleDescriptor</span><span class="p">(</span><span class="n">AsDictMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Containers for a bunch of attributes&quot;&quot;&quot;</span>

    <span class="c1"># XXX this is ugly. The &#39;print&#39; is inappropriate here, and instead of</span>
    <span class="c1"># assert, it should simply return True/False</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># test if this object contains the same data as the other</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed attribute&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> <span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>


<div class="viewcode-block" id="SourceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.SourceDescriptor">[docs]</a><span class="k">class</span> <span class="nc">SourceDescriptor</span><span class="p">(</span><span class="n">SimpleDescriptor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple container for data related to the source&quot;&quot;&quot;</span>
    <span class="n">flavor</span> <span class="o">=</span> <span class="s2">&quot;source&quot;</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;layerName&#39;</span><span class="p">,</span>
              <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;copyLib&#39;</span><span class="p">,</span>
              <span class="s1">&#39;copyGroups&#39;</span><span class="p">,</span> <span class="s1">&#39;copyFeatures&#39;</span><span class="p">,</span>
              <span class="s1">&#39;muteKerning&#39;</span><span class="p">,</span> <span class="s1">&#39;muteInfo&#39;</span><span class="p">,</span>
              <span class="s1">&#39;mutedGlyphNames&#39;</span><span class="p">,</span>
              <span class="s1">&#39;familyName&#39;</span><span class="p">,</span> <span class="s1">&#39;styleName&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">layerName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">familyName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">styleName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">copyLib</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">copyInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">copyGroups</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">copyFeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">muteKerning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">muteInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mutedGlyphNames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="sd">&quot;&quot;&quot;The original path as found in the document.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="sd">&quot;&quot;&quot;The absolute path, calculated from filename.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span>
        <span class="sd">&quot;&quot;&quot;Any Python object. Optional. Points to a representation of this</span>
<span class="sd">        source font that is loaded in memory, as a Python object (e.g. a</span>
<span class="sd">        ``defcon.Font`` or a ``fontTools.ttFont.TTFont``).</span>

<span class="sd">        The default document reader will not fill-in this attribute, and the</span>
<span class="sd">        default writer will not use this attribute. It is up to the user of</span>
<span class="sd">        ``designspaceLib`` to either load the resource identified by</span>
<span class="sd">        ``filename`` and store it in this field, or write the contents of</span>
<span class="sd">        this field to the disk and make ```filename`` point to that.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerName</span> <span class="o">=</span> <span class="n">layerName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">familyName</span> <span class="o">=</span> <span class="n">familyName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleName</span> <span class="o">=</span> <span class="n">styleName</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copyLib</span> <span class="o">=</span> <span class="n">copyLib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyInfo</span> <span class="o">=</span> <span class="n">copyInfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyGroups</span> <span class="o">=</span> <span class="n">copyGroups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyFeatures</span> <span class="o">=</span> <span class="n">copyFeatures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muteKerning</span> <span class="o">=</span> <span class="n">muteKerning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muteInfo</span> <span class="o">=</span> <span class="n">muteInfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutedGlyphNames</span> <span class="o">=</span> <span class="n">mutedGlyphNames</span> <span class="ow">or</span> <span class="p">[]</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">posixpath_property</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">posixpath_property</span><span class="p">(</span><span class="s2">&quot;_filename&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RuleDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.RuleDescriptor">[docs]</a><span class="k">class</span> <span class="nc">RuleDescriptor</span><span class="p">(</span><span class="n">SimpleDescriptor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&lt;!-- optional: list of substitution rules --&gt;</span>
<span class="sd">    &lt;rules&gt;</span>
<span class="sd">        &lt;rule name=&quot;vertical.bars&quot;&gt;</span>
<span class="sd">            &lt;conditionset&gt;</span>
<span class="sd">                &lt;condition minimum=&quot;250.000000&quot; maximum=&quot;750.000000&quot; name=&quot;weight&quot;/&gt;</span>
<span class="sd">                &lt;condition minimum=&quot;100&quot; name=&quot;width&quot;/&gt;</span>
<span class="sd">                &lt;condition minimum=&quot;10&quot; maximum=&quot;40&quot; name=&quot;optical&quot;/&gt;</span>
<span class="sd">            &lt;/conditionset&gt;</span>
<span class="sd">            &lt;sub name=&quot;cent&quot; with=&quot;cent.alt&quot;/&gt;</span>
<span class="sd">            &lt;sub name=&quot;dollar&quot; with=&quot;dollar.alt&quot;/&gt;</span>
<span class="sd">        &lt;/rule&gt;</span>
<span class="sd">    &lt;/rules&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;conditionSets&#39;</span><span class="p">,</span> <span class="s1">&#39;subs&#39;</span><span class="p">]</span>   <span class="c1"># what do we need here</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conditionSets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># list of lists of dict(name=&#39;aaaa&#39;, minimum=0, maximum=1000)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditionSets</span> <span class="o">=</span> <span class="n">conditionSets</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1"># list of substitutions stored as tuples of glyphnames (&quot;a&quot;, &quot;a.alt&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subs</span> <span class="o">=</span> <span class="n">subs</span> <span class="ow">or</span> <span class="p">[]</span></div>


<span class="k">def</span> <span class="nf">evaluateRule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return True if any of the rule&#39;s conditionsets matches the given location.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">evaluateConditions</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">conditionSets</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">evaluateConditions</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return True if all the conditions matches the given location.</span>
<span class="sd">        If a condition has no minimum, check for &lt; maximum.</span>
<span class="sd">        If a condition has no maximum, check for &gt; minimum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">cd</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="n">cd</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">processRules</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphNames</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Apply these rules at this location to these glyphnames</span>
<span class="sd">        - rule order matters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">evaluateRule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glyphNames</span><span class="p">:</span>
                <span class="n">swap</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">subs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">a</span><span class="p">:</span>
                        <span class="n">swap</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">swap</span><span class="p">:</span>
                    <span class="n">newNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">glyphNames</span> <span class="o">=</span> <span class="n">newNames</span>
            <span class="n">newNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">glyphNames</span>


<div class="viewcode-block" id="InstanceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor">[docs]</a><span class="k">class</span> <span class="nc">InstanceDescriptor</span><span class="p">(</span><span class="n">SimpleDescriptor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple container for data related to the instance&quot;&quot;&quot;</span>
    <span class="n">flavor</span> <span class="o">=</span> <span class="s2">&quot;instance&quot;</span>
    <span class="n">_defaultLanguageCode</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">,</span>
              <span class="s1">&#39;name&#39;</span><span class="p">,</span>
              <span class="s1">&#39;location&#39;</span><span class="p">,</span>
              <span class="s1">&#39;familyName&#39;</span><span class="p">,</span>
              <span class="s1">&#39;styleName&#39;</span><span class="p">,</span>
              <span class="s1">&#39;postScriptFontName&#39;</span><span class="p">,</span>
              <span class="s1">&#39;styleMapFamilyName&#39;</span><span class="p">,</span>
              <span class="s1">&#39;styleMapStyleName&#39;</span><span class="p">,</span>
              <span class="s1">&#39;kerning&#39;</span><span class="p">,</span>
              <span class="s1">&#39;info&#39;</span><span class="p">,</span>
              <span class="s1">&#39;lib&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">familyName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">styleName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">postScriptFontName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">styleMapFamilyName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">styleMapStyleName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">localisedFamilyName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">localisedStyleName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">localisedStyleMapFamilyName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">localisedStyleMapStyleName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">glyphs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kerning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">lib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># the original path as found in the document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="c1"># the absolute path, calculated from filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="c1"># Same as in SourceDescriptor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">familyName</span> <span class="o">=</span> <span class="n">familyName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleName</span> <span class="o">=</span> <span class="n">styleName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postScriptFontName</span> <span class="o">=</span> <span class="n">postScriptFontName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleMapFamilyName</span> <span class="o">=</span> <span class="n">styleMapFamilyName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleMapStyleName</span> <span class="o">=</span> <span class="n">styleMapStyleName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedFamilyName</span> <span class="o">=</span> <span class="n">localisedFamilyName</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleName</span> <span class="o">=</span> <span class="n">localisedStyleName</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleMapFamilyName</span> <span class="o">=</span> <span class="n">localisedStyleMapFamilyName</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleMapStyleName</span> <span class="o">=</span> <span class="n">localisedStyleMapStyleName</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">glyphs</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kerning</span> <span class="o">=</span> <span class="n">kerning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">lib</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Custom data associated with this instance.&quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">posixpath_property</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">posixpath_property</span><span class="p">(</span><span class="s2">&quot;_filename&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="InstanceDescriptor.setStyleName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.setStyleName">[docs]</a>    <span class="k">def</span> <span class="nf">setStyleName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleName</span><span class="p">[</span><span class="n">languageCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">styleName</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.getStyleName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.getStyleName">[docs]</a>    <span class="k">def</span> <span class="nf">getStyleName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">languageCode</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.setFamilyName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.setFamilyName">[docs]</a>    <span class="k">def</span> <span class="nf">setFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">familyName</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedFamilyName</span><span class="p">[</span><span class="n">languageCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">familyName</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.getFamilyName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.getFamilyName">[docs]</a>    <span class="k">def</span> <span class="nf">getFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">localisedFamilyName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">languageCode</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.setStyleMapStyleName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.setStyleMapStyleName">[docs]</a>    <span class="k">def</span> <span class="nf">setStyleMapStyleName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">styleMapStyleName</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleMapStyleName</span><span class="p">[</span><span class="n">languageCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">styleMapStyleName</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.getStyleMapStyleName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.getStyleMapStyleName">[docs]</a>    <span class="k">def</span> <span class="nf">getStyleMapStyleName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleMapStyleName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">languageCode</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.setStyleMapFamilyName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.setStyleMapFamilyName">[docs]</a>    <span class="k">def</span> <span class="nf">setStyleMapFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">styleMapFamilyName</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleMapFamilyName</span><span class="p">[</span><span class="n">languageCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">styleMapFamilyName</span><span class="p">)</span></div>

<div class="viewcode-block" id="InstanceDescriptor.getStyleMapFamilyName"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.InstanceDescriptor.getStyleMapFamilyName">[docs]</a>    <span class="k">def</span> <span class="nf">getStyleMapFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">languageCode</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">localisedStyleMapFamilyName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">languageCode</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">tagForAxisName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># try to find or make a tag name for this axis name</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;weight&#39;</span><span class="p">:</span>   <span class="p">(</span><span class="s1">&#39;wght&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">en</span> <span class="o">=</span> <span class="s1">&#39;Weight&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="s1">&#39;wdth&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">en</span> <span class="o">=</span> <span class="s1">&#39;Width&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;optical&#39;</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;opsz&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">en</span> <span class="o">=</span> <span class="s1">&#39;Optical Size&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;slant&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="s1">&#39;slnt&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">en</span> <span class="o">=</span> <span class="s1">&#39;Slant&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;italic&#39;</span><span class="p">:</span>   <span class="p">(</span><span class="s1">&#39;ital&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">en</span> <span class="o">=</span> <span class="s1">&#39;Italic&#39;</span><span class="p">)),</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">names</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tag</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">en</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>


<div class="viewcode-block" id="AxisDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.AxisDescriptor">[docs]</a><span class="k">class</span> <span class="nc">AxisDescriptor</span><span class="p">(</span><span class="n">SimpleDescriptor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple container for the axis data</span>
<span class="sd">        Add more localisations?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flavor</span> <span class="o">=</span> <span class="s2">&quot;axis&quot;</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">labelNames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">minimum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">maximum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hidden</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># opentype tag for this axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="c1"># name of the axis used in locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># names for UI purposes, if this is not a standard axis,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelNames</span> <span class="o">=</span> <span class="n">labelNames</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="n">hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="nb">map</span> <span class="ow">or</span> <span class="p">[]</span>

<div class="viewcode-block" id="AxisDescriptor.serialize"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.AxisDescriptor.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># output to a dict, used in testing</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">labelNames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labelNames</span><span class="p">,</span>
            <span class="n">maximum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">,</span>
            <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
            <span class="n">hidden</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
            <span class="nb">map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AxisDescriptor.map_forward"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.AxisDescriptor.map_forward">[docs]</a>    <span class="k">def</span> <span class="nf">map_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fontTools.varLib.models</span> <span class="k">import</span> <span class="n">piecewiseLinearMap</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">piecewiseLinearMap</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">})</span></div>

<div class="viewcode-block" id="AxisDescriptor.map_backward"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.AxisDescriptor.map_backward">[docs]</a>    <span class="k">def</span> <span class="nf">map_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fontTools.varLib.models</span> <span class="k">import</span> <span class="n">piecewiseLinearMap</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">piecewiseLinearMap</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">})</span></div></div>


<div class="viewcode-block" id="BaseDocWriter"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter">[docs]</a><span class="k">class</span> <span class="nc">BaseDocWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_whiteSpace</span> <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
    <span class="n">ruleDescriptorClass</span> <span class="o">=</span> <span class="n">RuleDescriptor</span>
    <span class="n">axisDescriptorClass</span> <span class="o">=</span> <span class="n">AxisDescriptor</span>
    <span class="n">sourceDescriptorClass</span> <span class="o">=</span> <span class="n">SourceDescriptor</span>
    <span class="n">instanceDescriptorClass</span> <span class="o">=</span> <span class="n">InstanceDescriptor</span>

<div class="viewcode-block" id="BaseDocWriter.getAxisDecriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter.getAxisDecriptor">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getAxisDecriptor</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">axisDescriptorClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="BaseDocWriter.getSourceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter.getSourceDescriptor">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getSourceDescriptor</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sourceDescriptorClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="BaseDocWriter.getInstanceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter.getInstanceDescriptor">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getInstanceDescriptor</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">instanceDescriptorClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="BaseDocWriter.getRuleDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter.getRuleDescriptor">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getRuleDescriptor</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ruleDescriptorClass</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documentPath</span><span class="p">,</span> <span class="n">documentObject</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">documentPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span> <span class="o">=</span> <span class="n">documentObject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documentVersion</span> <span class="o">=</span> <span class="s2">&quot;4.1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;designspace&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentVersion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># for use by the writer only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># for use by the writer only</span>

<div class="viewcode-block" id="BaseDocWriter.write"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">axisObject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addAxis</span><span class="p">(</span><span class="n">axisObject</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="p">,</span> <span class="s2">&quot;rulesProcessingLast&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;processing&quot;</span><span class="p">:</span> <span class="s2">&quot;last&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;rules&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ruleObject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addRule</span><span class="p">(</span><span class="n">ruleObject</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">sourceObject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addSource</span><span class="p">(</span><span class="n">sourceObject</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;instances&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">instanceObject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addInstance</span><span class="p">(</span><span class="n">instanceObject</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addLib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">lib</span><span class="p">)</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span>
            <span class="n">xml_declaration</span><span class="o">=</span><span class="n">xml_declaration</span><span class="p">,</span>
            <span class="n">pretty_print</span><span class="o">=</span><span class="n">pretty</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_makeLocationElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locationObject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert Location dict to a locationElement.&quot;&quot;&quot;</span>
        <span class="n">locElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">locElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">validatedLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">newDefaultLocation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">axisName</span><span class="p">,</span> <span class="n">axisValue</span> <span class="ow">in</span> <span class="n">locationObject</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">axisName</span> <span class="ow">in</span> <span class="n">validatedLocation</span><span class="p">:</span>
                <span class="c1"># only accept values we know</span>
                <span class="n">validatedLocation</span><span class="p">[</span><span class="n">axisName</span><span class="p">]</span> <span class="o">=</span> <span class="n">axisValue</span>
        <span class="k">for</span> <span class="n">dimensionName</span><span class="p">,</span> <span class="n">dimensionValue</span> <span class="ow">in</span> <span class="n">validatedLocation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dimElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;dimension&#39;</span><span class="p">)</span>
            <span class="n">dimElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dimensionName</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dimensionValue</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">dimElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;xvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">dimensionValue</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dimElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;yvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">dimensionValue</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dimElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;xvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">dimensionValue</span><span class="p">)</span>
            <span class="n">locElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dimElement</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">locElement</span><span class="p">,</span> <span class="n">validatedLocation</span>

<div class="viewcode-block" id="BaseDocWriter.intOrFloat"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocWriter.intOrFloat">[docs]</a>    <span class="k">def</span> <span class="nf">intOrFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="n">num</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num</span></div>

    <span class="k">def</span> <span class="nf">_addRule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ruleObject</span><span class="p">):</span>
        <span class="c1"># if none of the conditions have minimum or maximum values, do not add the rule.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ruleObject</span><span class="p">)</span>
        <span class="n">ruleElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ruleObject</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ruleElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ruleObject</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">conditions</span> <span class="ow">in</span> <span class="n">ruleObject</span><span class="o">.</span><span class="n">conditionSets</span><span class="p">:</span>
            <span class="n">conditionsetElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;conditionset&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># neither is defined, don&#39;t add this condition</span>
                    <span class="k">continue</span>
                <span class="n">conditionElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span>
                <span class="n">conditionElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">conditionElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">conditionElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">))</span>
                <span class="n">conditionsetElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conditionElement</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditionsetElement</span><span class="p">):</span>
                <span class="n">ruleElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conditionsetElement</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">ruleObject</span><span class="o">.</span><span class="n">subs</span><span class="p">:</span>
            <span class="n">subElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">)</span>
            <span class="n">subElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">subElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;with&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ruleElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ruleElement</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.rules&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ruleElement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_addAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisObject</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axisObject</span><span class="p">)</span>
        <span class="n">axisElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">)</span>
        <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axisObject</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axisObject</span><span class="o">.</span><span class="n">name</span>
        <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">axisObject</span><span class="o">.</span><span class="n">minimum</span><span class="p">)</span>
        <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">axisObject</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
        <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">axisObject</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axisObject</span><span class="o">.</span><span class="n">hidden</span><span class="p">:</span>
            <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hidden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
        <span class="k">for</span> <span class="n">languageCode</span><span class="p">,</span> <span class="n">labelName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">axisObject</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">languageElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;labelname&#39;</span><span class="p">)</span>
            <span class="n">languageElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">XML_LANG</span><span class="p">]</span> <span class="o">=</span> <span class="n">languageCode</span>
            <span class="n">languageElement</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">labelName</span>
            <span class="n">axisElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">languageElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axisObject</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">inputValue</span><span class="p">,</span> <span class="n">outputValue</span> <span class="ow">in</span> <span class="n">axisObject</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
                <span class="n">mapElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">)</span>
                <span class="n">mapElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">inputValue</span><span class="p">)</span>
                <span class="n">mapElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intOrFloat</span><span class="p">(</span><span class="n">outputValue</span><span class="p">)</span>
                <span class="n">axisElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapElement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.axes&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axisElement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_addInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">):</span>
        <span class="n">instanceElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">familyName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;familyname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">familyName</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;stylename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleName</span>
        <span class="c1"># add localisations</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedStyleName</span><span class="p">:</span>
            <span class="n">languageCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedStyleName</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">languageCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">languageCodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># already stored in the element attribute</span>
                <span class="n">localisedStyleNameElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;stylename&#39;</span><span class="p">)</span>
                <span class="n">localisedStyleNameElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">XML_LANG</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
                <span class="n">localisedStyleNameElement</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">getStyleName</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localisedStyleNameElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedFamilyName</span><span class="p">:</span>
            <span class="n">languageCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedFamilyName</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">languageCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">languageCodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># already stored in the element attribute</span>
                <span class="n">localisedFamilyNameElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;familyname&#39;</span><span class="p">)</span>
                <span class="n">localisedFamilyNameElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">XML_LANG</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
                <span class="n">localisedFamilyNameElement</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">getFamilyName</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localisedFamilyNameElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedStyleMapStyleName</span><span class="p">:</span>
            <span class="n">languageCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedStyleMapStyleName</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">languageCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">languageCodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">localisedStyleMapStyleNameElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;stylemapstylename&#39;</span><span class="p">)</span>
                <span class="n">localisedStyleMapStyleNameElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">XML_LANG</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
                <span class="n">localisedStyleMapStyleNameElement</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">getStyleMapStyleName</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localisedStyleMapStyleNameElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedStyleMapFamilyName</span><span class="p">:</span>
            <span class="n">languageCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">localisedStyleMapFamilyName</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">languageCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">languageCodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">localisedStyleMapFamilyNameElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;stylemapfamilyname&#39;</span><span class="p">)</span>
                <span class="n">localisedStyleMapFamilyNameElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">XML_LANG</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
                <span class="n">localisedStyleMapFamilyNameElement</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">getStyleMapFamilyName</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localisedStyleMapFamilyNameElement</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">locationElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeLocationElement</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locationElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">postScriptFontName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;postscriptfontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">postScriptFontName</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleMapFamilyName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;stylemapfamilyname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleMapFamilyName</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleMapStyleName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;stylemapstylename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleMapStyleName</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">glyphs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.glyphs&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">glyphsElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;glyphs&#39;</span><span class="p">)</span>
                <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphsElement</span><span class="p">)</span>
            <span class="n">glyphsElement</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.glyphs&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">glyphElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writeGlyphElement</span><span class="p">(</span><span class="n">instanceElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">glyphsElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">kerning</span><span class="p">:</span>
            <span class="n">kerningElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;kerning&#39;</span><span class="p">)</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kerningElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
            <span class="n">infoElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infoElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceObject</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="n">libElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">)</span>
            <span class="n">libElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plistlib</span><span class="o">.</span><span class="n">totree</span><span class="p">(</span><span class="n">instanceObject</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span> <span class="n">indent_level</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">instanceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">libElement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.instances&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instanceElement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_addSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceObject</span><span class="p">):</span>
        <span class="n">sourceElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;temp_master&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># do not save temporary source names</span>
                <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">familyName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;familyname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">familyName</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">styleName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;stylename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">styleName</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">layerName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">layerName</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyLib</span><span class="p">:</span>
            <span class="n">libElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">)</span>
            <span class="n">libElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">libElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyGroups</span><span class="p">:</span>
            <span class="n">groupsElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">)</span>
            <span class="n">groupsElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupsElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyFeatures</span><span class="p">:</span>
            <span class="n">featuresElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">)</span>
            <span class="n">featuresElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featuresElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyInfo</span> <span class="ow">or</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">muteInfo</span><span class="p">:</span>
            <span class="n">infoElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">:</span>
                <span class="n">infoElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
            <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">muteInfo</span><span class="p">:</span>
                <span class="n">infoElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;mute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infoElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">muteKerning</span><span class="p">:</span>
            <span class="n">kerningElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;kerning&quot;</span><span class="p">)</span>
            <span class="n">kerningElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;mute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kerningElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">mutedGlyphNames</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">mutedGlyphNames</span><span class="p">:</span>
                <span class="n">glyphElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;glyph&quot;</span><span class="p">)</span>
                <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;mute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
                <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphElement</span><span class="p">)</span>
        <span class="n">locationElement</span><span class="p">,</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeLocationElement</span><span class="p">(</span><span class="n">sourceObject</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="n">sourceElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locationElement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.sources&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sourceElement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_addLib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">libElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">)</span>
        <span class="n">libElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plistlib</span><span class="o">.</span><span class="n">totree</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">indent_level</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">libElement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_writeGlyphElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">glyphElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;glyph&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mute&#39;</span><span class="p">):</span>
            <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;mute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unicodes&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;unicode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">hex</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unicodes&#39;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instanceLocation&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">locationElement</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;instanceLocation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeLocationElement</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instanceLocation&#39;</span><span class="p">))</span>
            <span class="n">glyphElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locationElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glyphName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glyphName</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;note&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">noteElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;note&#39;</span><span class="p">)</span>
            <span class="n">noteElement</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;note&#39;</span><span class="p">)</span>
            <span class="n">glyphElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">noteElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;masters&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mastersElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;masters&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;masters&#39;</span><span class="p">):</span>
                <span class="n">masterElement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;master&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;glyphName&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">masterElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;glyphname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;glyphName&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">masterElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">locationElement</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeLocationElement</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">))</span>
                    <span class="n">masterElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locationElement</span><span class="p">)</span>
                <span class="n">mastersElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masterElement</span><span class="p">)</span>
            <span class="n">glyphElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mastersElement</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">glyphElement</span></div>


<div class="viewcode-block" id="BaseDocReader"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader">[docs]</a><span class="k">class</span> <span class="nc">BaseDocReader</span><span class="p">(</span><span class="n">LogMixin</span><span class="p">):</span>
    <span class="n">ruleDescriptorClass</span> <span class="o">=</span> <span class="n">RuleDescriptor</span>
    <span class="n">axisDescriptorClass</span> <span class="o">=</span> <span class="n">AxisDescriptor</span>
    <span class="n">sourceDescriptorClass</span> <span class="o">=</span> <span class="n">SourceDescriptor</span>
    <span class="n">instanceDescriptorClass</span> <span class="o">=</span> <span class="n">InstanceDescriptor</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documentPath</span><span class="p">,</span> <span class="n">documentObject</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">documentPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span> <span class="o">=</span> <span class="n">documentObject</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axisDefaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_strictAxisNames</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="BaseDocReader.fromstring"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.fromstring">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">documentObject</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">tobytes</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">documentObject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="BaseDocReader.read"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readAxes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readRules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readSources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readInstances</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readLib</span><span class="p">()</span></div>

<div class="viewcode-block" id="BaseDocReader.readRules"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readRules">[docs]</a>    <span class="k">def</span> <span class="nf">readRules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we also need to read any conditions that are outside of a condition set.</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rulesElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.rules&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rulesElement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">processingValue</span> <span class="o">=</span> <span class="n">rulesElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;processing&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">processingValue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">}:</span>
                <span class="k">raise</span> <span class="n">DesignSpaceDocumentError</span><span class="p">(</span>
                    <span class="s2">&quot;&lt;rules&gt; processing attribute value is not valid: </span><span class="si">%r</span><span class="s2">, &quot;</span>
                    <span class="s2">&quot;expected &#39;first&#39; or &#39;last&#39;&quot;</span> <span class="o">%</span> <span class="n">processingValue</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">rulesProcessingLast</span> <span class="o">=</span> <span class="n">processingValue</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span>
        <span class="k">for</span> <span class="n">ruleElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.rules/rule&quot;</span><span class="p">):</span>
            <span class="n">ruleObject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ruleDescriptorClass</span><span class="p">()</span>
            <span class="n">ruleName</span> <span class="o">=</span> <span class="n">ruleObject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ruleElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="c1"># read any stray conditions outside a condition set</span>
            <span class="n">externalConditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readConditionElements</span><span class="p">(</span>
                <span class="n">ruleElement</span><span class="p">,</span>
                <span class="n">ruleName</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">externalConditions</span><span class="p">:</span>
                <span class="n">ruleObject</span><span class="o">.</span><span class="n">conditionSets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">externalConditions</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Found stray rule conditions outside a conditionset. &quot;</span>
                    <span class="s2">&quot;Wrapped them in a new conditionset.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># read the conditionsets</span>
            <span class="k">for</span> <span class="n">conditionSetElement</span> <span class="ow">in</span> <span class="n">ruleElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.conditionset&#39;</span><span class="p">):</span>
                <span class="n">conditionSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readConditionElements</span><span class="p">(</span>
                    <span class="n">conditionSetElement</span><span class="p">,</span>
                    <span class="n">ruleName</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">conditionSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ruleObject</span><span class="o">.</span><span class="n">conditionSets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conditionSet</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">subElement</span> <span class="ow">in</span> <span class="n">ruleElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.sub&#39;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">subElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">subElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;with&#39;</span><span class="p">]</span>
                <span class="n">ruleObject</span><span class="o">.</span><span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ruleObject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span></div>

    <span class="k">def</span> <span class="nf">_readConditionElements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentElement</span><span class="p">,</span> <span class="n">ruleName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">conditionElement</span> <span class="ow">in</span> <span class="n">parentElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.condition&#39;</span><span class="p">):</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cdMin</span> <span class="o">=</span> <span class="n">conditionElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;minimum&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cdMin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdMin</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># will allow these to be None, assume axis.minimum</span>
                <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cdMax</span> <span class="o">=</span> <span class="n">conditionElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maximum&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cdMax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdMax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># will allow these to be None, assume axis.maximum</span>
                <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conditionElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="c1"># # test for things</span>
            <span class="k">if</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DesignSpaceDocumentError</span><span class="p">(</span>
                    <span class="s2">&quot;condition missing required minimum or maximum in rule&quot;</span> <span class="o">+</span>
                    <span class="p">(</span><span class="s2">&quot; &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">ruleName</span> <span class="k">if</span> <span class="n">ruleName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">cds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cds</span>

<div class="viewcode-block" id="BaseDocReader.readAxes"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readAxes">[docs]</a>    <span class="k">def</span> <span class="nf">readAxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># read the axes elements, including the warp map.</span>
        <span class="n">axisElements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.axes/axis&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axisElements</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">axisElement</span> <span class="ow">in</span> <span class="n">axisElements</span><span class="p">:</span>
            <span class="n">axisObject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisDescriptorClass</span><span class="p">()</span>
            <span class="n">axisObject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">axisObject</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;minimum&quot;</span><span class="p">))</span>
            <span class="n">axisObject</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maximum&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">axisObject</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">axisObject</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">))</span>
            <span class="n">axisObject</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">axisElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mapElement</span> <span class="ow">in</span> <span class="n">axisElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mapElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mapElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>
                <span class="n">axisObject</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">labelNameElement</span> <span class="ow">in</span> <span class="n">axisElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;labelname&#39;</span><span class="p">):</span>
                <span class="c1"># Note: elementtree reads the &quot;xml:lang&quot; attribute name as</span>
                <span class="c1"># &#39;{http://www.w3.org/XML/1998/namespace}lang&#39;</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">labelNameElement</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">XML_LANG</span><span class="p">:</span>
                        <span class="n">axisObject</span><span class="o">.</span><span class="n">labelNames</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">labelNameElement</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axisObject</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axisDefaults</span><span class="p">[</span><span class="n">axisObject</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">axisObject</span><span class="o">.</span><span class="n">default</span></div>

<div class="viewcode-block" id="BaseDocReader.readSources"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readSources">[docs]</a>    <span class="k">def</span> <span class="nf">readSources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sourceCount</span><span class="p">,</span> <span class="n">sourceElement</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.sources/source&quot;</span><span class="p">)):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sourcePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">filename</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sourcePath</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">sourceName</span> <span class="o">=</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sourceName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># add a temporary source name</span>
                <span class="n">sourceName</span> <span class="o">=</span> <span class="s2">&quot;temp_master.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sourceCount</span><span class="p">)</span>
            <span class="n">sourceObject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceDescriptorClass</span><span class="p">()</span>
            <span class="n">sourceObject</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">sourcePath</span>        <span class="c1"># absolute path to the ufo source</span>
            <span class="n">sourceObject</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>      <span class="c1"># path as it is stored in the document</span>
            <span class="n">sourceObject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sourceName</span>
            <span class="n">familyName</span> <span class="o">=</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;familyname&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">familyName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sourceObject</span><span class="o">.</span><span class="n">familyName</span> <span class="o">=</span> <span class="n">familyName</span>
            <span class="n">styleName</span> <span class="o">=</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stylename&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">styleName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sourceObject</span><span class="o">.</span><span class="n">styleName</span> <span class="o">=</span> <span class="n">styleName</span>
            <span class="n">sourceObject</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationFromElement</span><span class="p">(</span><span class="n">sourceElement</span><span class="p">)</span>
            <span class="n">layerName</span> <span class="o">=</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;layer&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sourceObject</span><span class="o">.</span><span class="n">layerName</span> <span class="o">=</span> <span class="n">layerName</span>
            <span class="k">for</span> <span class="n">libElement</span> <span class="ow">in</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.lib&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">libElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyLib</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">groupsElement</span> <span class="ow">in</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.groups&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">groupsElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyGroups</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">infoElement</span> <span class="ow">in</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.info&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">infoElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyInfo</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">infoElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mute&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">muteInfo</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">featuresElement</span> <span class="ow">in</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.features&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">featuresElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">copyFeatures</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">glyphElement</span> <span class="ow">in</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.glyph&quot;</span><span class="p">):</span>
                <span class="n">glyphName</span> <span class="o">=</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glyphName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mute&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">mutedGlyphNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kerningElement</span> <span class="ow">in</span> <span class="n">sourceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.kerning&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">kerningElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mute&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">sourceObject</span><span class="o">.</span><span class="n">muteKerning</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sourceObject</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseDocReader.locationFromElement"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.locationFromElement">[docs]</a>    <span class="k">def</span> <span class="nf">locationFromElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="n">elementLocation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">locationElement</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.location&#39;</span><span class="p">):</span>
            <span class="n">elementLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readLocationElement</span><span class="p">(</span><span class="n">locationElement</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">return</span> <span class="n">elementLocation</span></div>

<div class="viewcode-block" id="BaseDocReader.readLocationElement"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readLocationElement">[docs]</a>    <span class="k">def</span> <span class="nf">readLocationElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locationElement</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Format 0 location reader &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strictAxisNames</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DesignSpaceDocumentError</span><span class="p">(</span><span class="s2">&quot;No axes defined&quot;</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">dimensionElement</span> <span class="ow">in</span> <span class="n">locationElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.dimension&quot;</span><span class="p">):</span>
            <span class="n">dimName</span> <span class="o">=</span> <span class="n">dimensionElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strictAxisNames</span> <span class="ow">and</span> <span class="n">dimName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisDefaults</span><span class="p">:</span>
                <span class="c1"># In case the document contains no axis definitions,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Location with undefined axis: </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">dimName</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">xValue</span> <span class="o">=</span> <span class="n">yValue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xValue</span> <span class="o">=</span> <span class="n">dimensionElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xvalue&#39;</span><span class="p">)</span>
                <span class="n">xValue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xValue</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;KeyError in readLocation xValue </span><span class="si">%3.3f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xValue</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">yValue</span> <span class="o">=</span> <span class="n">dimensionElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yvalue&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">yValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">yValue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">yValue</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">yValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">loc</span><span class="p">[</span><span class="n">dimName</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xValue</span><span class="p">,</span> <span class="n">yValue</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">loc</span><span class="p">[</span><span class="n">dimName</span><span class="p">]</span> <span class="o">=</span> <span class="n">xValue</span>
        <span class="k">return</span> <span class="n">loc</span></div>

<div class="viewcode-block" id="BaseDocReader.readInstances"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readInstances">[docs]</a>    <span class="k">def</span> <span class="nf">readInstances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">makeGlyphs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">makeKerning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">makeInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">instanceElements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.instances/instance&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instanceElement</span> <span class="ow">in</span> <span class="n">instanceElements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_readSingleInstanceElement</span><span class="p">(</span><span class="n">instanceElement</span><span class="p">,</span> <span class="n">makeGlyphs</span><span class="o">=</span><span class="n">makeGlyphs</span><span class="p">,</span> <span class="n">makeKerning</span><span class="o">=</span><span class="n">makeKerning</span><span class="p">,</span> <span class="n">makeInfo</span><span class="o">=</span><span class="n">makeInfo</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_readSingleInstanceElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceElement</span><span class="p">,</span> <span class="n">makeGlyphs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">makeKerning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">makeInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instancePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instancePath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">instanceObject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instanceDescriptorClass</span><span class="p">()</span>
        <span class="n">instanceObject</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">instancePath</span>    <span class="c1"># absolute path to the instance</span>
        <span class="n">instanceObject</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>    <span class="c1"># path as it is stored in the document</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">familyname</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;familyname&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">familyname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">familyName</span> <span class="o">=</span> <span class="n">familyname</span>
        <span class="n">stylename</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stylename&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stylename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleName</span> <span class="o">=</span> <span class="n">stylename</span>
        <span class="n">postScriptFontName</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;postscriptfontname&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">postScriptFontName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">postScriptFontName</span> <span class="o">=</span> <span class="n">postScriptFontName</span>
        <span class="n">styleMapFamilyName</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stylemapfamilyname&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">styleMapFamilyName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleMapFamilyName</span> <span class="o">=</span> <span class="n">styleMapFamilyName</span>
        <span class="n">styleMapStyleName</span> <span class="o">=</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stylemapstylename&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">styleMapStyleName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">styleMapStyleName</span> <span class="o">=</span> <span class="n">styleMapStyleName</span>
        <span class="c1"># read localised names</span>
        <span class="k">for</span> <span class="n">styleNameElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;stylename&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">styleNameElement</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">XML_LANG</span><span class="p">:</span>
                    <span class="n">styleName</span> <span class="o">=</span> <span class="n">styleNameElement</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">instanceObject</span><span class="o">.</span><span class="n">setStyleName</span><span class="p">(</span><span class="n">styleName</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">familyNameElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;familyname&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">familyNameElement</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">XML_LANG</span><span class="p">:</span>
                    <span class="n">familyName</span> <span class="o">=</span> <span class="n">familyNameElement</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">instanceObject</span><span class="o">.</span><span class="n">setFamilyName</span><span class="p">(</span><span class="n">familyName</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">styleMapStyleNameElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;stylemapstylename&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">styleMapStyleNameElement</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">XML_LANG</span><span class="p">:</span>
                    <span class="n">styleMapStyleName</span> <span class="o">=</span> <span class="n">styleMapStyleNameElement</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">instanceObject</span><span class="o">.</span><span class="n">setStyleMapStyleName</span><span class="p">(</span><span class="n">styleMapStyleName</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">styleMapFamilyNameElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;stylemapfamilyname&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">styleMapFamilyNameElement</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">XML_LANG</span><span class="p">:</span>
                    <span class="n">styleMapFamilyName</span> <span class="o">=</span> <span class="n">styleMapFamilyNameElement</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">instanceObject</span><span class="o">.</span><span class="n">setStyleMapFamilyName</span><span class="p">(</span><span class="n">styleMapFamilyName</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
        <span class="n">instanceLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationFromElement</span><span class="p">(</span><span class="n">instanceElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceLocation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instanceObject</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">instanceLocation</span>
        <span class="k">for</span> <span class="n">glyphElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.glyphs/glyph&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readGlyphElement</span><span class="p">(</span><span class="n">glyphElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">infoElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readInfoElement</span><span class="p">(</span><span class="n">infoElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">libElement</span> <span class="ow">in</span> <span class="n">instanceElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readLibElement</span><span class="p">(</span><span class="n">libElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instanceObject</span><span class="p">)</span>

<div class="viewcode-block" id="BaseDocReader.readLibElement"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readLibElement">[docs]</a>    <span class="k">def</span> <span class="nf">readLibElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the lib element for the given instance.&quot;&quot;&quot;</span>
        <span class="n">instanceObject</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">fromtree</span><span class="p">(</span><span class="n">libElement</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="BaseDocReader.readInfoElement"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readInfoElement">[docs]</a>    <span class="k">def</span> <span class="nf">readInfoElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infoElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the info element.&quot;&quot;&quot;</span>
        <span class="n">instanceObject</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="BaseDocReader.readKerningElement"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readKerningElement">[docs]</a>    <span class="k">def</span> <span class="nf">readKerningElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kerningElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the kerning element.&quot;&quot;&quot;</span>
        <span class="n">kerningLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationFromElement</span><span class="p">(</span><span class="n">kerningElement</span><span class="p">)</span>
        <span class="n">instanceObject</span><span class="o">.</span><span class="n">addKerning</span><span class="p">(</span><span class="n">kerningLocation</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseDocReader.readGlyphElement"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readGlyphElement">[docs]</a>    <span class="k">def</span> <span class="nf">readGlyphElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphElement</span><span class="p">,</span> <span class="n">instanceObject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the glyph element.</span>
<span class="sd">            &lt;glyph name=&quot;b&quot; unicode=&quot;0x62&quot;/&gt;</span>
<span class="sd">            &lt;glyph name=&quot;b&quot;/&gt;</span>
<span class="sd">            &lt;glyph name=&quot;b&quot;&gt;</span>
<span class="sd">                &lt;master location=&quot;location-token-bbb&quot; source=&quot;master-token-aaa2&quot;/&gt;</span>
<span class="sd">                &lt;master glyphname=&quot;b.alt1&quot; location=&quot;location-token-ccc&quot; source=&quot;master-token-aaa3&quot;/&gt;</span>
<span class="sd">                &lt;note&gt;</span>
<span class="sd">                    This is an instance from an anisotropic interpolation.</span>
<span class="sd">                &lt;/note&gt;</span>
<span class="sd">            &lt;/glyph&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">glyphData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">glyphName</span> <span class="o">=</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glyphName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DesignSpaceDocumentError</span><span class="p">(</span><span class="s2">&quot;Glyph object without name attribute&quot;</span><span class="p">)</span>
        <span class="n">mute</span> <span class="o">=</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mute&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mute</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;mute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># unicode</span>
        <span class="n">unicodes</span> <span class="o">=</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unicodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">unicodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">unicodes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)]</span>
                <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;unicodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unicodes</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DesignSpaceDocumentError</span><span class="p">(</span><span class="s2">&quot;unicode values </span><span class="si">%s</span><span class="s2"> are not integers&quot;</span> <span class="o">%</span> <span class="n">unicodes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">noteElement</span> <span class="ow">in</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.note&#39;</span><span class="p">):</span>
            <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;note&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noteElement</span><span class="o">.</span><span class="n">text</span>
            <span class="k">break</span>
        <span class="n">instanceLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationFromElement</span><span class="p">(</span><span class="n">glyphElement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instanceLocation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;instanceLocation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instanceLocation</span>
        <span class="n">glyphSources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">masterElement</span> <span class="ow">in</span> <span class="n">glyphElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.masters/master&#39;</span><span class="p">):</span>
            <span class="n">fontSourceName</span> <span class="o">=</span> <span class="n">masterElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">)</span>
            <span class="n">sourceLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationFromElement</span><span class="p">(</span><span class="n">masterElement</span><span class="p">)</span>
            <span class="n">masterGlyphName</span> <span class="o">=</span> <span class="n">masterElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;glyphname&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">masterGlyphName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># if we don&#39;t read a glyphname, use the one we have</span>
                <span class="n">masterGlyphName</span> <span class="o">=</span> <span class="n">glyphName</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">fontSourceName</span><span class="p">,</span>
                     <span class="n">location</span><span class="o">=</span><span class="n">sourceLocation</span><span class="p">,</span>
                     <span class="n">glyphName</span><span class="o">=</span><span class="n">masterGlyphName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glyphSources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">glyphSources</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">glyphSources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glyphSources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;masters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glyphSources</span>
        <span class="n">instanceObject</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">glyphData</span></div>

<div class="viewcode-block" id="BaseDocReader.readLib"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.BaseDocReader.readLib">[docs]</a>    <span class="k">def</span> <span class="nf">readLib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the lib element for the whole document.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">libElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.lib&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">documentObject</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">fromtree</span><span class="p">(</span><span class="n">libElement</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="DesignSpaceDocument"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument">[docs]</a><span class="k">class</span> <span class="nc">DesignSpaceDocument</span><span class="p">(</span><span class="n">LogMixin</span><span class="p">,</span> <span class="n">AsDictMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read, write data from the designspace file&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;String, optional. When the document is read from the disk, this is</span>
<span class="sd">        its original file name, i.e. the last part of its path.</span>

<span class="sd">        When the document is produced by a Python script and still only exists</span>
<span class="sd">        in memory, the producing script can write here an indication of a</span>
<span class="sd">        possible &quot;good&quot; filename, in case one wants to save the file somewhere.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rulesProcessingLast</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>         <span class="c1"># name of the default master</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Custom data associated with the whole document.&quot;&quot;&quot;</span>

        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">readerClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readerClass</span> <span class="o">=</span> <span class="n">readerClass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readerClass</span> <span class="o">=</span> <span class="n">BaseDocReader</span>
        <span class="k">if</span> <span class="n">writerClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span> <span class="o">=</span> <span class="n">writerClass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span> <span class="o">=</span> <span class="n">BaseDocWriter</span>

<div class="viewcode-block" id="DesignSpaceDocument.fromfile"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.fromfile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">readerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">readerClass</span><span class="o">=</span><span class="n">readerClass</span><span class="p">,</span> <span class="n">writerClass</span><span class="o">=</span><span class="n">writerClass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.fromstring"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.fromstring">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">readerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">readerClass</span><span class="o">=</span><span class="n">readerClass</span><span class="p">,</span> <span class="n">writerClass</span><span class="o">=</span><span class="n">writerClass</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readerClass</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findDefault</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.tostring"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.tostring">[docs]</a>    <span class="k">def</span> <span class="nf">tostring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="n">unicode</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">encoding</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;unicode&quot;</span>
        <span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">UnicodeIO</span><span class="p">()</span>
            <span class="n">xml_declaration</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span>
            <span class="n">xml_declaration</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unsupported encoding: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="n">xml_declaration</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.read"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;__fspath__&quot;</span><span class="p">):</span>  <span class="c1"># support os.PathLike objects</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">__fspath__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readerClass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findDefault</span><span class="p">()</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.write"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;__fspath__&quot;</span><span class="p">):</span>  <span class="c1"># support os.PathLike objects</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">__fspath__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePaths</span><span class="p">()</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_posixRelativePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherPath</span><span class="p">):</span>
        <span class="n">relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">otherPath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">posix</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span>

<div class="viewcode-block" id="DesignSpaceDocument.updatePaths"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.updatePaths">[docs]</a>    <span class="k">def</span> <span class="nf">updatePaths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Right before we save we need to identify and respond to the following situations:</span>
<span class="sd">            In each descriptor, we have to do the right thing for the filename attribute.</span>

<span class="sd">            case 1.</span>
<span class="sd">            descriptor.filename == None</span>
<span class="sd">            descriptor.path == None</span>

<span class="sd">            -- action:</span>
<span class="sd">            write as is, descriptors will not have a filename attr.</span>
<span class="sd">            useless, but no reason to interfere.</span>


<span class="sd">            case 2.</span>
<span class="sd">            descriptor.filename == &quot;../something&quot;</span>
<span class="sd">            descriptor.path == None</span>

<span class="sd">            -- action:</span>
<span class="sd">            write as is. The filename attr should not be touched.</span>


<span class="sd">            case 3.</span>
<span class="sd">            descriptor.filename == None</span>
<span class="sd">            descriptor.path == &quot;~/absolute/path/there&quot;</span>

<span class="sd">            -- action:</span>
<span class="sd">            calculate the relative path for filename.</span>
<span class="sd">            We&#39;re not overwriting some other value for filename, it should be fine</span>


<span class="sd">            case 4.</span>
<span class="sd">            descriptor.filename == &#39;../somewhere&#39;</span>
<span class="sd">            descriptor.path == &quot;~/absolute/path/there&quot;</span>

<span class="sd">            -- action:</span>
<span class="sd">            there is a conflict between the given filename, and the path.</span>
<span class="sd">            So we know where the file is relative to the document.</span>
<span class="sd">            Can&#39;t guess why they&#39;re different, we just choose for path to be correct and update filename.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">descriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># case 3 and 4: filename gets updated and relativized</span>
                <span class="n">descriptor</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posixRelativePath</span><span class="p">(</span><span class="n">descriptor</span><span class="o">.</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addSource"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addSource">[docs]</a>    <span class="k">def</span> <span class="nf">addSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceDescriptor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sourceDescriptor</span><span class="p">)</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addSourceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addSourceDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">addSourceDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">sourceDescriptorClass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addSource</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">source</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addInstance"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addInstance">[docs]</a>    <span class="k">def</span> <span class="nf">addInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceDescriptor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instanceDescriptor</span><span class="p">)</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addInstanceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addInstanceDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">addInstanceDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">instanceDescriptorClass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addAxis"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addAxis">[docs]</a>    <span class="k">def</span> <span class="nf">addAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisDescriptor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axisDescriptor</span><span class="p">)</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addAxisDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addAxisDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">addAxisDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">axisDescriptorClass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axis</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addRule"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addRule">[docs]</a>    <span class="k">def</span> <span class="nf">addRule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ruleDescriptor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ruleDescriptor</span><span class="p">)</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.addRuleDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.addRuleDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">addRuleDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">ruleDescriptorClass</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.newDefaultLocation"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.newDefaultLocation">[docs]</a>    <span class="k">def</span> <span class="nf">newDefaultLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return default location in design space.&quot;&quot;&quot;</span>
        <span class="c1"># Without OrderedDict, output XML would be non-deterministic.</span>
        <span class="c1"># https://github.com/LettError/designSpaceDocument/issues/10</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">axisDescriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">loc</span><span class="p">[</span><span class="n">axisDescriptor</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">axisDescriptor</span><span class="o">.</span><span class="n">map_forward</span><span class="p">(</span>
                <span class="n">axisDescriptor</span><span class="o">.</span><span class="n">default</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">loc</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.updateFilenameFromPath"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.updateFilenameFromPath">[docs]</a>    <span class="k">def</span> <span class="nf">updateFilenameFromPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">masters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">instances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># set a descriptor filename attr from the path and this document path</span>
        <span class="c1"># if the filename attribute is not None: skip it.</span>
        <span class="k">if</span> <span class="n">masters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">descriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">descriptor</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posixRelativePath</span><span class="p">(</span><span class="n">descriptor</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instances</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">descriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">descriptor</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posixRelativePath</span><span class="p">(</span><span class="n">descriptor</span><span class="o">.</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.newAxisDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.newAxisDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">newAxisDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Ask the writer class to make us a new axisDescriptor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">getAxisDecriptor</span><span class="p">()</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.newSourceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.newSourceDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">newSourceDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Ask the writer class to make us a new sourceDescriptor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">getSourceDescriptor</span><span class="p">()</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.newInstanceDescriptor"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.newInstanceDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">newInstanceDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Ask the writer class to make us a new instanceDescriptor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerClass</span><span class="o">.</span><span class="n">getInstanceDescriptor</span><span class="p">()</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.getAxisOrder"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.getAxisOrder">[docs]</a>    <span class="k">def</span> <span class="nf">getAxisOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">axisDescriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axisDescriptor</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.getAxis"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.getAxis">[docs]</a>    <span class="k">def</span> <span class="nf">getAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">axisDescriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">axisDescriptor</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">axisDescriptor</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.findDefault"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.findDefault">[docs]</a>    <span class="k">def</span> <span class="nf">findDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set and return SourceDescriptor at the default location or None.</span>

<span class="sd">        The default location is the set of all `default` values in user space</span>
<span class="sd">        of all axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Convert the default location from user space to design space before comparing</span>
        <span class="c1"># it against the SourceDescriptor locations (always in design space).</span>
        <span class="n">default_location_design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newDefaultLocation</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">sourceDescriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sourceDescriptor</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="n">default_location_design</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">sourceDescriptor</span>
                <span class="k">return</span> <span class="n">sourceDescriptor</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.normalizeLocation"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.normalizeLocation">[docs]</a>    <span class="k">def</span> <span class="nf">normalizeLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">fontTools.varLib.models</span> <span class="k">import</span> <span class="n">normalizeValue</span>

        <span class="n">new</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">location</span><span class="p">:</span>
                <span class="c1"># skipping this dimension it seems</span>
                <span class="k">continue</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># &#39;anisotropic&#39; location, take first coord only</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">triple</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">map_forward</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">new</span><span class="p">[</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizeValue</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">triple</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.normalize"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Normalise the geometry of this designspace:</span>
        <span class="c1">#   scale all the locations of all masters and instances to the -1 - 0 - 1 value.</span>
        <span class="c1">#   we need the axis data to do the scaling, so we do those last.</span>
        <span class="c1"># masters</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="c1"># instances</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="c1"># glyph masters for this instance</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">glyphData</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;instanceLocation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">(</span><span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;instanceLocation&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">glyphMaster</span> <span class="ow">in</span> <span class="n">glyphData</span><span class="p">[</span><span class="s1">&#39;masters&#39;</span><span class="p">]:</span>
                    <span class="n">glyphMaster</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">(</span><span class="n">glyphMaster</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">])</span>
            <span class="n">item</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="c1"># the axes</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="c1"># scale the map first</span>
            <span class="n">newMap</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inputValue</span><span class="p">,</span> <span class="n">outputValue</span> <span class="ow">in</span> <span class="n">axis</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
                <span class="n">newOutputValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">({</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">outputValue</span><span class="p">})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">newMap</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">inputValue</span><span class="p">,</span> <span class="n">newOutputValue</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">newMap</span><span class="p">:</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">newMap</span>
            <span class="c1"># finally the axis values</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">({</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">axis</span><span class="o">.</span><span class="n">minimum</span><span class="p">})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">({</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">axis</span><span class="o">.</span><span class="n">maximum</span><span class="p">})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">({</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">axis</span><span class="o">.</span><span class="n">default</span><span class="p">})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># and set them in the axis.minimum</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="c1"># now the rules</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="n">newConditionSets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">conditions</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">conditionSets</span><span class="p">:</span>
                <span class="n">newConditions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">minimum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">({</span><span class="n">cond</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">cond</span><span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cond</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">minimum</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">cond</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">maximum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeLocation</span><span class="p">({</span><span class="n">cond</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">cond</span><span class="p">[</span><span class="s1">&#39;maximum&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cond</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">maximum</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">newConditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cond</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">minimum</span><span class="o">=</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">maximum</span><span class="p">))</span>
                <span class="n">newConditionSets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newConditions</span><span class="p">)</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">conditionSets</span> <span class="o">=</span> <span class="n">newConditionSets</span></div>

<div class="viewcode-block" id="DesignSpaceDocument.loadSourceFonts"><a class="viewcode-back" href="../../designspaceLib/index.html#fontTools.designspaceLib.DesignSpaceDocument.loadSourceFonts">[docs]</a>    <span class="k">def</span> <span class="nf">loadSourceFonts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opener</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure SourceDescriptor.font attributes are loaded, and return list of fonts.</span>

<span class="sd">        Takes a callable which initializes a new font object (e.g. TTFont, or</span>
<span class="sd">        defcon.Font, etc.) from the SourceDescriptor.path, and sets the</span>
<span class="sd">        SourceDescriptor.font attribute.</span>
<span class="sd">        If the font attribute is already not None, it is not loaded again.</span>
<span class="sd">        Fonts with the same path are only loaded once and shared among SourceDescriptors.</span>

<span class="sd">        For example, to load UFO sources using defcon:</span>

<span class="sd">            designspace = DesignSpaceDocument.fromfile(&quot;path/to/my.designspace&quot;)</span>
<span class="sd">            designspace.loadSourceFonts(defcon.Font)</span>

<span class="sd">        Or to load masters as FontTools binary fonts, including extra options:</span>

<span class="sd">            designspace.loadSourceFonts(ttLib.TTFont, recalcBBoxes=False)</span>

<span class="sd">        Args:</span>
<span class="sd">            opener (Callable): takes one required positional argument, the source.path,</span>
<span class="sd">                and an optional list of keyword arguments, and returns a new font object</span>
<span class="sd">                loaded from the path.</span>
<span class="sd">            **kwargs: extra options passed on to the opener function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of font objects in the order they appear in the sources list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we load fonts with the same source.path only once</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fonts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># font already loaded</span>
                <span class="n">fonts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">path</span> <span class="ow">in</span> <span class="n">loaded</span><span class="p">:</span>
                <span class="n">source</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">loaded</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DesignSpaceDocumentError</span><span class="p">(</span>
                        <span class="s2">&quot;Designspace source &#39;</span><span class="si">%s</span><span class="s2">&#39; has no &#39;path&#39; attribute&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&lt;Unknown&gt;&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">source</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">opener</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">loaded</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">font</span>
            <span class="n">fonts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fonts</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>