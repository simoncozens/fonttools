

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.feaLib.builder &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>fontTools.feaLib.builder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.feaLib.builder</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">sstruct</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.textTools</span> <span class="k">import</span> <span class="n">binary2num</span><span class="p">,</span> <span class="n">safeEval</span>
<span class="kn">from</span> <span class="nn">fontTools.feaLib.error</span> <span class="k">import</span> <span class="n">FeatureLibError</span>
<span class="kn">from</span> <span class="nn">fontTools.feaLib.parser</span> <span class="k">import</span> <span class="n">Parser</span>
<span class="kn">from</span> <span class="nn">fontTools.feaLib.ast</span> <span class="k">import</span> <span class="n">FeatureFile</span>
<span class="kn">from</span> <span class="nn">fontTools.otlLib</span> <span class="k">import</span> <span class="n">builder</span> <span class="k">as</span> <span class="n">otl</span>
<span class="kn">from</span> <span class="nn">fontTools.otlLib.maxContextCalc</span> <span class="k">import</span> <span class="n">maxCtxFont</span>
<span class="kn">from</span> <span class="nn">fontTools.ttLib</span> <span class="k">import</span> <span class="n">newTable</span><span class="p">,</span> <span class="n">getTableModule</span>
<span class="kn">from</span> <span class="nn">fontTools.ttLib.tables</span> <span class="k">import</span> <span class="n">otBase</span><span class="p">,</span> <span class="n">otTables</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="addOpenTypeFeatures"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.addOpenTypeFeatures">[docs]</a><span class="k">def</span> <span class="nf">addOpenTypeFeatures</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">featurefile</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">Builder</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">featurefile</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="n">tables</span><span class="p">)</span></div>


<div class="viewcode-block" id="addOpenTypeFeaturesFromString"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.addOpenTypeFeaturesFromString">[docs]</a><span class="k">def</span> <span class="nf">addOpenTypeFeaturesFromString</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">featurefile</span> <span class="o">=</span> <span class="n">UnicodeIO</span><span class="p">(</span><span class="n">tounicode</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="c1"># the directory containing &#39;filename&#39; is used as the root of relative</span>
        <span class="c1"># include paths; if None is provided, the current directory is assumed</span>
        <span class="n">featurefile</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="n">addOpenTypeFeatures</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">featurefile</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">tables</span><span class="p">)</span></div>


<div class="viewcode-block" id="Builder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder">[docs]</a><span class="k">class</span> <span class="nc">Builder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">supportedTables</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">Tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;BASE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GDEF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GPOS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GSUB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OS/2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;head&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hhea&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vhea&quot;</span><span class="p">,</span>
    <span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">featurefile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span>
        <span class="c1"># &#39;featurefile&#39; can be either a path or file object (in which case we</span>
        <span class="c1"># parse it into an AST), or a pre-parsed AST instance</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featurefile</span><span class="p">,</span> <span class="n">FeatureFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseTree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">featurefile</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseTree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">featurefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_language_systems_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seen_non_DFLT_script_</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (&#39;latn&#39;, &#39;DEU &#39;, &#39;smcp&#39;) --&gt; [LookupBuilder*]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required_features_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (&#39;latn&#39;, &#39;DEU &#39;) --&gt; &#39;scmp&#39;</span>
        <span class="c1"># for feature &#39;aalt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aalt_features_</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [(location, featureName)*], for &#39;aalt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aalt_location_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aalt_alternates_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># for &#39;featureNames&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># for &#39;cvParameters&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_num_named_params_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_characters_</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="c1"># for feature &#39;size&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size_parameters_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># for table &#39;head&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontRevision_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># 2.71</span>
        <span class="c1"># for table &#39;name&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># for table &#39;BASE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_horiz_axis_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_vert_axis_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># for table &#39;GDEF&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attachPoints_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &quot;a&quot; --&gt; {3, 7}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretCoords_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &quot;f_f_i&quot; --&gt; {300, 600}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretPoints_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &quot;f_f_i&quot; --&gt; {3, 7}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphClassDefs_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &quot;fi&quot; --&gt; (2, (file, line, column))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markAttach_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &quot;acute&quot; --&gt; (4, (file, line, column))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markAttachClassID_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># frozenset({&quot;acute&quot;, &quot;grave&quot;}) --&gt; 4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markFilterSets_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># frozenset({&quot;acute&quot;, &quot;grave&quot;}) --&gt; 4</span>
        <span class="c1"># for table &#39;OS/2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># for table &#39;hhea&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># for table &#39;vhea&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Builder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseTree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseTree</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parseTree</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># by default, build all the supported tables</span>
        <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supportedTables</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
            <span class="n">unsupported</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">supportedTables</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">unsupported</span><span class="p">,</span> <span class="n">unsupported</span>
        <span class="k">if</span> <span class="s2">&quot;GSUB&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_feature_aalt_</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;head&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_head</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;hhea&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_hhea</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;vhea&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_vhea</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;OS/2&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_OS_2</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeTable</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">ScriptList</span><span class="o">.</span><span class="n">ScriptCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span><span class="o">.</span><span class="n">FeatureCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">LookupCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">fontTable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">fontTable</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;GPOS&quot;</span><span class="p">,</span> <span class="s2">&quot;GSUB&quot;</span><span class="p">))</span> <span class="ow">and</span>
                <span class="s2">&quot;OS/2&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;OS/2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">usMaxContext</span> <span class="o">=</span> <span class="n">maxCtxFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;GDEF&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">gdef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildGDEF</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">gdef</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;GDEF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdef</span>
            <span class="k">elif</span> <span class="s2">&quot;GDEF&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;GDEF&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;BASE&quot;</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildBASE</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">base</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;BASE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span>
            <span class="k">elif</span> <span class="s2">&quot;BASE&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;BASE&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Builder.get_chained_lookup_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.get_chained_lookup_">[docs]</a>    <span class="k">def</span> <span class="nf">get_chained_lookup_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">builder_class</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">builder_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">lookupflag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span>
        <span class="n">result</span><span class="o">.</span><span class="n">markFilterSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Builder.add_lookup_to_feature_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_lookup_to_feature_">[docs]</a>    <span class="k">def</span> <span class="nf">add_lookup_to_feature_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookup</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">script</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.get_lookup_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.get_lookup_">[docs]</a>    <span class="k">def</span> <span class="nf">get_lookup_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">builder_class</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="ow">and</span>
            <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="p">)</span> <span class="o">==</span> <span class="n">builder_class</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="o">.</span><span class="n">lookupflag</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="o">.</span><span class="n">markFilterSet</span> <span class="o">==</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Within a named lookup block, all rules must be of &quot;</span>
                <span class="s2">&quot;the same lookup type and flag&quot;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="n">builder_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="o">.</span><span class="n">lookupflag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="o">.</span><span class="n">markFilterSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span><span class="p">:</span>
            <span class="c1"># We are starting a lookup rule inside a named lookup block.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">:</span>
            <span class="c1"># We are starting a lookup rule inside a feature. This includes</span>
            <span class="c1"># lookup rules inside named lookups inside features.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_lookup_to_feature_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span></div>

<div class="viewcode-block" id="Builder.build_feature_aalt_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_feature_aalt_">[docs]</a>    <span class="k">def</span> <span class="nf">build_feature_aalt_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">aalt_features_</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">aalt_alternates_</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">alternates</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aalt_alternates_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aalt_features_</span> <span class="o">+</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;aalt&quot;</span><span class="p">)]:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="p">[(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">lookups</span><span class="p">)</span>
                       <span class="k">for</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature</span><span class="p">),</span> <span class="n">lookups</span>
                       <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                       <span class="k">if</span> <span class="n">feature</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
            <span class="c1"># &quot;aalt&quot; does not have to specify its own lookups, but it might.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">feature</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;aalt&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span><span class="s2">&quot;Feature </span><span class="si">%s</span><span class="s2"> has not been defined&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                      <span class="n">location</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">lookups</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="n">lookups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">alts</span> <span class="ow">in</span> <span class="n">lookup</span><span class="o">.</span><span class="n">getAlternateGlyphs</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">alternates</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">alts</span><span class="p">)</span>
        <span class="n">single</span> <span class="o">=</span> <span class="p">{</span><span class="n">glyph</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">repl</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="n">alternates</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">}</span>
        <span class="c1"># TODO: Figure out the glyph alternate ordering used by makeotf.</span>
        <span class="c1"># https://github.com/fonttools/fonttools/issues/836</span>
        <span class="n">multi</span> <span class="o">=</span> <span class="p">{</span><span class="n">glyph</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="n">alternates</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">single</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">multi</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_</span> <span class="o">=</span> <span class="p">{(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span> <span class="n">lookups</span>
                          <span class="k">for</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature</span><span class="p">),</span> <span class="n">lookups</span>
                          <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                          <span class="k">if</span> <span class="n">feature</span> <span class="o">!=</span> <span class="s2">&quot;aalt&quot;</span><span class="p">}</span>
        <span class="n">old_lookups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_feature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aalt_location_</span><span class="p">,</span> <span class="s2">&quot;aalt&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
            <span class="n">single_lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">SingleSubstBuilder</span><span class="p">)</span>
            <span class="n">single_lookup</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">single</span>
        <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
            <span class="n">multi_lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">AlternateSubstBuilder</span><span class="p">)</span>
            <span class="n">multi_lookup</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="n">multi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_feature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">old_lookups</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.build_head"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_head">[docs]</a>    <span class="k">def</span> <span class="nf">build_head</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontRevision_</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>  <span class="c1"># this only happens for unit tests</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">54</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">tableVersion</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">table</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="mi">3406620153</span>  <span class="c1"># 2011-12-13 11:22:33</span>
        <span class="n">table</span><span class="o">.</span><span class="n">fontRevision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontRevision_</span></div>

<div class="viewcode-block" id="Builder.build_hhea"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_hhea">[docs]</a>    <span class="k">def</span> <span class="nf">build_hhea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hhea&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>  <span class="c1"># this only happens for unit tests</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;hhea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;hhea&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">36</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">tableVersion</span> <span class="o">=</span> <span class="mh">0x00010000</span>
        <span class="k">if</span> <span class="s2">&quot;caretoffset&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">caretOffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">[</span><span class="s2">&quot;caretoffset&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;ascender&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">ascent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">[</span><span class="s2">&quot;ascender&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;descender&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">descent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">[</span><span class="s2">&quot;descender&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;linegap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">lineGap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">[</span><span class="s2">&quot;linegap&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Builder.build_vhea"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_vhea">[docs]</a>    <span class="k">def</span> <span class="nf">build_vhea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vhea&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>  <span class="c1"># this only happens for unit tests</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;vhea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;vhea&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">36</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">tableVersion</span> <span class="o">=</span> <span class="mh">0x00011000</span>
        <span class="k">if</span> <span class="s2">&quot;verttypoascender&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">ascent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">[</span><span class="s2">&quot;verttypoascender&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;verttypodescender&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">descent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">[</span><span class="s2">&quot;verttypodescender&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;verttypolinegap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">lineGap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">[</span><span class="s2">&quot;verttypolinegap&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Builder.get_user_name_id"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.get_user_name_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_name_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="c1"># Try to find first unused font-specific name id</span>
        <span class="n">nameIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">nameID</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">user_name_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">32767</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">user_name_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nameIDs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">user_name_id</span></div>

<div class="viewcode-block" id="Builder.buildFeatureParams"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildFeatureParams">[docs]</a>    <span class="k">def</span> <span class="nf">buildFeatureParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">FeatureParamsSize</span><span class="p">()</span>
            <span class="n">params</span><span class="o">.</span><span class="n">DesignSize</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">SubfamilyID</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">RangeStart</span><span class="p">,</span> \
                    <span class="n">params</span><span class="o">.</span><span class="n">RangeEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_parameters_</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">SubfamilyNameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">SubfamilyNameID</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">:</span>
                <span class="c1"># name table wasn&#39;t selected among the tables to build; skip</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">FeatureParamsStylisticSet</span><span class="p">()</span>
                <span class="n">params</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">params</span><span class="o">.</span><span class="n">UINameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">FeatureParamsCharacterVariants</span><span class="p">()</span>
            <span class="n">params</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">params</span><span class="o">.</span><span class="n">FeatUILabelNameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;FeatUILabelNameID&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">FeatUITooltipTextNameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;FeatUITooltipTextNameID&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">SampleTextNameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;SampleTextNameID&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">NumNamedParameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_num_named_params_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">FirstParamUILabelNameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;ParamUILabelNameID_0&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">CharCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_characters_</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
            <span class="n">params</span><span class="o">.</span><span class="n">Character</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_characters_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Builder.build_name"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_name">[docs]</a>    <span class="k">def</span> <span class="nf">build_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>  <span class="c1"># this only happens for unit tests</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_</span><span class="p">:</span>
            <span class="n">nameID</span><span class="p">,</span> <span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">,</span> <span class="n">langID</span><span class="p">,</span> <span class="n">string</span> <span class="o">=</span> <span class="n">name</span>
            <span class="c1"># For featureNames block, nameID is &#39;feature tag&#39;</span>
            <span class="c1"># For cvParameters blocks, nameID is (&#39;feature tag&#39;, &#39;block name&#39;)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nameID</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">nameID</span>
                <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_name_id</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="n">nameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_name_id</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="n">nameID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_ids_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
            <span class="n">table</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">nameID</span><span class="p">,</span> <span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">,</span> <span class="n">langID</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.build_OS_2"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_OS_2">[docs]</a>    <span class="k">def</span> <span class="nf">build_OS_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OS/2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>  <span class="c1"># this only happens for unit tests</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">[</span><span class="s2">&quot;OS/2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;OS/2&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">getTableModule</span><span class="p">(</span><span class="s2">&quot;OS/2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">OS2_format_0</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;fstype&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">fsType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;fstype&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;panose&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">panose</span> <span class="o">=</span> <span class="n">getTableModule</span><span class="p">(</span><span class="s2">&quot;OS/2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Panose</span><span class="p">()</span>
            <span class="n">panose</span><span class="o">.</span><span class="n">bFamilyType</span><span class="p">,</span> <span class="n">panose</span><span class="o">.</span><span class="n">bSerifStyle</span><span class="p">,</span> <span class="n">panose</span><span class="o">.</span><span class="n">bWeight</span><span class="p">,</span>\
                <span class="n">panose</span><span class="o">.</span><span class="n">bProportion</span><span class="p">,</span> <span class="n">panose</span><span class="o">.</span><span class="n">bContrast</span><span class="p">,</span> <span class="n">panose</span><span class="o">.</span><span class="n">bStrokeVariation</span><span class="p">,</span>\
                <span class="n">panose</span><span class="o">.</span><span class="n">bArmStyle</span><span class="p">,</span> <span class="n">panose</span><span class="o">.</span><span class="n">bLetterForm</span><span class="p">,</span> <span class="n">panose</span><span class="o">.</span><span class="n">bMidline</span><span class="p">,</span> \
                <span class="n">panose</span><span class="o">.</span><span class="n">bXHeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;panose&quot;</span><span class="p">]</span>
            <span class="n">table</span><span class="o">.</span><span class="n">panose</span> <span class="o">=</span> <span class="n">panose</span>
        <span class="k">if</span> <span class="s2">&quot;typoascender&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">sTypoAscender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;typoascender&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;typodescender&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">sTypoDescender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;typodescender&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;typolinegap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">sTypoLineGap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;typolinegap&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;winascent&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">usWinAscent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;winascent&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;windescent&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">usWinDescent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;windescent&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;vendor&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">achVendID</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;vendor&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;weightclass&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">usWeightClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;weightclass&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;widthclass&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">usWidthClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;widthclass&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;unicoderange&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">setUnicodeRanges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;unicoderange&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;codepagerange&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_codepages_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;codepagerange&quot;</span><span class="p">])</span>
            <span class="n">table</span><span class="o">.</span><span class="n">ulCodePageRange1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">ulCodePageRange2</span> <span class="o">=</span> <span class="n">pages</span>
            <span class="n">version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s2">&quot;xheight&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">sxHeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;xheight&quot;</span><span class="p">]</span>
            <span class="n">version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="s2">&quot;capheight&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">sCapHeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;capheight&quot;</span><span class="p">]</span>
            <span class="n">version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="s2">&quot;loweropsize&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">usLowerOpticalPointSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;loweropsize&quot;</span><span class="p">]</span>
            <span class="n">version</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="s2">&quot;upperopsize&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">usUpperOpticalPointSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="s2">&quot;upperopsize&quot;</span><span class="p">]</span>
            <span class="n">version</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">def</span> <span class="nf">checkattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="c1"># this only happens for unit tests</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">checkattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;ulCodePageRange1&quot;</span><span class="p">,</span> <span class="s2">&quot;ulCodePageRange2&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">checkattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;sxHeight&quot;</span><span class="p">,</span> <span class="s2">&quot;sCapHeight&quot;</span><span class="p">,</span> <span class="s2">&quot;usDefaultChar&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;usBreakChar&quot;</span><span class="p">,</span> <span class="s2">&quot;usMaxContext&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">checkattr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;usLowerOpticalPointSize&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;usUpperOpticalPointSize&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Builder.build_codepages_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.build_codepages_">[docs]</a>    <span class="k">def</span> <span class="nf">build_codepages_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pages</span><span class="p">):</span>
        <span class="n">pages2bits</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1252</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1250</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1251</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1253</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1254</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1255</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1256</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="mi">1257</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="mi">1258</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">874</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">932</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">936</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">949</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">950</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="mi">1361</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">869</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">866</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">865</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">864</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">863</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">862</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
            <span class="mi">861</span><span class="p">:</span>  <span class="mi">54</span><span class="p">,</span> <span class="mi">860</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">857</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">855</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">852</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">775</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">737</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
            <span class="mi">708</span><span class="p">:</span>  <span class="mi">61</span><span class="p">,</span> <span class="mi">850</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">437</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">pages2bits</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pages</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pages2bits</span><span class="p">]</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">32</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">bits</span><span class="p">:</span>
                    <span class="n">pages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;1&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">binary2num</span><span class="p">(</span><span class="n">p</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">]</span></div>

<div class="viewcode-block" id="Builder.buildBASE"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildBASE">[docs]</a>    <span class="k">def</span> <span class="nf">buildBASE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_horiz_axis_</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_vert_axis_</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BASE</span><span class="p">()</span>
        <span class="n">base</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="mh">0x00010000</span>
        <span class="n">base</span><span class="o">.</span><span class="n">HorizAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildBASEAxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_horiz_axis_</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">VertAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildBASEAxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_vert_axis_</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;BASE&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">base</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Builder.buildBASEAxis"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildBASEAxis">[docs]</a>    <span class="k">def</span> <span class="nf">buildBASEAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axis</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">bases</span><span class="p">,</span> <span class="n">scripts</span> <span class="o">=</span> <span class="n">axis</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">Axis</span><span class="p">()</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">BaseTagList</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BaseTagList</span><span class="p">()</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">BaseTagList</span><span class="o">.</span><span class="n">BaselineTag</span> <span class="o">=</span> <span class="n">bases</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">BaseTagList</span><span class="o">.</span><span class="n">BaseTagCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">BaseScriptList</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BaseScriptList</span><span class="p">()</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">BaseScriptList</span><span class="o">.</span><span class="n">BaseScriptRecord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">BaseScriptList</span><span class="o">.</span><span class="n">BaseScriptCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scripts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scripts</span><span class="p">):</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BaseScriptRecord</span><span class="p">()</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScriptTag</span> <span class="o">=</span> <span class="n">script</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BaseScript</span><span class="p">()</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span><span class="o">.</span><span class="n">BaseLangSysCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span><span class="o">.</span><span class="n">BaseValues</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BaseValues</span><span class="p">()</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span><span class="o">.</span><span class="n">BaseValues</span><span class="o">.</span><span class="n">DefaultIndex</span> <span class="o">=</span> <span class="n">bases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">script</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span><span class="o">.</span><span class="n">BaseValues</span><span class="o">.</span><span class="n">BaseCoord</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span><span class="o">.</span><span class="n">BaseValues</span><span class="o">.</span><span class="n">BaseCoordCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">script</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">script</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">BaseCoord</span><span class="p">()</span>
                <span class="n">coord</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">coord</span><span class="o">.</span><span class="n">Coordinate</span> <span class="o">=</span> <span class="n">c</span>
                <span class="n">record</span><span class="o">.</span><span class="n">BaseScript</span><span class="o">.</span><span class="n">BaseValues</span><span class="o">.</span><span class="n">BaseCoord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">BaseScriptList</span><span class="o">.</span><span class="n">BaseScriptRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axis</span></div>

<div class="viewcode-block" id="Builder.buildGDEF"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildGDEF">[docs]</a>    <span class="k">def</span> <span class="nf">buildGDEF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gdef</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">GDEF</span><span class="p">()</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">GlyphClassDef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildGDEFGlyphClassDef_</span><span class="p">()</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">AttachList</span> <span class="o">=</span> \
            <span class="n">otl</span><span class="o">.</span><span class="n">buildAttachList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attachPoints_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">LigCaretList</span> <span class="o">=</span> \
            <span class="n">otl</span><span class="o">.</span><span class="n">buildLigCaretList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ligCaretCoords_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretPoints_</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">MarkAttachClassDef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildGDEFMarkAttachClassDef_</span><span class="p">()</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">MarkGlyphSetsDef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildGDEFMarkGlyphSetsDef_</span><span class="p">()</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="mh">0x00010002</span> <span class="k">if</span> <span class="n">gdef</span><span class="o">.</span><span class="n">MarkGlyphSetsDef</span> <span class="k">else</span> <span class="mh">0x00010000</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">gdef</span><span class="o">.</span><span class="n">GlyphClassDef</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">AttachList</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">LigCaretList</span><span class="p">,</span>
                <span class="n">gdef</span><span class="o">.</span><span class="n">MarkAttachClassDef</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">MarkGlyphSetsDef</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">(</span><span class="s2">&quot;GDEF&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">gdef</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Builder.buildGDEFGlyphClassDef_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildGDEFGlyphClassDef_">[docs]</a>    <span class="k">def</span> <span class="nf">buildGDEFGlyphClassDef_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphClassDefs_</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphClassDefs_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span><span class="p">:</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">inferGlyphClasses</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">markClass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseTree</span><span class="o">.</span><span class="n">markClasses</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">markClassDef</span> <span class="ow">in</span> <span class="n">markClass</span><span class="o">.</span><span class="n">definitions</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">markClassDef</span><span class="o">.</span><span class="n">glyphSet</span><span class="p">():</span>
                        <span class="n">classes</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">GlyphClassDef</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="n">classes</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Builder.buildGDEFMarkAttachClassDef_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildGDEFMarkAttachClassDef_">[docs]</a>    <span class="k">def</span> <span class="nf">buildGDEFMarkAttachClassDef_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classDefs</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markAttach_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">classDefs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">MarkAttachClassDef</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="n">classDefs</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Builder.buildGDEFMarkGlyphSetsDef_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildGDEFMarkGlyphSetsDef_">[docs]</a>    <span class="k">def</span> <span class="nf">buildGDEFMarkGlyphSetsDef_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">id_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markFilterSets_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                                 <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildMarkGlyphSetsDef</span><span class="p">(</span><span class="n">sets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.buildLookups_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.buildLookups_">[docs]</a>    <span class="k">def</span> <span class="nf">buildLookups_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">),</span> <span class="n">tag</span>
        <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span><span class="p">:</span>
            <span class="n">lookup</span><span class="o">.</span><span class="n">lookup_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">lookups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookups_</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lookup</span><span class="o">.</span><span class="n">table</span> <span class="o">!=</span> <span class="n">tag</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">lookup</span><span class="o">.</span><span class="n">lookup_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lookups</span><span class="p">)</span>
            <span class="n">lookups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">build</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lookups</span><span class="p">]</span></div>

<div class="viewcode-block" id="Builder.makeTable"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.makeTable">[docs]</a>    <span class="k">def</span> <span class="nf">makeTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">otTables</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="kc">None</span><span class="p">)()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="mh">0x00010000</span>
        <span class="n">table</span><span class="o">.</span><span class="n">ScriptList</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">ScriptList</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">ScriptList</span><span class="o">.</span><span class="n">ScriptRecord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">FeatureList</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span><span class="o">.</span><span class="n">FeatureRecord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">table</span><span class="o">.</span><span class="n">LookupList</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">LookupList</span><span class="p">()</span>
        <span class="n">table</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookups_</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

        <span class="c1"># Build a table for mapping (tag, lookup_indices) to feature_index.</span>
        <span class="c1"># For example, (&#39;liga&#39;, (2,3,7)) --&gt; 23.</span>
        <span class="n">feature_indices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">required_feature_indices</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (&#39;latn&#39;, &#39;DEU&#39;) --&gt; 23</span>
        <span class="n">scripts</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># &#39;latn&#39; --&gt; {&#39;DEU&#39;: [23, 24]} for feature #23,24</span>
        <span class="c1"># Sort the feature table by feature tag:</span>
        <span class="c1"># https://github.com/fonttools/fonttools/issues/568</span>
        <span class="n">sortFeatureTag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lookups</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">sortFeatureTag</span><span class="p">):</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature_tag</span> <span class="o">=</span> <span class="n">key</span>
            <span class="c1"># l.lookup_index will be None when a lookup is not needed</span>
            <span class="c1"># for the table under construction. For example, substitution</span>
            <span class="c1"># rules will have no lookup_index while building GPOS tables.</span>
            <span class="n">lookup_indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">lookup_index</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lookups</span>
                                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">lookup_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>

            <span class="n">size_feature</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;GPOS&quot;</span> <span class="ow">and</span> <span class="n">feature_tag</span> <span class="o">==</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lookup_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">size_feature</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">feature_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">feature_tag</span><span class="p">,</span> <span class="n">lookup_indices</span><span class="p">)</span>
            <span class="n">feature_index</span> <span class="o">=</span> <span class="n">feature_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">feature_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">)</span>
                <span class="n">frec</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">()</span>
                <span class="n">frec</span><span class="o">.</span><span class="n">FeatureTag</span> <span class="o">=</span> <span class="n">feature_tag</span>
                <span class="n">frec</span><span class="o">.</span><span class="n">Feature</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">Feature</span><span class="p">()</span>
                <span class="n">frec</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">FeatureParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildFeatureParams</span><span class="p">(</span>
                                                <span class="n">feature_tag</span><span class="p">)</span>
                <span class="n">frec</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">LookupListIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lookup_indices</span><span class="p">)</span>
                <span class="n">frec</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">LookupCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lookup_indices</span><span class="p">)</span>
                <span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frec</span><span class="p">)</span>
                <span class="n">feature_indices</span><span class="p">[</span><span class="n">feature_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_index</span>
            <span class="n">scripts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">feature_index</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_features_</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">))</span> <span class="o">==</span> <span class="n">feature_tag</span><span class="p">:</span>
                <span class="n">required_feature_indices</span><span class="p">[(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">)]</span> <span class="o">=</span> <span class="n">feature_index</span>

        <span class="c1"># Build ScriptList.</span>
        <span class="k">for</span> <span class="n">script</span><span class="p">,</span> <span class="n">lang_features</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scripts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">srec</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">ScriptRecord</span><span class="p">()</span>
            <span class="n">srec</span><span class="o">.</span><span class="n">ScriptTag</span> <span class="o">=</span> <span class="n">script</span>
            <span class="n">srec</span><span class="o">.</span><span class="n">Script</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
            <span class="n">srec</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">DefaultLangSys</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">srec</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">LangSysRecord</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">feature_indices</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lang_features</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">langrec</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="p">()</span>
                <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">LangSys</span><span class="p">()</span>
                <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span><span class="o">.</span><span class="n">LookupOrder</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">req_feature_index</span> <span class="o">=</span> \
                    <span class="n">required_feature_indices</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">req_feature_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span><span class="o">.</span><span class="n">ReqFeatureIndex</span> <span class="o">=</span> <span class="mh">0xFFFF</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span><span class="o">.</span><span class="n">ReqFeatureIndex</span> <span class="o">=</span> <span class="n">req_feature_index</span>

                <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span><span class="o">.</span><span class="n">FeatureIndex</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_indices</span>
                                                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">req_feature_index</span><span class="p">]</span>
                <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span><span class="o">.</span><span class="n">FeatureCount</span> <span class="o">=</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span><span class="o">.</span><span class="n">FeatureIndex</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;dflt&quot;</span><span class="p">:</span>
                    <span class="n">srec</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">DefaultLangSys</span> <span class="o">=</span> <span class="n">langrec</span><span class="o">.</span><span class="n">LangSys</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">langrec</span><span class="o">.</span><span class="n">LangSysTag</span> <span class="o">=</span> <span class="n">lang</span>
                    <span class="n">srec</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">langrec</span><span class="p">)</span>
            <span class="n">srec</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">LangSysCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">srec</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">ScriptList</span><span class="o">.</span><span class="n">ScriptRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srec</span><span class="p">)</span>

        <span class="n">table</span><span class="o">.</span><span class="n">ScriptList</span><span class="o">.</span><span class="n">ScriptCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">ScriptList</span><span class="o">.</span><span class="n">ScriptRecord</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span><span class="o">.</span><span class="n">FeatureCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">FeatureList</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">LookupCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span></div>

<div class="viewcode-block" id="Builder.add_language_system"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_language_system">[docs]</a>    <span class="k">def</span> <span class="nf">add_language_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">language</span><span class="p">):</span>
        <span class="c1"># OpenType Feature File Specification, section 4.b.i</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">script</span> <span class="o">==</span> <span class="s2">&quot;DFLT&quot;</span> <span class="ow">and</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;dflt&quot;</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_language_systems_</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s1">&#39;If &quot;languagesystem DFLT dflt&quot; is present, it must be &#39;</span>
                <span class="s1">&#39;the first of the languagesystem statements&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">script</span> <span class="o">==</span> <span class="s2">&quot;DFLT&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seen_non_DFLT_script_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                    <span class="s1">&#39;languagesystems using the &quot;DFLT&quot; script tag must &#39;</span>
                    <span class="s2">&quot;precede all other languagesystems&quot;</span><span class="p">,</span>
                    <span class="n">location</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seen_non_DFLT_script_</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_language_systems_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s1">&#39;&quot;languagesystem </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&quot; has already been specified&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">language</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_language_systems_</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">script</span><span class="p">,</span> <span class="n">language</span><span class="p">))</span></div>

<div class="viewcode-block" id="Builder.get_default_language_systems_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.get_default_language_systems_">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_language_systems_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># OpenType Feature File specification, 4.b.i. languagesystem:</span>
        <span class="c1"># If no &quot;languagesystem&quot; statement is present, then the</span>
        <span class="c1"># implementation must behave exactly as though the following</span>
        <span class="c1"># statement were present at the beginning of the feature file:</span>
        <span class="c1"># languagesystem DFLT dflt;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_language_systems_</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_language_systems_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">frozenset</span><span class="p">({(</span><span class="s1">&#39;DFLT&#39;</span><span class="p">,</span> <span class="s1">&#39;dflt&#39;</span><span class="p">)})</span></div>

<div class="viewcode-block" id="Builder.start_feature"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.start_feature">[docs]</a>    <span class="k">def</span> <span class="nf">start_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_language_systems_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_</span> <span class="o">=</span> <span class="s1">&#39;DFLT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;aalt&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aalt_location_</span> <span class="o">=</span> <span class="n">location</span></div>

<div class="viewcode-block" id="Builder.end_feature"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.end_feature">[docs]</a>    <span class="k">def</span> <span class="nf">end_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Builder.start_lookup_block"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.start_lookup_block">[docs]</a>    <span class="k">def</span> <span class="nf">start_lookup_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s1">&#39;Lookup &quot;</span><span class="si">%s</span><span class="s1">&quot; has already been defined&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">==</span> <span class="s2">&quot;aalt&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Lookup blocks cannot be placed inside &#39;aalt&#39; features; &quot;</span>
                <span class="s2">&quot;move it out, and then refer to it with a lookup statement&quot;</span><span class="p">,</span>
                <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Builder.end_lookup_block"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.end_lookup_block">[docs]</a>    <span class="k">def</span> <span class="nf">end_lookup_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_name_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Builder.add_lookup_call"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_lookup_call">[docs]</a>    <span class="k">def</span> <span class="nf">add_lookup_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookup_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">lookup_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span><span class="p">,</span> <span class="n">lookup_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span><span class="p">[</span><span class="n">lookup_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lookup_to_feature_</span><span class="p">(</span><span class="n">lookup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.set_font_revision"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.set_font_revision">[docs]</a>    <span class="k">def</span> <span class="nf">set_font_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">revision</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontRevision_</span> <span class="o">=</span> <span class="n">revision</span></div>

<div class="viewcode-block" id="Builder.set_language"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.set_language">[docs]</a>    <span class="k">def</span> <span class="nf">set_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">include_default</span><span class="p">,</span> <span class="n">required</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">language</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;aalt&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Language statements are not allowed &quot;</span>
                <span class="s2">&quot;within </span><span class="se">\&quot;</span><span class="s2">feature </span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Language statements are not allowed &quot;</span>
                <span class="s2">&quot;within standalone lookup blocks&quot;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">)</span>
        <span class="n">lookups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;dflt&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="o">==</span> <span class="s1">&#39;dflt&#39;</span> <span class="ow">or</span> <span class="n">include_default</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lookups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookups</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_</span><span class="p">,</span> <span class="n">language</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">required</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_features_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                    <span class="s2">&quot;Language </span><span class="si">%s</span><span class="s2"> (script </span><span class="si">%s</span><span class="s2">) has already &quot;</span>
                    <span class="s2">&quot;specified feature </span><span class="si">%s</span><span class="s2"> as its required feature&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">language</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">required_features_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span>
                    <span class="n">location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">required_features_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span></div>

<div class="viewcode-block" id="Builder.getMarkAttachClass_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.getMarkAttachClass_">[docs]</a>    <span class="k">def</span> <span class="nf">getMarkAttachClass_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">):</span>
        <span class="n">glyphs</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markAttachClassID_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">id_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">id_</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markAttachClassID_</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markAttachClassID_</span><span class="p">[</span><span class="n">glyphs</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markAttach_</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markAttach_</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span>
                <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                    <span class="s2">&quot;Glyph </span><span class="si">%s</span><span class="s2"> already has been assigned &quot;</span>
                    <span class="s2">&quot;a MarkAttachmentType at </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">glyph</span><span class="p">,</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                    <span class="n">location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markAttach_</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">id_</span></div>

<div class="viewcode-block" id="Builder.getMarkFilterSet_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.getMarkFilterSet_">[docs]</a>    <span class="k">def</span> <span class="nf">getMarkFilterSet_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">):</span>
        <span class="n">glyphs</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markFilterSets_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">id_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">id_</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markFilterSets_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markFilterSets_</span><span class="p">[</span><span class="n">glyphs</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="k">return</span> <span class="n">id_</span></div>

<div class="viewcode-block" id="Builder.set_lookup_flag"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.set_lookup_flag">[docs]</a>    <span class="k">def</span> <span class="nf">set_lookup_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">markAttach</span><span class="p">,</span> <span class="n">markFilter</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="k">if</span> <span class="n">markAttach</span><span class="p">:</span>
            <span class="n">markAttachClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMarkAttachClass_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">markAttach</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">|</span> <span class="p">(</span><span class="n">markAttachClass</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markFilter</span><span class="p">:</span>
            <span class="n">markFilterSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMarkFilterSet_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">markFilter</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">|</span> <span class="mh">0x10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="n">markFilterSet</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Builder.set_script"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.set_script">[docs]</a>    <span class="k">def</span> <span class="nf">set_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">script</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;aalt&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Script statements are not allowed &quot;</span>
                <span class="s2">&quot;within </span><span class="se">\&quot;</span><span class="s2">feature </span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Script statements are not allowed &quot;</span>
                <span class="s2">&quot;within standalone lookup blocks&quot;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span> <span class="o">==</span> <span class="p">{(</span><span class="n">script</span><span class="p">,</span> <span class="s1">&#39;dflt&#39;</span><span class="p">)}:</span>
            <span class="c1"># Nothing to do.</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_</span> <span class="o">=</span> <span class="n">script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag_markFilterSet_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_language</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s2">&quot;dflt&quot;</span><span class="p">,</span>
                          <span class="n">include_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.find_lookup_builders_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.find_lookup_builders_">[docs]</a>    <span class="k">def</span> <span class="nf">find_lookup_builders_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for building chain contextual substitutions</span>

<span class="sd">        Given a list of lookup names, finds the LookupBuilder for each name.</span>
<span class="sd">        If an input name is None, it gets mapped to a None LookupBuilder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lookup_builders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="n">lookups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lookup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lookup_builders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">named_lookups_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lookup_builders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lookup_builders</span></div>

<div class="viewcode-block" id="Builder.add_attach_points"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_attach_points">[docs]</a>    <span class="k">def</span> <span class="nf">add_attach_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">contourPoints</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attachPoints_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourPoints</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_chain_context_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_chain_context_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_chain_context_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">lookups</span><span class="p">):</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextPosBuilder</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">find_lookup_builders_</span><span class="p">(</span><span class="n">lookups</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Builder.add_chain_context_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_chain_context_subst">[docs]</a>    <span class="k">def</span> <span class="nf">add_chain_context_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span>
                                <span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">lookups</span><span class="p">):</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextSubstBuilder</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">find_lookup_builders_</span><span class="p">(</span><span class="n">lookups</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Builder.add_alternate_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_alternate_subst">[docs]</a>    <span class="k">def</span> <span class="nf">add_alternate_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span>
                            <span class="n">prefix</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">replacement</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">==</span> <span class="s2">&quot;aalt&quot;</span><span class="p">:</span>
            <span class="n">alts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aalt_alternates_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
            <span class="n">alts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replacement</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">or</span> <span class="n">suffix</span><span class="p">:</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextSubstBuilder</span><span class="p">)</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chained_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">AlternateSubstBuilder</span><span class="p">)</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="p">[{</span><span class="n">glyph</span><span class="p">}],</span> <span class="n">suffix</span><span class="p">,</span> <span class="p">[</span><span class="n">lookup</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">AlternateSubstBuilder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">lookup</span><span class="o">.</span><span class="n">alternates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s1">&#39;Already defined alternates for glyph &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">glyph</span><span class="p">,</span>
                <span class="n">location</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">alternates</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">replacement</span></div>

<div class="viewcode-block" id="Builder.add_feature_reference"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_feature_reference">[docs]</a>    <span class="k">def</span> <span class="nf">add_feature_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">featureName</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">!=</span> <span class="s2">&quot;aalt&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s1">&#39;Feature references are only allowed inside &quot;feature aalt&quot;&#39;</span><span class="p">,</span>
                <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aalt_features_</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">location</span><span class="p">,</span> <span class="n">featureName</span><span class="p">))</span></div>

<div class="viewcode-block" id="Builder.add_featureName"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_featureName">[docs]</a>    <span class="k">def</span> <span class="nf">add_featureName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureNames_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_cv_parameter"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_cv_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">add_cv_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_parameters_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_to_cv_num_named_params"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_to_cv_num_named_params">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_cv_num_named_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds new items to self.cv_num_named_params_</span>
<span class="sd">        or increments the count of existing items.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_num_named_params_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_num_named_params_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_num_named_params_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Builder.add_cv_character"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_cv_character">[docs]</a>    <span class="k">def</span> <span class="nf">add_cv_character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_characters_</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">character</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.set_base_axis"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.set_base_axis">[docs]</a>    <span class="k">def</span> <span class="nf">set_base_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">scripts</span><span class="p">,</span> <span class="n">vertical</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vertical</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_vert_axis_</span> <span class="o">=</span> <span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">scripts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_horiz_axis_</span> <span class="o">=</span> <span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">scripts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.set_size_parameters"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.set_size_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_size_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">DesignSize</span><span class="p">,</span> <span class="n">SubfamilyID</span><span class="p">,</span>
                            <span class="n">RangeStart</span><span class="p">,</span> <span class="n">RangeEnd</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">!=</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Parameters statements are not allowed &quot;</span>
                <span class="s2">&quot;within </span><span class="se">\&quot;</span><span class="s2">feature </span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size_parameters_</span> <span class="o">=</span> <span class="p">[</span><span class="n">DesignSize</span><span class="p">,</span> <span class="n">SubfamilyID</span><span class="p">,</span> <span class="n">RangeStart</span><span class="p">,</span> <span class="n">RangeEnd</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">script</span><span class="p">,</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_systems</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="Builder.add_ligature_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_ligature_subst">[docs]</a>    <span class="k">def</span> <span class="nf">add_ligature_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span>
                           <span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">forceChain</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">or</span> <span class="n">suffix</span> <span class="ow">or</span> <span class="n">forceChain</span><span class="p">:</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextSubstBuilder</span><span class="p">)</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chained_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">LigatureSubstBuilder</span><span class="p">)</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="p">[</span><span class="n">lookup</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">LigatureSubstBuilder</span><span class="p">)</span>

        <span class="c1"># OpenType feature file syntax, section 5.d, &quot;Ligature substitution&quot;:</span>
        <span class="c1"># &quot;Since the OpenType specification does not allow ligature</span>
        <span class="c1"># substitutions to be specified on target sequences that contain</span>
        <span class="c1"># glyph classes, the implementation software will enumerate</span>
        <span class="c1"># all specific glyph sequences if glyph classes are detected&quot;</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">glyphs</span><span class="p">)):</span>
            <span class="n">lookup</span><span class="o">.</span><span class="n">ligatures</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">replacement</span></div>

<div class="viewcode-block" id="Builder.add_multiple_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_multiple_subst">[docs]</a>    <span class="k">def</span> <span class="nf">add_multiple_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span>
                           <span class="n">prefix</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">forceChain</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">or</span> <span class="n">suffix</span> <span class="ow">or</span> <span class="n">forceChain</span><span class="p">:</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextSubstBuilder</span><span class="p">)</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chained_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">MultipleSubstBuilder</span><span class="p">)</span>
            <span class="n">sub</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">replacements</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="p">[{</span><span class="n">glyph</span><span class="p">}],</span> <span class="n">suffix</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span><span class="p">]))</span>
            <span class="k">return</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">MultipleSubstBuilder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replacements</span> <span class="o">==</span> <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">]:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Removing duplicate multiple substitution from glyph&#39;</span>
                    <span class="s1">&#39; &quot;</span><span class="si">%s</span><span class="s1">&quot; to </span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">glyph</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span>
                    <span class="s1">&#39; at </span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">location</span><span class="p">)</span> <span class="k">if</span> <span class="n">location</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                    <span class="s1">&#39;Already defined substitution for glyph &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">glyph</span><span class="p">,</span>
                    <span class="n">location</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">replacements</span></div>

<div class="viewcode-block" id="Builder.add_reverse_chain_single_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_reverse_chain_single_subst">[docs]</a>    <span class="k">def</span> <span class="nf">add_reverse_chain_single_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">old_prefix</span><span class="p">,</span>
                                       <span class="n">old_suffix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ReverseChainSingleSubstBuilder</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">old_prefix</span><span class="p">,</span> <span class="n">old_suffix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">))</span></div>

<div class="viewcode-block" id="Builder.add_single_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_single_subst">[docs]</a>    <span class="k">def</span> <span class="nf">add_single_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">forceChain</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_feature_name_</span> <span class="o">==</span> <span class="s2">&quot;aalt&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">from_glyph</span><span class="p">,</span> <span class="n">to_glyph</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">alts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aalt_alternates_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">from_glyph</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
                <span class="n">alts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">to_glyph</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">or</span> <span class="n">suffix</span> <span class="ow">or</span> <span class="n">forceChain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_single_subst_chained_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">SingleSubstBuilder</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">from_glyph</span><span class="p">,</span> <span class="n">to_glyph</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">from_glyph</span> <span class="ow">in</span> <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">to_glyph</span> <span class="o">==</span> <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">from_glyph</span><span class="p">]:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;Removing duplicate single substitution from glyph&#39;</span>
                        <span class="s1">&#39; &quot;</span><span class="si">%s</span><span class="s1">&quot; to &quot;</span><span class="si">%s</span><span class="s1">&quot; at </span><span class="si">%s</span><span class="s1">:</span><span class="si">%i</span><span class="s1">:</span><span class="si">%i</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">from_glyph</span><span class="p">,</span> <span class="n">to_glyph</span><span class="p">,</span> <span class="o">*</span><span class="n">location</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                        <span class="s1">&#39;Already defined rule for replacing glyph &quot;</span><span class="si">%s</span><span class="s1">&quot; by &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">from_glyph</span><span class="p">,</span> <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">from_glyph</span><span class="p">]),</span>
                        <span class="n">location</span><span class="p">)</span>
            <span class="n">lookup</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">from_glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_glyph</span></div>

<div class="viewcode-block" id="Builder.add_single_subst_chained_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_single_subst_chained_">[docs]</a>    <span class="k">def</span> <span class="nf">add_single_subst_chained_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="c1"># https://github.com/fonttools/fonttools/issues/512</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextSubstBuilder</span><span class="p">)</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">find_chainable_single_subst</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chained_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">SingleSubstBuilder</span><span class="p">)</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="p">[</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span> <span class="n">suffix</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Builder.add_cursive_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_cursive_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_cursive_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphclass</span><span class="p">,</span> <span class="n">entryAnchor</span><span class="p">,</span> <span class="n">exitAnchor</span><span class="p">):</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">CursivePosBuilder</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">add_attachment</span><span class="p">(</span>
            <span class="n">location</span><span class="p">,</span> <span class="n">glyphclass</span><span class="p">,</span>
            <span class="n">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">entryAnchor</span><span class="p">),</span>
            <span class="n">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">exitAnchor</span><span class="p">))</span></div>

<div class="viewcode-block" id="Builder.add_marks_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_marks_">[docs]</a>    <span class="k">def</span> <span class="nf">add_marks_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">lookupBuilder</span><span class="p">,</span> <span class="n">marks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for add_mark_{base,liga,mark}_pos.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">markClass</span> <span class="ow">in</span> <span class="n">marks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">markClassDef</span> <span class="ow">in</span> <span class="n">markClass</span><span class="o">.</span><span class="n">definitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="n">markClassDef</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">glyphSet</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">mark</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lookupBuilder</span><span class="o">.</span><span class="n">marks</span><span class="p">:</span>
                        <span class="n">otMarkAnchor</span> <span class="o">=</span> <span class="n">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">markClassDef</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
                        <span class="n">lookupBuilder</span><span class="o">.</span><span class="n">marks</span><span class="p">[</span><span class="n">mark</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">markClass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">otMarkAnchor</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">existingMarkClass</span> <span class="o">=</span> <span class="n">lookupBuilder</span><span class="o">.</span><span class="n">marks</span><span class="p">[</span><span class="n">mark</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">markClass</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">existingMarkClass</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                                <span class="s2">&quot;Glyph </span><span class="si">%s</span><span class="s2"> cannot be in both @</span><span class="si">%s</span><span class="s2"> and @</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="n">mark</span><span class="p">,</span> <span class="n">existingMarkClass</span><span class="p">,</span> <span class="n">markClass</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                <span class="n">location</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_mark_base_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_mark_base_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_mark_base_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">marks</span><span class="p">):</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">MarkBasePosBuilder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_marks_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">marks</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">baseAnchor</span><span class="p">,</span> <span class="n">markClass</span> <span class="ow">in</span> <span class="n">marks</span><span class="p">:</span>
            <span class="n">otBaseAnchor</span> <span class="o">=</span> <span class="n">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">baseAnchor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">bases</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="p">{})[</span><span class="n">markClass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">otBaseAnchor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_mark_lig_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_mark_lig_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_mark_lig_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">ligatures</span><span class="p">,</span> <span class="n">components</span><span class="p">):</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">MarkLigPosBuilder</span><span class="p">)</span>
        <span class="n">componentAnchors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">marks</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
            <span class="n">anchors</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_marks_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">marks</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ligAnchor</span><span class="p">,</span> <span class="n">markClass</span> <span class="ow">in</span> <span class="n">marks</span><span class="p">:</span>
                <span class="n">anchors</span><span class="p">[</span><span class="n">markClass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">ligAnchor</span><span class="p">)</span>
            <span class="n">componentAnchors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">ligatures</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">ligatures</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">componentAnchors</span></div>

<div class="viewcode-block" id="Builder.add_mark_mark_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_mark_mark_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_mark_mark_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">baseMarks</span><span class="p">,</span> <span class="n">marks</span><span class="p">):</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">MarkMarkPosBuilder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_marks_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">marks</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">baseAnchor</span><span class="p">,</span> <span class="n">markClass</span> <span class="ow">in</span> <span class="n">marks</span><span class="p">:</span>
            <span class="n">otBaseAnchor</span> <span class="o">=</span> <span class="n">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">baseAnchor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">baseMark</span> <span class="ow">in</span> <span class="n">baseMarks</span><span class="p">:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">baseMarks</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">baseMark</span><span class="p">,</span> <span class="p">{})[</span><span class="n">markClass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">otBaseAnchor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_class_pair_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_class_pair_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_class_pair_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphclass1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span>
                           <span class="n">glyphclass2</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">PairPosBuilder</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">addClassPair</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyphclass1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyphclass2</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_lookup_</span><span class="o">.</span><span class="n">add_subtable_break</span><span class="p">(</span><span class="n">location</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_specific_pair_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_specific_pair_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_specific_pair_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyph1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyph2</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">PairPosBuilder</span><span class="p">)</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">addGlyphPair</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyph2</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_single_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_single_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_single_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">forceChain</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">or</span> <span class="n">suffix</span> <span class="ow">or</span> <span class="n">forceChain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_single_pos_chained_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">SinglePosBuilder</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
                    <span class="n">lookup</span><span class="o">.</span><span class="n">add_pos</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_single_pos_chained_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_single_pos_chained_">[docs]</a>    <span class="k">def</span> <span class="nf">add_single_pos_chained_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="c1"># https://github.com/fonttools/fonttools/issues/514</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">ChainContextPosBuilder</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">lookups</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lookups</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">otValue</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">makeOpenTypeValueRecord</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">find_chainable_single_pos</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">otValue</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chained_lookup_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">SinglePosBuilder</span><span class="p">)</span>
                <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
                <span class="n">sub</span><span class="o">.</span><span class="n">add_pos</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">subs</span><span class="p">),</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">subs</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">],</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">subs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Builder.setGlyphClass_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.setGlyphClass_">[docs]</a>    <span class="k">def</span> <span class="nf">setGlyphClass_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">glyphClass</span><span class="p">):</span>
        <span class="n">oldClass</span><span class="p">,</span> <span class="n">oldLocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphClassDefs_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">oldClass</span> <span class="ow">and</span> <span class="n">oldClass</span> <span class="o">!=</span> <span class="n">glyphClass</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s2">&quot;Glyph </span><span class="si">%s</span><span class="s2"> was assigned to a different class at </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">oldLocation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oldLocation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oldLocation</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphClassDefs_</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">glyphClass</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_glyphClassDef"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_glyphClassDef">[docs]</a>    <span class="k">def</span> <span class="nf">add_glyphClassDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">baseGlyphs</span><span class="p">,</span> <span class="n">ligatureGlyphs</span><span class="p">,</span>
                          <span class="n">markGlyphs</span><span class="p">,</span> <span class="n">componentGlyphs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">baseGlyphs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGlyphClass_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">ligatureGlyphs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGlyphClass_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">markGlyphs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGlyphClass_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">componentGlyphs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGlyphClass_</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="Builder.add_ligatureCaretByIndex_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_ligatureCaretByIndex_">[docs]</a>    <span class="k">def</span> <span class="nf">add_ligatureCaretByIndex_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">carets</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">glyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretPoints_</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretPoints_</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">carets</span></div>

<div class="viewcode-block" id="Builder.add_ligatureCaretByPos_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_ligatureCaretByPos_">[docs]</a>    <span class="k">def</span> <span class="nf">add_ligatureCaretByPos_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">carets</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">glyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretCoords_</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ligCaretCoords_</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">carets</span></div>

<div class="viewcode-block" id="Builder.add_name_record"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_name_record">[docs]</a>    <span class="k">def</span> <span class="nf">add_name_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">nameID</span><span class="p">,</span> <span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">,</span>
                        <span class="n">langID</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nameID</span><span class="p">,</span> <span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">,</span> <span class="n">langID</span><span class="p">,</span> <span class="n">string</span><span class="p">])</span></div>

<div class="viewcode-block" id="Builder.add_os2_field"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_os2_field">[docs]</a>    <span class="k">def</span> <span class="nf">add_os2_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">os2_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Builder.add_hhea_field"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_hhea_field">[docs]</a>    <span class="k">def</span> <span class="nf">add_hhea_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hhea_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Builder.add_vhea_field"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.Builder.add_vhea_field">[docs]</a>    <span class="k">def</span> <span class="nf">add_vhea_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vhea_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="makeOpenTypeAnchor"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.makeOpenTypeAnchor">[docs]</a><span class="k">def</span> <span class="nf">makeOpenTypeAnchor</span><span class="p">(</span><span class="n">anchor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ast.Anchor --&gt; otTables.Anchor&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">deviceX</span><span class="p">,</span> <span class="n">deviceY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">anchor</span><span class="o">.</span><span class="n">xDeviceTable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">deviceX</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildDevice</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">anchor</span><span class="o">.</span><span class="n">xDeviceTable</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">anchor</span><span class="o">.</span><span class="n">yDeviceTable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">deviceY</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildDevice</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">anchor</span><span class="o">.</span><span class="n">yDeviceTable</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildAnchor</span><span class="p">(</span><span class="n">anchor</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">anchor</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">.</span><span class="n">contourpoint</span><span class="p">,</span>
                           <span class="n">deviceX</span><span class="p">,</span> <span class="n">deviceY</span><span class="p">)</span></div>


<span class="n">_VALUEREC_ATTRS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">isDevice</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">isDevice</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">otBase</span><span class="o">.</span><span class="n">valueRecordFormat</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Reserved&quot;</span><span class="p">)</span>
<span class="p">}</span>


<div class="viewcode-block" id="makeOpenTypeValueRecord"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.makeOpenTypeValueRecord">[docs]</a><span class="k">def</span> <span class="nf">makeOpenTypeValueRecord</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ast.ValueRecord --&gt; (otBase.ValueRecord, int ValueFormat)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">vr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">astName</span><span class="p">,</span> <span class="p">(</span><span class="n">otName</span><span class="p">,</span> <span class="n">isDevice</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_VALUEREC_ATTRS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">astName</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">otName</span><span class="p">]</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildDevice</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">if</span> <span class="n">isDevice</span> <span class="k">else</span> <span class="n">val</span>
    <span class="k">if</span> <span class="n">pairPosContext</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vr</span><span class="p">:</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;YAdvance&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">vertical</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;XAdvance&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">valRec</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildValue</span><span class="p">(</span><span class="n">vr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valRec</span><span class="p">,</span> <span class="n">valRec</span><span class="o">.</span><span class="n">getFormat</span><span class="p">()</span></div>


<div class="viewcode-block" id="LookupBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder">[docs]</a><span class="k">class</span> <span class="nc">LookupBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">SUBTABLE_BREAK_</span> <span class="o">=</span> <span class="s2">&quot;SUBTABLE_BREAK&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">lookup_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_type</span> <span class="o">=</span> <span class="n">table</span><span class="p">,</span> <span class="n">lookup_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markFilterSet</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup_index</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># assigned when making final tables</span>
        <span class="k">assert</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="LookupBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">table</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">lookupflag</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markFilterSet</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">markFilterSet</span><span class="p">)</span></div>

<div class="viewcode-block" id="LookupBuilder.inferGlyphClasses"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.inferGlyphClasses">[docs]</a>    <span class="k">def</span> <span class="nf">inferGlyphClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infers glyph glasses for the GDEF table, such as {&quot;cedilla&quot;:3}.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="LookupBuilder.getAlternateGlyphs"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.getAlternateGlyphs">[docs]</a>    <span class="k">def</span> <span class="nf">getAlternateGlyphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for building &#39;aalt&#39; features.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="LookupBuilder.buildLookup_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.buildLookup_">[docs]</a>    <span class="k">def</span> <span class="nf">buildLookup_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtables</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildLookup</span><span class="p">(</span><span class="n">subtables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookupflag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markFilterSet</span><span class="p">)</span></div>

<div class="viewcode-block" id="LookupBuilder.buildMarkClasses_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.buildMarkClasses_">[docs]</a>    <span class="k">def</span> <span class="nf">buildMarkClasses_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;{&quot;cedilla&quot;: (&quot;BOTTOM&quot;, ast.Anchor), ...} --&gt; {&quot;BOTTOM&quot;:0, &quot;TOP&quot;:1}</span>

<span class="sd">        Helper for MarkBasePostBuilder, MarkLigPosBuilder, and</span>
<span class="sd">        MarkMarkPosBuilder. Seems to return the same numeric IDs</span>
<span class="sd">        for mark classes as the AFDKO makeotf tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">marks</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">):</span>
            <span class="n">markClassName</span><span class="p">,</span> <span class="n">_markAnchor</span> <span class="o">=</span> <span class="n">marks</span><span class="p">[</span><span class="n">mark</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">markClassName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">ids</span><span class="p">[</span><span class="n">markClassName</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ids</span></div>

<div class="viewcode-block" id="LookupBuilder.setBacktrackCoverage_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.setBacktrackCoverage_">[docs]</a>    <span class="k">def</span> <span class="nf">setBacktrackCoverage_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">subtable</span><span class="p">):</span>
        <span class="n">subtable</span><span class="o">.</span><span class="n">BacktrackGlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">subtable</span><span class="o">.</span><span class="n">BacktrackCoverage</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCoverage</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
            <span class="n">subtable</span><span class="o">.</span><span class="n">BacktrackCoverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverage</span><span class="p">)</span></div>

<div class="viewcode-block" id="LookupBuilder.setLookAheadCoverage_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.setLookAheadCoverage_">[docs]</a>    <span class="k">def</span> <span class="nf">setLookAheadCoverage_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">subtable</span><span class="p">):</span>
        <span class="n">subtable</span><span class="o">.</span><span class="n">LookAheadGlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">subtable</span><span class="o">.</span><span class="n">LookAheadCoverage</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">suffix</span><span class="p">:</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCoverage</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
            <span class="n">subtable</span><span class="o">.</span><span class="n">LookAheadCoverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverage</span><span class="p">)</span></div>

<div class="viewcode-block" id="LookupBuilder.setInputCoverage_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.setInputCoverage_">[docs]</a>    <span class="k">def</span> <span class="nf">setInputCoverage_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">subtable</span><span class="p">):</span>
        <span class="n">subtable</span><span class="o">.</span><span class="n">InputGlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="n">subtable</span><span class="o">.</span><span class="n">InputCoverage</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCoverage</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
            <span class="n">subtable</span><span class="o">.</span><span class="n">InputCoverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverage</span><span class="p">)</span></div>

<div class="viewcode-block" id="LookupBuilder.build_subst_subtables"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.build_subst_subtables">[docs]</a>    <span class="k">def</span> <span class="nf">build_subst_subtables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">klass</span><span class="p">):</span>
        <span class="n">substitutions</span> <span class="o">=</span> <span class="p">[{}]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">substitutions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="p">[</span><span class="n">klass</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substitutions</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">subtables</span></div>

<div class="viewcode-block" id="LookupBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LookupBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">FeatureLibError</span><span class="p">(</span>
            <span class="s1">&#39;unsupported &quot;subtable&quot; statement for lookup type&#39;</span><span class="p">,</span>
            <span class="n">location</span>
        <span class="p">))</span></div></div>


<div class="viewcode-block" id="AlternateSubstBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.AlternateSubstBuilder">[docs]</a><span class="k">class</span> <span class="nc">AlternateSubstBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

<div class="viewcode-block" id="AlternateSubstBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.AlternateSubstBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alternates</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">alternates</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlternateSubstBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.AlternateSubstBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_subst_subtables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alternates</span><span class="p">,</span>
                <span class="n">otl</span><span class="o">.</span><span class="n">buildAlternateSubstSubtable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlternateSubstBuilder.getAlternateGlyphs"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.AlternateSubstBuilder.getAlternateGlyphs">[docs]</a>    <span class="k">def</span> <span class="nf">getAlternateGlyphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternates</span></div>

<div class="viewcode-block" id="AlternateSubstBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.AlternateSubstBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternates</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="n">location</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span></div></div>


<div class="viewcode-block" id="ChainContextPosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextPosBuilder">[docs]</a><span class="k">class</span> <span class="nc">ChainContextPosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># (prefix, input, suffix, lookups)</span>

<div class="viewcode-block" id="ChainContextPosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextPosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChainContextPosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextPosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">lookups</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">ChainContextPos</span><span class="p">()</span>
            <span class="n">subtables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBacktrackCoverage_</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLookAheadCoverage_</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setInputCoverage_</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>

            <span class="n">st</span><span class="o">.</span><span class="n">PosCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lookups</span> <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">st</span><span class="o">.</span><span class="n">PosLookupRecord</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sequenceIndex</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lookups</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">lookup_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span><span class="s1">&#39;Missing index of the specified &#39;</span>
                            <span class="s1">&#39;lookup, might be a substitution lookup&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">PosLookupRecord</span><span class="p">()</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">SequenceIndex</span> <span class="o">=</span> <span class="n">sequenceIndex</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">LookupListIndex</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">lookup_index</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">PosLookupRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChainContextPosBuilder.find_chainable_single_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextPosBuilder.find_chainable_single_pos">[docs]</a>    <span class="k">def</span> <span class="nf">find_chainable_single_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookups</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for add_single_pos_chained_()&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="n">lookups</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">lookup</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lookup</span><span class="p">,</span> <span class="n">SinglePosBuilder</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="nb">all</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">can_add</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">lookup</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="ChainContextPosBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextPosBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="ChainContextSubstBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextSubstBuilder">[docs]</a><span class="k">class</span> <span class="nc">ChainContextSubstBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># (prefix, input, suffix, lookups)</span>

<div class="viewcode-block" id="ChainContextSubstBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextSubstBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">substitutions</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChainContextSubstBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextSubstBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">lookups</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">ChainContextSubst</span><span class="p">()</span>
            <span class="n">subtables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBacktrackCoverage_</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLookAheadCoverage_</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setInputCoverage_</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>

            <span class="n">st</span><span class="o">.</span><span class="n">SubstCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lookups</span> <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">st</span><span class="o">.</span><span class="n">SubstLookupRecord</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sequenceIndex</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lookups</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">lookup_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span><span class="s1">&#39;Missing index of the specified &#39;</span>
                            <span class="s1">&#39;lookup, might be a positioning lookup&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">SubstLookupRecord</span><span class="p">()</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">SequenceIndex</span> <span class="o">=</span> <span class="n">sequenceIndex</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">LookupListIndex</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">lookup_index</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">SubstLookupRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChainContextSubstBuilder.getAlternateGlyphs"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextSubstBuilder.getAlternateGlyphs">[docs]</a>    <span class="k">def</span> <span class="nf">getAlternateGlyphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">lookups</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lookups</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="n">lookups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lookup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">alts</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">getAlternateGlyphs</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">replacements</span> <span class="ow">in</span> <span class="n">alts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replacements</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="ChainContextSubstBuilder.find_chainable_single_subst"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextSubstBuilder.find_chainable_single_subst">[docs]</a>    <span class="k">def</span> <span class="nf">find_chainable_single_subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for add_single_subst_chained_()&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">substitutions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">substitutions</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">substitutions</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">SingleSubstBuilder</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">g</span> <span class="ow">in</span> <span class="n">glyphs</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">sub</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="ChainContextSubstBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ChainContextSubstBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="LigatureSubstBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LigatureSubstBuilder">[docs]</a><span class="k">class</span> <span class="nc">LigatureSubstBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>  <span class="c1"># {(&#39;f&#39;,&#39;f&#39;,&#39;i&#39;): &#39;f_f_i&#39;}</span>

<div class="viewcode-block" id="LigatureSubstBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LigatureSubstBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ligatures</span><span class="p">)</span></div>

<div class="viewcode-block" id="LigatureSubstBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LigatureSubstBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_subst_subtables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span><span class="p">,</span>
                <span class="n">otl</span><span class="o">.</span><span class="n">buildLigatureSubstSubtable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="LigatureSubstBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.LigatureSubstBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="n">location</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span></div></div>


<div class="viewcode-block" id="MultipleSubstBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MultipleSubstBuilder">[docs]</a><span class="k">class</span> <span class="nc">MultipleSubstBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

<div class="viewcode-block" id="MultipleSubstBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MultipleSubstBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultipleSubstBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MultipleSubstBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_subst_subtables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">,</span>
                <span class="n">otl</span><span class="o">.</span><span class="n">buildMultipleSubstSubtable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultipleSubstBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MultipleSubstBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="n">location</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span></div></div>


<div class="viewcode-block" id="CursivePosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.CursivePosBuilder">[docs]</a><span class="k">class</span> <span class="nc">CursivePosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attachments</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="CursivePosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.CursivePosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attachments</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">attachments</span><span class="p">)</span></div>

<div class="viewcode-block" id="CursivePosBuilder.add_attachment"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.CursivePosBuilder.add_attachment">[docs]</a>    <span class="k">def</span> <span class="nf">add_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">entryAnchor</span><span class="p">,</span> <span class="n">exitAnchor</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attachments</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">entryAnchor</span><span class="p">,</span> <span class="n">exitAnchor</span><span class="p">)</span></div>

<div class="viewcode-block" id="CursivePosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.CursivePosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCursivePosSubtable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attachments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">([</span><span class="n">st</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="MarkBasePosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkBasePosBuilder">[docs]</a><span class="k">class</span> <span class="nc">MarkBasePosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyphName -&gt; (markClassName, anchor)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bases</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyphName -&gt; {markClassName: anchor}</span>

<div class="viewcode-block" id="MarkBasePosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkBasePosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">marks</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bases</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bases</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkBasePosBuilder.inferGlyphClasses"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkBasePosBuilder.inferGlyphClasses">[docs]</a>    <span class="k">def</span> <span class="nf">inferGlyphClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">glyph</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bases</span><span class="p">}</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">glyph</span><span class="p">:</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MarkBasePosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkBasePosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">markClasses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildMarkClasses_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">)</span>
        <span class="n">marks</span> <span class="o">=</span> <span class="p">{</span><span class="n">mark</span><span class="p">:</span> <span class="p">(</span><span class="n">markClasses</span><span class="p">[</span><span class="n">mc</span><span class="p">],</span> <span class="n">anchor</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">mark</span><span class="p">,</span> <span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">anchor</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">anchors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">bases</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">markClasses</span><span class="p">[</span><span class="n">mc</span><span class="p">]:</span> <span class="n">anchor</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">anchor</span><span class="p">)</span> <span class="ow">in</span> <span class="n">anchors</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildMarkBasePos</span><span class="p">(</span><span class="n">marks</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MarkLigPosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkLigPosBuilder">[docs]</a><span class="k">class</span> <span class="nc">MarkLigPosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyphName -&gt; (markClassName, anchor)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyphName -&gt; [{markClassName: anchor}, ...]</span>

<div class="viewcode-block" id="MarkLigPosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkLigPosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">marks</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ligatures</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkLigPosBuilder.inferGlyphClasses"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkLigPosBuilder.inferGlyphClasses">[docs]</a>    <span class="k">def</span> <span class="nf">inferGlyphClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">glyph</span><span class="p">:</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span><span class="p">}</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">glyph</span><span class="p">:</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MarkLigPosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkLigPosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">markClasses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildMarkClasses_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">)</span>
        <span class="n">marks</span> <span class="o">=</span> <span class="p">{</span><span class="n">mark</span><span class="p">:</span> <span class="p">(</span><span class="n">markClasses</span><span class="p">[</span><span class="n">mc</span><span class="p">],</span> <span class="n">anchor</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">mark</span><span class="p">,</span> <span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">anchor</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">ligs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">lig</span><span class="p">,</span> <span class="n">components</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ligs</span><span class="p">[</span><span class="n">lig</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                <span class="n">ligs</span><span class="p">[</span><span class="n">lig</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">markClasses</span><span class="p">[</span><span class="n">mc</span><span class="p">]:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">mc</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildMarkLigPos</span><span class="p">(</span><span class="n">marks</span><span class="p">,</span> <span class="n">ligs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MarkMarkPosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkMarkPosBuilder">[docs]</a><span class="k">class</span> <span class="nc">MarkMarkPosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># glyphName -&gt; (markClassName, anchor)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseMarks</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyphName -&gt; {markClassName: anchor}</span>

<div class="viewcode-block" id="MarkMarkPosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkMarkPosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">marks</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseMarks</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">baseMarks</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkMarkPosBuilder.inferGlyphClasses"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkMarkPosBuilder.inferGlyphClasses">[docs]</a>    <span class="k">def</span> <span class="nf">inferGlyphClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">glyph</span><span class="p">:</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseMarks</span><span class="p">}</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">glyph</span><span class="p">:</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MarkMarkPosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.MarkMarkPosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">markClasses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildMarkClasses_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">)</span>
        <span class="n">markClassList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">markClasses</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">markClasses</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
        <span class="n">marks</span> <span class="o">=</span> <span class="p">{</span><span class="n">mark</span><span class="p">:</span> <span class="p">(</span><span class="n">markClasses</span><span class="p">[</span><span class="n">mc</span><span class="p">],</span> <span class="n">anchor</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">mark</span><span class="p">,</span> <span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">anchor</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">st</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">MarkMarkPos</span><span class="p">()</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">st</span><span class="o">.</span><span class="n">ClassCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">markClasses</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Mark1Coverage</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCoverage</span><span class="p">(</span><span class="n">marks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Mark2Coverage</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCoverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseMarks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Mark1Array</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildMarkArray</span><span class="p">(</span><span class="n">marks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Mark2Array</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">Mark2Array</span><span class="p">()</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Mark2Array</span><span class="o">.</span><span class="n">Mark2Count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">Mark2Coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">Mark2Array</span><span class="o">.</span><span class="n">Mark2Record</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">Mark2Coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">:</span>
            <span class="n">anchors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">baseMarks</span><span class="p">[</span><span class="n">base</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span> <span class="k">for</span> <span class="n">mc</span> <span class="ow">in</span> <span class="n">markClassList</span><span class="p">]</span>
            <span class="n">st</span><span class="o">.</span><span class="n">Mark2Array</span><span class="o">.</span><span class="n">Mark2Record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">otl</span><span class="o">.</span><span class="n">buildMark2Record</span><span class="p">(</span><span class="n">anchors</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">([</span><span class="n">st</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="ReverseChainSingleSubstBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ReverseChainSingleSubstBuilder">[docs]</a><span class="k">class</span> <span class="nc">ReverseChainSingleSubstBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># (prefix, suffix, mapping)</span>

<div class="viewcode-block" id="ReverseChainSingleSubstBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ReverseChainSingleSubstBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">substitutions</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReverseChainSingleSubstBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ReverseChainSingleSubstBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitutions</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">otTables</span><span class="o">.</span><span class="n">ReverseChainSingleSubst</span><span class="p">()</span>
            <span class="n">st</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBacktrackCoverage_</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLookAheadCoverage_</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCoverage</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">GlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">Substitute</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">]</span>
            <span class="n">subtables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReverseChainSingleSubstBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ReverseChainSingleSubstBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="c1"># Nothing to do here, each substitution is in its own subtable.</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="SingleSubstBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SingleSubstBuilder">[docs]</a><span class="k">class</span> <span class="nc">SingleSubstBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

<div class="viewcode-block" id="SingleSubstBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SingleSubstBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleSubstBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SingleSubstBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_subst_subtables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">,</span>
                <span class="n">otl</span><span class="o">.</span><span class="n">buildSingleSubstSubtable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleSubstBuilder.getAlternateGlyphs"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SingleSubstBuilder.getAlternateGlyphs">[docs]</a>    <span class="k">def</span> <span class="nf">getAlternateGlyphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">glyph</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="n">repl</span><span class="p">])</span> <span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>

<div class="viewcode-block" id="SingleSubstBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SingleSubstBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="n">location</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span></div></div>


<div class="viewcode-block" id="ClassPairPosSubtableBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ClassPairPosSubtableBuilder">[docs]</a><span class="k">class</span> <span class="nc">ClassPairPosSubtableBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">valueFormat1</span><span class="p">,</span> <span class="n">valueFormat2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builder_</span> <span class="o">=</span> <span class="n">builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classDef1_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classDef2_</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (glyphclass1, glyphclass2) --&gt; (value1, value2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valueFormat1_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueFormat2_</span> <span class="o">=</span> <span class="n">valueFormat1</span><span class="p">,</span> <span class="n">valueFormat2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forceSubtableBreak_</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtables_</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ClassPairPosSubtableBuilder.addPair"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ClassPairPosSubtableBuilder.addPair">[docs]</a>    <span class="k">def</span> <span class="nf">addPair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">gc2</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
        <span class="n">mergeable</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forceSubtableBreak_</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">classDef1_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">classDef1_</span><span class="o">.</span><span class="n">canAdd</span><span class="p">(</span><span class="n">gc1</span><span class="p">)</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">classDef2_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">classDef2_</span><span class="o">.</span><span class="n">canAdd</span><span class="p">(</span><span class="n">gc2</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mergeable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classDef1_</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">ClassDefBuilder</span><span class="p">(</span><span class="n">useClass0</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classDef2_</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">ClassDefBuilder</span><span class="p">(</span><span class="n">useClass0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classDef1_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gc1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classDef2_</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gc2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_</span><span class="p">[(</span><span class="n">gc1</span><span class="p">,</span> <span class="n">gc2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClassPairPosSubtableBuilder.addSubtableBreak"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ClassPairPosSubtableBuilder.addSubtableBreak">[docs]</a>    <span class="k">def</span> <span class="nf">addSubtableBreak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forceSubtableBreak_</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ClassPairPosSubtableBuilder.subtables"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ClassPairPosSubtableBuilder.subtables">[docs]</a>    <span class="k">def</span> <span class="nf">subtables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush_</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtables_</span></div>

<div class="viewcode-block" id="ClassPairPosSubtableBuilder.flush_"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.ClassPairPosSubtableBuilder.flush_">[docs]</a>    <span class="k">def</span> <span class="nf">flush_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classDef1_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">classDef2_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildPairPosClassesSubtable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values_</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">builder_</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">Coverage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtables_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forceSubtableBreak_</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="PairPosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.PairPosBuilder">[docs]</a><span class="k">class</span> <span class="nc">PairPosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [(gc1, value1, gc2, value2)*]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphPairs</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (glyph1, glyph2) --&gt; (value1, value2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (gc1, gc2) --&gt; (filepath, line, column)</span>

<div class="viewcode-block" id="PairPosBuilder.addClassPair"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.PairPosBuilder.addClassPair">[docs]</a>    <span class="k">def</span> <span class="nf">addClassPair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyphclass1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyphclass2</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">glyphclass1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyphclass2</span><span class="p">,</span> <span class="n">value2</span><span class="p">))</span></div>

<div class="viewcode-block" id="PairPosBuilder.addGlyphPair"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.PairPosBuilder.addGlyphPair">[docs]</a>    <span class="k">def</span> <span class="nf">addGlyphPair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyph1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyph2</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">glyph1</span><span class="p">,</span> <span class="n">glyph2</span><span class="p">)</span>
        <span class="n">oldValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphPairs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">oldValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># the Feature File spec explicitly allows specific pairs generated</span>
            <span class="c1"># by an &#39;enum&#39; rule to be overridden by preceding single pairs</span>
            <span class="n">otherLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;Already defined position for pair </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> at </span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1">; &#39;</span>
                <span class="s1">&#39;choosing the first value&#39;</span><span class="p">,</span>
                <span class="n">glyph1</span><span class="p">,</span> <span class="n">glyph2</span><span class="p">,</span> <span class="n">otherLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">otherLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">otherLoc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">makeOpenTypeValueRecord</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">val2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">makeOpenTypeValueRecord</span><span class="p">(</span><span class="n">value2</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glyphPairs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span></div>

<div class="viewcode-block" id="PairPosBuilder.add_subtable_break"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.PairPosBuilder.add_subtable_break">[docs]</a>    <span class="k">def</span> <span class="nf">add_subtable_break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">))</span></div>

<div class="viewcode-block" id="PairPosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.PairPosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glyphPairs</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">glyphPairs</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span></div>

<div class="viewcode-block" id="PairPosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.PairPosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">builders</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">glyphclass1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">glyphclass2</span><span class="p">,</span> <span class="n">value2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">glyphclass1</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUBTABLE_BREAK_</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">builder</span><span class="o">.</span><span class="n">addSubtableBreak</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="n">val1</span><span class="p">,</span> <span class="n">valFormat1</span> <span class="o">=</span> <span class="n">makeOpenTypeValueRecord</span><span class="p">(</span>
                <span class="n">value1</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">val2</span><span class="p">,</span> <span class="n">valFormat2</span> <span class="o">=</span> <span class="n">makeOpenTypeValueRecord</span><span class="p">(</span>
                <span class="n">value2</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">builders</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">valFormat1</span><span class="p">,</span> <span class="n">valFormat2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">builder</span> <span class="o">=</span> <span class="n">ClassPairPosSubtableBuilder</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">valFormat1</span><span class="p">,</span> <span class="n">valFormat2</span><span class="p">)</span>
                <span class="n">builders</span><span class="p">[(</span><span class="n">valFormat1</span><span class="p">,</span> <span class="n">valFormat2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">addPair</span><span class="p">(</span><span class="n">glyphclass1</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">glyphclass2</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphPairs</span><span class="p">:</span>
            <span class="n">subtables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">otl</span><span class="o">.</span><span class="n">buildPairPosGlyphs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glyphPairs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">builders</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">subtables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">builders</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">subtables</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SinglePosBuilder"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SinglePosBuilder">[docs]</a><span class="k">class</span> <span class="nc">SinglePosBuilder</span><span class="p">(</span><span class="n">LookupBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">LookupBuilder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyph -&gt; (filename, line, column)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># glyph -&gt; otTables.ValueRecord</span>

<div class="viewcode-block" id="SinglePosBuilder.add_pos"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SinglePosBuilder.add_pos">[docs]</a>    <span class="k">def</span> <span class="nf">add_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">valueRecord</span><span class="p">):</span>
        <span class="n">otValueRecord</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">makeOpenTypeValueRecord</span><span class="p">(</span>
            <span class="n">valueRecord</span><span class="p">,</span> <span class="n">pairPosContext</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_add</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">otValueRecord</span><span class="p">):</span>
            <span class="n">otherLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">FeatureLibError</span><span class="p">(</span>
                <span class="s1">&#39;Already defined different position for glyph &quot;</span><span class="si">%s</span><span class="s1">&quot; at </span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">otherLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">otherLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">otherLoc</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">otValueRecord</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">otValueRecord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span></div>

<div class="viewcode-block" id="SinglePosBuilder.can_add"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SinglePosBuilder.can_add">[docs]</a>    <span class="k">def</span> <span class="nf">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">otl</span><span class="o">.</span><span class="n">ValueRecord</span><span class="p">)</span>
        <span class="n">curValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">curValue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">curValue</span> <span class="o">==</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SinglePosBuilder.equals"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SinglePosBuilder.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LookupBuilder</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="SinglePosBuilder.build"><a class="viewcode-back" href="../../../feaLib/builder.html#fontTools.feaLib.builder.SinglePosBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subtables</span> <span class="o">=</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildSinglePos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphMap</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildLookup_</span><span class="p">(</span><span class="n">subtables</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>