

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.misc.bezierTools &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>fontTools.misc.bezierTools</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.misc.bezierTools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;fontTools.misc.bezierTools.py -- tools for working with bezier path segments.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">fontTools.misc.arrayTools</span> <span class="k">import</span> <span class="n">calcBounds</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;approximateCubicArcLength&quot;</span><span class="p">,</span>
    <span class="s2">&quot;approximateCubicArcLengthC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;approximateQuadraticArcLength&quot;</span><span class="p">,</span>
    <span class="s2">&quot;approximateQuadraticArcLengthC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calcCubicArcLength&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calcCubicArcLengthC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calcQuadraticArcLength&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calcQuadraticArcLengthC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calcCubicBounds&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calcQuadraticBounds&quot;</span><span class="p">,</span>
    <span class="s2">&quot;splitLine&quot;</span><span class="p">,</span>
    <span class="s2">&quot;splitQuadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;splitCubic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;splitQuadraticAtT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;splitCubicAtT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;solveQuadratic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;solveCubic&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="calcCubicArcLength"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.calcCubicArcLength">[docs]</a><span class="k">def</span> <span class="nf">calcCubicArcLength</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.005</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the arc length for a cubic bezier segment.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">calcCubicArcLengthC</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt1</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt2</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt3</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt4</span><span class="p">),</span> <span class="n">tolerance</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_split_cubic_into_two</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p3</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">125</span>
    <span class="n">deriv3</span> <span class="o">=</span> <span class="p">(</span><span class="n">p3</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">125</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">p0</span><span class="p">,</span> <span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">mid</span> <span class="o">-</span> <span class="n">deriv3</span><span class="p">,</span> <span class="n">mid</span><span class="p">),</span>
            <span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="n">deriv3</span><span class="p">,</span> <span class="p">(</span><span class="n">p2</span> <span class="o">+</span> <span class="n">p3</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">p3</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_calcCubicArcLengthCRecurse</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
	<span class="n">arch</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p0</span><span class="o">-</span><span class="n">p3</span><span class="p">)</span>
	<span class="n">box</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p0</span><span class="o">-</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">p3</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">arch</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">&gt;=</span> <span class="n">box</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">arch</span> <span class="o">+</span> <span class="n">box</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">one</span><span class="p">,</span><span class="n">two</span> <span class="o">=</span> <span class="n">_split_cubic_into_two</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">_calcCubicArcLengthCRecurse</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="o">*</span><span class="n">one</span><span class="p">)</span> <span class="o">+</span> <span class="n">_calcCubicArcLengthCRecurse</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="o">*</span><span class="n">two</span><span class="p">)</span>

<div class="viewcode-block" id="calcCubicArcLengthC"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.calcCubicArcLengthC">[docs]</a><span class="k">def</span> <span class="nf">calcCubicArcLengthC</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.005</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the arc length for a cubic bezier segment using complex points.&quot;&quot;&quot;</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">tolerance</span> <span class="c1"># The 1.5 is a empirical hack; no math</span>
    <span class="k">return</span> <span class="n">_calcCubicArcLengthCRecurse</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span></div>


<span class="n">epsilonDigits</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-10</span>


<span class="k">def</span> <span class="nf">_dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span> <span class="o">*</span> <span class="n">v2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">())</span><span class="o">.</span><span class="n">real</span>


<span class="k">def</span> <span class="nf">_intSecAtan</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># In : sympy.integrate(sp.sec(sp.atan(x)))</span>
    <span class="c1"># Out: x*sqrt(x**2 + 1)/2 + asinh(x)/2</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">asinh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<div class="viewcode-block" id="calcQuadraticArcLength"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.calcQuadraticArcLength">[docs]</a><span class="k">def</span> <span class="nf">calcQuadraticArcLength</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the arc length for a qudratic bezier segment.</span>
<span class="sd">    pt1 and pt3 are the &quot;anchor&quot; points, pt2 is the &quot;handle&quot;.</span>

<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (0, 0), (0, 0)) # empty segment</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (50, 0), (80, 0)) # collinear points</span>
<span class="sd">        80.0</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (0, 50), (0, 80)) # collinear points vertical</span>
<span class="sd">        80.0</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (50, 20), (100, 40)) # collinear points</span>
<span class="sd">        107.70329614269008</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (0, 100), (100, 0))</span>
<span class="sd">        154.02976155645263</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (0, 50), (100, 0))</span>
<span class="sd">        120.21581243984076</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (50, -10), (80, 50))</span>
<span class="sd">        102.53273816445825</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (40, 0), (-40, 0)) # collinear points, control point outside</span>
<span class="sd">        66.66666666666667</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticArcLength((0, 0), (40, 0), (0, 0)) # collinear points, looping back</span>
<span class="sd">        40.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">calcQuadraticArcLengthC</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt1</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt2</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt3</span><span class="p">))</span></div>


<div class="viewcode-block" id="calcQuadraticArcLengthC"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.calcQuadraticArcLengthC">[docs]</a><span class="k">def</span> <span class="nf">calcQuadraticArcLengthC</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the arc length for a qudratic bezier segment using complex points.</span>
<span class="sd">    pt1 and pt3 are the &quot;anchor&quot; points, pt2 is the &quot;handle&quot;.&quot;&quot;&quot;</span>

    <span class="c1"># Analytical solution to the length of a quadratic bezier.</span>
    <span class="c1"># I&#39;ll explain how I arrived at this later.</span>
    <span class="n">d0</span> <span class="o">=</span> <span class="n">pt2</span> <span class="o">-</span> <span class="n">pt1</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">pt3</span> <span class="o">-</span> <span class="n">pt2</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">d0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt3</span><span class="o">-</span><span class="n">pt1</span><span class="p">)</span>
    <span class="n">origDist</span> <span class="o">=</span> <span class="n">_dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">origDist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_dot</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span><span class="n">d1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt3</span><span class="o">-</span><span class="n">pt1</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d0</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">_dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">d0</span><span class="p">)</span> <span class="o">/</span> <span class="n">origDist</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">_dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="n">origDist</span>
    <span class="n">Len</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">_intSecAtan</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="n">_intSecAtan</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span> <span class="o">*</span> <span class="n">origDist</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">Len</span></div>


<div class="viewcode-block" id="approximateQuadraticArcLength"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.approximateQuadraticArcLength">[docs]</a><span class="k">def</span> <span class="nf">approximateQuadraticArcLength</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
    <span class="c1"># Approximate length of quadratic Bezier curve using Gauss-Legendre quadrature</span>
    <span class="c1"># with n=3 points.</span>
    <span class="k">return</span> <span class="n">approximateQuadraticArcLengthC</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt1</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt2</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt3</span><span class="p">))</span></div>


<div class="viewcode-block" id="approximateQuadraticArcLengthC"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.approximateQuadraticArcLengthC">[docs]</a><span class="k">def</span> <span class="nf">approximateQuadraticArcLengthC</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
    <span class="c1"># Approximate length of quadratic Bezier curve using Gauss-Legendre quadrature</span>
    <span class="c1"># with n=3 points for complex points.</span>
    <span class="c1">#</span>
    <span class="c1"># This, essentially, approximates the length-of-derivative function</span>
    <span class="c1"># to be integrated with the best-matching fifth-degree polynomial</span>
    <span class="c1"># approximation of it.</span>
    <span class="c1">#</span>
    <span class="c1">#https://en.wikipedia.org/wiki/Gaussian_quadrature#Gauss.E2.80.93Legendre_quadrature</span>

    <span class="c1"># abs(BezierCurveC[2].diff(t).subs({t:T})) for T in sorted(.5, .5±sqrt(3/5)/2),</span>
    <span class="c1"># weighted 5/18, 8/18, 5/18 respectively.</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">0.492943519233745</span><span class="o">*</span><span class="n">pt1</span> <span class="o">+</span> <span class="mf">0.430331482911935</span><span class="o">*</span><span class="n">pt2</span> <span class="o">+</span> <span class="mf">0.0626120363218102</span><span class="o">*</span><span class="n">pt3</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt3</span><span class="o">-</span><span class="n">pt1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4444444444444444</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0626120363218102</span><span class="o">*</span><span class="n">pt1</span> <span class="o">-</span> <span class="mf">0.430331482911935</span><span class="o">*</span><span class="n">pt2</span> <span class="o">+</span> <span class="mf">0.492943519233745</span><span class="o">*</span><span class="n">pt3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span></div>


<div class="viewcode-block" id="calcQuadraticBounds"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.calcQuadraticBounds">[docs]</a><span class="k">def</span> <span class="nf">calcQuadraticBounds</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the bounding rectangle for a qudratic bezier segment.</span>
<span class="sd">    pt1 and pt3 are the &quot;anchor&quot; points, pt2 is the &quot;handle&quot;.</span>

<span class="sd">        &gt;&gt;&gt; calcQuadraticBounds((0, 0), (50, 100), (100, 0))</span>
<span class="sd">        (0, 0, 100, 50.0)</span>
<span class="sd">        &gt;&gt;&gt; calcQuadraticBounds((0, 0), (100, 0), (100, 100))</span>
<span class="sd">        (0.0, 0.0, 100, 100)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span> <span class="o">=</span> <span class="n">calcQuadraticParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">*</span><span class="mf">2.0</span>
    <span class="n">ay2</span> <span class="o">=</span> <span class="n">ay</span><span class="o">*</span><span class="mf">2.0</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">ax2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">roots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">bx</span><span class="o">/</span><span class="n">ax2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ay2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">roots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">by</span><span class="o">/</span><span class="n">ay2</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ax</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">bx</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">cx</span><span class="p">,</span> <span class="n">ay</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">by</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">cy</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">roots</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">calcBounds</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>


<div class="viewcode-block" id="approximateCubicArcLength"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.approximateCubicArcLength">[docs]</a><span class="k">def</span> <span class="nf">approximateCubicArcLength</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the approximate arc length for a cubic bezier segment.</span>
<span class="sd">    pt1 and pt4 are the &quot;anchor&quot; points, pt2 and pt3 are the &quot;handles&quot;.</span>

<span class="sd">        &gt;&gt;&gt; approximateCubicArcLength((0, 0), (25, 100), (75, 100), (100, 0))</span>
<span class="sd">        190.04332968932817</span>
<span class="sd">        &gt;&gt;&gt; approximateCubicArcLength((0, 0), (50, 0), (100, 50), (100, 100))</span>
<span class="sd">        154.8852074945903</span>
<span class="sd">        &gt;&gt;&gt; approximateCubicArcLength((0, 0), (50, 0), (100, 0), (150, 0)) # line; exact result should be 150.</span>
<span class="sd">        149.99999999999991</span>
<span class="sd">        &gt;&gt;&gt; approximateCubicArcLength((0, 0), (50, 0), (100, 0), (-50, 0)) # cusp; exact result should be 150.</span>
<span class="sd">        136.9267662156362</span>
<span class="sd">        &gt;&gt;&gt; approximateCubicArcLength((0, 0), (50, 0), (100, -50), (-50, 0)) # cusp</span>
<span class="sd">        154.80848416537057</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Approximate length of cubic Bezier curve using Gauss-Lobatto quadrature</span>
    <span class="c1"># with n=5 points.</span>
    <span class="k">return</span> <span class="n">approximateCubicArcLengthC</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt1</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt2</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt3</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">pt4</span><span class="p">))</span></div>


<div class="viewcode-block" id="approximateCubicArcLengthC"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.approximateCubicArcLengthC">[docs]</a><span class="k">def</span> <span class="nf">approximateCubicArcLengthC</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the approximate arc length for a cubic bezier segment of complex points.</span>
<span class="sd">    pt1 and pt4 are the &quot;anchor&quot; points, pt2 and pt3 are the &quot;handles&quot;.&quot;&quot;&quot;</span>

    <span class="c1"># Approximate length of cubic Bezier curve using Gauss-Lobatto quadrature</span>
    <span class="c1"># with n=5 points for complex points.</span>
    <span class="c1">#</span>
    <span class="c1"># This, essentially, approximates the length-of-derivative function</span>
    <span class="c1"># to be integrated with the best-matching seventh-degree polynomial</span>
    <span class="c1"># approximation of it.</span>
    <span class="c1">#</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Gaussian_quadrature#Gauss.E2.80.93Lobatto_rules</span>

    <span class="c1"># abs(BezierCurveC[3].diff(t).subs({t:T})) for T in sorted(0, .5±(3/7)**.5/2, .5, 1),</span>
    <span class="c1"># weighted 1/20, 49/180, 32/90, 49/180, 1/20 respectively.</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt2</span><span class="o">-</span><span class="n">pt1</span><span class="p">)</span><span class="o">*.</span><span class="mi">15</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">0.558983582205757</span><span class="o">*</span><span class="n">pt1</span> <span class="o">+</span> <span class="mf">0.325650248872424</span><span class="o">*</span><span class="n">pt2</span> <span class="o">+</span> <span class="mf">0.208983582205757</span><span class="o">*</span><span class="n">pt3</span> <span class="o">+</span> <span class="mf">0.024349751127576</span><span class="o">*</span><span class="n">pt4</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt4</span><span class="o">-</span><span class="n">pt1</span><span class="o">+</span><span class="n">pt3</span><span class="o">-</span><span class="n">pt2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.26666666666666666</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">0.024349751127576</span><span class="o">*</span><span class="n">pt1</span> <span class="o">-</span> <span class="mf">0.208983582205757</span><span class="o">*</span><span class="n">pt2</span> <span class="o">-</span> <span class="mf">0.325650248872424</span><span class="o">*</span><span class="n">pt3</span> <span class="o">+</span> <span class="mf">0.558983582205757</span><span class="o">*</span><span class="n">pt4</span><span class="p">)</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt4</span><span class="o">-</span><span class="n">pt3</span><span class="p">)</span><span class="o">*.</span><span class="mi">15</span>

    <span class="k">return</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span> <span class="o">+</span> <span class="n">v4</span></div>


<div class="viewcode-block" id="calcCubicBounds"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.calcCubicBounds">[docs]</a><span class="k">def</span> <span class="nf">calcCubicBounds</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the bounding rectangle for a cubic bezier segment.</span>
<span class="sd">    pt1 and pt4 are the &quot;anchor&quot; points, pt2 and pt3 are the &quot;handles&quot;.</span>

<span class="sd">        &gt;&gt;&gt; calcCubicBounds((0, 0), (25, 100), (75, 100), (100, 0))</span>
<span class="sd">        (0, 0, 100, 75.0)</span>
<span class="sd">        &gt;&gt;&gt; calcCubicBounds((0, 0), (50, 0), (100, 50), (100, 100))</span>
<span class="sd">        (0.0, 0.0, 100, 100)</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;%f %f %f %f&quot; % calcCubicBounds((50, 0), (0, 100), (100, 100), (50, 0)))</span>
<span class="sd">        35.566243 0.000000 64.433757 75.000000</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">=</span> <span class="n">calcCubicParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
    <span class="c1"># calc first derivative</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">*</span> <span class="mf">3.0</span>
    <span class="n">ay3</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">*</span> <span class="mf">3.0</span>
    <span class="n">bx2</span> <span class="o">=</span> <span class="n">bx</span> <span class="o">*</span> <span class="mf">2.0</span>
    <span class="n">by2</span> <span class="o">=</span> <span class="n">by</span> <span class="o">*</span> <span class="mf">2.0</span>
    <span class="n">xRoots</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">solveQuadratic</span><span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">bx2</span><span class="p">,</span> <span class="n">cx</span><span class="p">)</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">yRoots</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">solveQuadratic</span><span class="p">(</span><span class="n">ay3</span><span class="p">,</span> <span class="n">by2</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">xRoots</span> <span class="o">+</span> <span class="n">yRoots</span>

    <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ax</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">bx</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ay</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">by</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">calcBounds</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitLine"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.splitLine">[docs]</a><span class="k">def</span> <span class="nf">splitLine</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">isHorizontal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the line between pt1 and pt2 at position &#39;where&#39;, which</span>
<span class="sd">    is an x coordinate if isHorizontal is False, a y coordinate if</span>
<span class="sd">    isHorizontal is True. Return a list of two line segments if the</span>
<span class="sd">    line was successfully split, or a list containing the original</span>
<span class="sd">    line.</span>

<span class="sd">        &gt;&gt;&gt; printSegments(splitLine((0, 0), (100, 100), 50, True))</span>
<span class="sd">        ((0, 0), (50, 50))</span>
<span class="sd">        ((50, 50), (100, 100))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitLine((0, 0), (100, 100), 100, True))</span>
<span class="sd">        ((0, 0), (100, 100))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitLine((0, 0), (100, 100), 0, True))</span>
<span class="sd">        ((0, 0), (0, 0))</span>
<span class="sd">        ((0, 0), (100, 100))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitLine((0, 0), (100, 100), 0, False))</span>
<span class="sd">        ((0, 0), (0, 0))</span>
<span class="sd">        ((0, 0), (100, 100))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitLine((100, 0), (0, 0), 50, False))</span>
<span class="sd">        ((100, 0), (50, 0))</span>
<span class="sd">        ((50, 0), (0, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitLine((0, 100), (0, 0), 50, True))</span>
<span class="sd">        ((0, 100), (0, 50))</span>
<span class="sd">        ((0, 50), (0, 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pt1x</span><span class="p">,</span> <span class="n">pt1y</span> <span class="o">=</span> <span class="n">pt1</span>
    <span class="n">pt2x</span><span class="p">,</span> <span class="n">pt2y</span> <span class="o">=</span> <span class="n">pt2</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt2x</span> <span class="o">-</span> <span class="n">pt1x</span><span class="p">)</span>
    <span class="n">ay</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt2y</span> <span class="o">-</span> <span class="n">pt1y</span><span class="p">)</span>

    <span class="n">bx</span> <span class="o">=</span> <span class="n">pt1x</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">pt1y</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">)[</span><span class="n">isHorizontal</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">where</span> <span class="o">-</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">)[</span><span class="n">isHorizontal</span><span class="p">])</span> <span class="o">/</span> <span class="n">a</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">midPt</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">bx</span><span class="p">,</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">by</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">midPt</span><span class="p">),</span> <span class="p">(</span><span class="n">midPt</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)]</span></div>


<div class="viewcode-block" id="splitQuadratic"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.splitQuadratic">[docs]</a><span class="k">def</span> <span class="nf">splitQuadratic</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">isHorizontal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the quadratic curve between pt1, pt2 and pt3 at position &#39;where&#39;,</span>
<span class="sd">    which is an x coordinate if isHorizontal is False, a y coordinate if</span>
<span class="sd">    isHorizontal is True. Return a list of curve segments.</span>

<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadratic((0, 0), (50, 100), (100, 0), 150, False))</span>
<span class="sd">        ((0, 0), (50, 100), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadratic((0, 0), (50, 100), (100, 0), 50, False))</span>
<span class="sd">        ((0, 0), (25, 50), (50, 50))</span>
<span class="sd">        ((50, 50), (75, 50), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadratic((0, 0), (50, 100), (100, 0), 25, False))</span>
<span class="sd">        ((0, 0), (12.5, 25), (25, 37.5))</span>
<span class="sd">        ((25, 37.5), (62.5, 75), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadratic((0, 0), (50, 100), (100, 0), 25, True))</span>
<span class="sd">        ((0, 0), (7.32233, 14.6447), (14.6447, 25))</span>
<span class="sd">        ((14.6447, 25), (50, 75), (85.3553, 25))</span>
<span class="sd">        ((85.3553, 25), (92.6777, 14.6447), (100, -7.10543e-15))</span>
<span class="sd">        &gt;&gt;&gt; # XXX I&#39;m not at all sure if the following behavior is desirable:</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadratic((0, 0), (50, 100), (100, 0), 50, True))</span>
<span class="sd">        ((0, 0), (25, 50), (50, 50))</span>
<span class="sd">        ((50, 50), (50, 50), (50, 50))</span>
<span class="sd">        ((50, 50), (75, 50), (100, 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">calcQuadraticParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
    <span class="n">solutions</span> <span class="o">=</span> <span class="n">solveQuadratic</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">],</span>
        <span class="n">c</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">]</span> <span class="o">-</span> <span class="n">where</span><span class="p">)</span>
    <span class="n">solutions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">solutions</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">solutions</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">_splitQuadraticAtT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">solutions</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitCubic"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.splitCubic">[docs]</a><span class="k">def</span> <span class="nf">splitCubic</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">isHorizontal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the cubic curve between pt1, pt2, pt3 and pt4 at position &#39;where&#39;,</span>
<span class="sd">    which is an x coordinate if isHorizontal is False, a y coordinate if</span>
<span class="sd">    isHorizontal is True. Return a list of curve segments.</span>

<span class="sd">        &gt;&gt;&gt; printSegments(splitCubic((0, 0), (25, 100), (75, 100), (100, 0), 150, False))</span>
<span class="sd">        ((0, 0), (25, 100), (75, 100), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitCubic((0, 0), (25, 100), (75, 100), (100, 0), 50, False))</span>
<span class="sd">        ((0, 0), (12.5, 50), (31.25, 75), (50, 75))</span>
<span class="sd">        ((50, 75), (68.75, 75), (87.5, 50), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitCubic((0, 0), (25, 100), (75, 100), (100, 0), 25, True))</span>
<span class="sd">        ((0, 0), (2.29379, 9.17517), (4.79804, 17.5085), (7.47414, 25))</span>
<span class="sd">        ((7.47414, 25), (31.2886, 91.6667), (68.7114, 91.6667), (92.5259, 25))</span>
<span class="sd">        ((92.5259, 25), (95.202, 17.5085), (97.7062, 9.17517), (100, 1.77636e-15))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">calcCubicParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
    <span class="n">solutions</span> <span class="o">=</span> <span class="n">solveCubic</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">],</span>
        <span class="n">d</span><span class="p">[</span><span class="n">isHorizontal</span><span class="p">]</span> <span class="o">-</span> <span class="n">where</span><span class="p">)</span>
    <span class="n">solutions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">solutions</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">solutions</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">_splitCubicAtT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">solutions</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitQuadraticAtT"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.splitQuadraticAtT">[docs]</a><span class="k">def</span> <span class="nf">splitQuadraticAtT</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="o">*</span><span class="n">ts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the quadratic curve between pt1, pt2 and pt3 at one or more</span>
<span class="sd">    values of t. Return a list of curve segments.</span>

<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadraticAtT((0, 0), (50, 100), (100, 0), 0.5))</span>
<span class="sd">        ((0, 0), (25, 50), (50, 50))</span>
<span class="sd">        ((50, 50), (75, 50), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitQuadraticAtT((0, 0), (50, 100), (100, 0), 0.5, 0.75))</span>
<span class="sd">        ((0, 0), (25, 50), (50, 50))</span>
<span class="sd">        ((50, 50), (62.5, 50), (75, 37.5))</span>
<span class="sd">        ((75, 37.5), (87.5, 25), (100, 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">calcQuadraticParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_splitQuadraticAtT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">ts</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitCubicAtT"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.splitCubicAtT">[docs]</a><span class="k">def</span> <span class="nf">splitCubicAtT</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">,</span> <span class="o">*</span><span class="n">ts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the cubic curve between pt1, pt2, pt3 and pt4 at one or more</span>
<span class="sd">    values of t. Return a list of curve segments.</span>

<span class="sd">        &gt;&gt;&gt; printSegments(splitCubicAtT((0, 0), (25, 100), (75, 100), (100, 0), 0.5))</span>
<span class="sd">        ((0, 0), (12.5, 50), (31.25, 75), (50, 75))</span>
<span class="sd">        ((50, 75), (68.75, 75), (87.5, 50), (100, 0))</span>
<span class="sd">        &gt;&gt;&gt; printSegments(splitCubicAtT((0, 0), (25, 100), (75, 100), (100, 0), 0.5, 0.75))</span>
<span class="sd">        ((0, 0), (12.5, 50), (31.25, 75), (50, 75))</span>
<span class="sd">        ((50, 75), (59.375, 75), (68.75, 68.75), (77.3438, 56.25))</span>
<span class="sd">        ((77.3438, 56.25), (85.9375, 43.75), (93.75, 25), (100, 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">calcCubicParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_splitCubicAtT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">ts</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_splitQuadraticAtT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">ts</span><span class="p">):</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span>
        <span class="c1"># calc new a, b and c</span>
        <span class="n">delta_2</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">delta</span>
        <span class="n">a1x</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">delta_2</span>
        <span class="n">a1y</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">delta_2</span>
        <span class="n">b1x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">bx</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">b1y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ay</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">t1_2</span> <span class="o">=</span> <span class="n">t1</span><span class="o">*</span><span class="n">t1</span>
        <span class="n">c1x</span> <span class="o">=</span> <span class="n">ax</span><span class="o">*</span><span class="n">t1_2</span> <span class="o">+</span> <span class="n">bx</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">cx</span>
        <span class="n">c1y</span> <span class="o">=</span> <span class="n">ay</span><span class="o">*</span><span class="n">t1_2</span> <span class="o">+</span> <span class="n">by</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">cy</span>

        <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span> <span class="o">=</span> <span class="n">calcQuadraticPoints</span><span class="p">((</span><span class="n">a1x</span><span class="p">,</span> <span class="n">a1y</span><span class="p">),</span> <span class="p">(</span><span class="n">b1x</span><span class="p">,</span> <span class="n">b1y</span><span class="p">),</span> <span class="p">(</span><span class="n">c1x</span><span class="p">,</span> <span class="n">c1y</span><span class="p">))</span>
        <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">segments</span>


<span class="k">def</span> <span class="nf">_splitCubicAtT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">ts</span><span class="p">):</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">d</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span>

        <span class="n">delta_2</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">delta</span>
        <span class="n">delta_3</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">delta_2</span>
        <span class="n">t1_2</span> <span class="o">=</span> <span class="n">t1</span><span class="o">*</span><span class="n">t1</span>
        <span class="n">t1_3</span> <span class="o">=</span> <span class="n">t1</span><span class="o">*</span><span class="n">t1_2</span>

        <span class="c1"># calc new a, b, c and d</span>
        <span class="n">a1x</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">delta_3</span>
        <span class="n">a1y</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">delta_3</span>
        <span class="n">b1x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">bx</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_2</span>
        <span class="n">b1y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">ay</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_2</span>
        <span class="n">c1x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bx</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">t1_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">c1y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">by</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">cy</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">ay</span><span class="o">*</span><span class="n">t1_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">d1x</span> <span class="o">=</span> <span class="n">ax</span><span class="o">*</span><span class="n">t1_3</span> <span class="o">+</span> <span class="n">bx</span><span class="o">*</span><span class="n">t1_2</span> <span class="o">+</span> <span class="n">cx</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">d1y</span> <span class="o">=</span> <span class="n">ay</span><span class="o">*</span><span class="n">t1_3</span> <span class="o">+</span> <span class="n">by</span><span class="o">*</span><span class="n">t1_2</span> <span class="o">+</span> <span class="n">cy</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">dy</span>
        <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span> <span class="o">=</span> <span class="n">calcCubicPoints</span><span class="p">((</span><span class="n">a1x</span><span class="p">,</span> <span class="n">a1y</span><span class="p">),</span> <span class="p">(</span><span class="n">b1x</span><span class="p">,</span> <span class="n">b1y</span><span class="p">),</span> <span class="p">(</span><span class="n">c1x</span><span class="p">,</span> <span class="n">c1y</span><span class="p">),</span> <span class="p">(</span><span class="n">d1x</span><span class="p">,</span> <span class="n">d1y</span><span class="p">))</span>
        <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">segments</span>


<span class="c1">#</span>
<span class="c1"># Equation solvers.</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span>


<div class="viewcode-block" id="solveQuadratic"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.solveQuadratic">[docs]</a><span class="k">def</span> <span class="nf">solveQuadratic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span>
        <span class="n">sqrt</span><span class="o">=</span><span class="n">sqrt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve a quadratic equation where a, b and c are real.</span>
<span class="sd">        a*x*x + b*x + c = 0</span>
<span class="sd">    This function returns a list of roots. Note that the returned list</span>
<span class="sd">    is neither guaranteed to be sorted nor to contain unique values!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="c1"># We have a non-equation; therefore, we have no valid solution</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We have a linear equation with 1 root.</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="n">b</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We have a true quadratic equation.  Apply the quadratic formula to find two roots.</span>
        <span class="n">DD</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span>
        <span class="k">if</span> <span class="n">DD</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">rDD</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">DD</span><span class="p">)</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">b</span><span class="o">+</span><span class="n">rDD</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">-</span><span class="n">rDD</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">a</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># complex roots, ignore</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">roots</span></div>


<div class="viewcode-block" id="solveCubic"><a class="viewcode-back" href="../../../misc/bezierTools.html#fontTools.misc.bezierTools.solveCubic">[docs]</a><span class="k">def</span> <span class="nf">solveCubic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve a cubic equation where a, b, c and d are real.</span>
<span class="sd">        a*x*x*x + b*x*x + c*x + d = 0</span>
<span class="sd">    This function returns a list of roots. Note that the returned list</span>
<span class="sd">    is neither guaranteed to be sorted nor to contain unique values!</span>

<span class="sd">    &gt;&gt;&gt; solveCubic(1, 1, -6, 0)</span>
<span class="sd">    [-3.0, -0.0, 2.0]</span>
<span class="sd">    &gt;&gt;&gt; solveCubic(-10.0, -9.0, 48.0, -29.0)</span>
<span class="sd">    [-2.9, 1.0, 1.0]</span>
<span class="sd">    &gt;&gt;&gt; solveCubic(-9.875, -9.0, 47.625, -28.75)</span>
<span class="sd">    [-2.911392, 1.0, 1.0]</span>
<span class="sd">    &gt;&gt;&gt; solveCubic(1.0, -4.5, 6.75, -3.375)</span>
<span class="sd">    [1.5, 1.5, 1.5]</span>
<span class="sd">    &gt;&gt;&gt; solveCubic(-12.0, 18.0, -9.0, 1.50023651123)</span>
<span class="sd">    [0.5, 0.5, 0.5]</span>
<span class="sd">    &gt;&gt;&gt; solveCubic(</span>
<span class="sd">    ...     9.0, 0.0, 0.0, -7.62939453125e-05</span>
<span class="sd">    ... ) == [-0.0, -0.0, -0.0]</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># adapted from:</span>
    <span class="c1">#   CUBIC.C - Solve a cubic polynomial</span>
    <span class="c1">#   public domain by Ross Cottrell</span>
    <span class="c1"># found at: http://www.strangecreations.com/library/snippets/Cubic.C</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
        <span class="c1"># don&#39;t just test for zero; for very small values of &#39;a&#39; solveCubic()</span>
        <span class="c1"># returns unreliable results, so we fall back to quad.</span>
        <span class="k">return</span> <span class="n">solveQuadratic</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">a</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">a</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">a1</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">a2</span><span class="p">)</span><span class="o">/</span><span class="mf">9.0</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a1</span> <span class="o">-</span> <span class="mf">9.0</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mf">27.0</span><span class="o">*</span><span class="n">a3</span><span class="p">)</span><span class="o">/</span><span class="mf">54.0</span>

    <span class="n">R2</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">R</span>
    <span class="n">Q3</span> <span class="o">=</span> <span class="n">Q</span><span class="o">*</span><span class="n">Q</span><span class="o">*</span><span class="n">Q</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">R2</span> <span class="o">&lt;</span> <span class="n">epsilon</span> <span class="k">else</span> <span class="n">R2</span>
    <span class="n">Q3</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Q3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span> <span class="k">else</span> <span class="n">Q3</span>

    <span class="n">R2_Q3</span> <span class="o">=</span> <span class="n">R2</span> <span class="o">-</span> <span class="n">Q3</span>

    <span class="k">if</span> <span class="n">R2</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">Q3</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">R2_Q3</span> <span class="o">&lt;=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">:</span>
        <span class="c1"># The epsilon * .5 above ensures that Q3 is not zero.</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">R</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q3</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="n">rQ2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">a1_3</span> <span class="o">=</span> <span class="n">a1</span><span class="o">/</span><span class="mf">3.0</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">rQ2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">a1_3</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">rQ2</span><span class="o">*</span><span class="n">cos</span><span class="p">((</span><span class="n">theta</span><span class="o">+</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">a1_3</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">rQ2</span><span class="o">*</span><span class="n">cos</span><span class="p">((</span><span class="n">theta</span><span class="o">+</span><span class="mf">4.0</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">a1_3</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>
        <span class="c1"># Merge roots that are close-enough</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">&lt;</span> <span class="n">epsilon</span> <span class="ow">and</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R2_Q3</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">Q</span><span class="o">/</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">R</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">a1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">epsilonDigits</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span></div>


<span class="c1">#</span>
<span class="c1"># Conversion routines for points to parameters and vice versa</span>
<span class="c1">#</span>

<span class="k">def</span> <span class="nf">calcQuadraticParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">pt2</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">pt3</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">pt1</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span>
    <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span>
    <span class="n">ay</span> <span class="o">=</span> <span class="n">y3</span> <span class="o">-</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">by</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calcCubicParameters</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">):</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">pt2</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">pt3</span>
    <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">pt4</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">pt1</span>
    <span class="n">cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span><span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.0</span>
    <span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.0</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.0</span> <span class="o">-</span> <span class="n">cx</span>
    <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.0</span> <span class="o">-</span> <span class="n">cy</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span>
    <span class="n">ay</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">by</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">),</span> <span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calcQuadraticPoints</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">cx</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">cy</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">bx</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="n">cx</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">by</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="n">cy</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">+</span> <span class="n">bx</span> <span class="o">+</span> <span class="n">cx</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">+</span> <span class="n">by</span> <span class="o">+</span> <span class="n">cy</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calcCubicPoints</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">d</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">dx</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">dy</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">cx</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">cy</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dy</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">bx</span> <span class="o">+</span> <span class="n">cx</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">+</span> <span class="n">x2</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="p">(</span><span class="n">by</span> <span class="o">+</span> <span class="n">cy</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">+</span> <span class="n">y2</span>
    <span class="n">x4</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">bx</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">by</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_segmentrepr</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; _segmentrepr([1, [2, 3], [], [[2, [3, 4], [0.1, 2.2]]]])</span>
<span class="sd">        &#39;(1, (2, 3), (), ((2, (3, 4), (0.1, 2.2))))&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_segmentrepr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">it</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">printSegments</span><span class="p">(</span><span class="n">segments</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper for the doctests, displaying each segment in a list of</span>
<span class="sd">    segments on a single line as a tuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">_segmentrepr</span><span class="p">(</span><span class="n">segment</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>