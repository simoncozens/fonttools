

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.ttLib.tables._c_m_a_p &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ttLib.html">fontTools.ttLib</a> &raquo;</li>
        
      <li>fontTools.ttLib.tables._c_m_a_p</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.ttLib.tables._c_m_a_p</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.textTools</span> <span class="k">import</span> <span class="n">safeEval</span><span class="p">,</span> <span class="n">readHex</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.encodingTools</span> <span class="k">import</span> <span class="n">getEncoding</span>
<span class="kn">from</span> <span class="nn">fontTools.ttLib</span> <span class="k">import</span> <span class="n">getSearchRange</span>
<span class="kn">from</span> <span class="nn">fontTools.unicode</span> <span class="k">import</span> <span class="n">Unicode</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">DefaultTable</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">import</span> <span class="nn">logging</span>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_make_map</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">chars</span><span class="p">,</span> <span class="n">gids</span><span class="p">):</span>
	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">char</span><span class="p">,</span><span class="n">gid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span><span class="n">gids</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">gid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="n">glyphOrder</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
		<span class="n">cmap</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
	<span class="k">return</span> <span class="n">cmap</span>

<div class="viewcode-block" id="table__c_m_a_p"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p">[docs]</a><span class="k">class</span> <span class="nc">table__c_m_a_p</span><span class="p">(</span><span class="n">DefaultTable</span><span class="o">.</span><span class="n">DefaultTable</span><span class="p">):</span>

<div class="viewcode-block" id="table__c_m_a_p.getcmap"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.getcmap">[docs]</a>	<span class="k">def</span> <span class="nf">getcmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">subtable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">platformID</span> <span class="o">==</span> <span class="n">platformID</span> <span class="ow">and</span>
					<span class="n">subtable</span><span class="o">.</span><span class="n">platEncID</span> <span class="o">==</span> <span class="n">platEncID</span><span class="p">):</span>
				<span class="k">return</span> <span class="n">subtable</span>
		<span class="k">return</span> <span class="kc">None</span> <span class="c1"># not found</span></div>

<div class="viewcode-block" id="table__c_m_a_p.getBestCmap"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.getBestCmap">[docs]</a>	<span class="k">def</span> <span class="nf">getBestCmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmapPreferences</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
		<span class="sd">&quot;&quot;&quot;Return the &#39;best&#39; unicode cmap dictionary available in the font,</span>
<span class="sd">		or None, if no unicode cmap subtable is available.</span>

<span class="sd">		By default it will search for the following (platformID, platEncID)</span>
<span class="sd">		pairs:</span>
<span class="sd">			(3, 10), (0, 6), (0, 4), (3, 1), (0, 3), (0, 2), (0, 1), (0, 0)</span>
<span class="sd">		This can be customized via the cmapPreferences argument.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span> <span class="ow">in</span> <span class="n">cmapPreferences</span><span class="p">:</span>
			<span class="n">cmapSubtable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getcmap</span><span class="p">(</span><span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">cmapSubtable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">cmapSubtable</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">return</span> <span class="kc">None</span>  <span class="c1"># None of the requested cmap subtables were found</span></div>

<div class="viewcode-block" id="table__c_m_a_p.buildReversed"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.buildReversed">[docs]</a>	<span class="k">def</span> <span class="nf">buildReversed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Returns a reverse cmap such as {&#39;one&#39;:{0x31}, &#39;A&#39;:{0x41,0x391}}.</span>

<span class="sd">		The values are sets of Unicode codepoints because</span>
<span class="sd">		some fonts map different codepoints to the same glyph.</span>
<span class="sd">		For example, U+0041 LATIN CAPITAL LETTER A and U+0391</span>
<span class="sd">		GREEK CAPITAL LETTER ALPHA are sometimes the same glyph.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">subtable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">subtable</span><span class="o">.</span><span class="n">isUnicode</span><span class="p">():</span>
				<span class="k">for</span> <span class="n">codepoint</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">subtable</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
					<span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">codepoint</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="table__c_m_a_p.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">tableVersion</span><span class="p">,</span> <span class="n">numSubTables</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tableVersion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tableVersion</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">seenOffsets</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSubTables</span><span class="p">):</span>
			<span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
					<span class="s2">&quot;&gt;HHl&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">8</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">])</span>
			<span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">platformID</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">platEncID</span><span class="p">)</span>
			<span class="nb">format</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
			<span class="k">if</span> <span class="nb">format</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">]:</span>
				<span class="nb">format</span><span class="p">,</span> <span class="n">reserved</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HHL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">8</span><span class="p">])</span>
			<span class="k">elif</span> <span class="nb">format</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span>
				<span class="nb">format</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">6</span><span class="p">])</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="n">length</span><span class="p">:</span>
				<span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
					<span class="s2">&quot;cmap subtable is reported as having zero length: platformID </span><span class="si">%s</span><span class="s2">, &quot;</span>
					<span class="s2">&quot;platEncID </span><span class="si">%s</span><span class="s2">, format </span><span class="si">%s</span><span class="s2"> offset </span><span class="si">%s</span><span class="s2">. Skipping table.&quot;</span><span class="p">,</span>
					<span class="n">platformID</span><span class="p">,</span> <span class="n">platEncID</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
				<span class="k">continue</span>
			<span class="n">table</span> <span class="o">=</span> <span class="n">CmapSubtable</span><span class="o">.</span><span class="n">newSubtable</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
			<span class="n">table</span><span class="o">.</span><span class="n">platformID</span> <span class="o">=</span> <span class="n">platformID</span>
			<span class="n">table</span><span class="o">.</span><span class="n">platEncID</span> <span class="o">=</span> <span class="n">platEncID</span>
			<span class="c1"># Note that by default we decompile only the subtable header info;</span>
			<span class="c1"># any other data gets decompiled only when an attribute of the</span>
			<span class="c1"># subtable is referenced.</span>
			<span class="n">table</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)],</span> <span class="n">ttFont</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">seenOffsets</span><span class="p">:</span>
				<span class="n">table</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Mark as decompiled</span>
				<span class="n">table</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">seenOffsets</span><span class="p">[</span><span class="n">offset</span><span class="p">]]</span><span class="o">.</span><span class="n">cmap</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">seenOffsets</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
			<span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></div>

<div class="viewcode-block" id="table__c_m_a_p.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># sort according to the spec; see CmapSubtable.__lt__()</span>
		<span class="n">numSubTables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">)</span>
		<span class="n">totalOffset</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">numSubTables</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tableVersion</span><span class="p">,</span> <span class="n">numSubTables</span><span class="p">)</span>
		<span class="n">tableData</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
		<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Some tables are the same object reference. Don&#39;t compile them twice.</span>
		<span class="n">done</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Some tables are different objects, but compile to the same data chunk</span>
		<span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">offset</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">cmap</span><span class="p">)]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">chunk</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ttFont</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
					<span class="n">offset</span> <span class="o">=</span> <span class="n">done</span><span class="p">[</span><span class="n">chunk</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">offset</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">cmap</span><span class="p">)]</span> <span class="o">=</span> <span class="n">done</span><span class="p">[</span><span class="n">chunk</span><span class="p">]</span> <span class="o">=</span> <span class="n">totalOffset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableData</span><span class="p">)</span>
					<span class="n">tableData</span> <span class="o">=</span> <span class="n">tableData</span> <span class="o">+</span> <span class="n">chunk</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHl&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">platformID</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">platEncID</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span> <span class="o">+</span> <span class="n">tableData</span></div>

<div class="viewcode-block" id="table__c_m_a_p.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;tableVersion&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tableVersion</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
			<span class="n">table</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span></div>

<div class="viewcode-block" id="table__c_m_a_p.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.table__c_m_a_p.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tableVersion&quot;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">tableVersion</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">])</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;cmap_format_&quot;</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="nb">format</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">12</span><span class="p">:])</span>
		<span class="n">table</span> <span class="o">=</span> <span class="n">CmapSubtable</span><span class="o">.</span><span class="n">newSubtable</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
		<span class="n">table</span><span class="o">.</span><span class="n">platformID</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;platformID&quot;</span><span class="p">])</span>
		<span class="n">table</span><span class="o">.</span><span class="n">platEncID</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;platEncID&quot;</span><span class="p">])</span>
		<span class="n">table</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmapSubtable"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable">[docs]</a><span class="k">class</span> <span class="nc">CmapSubtable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="CmapSubtable.getSubtableClass"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.getSubtableClass">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">getSubtableClass</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return the subtable class for a format.&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">cmap_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">cmap_format_unknown</span><span class="p">)</span></div>

<div class="viewcode-block" id="CmapSubtable.newSubtable"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.newSubtable">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">newSubtable</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return a new instance of a subtable for format.&quot;&quot;&quot;</span>
		<span class="n">subtableClass</span> <span class="o">=</span> <span class="n">CmapSubtable</span><span class="o">.</span><span class="n">getSubtableClass</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">subtableClass</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
		<span class="c1"># allow lazy decompilation of subtables.</span>
		<span class="k">if</span> <span class="n">attr</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;__&#39;</span><span class="p">:</span> <span class="c1"># don&#39;t handle requests for member functions like &#39;__lt__&#39;</span>
			<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># use saved data.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>	<span class="c1"># Once this table has been decompiled, make sure we don&#39;t</span>
							<span class="c1"># just return the original data. Also avoids recursion when</span>
							<span class="c1"># called with an attribute that the cmap subtable doesn&#39;t have.</span>
		<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

<div class="viewcode-block" id="CmapSubtable.decompileHeader"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.decompileHeader">[docs]</a>	<span class="k">def</span> <span class="nf">decompileHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="nb">format</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">language</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">,</span> <span class="s2">&quot;corrupt cmap table format </span><span class="si">%d</span><span class="s2"> (data length: </span><span class="si">%d</span><span class="s2">, header length: </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">length</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span> <span class="o">=</span> <span class="n">ttFont</span></div>

<div class="viewcode-block" id="CmapSubtable.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">[</span>
				<span class="p">(</span><span class="s2">&quot;platformID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platformID</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;platEncID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">),</span>
				<span class="p">])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">codes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeCodes</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="CmapSubtable.getEncoding"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.getEncoding">[docs]</a>	<span class="k">def</span> <span class="nf">getEncoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Returns the Python encoding name for this cmap subtable based on its platformID,</span>
<span class="sd">		platEncID, and language.  If encoding for these values is not known, by default</span>
<span class="sd">		None is returned.  That can be overriden by passing a value to the default</span>
<span class="sd">		argument.</span>

<span class="sd">		Note that if you want to choose a &quot;preferred&quot; cmap subtable, most of the time</span>
<span class="sd">		self.isUnicode() is what you want as that one only returns true for the modern,</span>
<span class="sd">		commonly used, Unicode-compatible triplets, not the legacy ones.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getEncoding</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platformID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="CmapSubtable.isUnicode"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.isUnicode">[docs]</a>	<span class="k">def</span> <span class="nf">isUnicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platformID</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span>
			<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platformID</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span></div>

<div class="viewcode-block" id="CmapSubtable.isSymbol"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.CmapSubtable.isSymbol">[docs]</a>	<span class="k">def</span> <span class="nf">isSymbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">platformID</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span> <span class="o">==</span> <span class="mi">0</span></div>

	<span class="k">def</span> <span class="nf">_writeCodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
		<span class="n">isUnicode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isUnicode</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="nb">hex</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">isUnicode</span><span class="p">:</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">Unicode</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CmapSubtable</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">NotImplemented</span>

		<span class="c1"># implemented so that list.sort() sorts according to the spec.</span>
		<span class="n">selfTuple</span> <span class="o">=</span> <span class="p">(</span>
			<span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;platformID&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
			<span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;platEncID&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
			<span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
			<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
		<span class="n">otherTuple</span> <span class="o">=</span> <span class="p">(</span>
			<span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;platformID&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
			<span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;platEncID&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
			<span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
			<span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">selfTuple</span> <span class="o">&lt;</span> <span class="n">otherTuple</span></div>


<div class="viewcode-block" id="cmap_format_0"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_0">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_0</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

<div class="viewcode-block" id="cmap_format_0.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_0.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># we usually get here indirectly from the subtable __getattr__ function, in which case both args must be None.</span>
		<span class="c1"># If not, someone is calling the subtable decompile() directly, and must provide both args.</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c1"># decompileHeader assigns the data after the header to self.data</span>
		<span class="k">assert</span> <span class="mi">262</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="s2">&quot;Format 0 cmap subtable not 262 bytes&quot;</span>
		<span class="n">gids</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
		<span class="n">gids</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
		<span class="n">charCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">_make_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="p">,</span> <span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">)</span></div>

<div class="viewcode-block" id="cmap_format_0.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_0.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">262</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
		<span class="n">getGlyphID</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span>
		<span class="n">valueList</span> <span class="o">=</span> <span class="p">[</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmap</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]</span>

		<span class="n">gids</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">valueList</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">262</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="o">+</span> <span class="n">gids</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">262</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="cmap_format_0.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_0.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">cmap</span><span class="p">[</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span></div></div>


<span class="n">subHeaderFormat</span> <span class="o">=</span> <span class="s2">&quot;&gt;HHhH&quot;</span>
<div class="viewcode-block" id="SubHeader"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.SubHeader">[docs]</a><span class="k">class</span> <span class="nc">SubHeader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">idDelta</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphIndexArray</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="cmap_format_2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_2">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_2</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

<div class="viewcode-block" id="cmap_format_2.setIDDelta"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_2.setIDDelta">[docs]</a>	<span class="k">def</span> <span class="nf">setIDDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subHeader</span><span class="p">):</span>
		<span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="c1"># find the minGI which is not zero.</span>
		<span class="n">minGI</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">gid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">gid</span> <span class="o">&lt;</span> <span class="n">minGI</span><span class="p">):</span>
				<span class="n">minGI</span> <span class="o">=</span> <span class="n">gid</span>
		<span class="c1"># The lowest gid in glyphIndexArray, after subtracting idDelta, must be 1.</span>
		<span class="c1"># idDelta is a short, and must be between -32K and 32K. minGI can be between 1 and 64K.</span>
		<span class="c1"># We would like to pick an idDelta such that the first glyphArray GID is 1,</span>
		<span class="c1"># so that we are more likely to be able to combine glypharray GID subranges.</span>
		<span class="c1"># This means that we have a problem when minGI is &gt; 32K</span>
		<span class="c1"># Since the final gi is reconstructed from the glyphArray GID by:</span>
		<span class="c1">#    (short)finalGID = (gid + idDelta) % 0x10000),</span>
		<span class="c1"># we can get from a glypharray GID of 1 to a final GID of 65K by subtracting 2, and casting the</span>
		<span class="c1"># negative number to an unsigned short.</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">minGI</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">minGI</span> <span class="o">&gt;</span> <span class="mh">0x7FFF</span><span class="p">:</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mh">0x10000</span> <span class="o">-</span> <span class="n">minGI</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span> <span class="o">=</span> <span class="n">minGI</span> <span class="o">-</span><span class="mi">1</span>
			<span class="n">idDelta</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">):</span>
				<span class="n">gid</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">gid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gid</span> <span class="o">-</span> <span class="n">idDelta</span></div>

<div class="viewcode-block" id="cmap_format_2.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_2.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># we usually get here indirectly from the subtable __getattr__ function, in which case both args must be None.</span>
		<span class="c1"># If not, someone is calling the subtable decompile() directly, and must provide both args.</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span>

		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c1"># decompileHeader assigns the data after the header to self.data</span>
		<span class="n">subHeaderKeys</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">maxSubHeaderindex</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="c1"># get the key array, and determine the number of subHeaders.</span>
		<span class="n">allKeys</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>
		<span class="n">allKeys</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">512</span><span class="p">])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">512</span><span class="p">:]</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">allKeys</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="n">subHeaderKeys</span> <span class="o">=</span> <span class="p">[</span> <span class="n">key</span><span class="o">//</span><span class="mi">8</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">allKeys</span><span class="p">]</span>
		<span class="n">maxSubHeaderindex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">subHeaderKeys</span><span class="p">)</span>

		<span class="c1">#Load subHeaders</span>
		<span class="n">subHeaderList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxSubHeaderindex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
			<span class="n">subHeader</span> <span class="o">=</span> <span class="n">SubHeader</span><span class="p">()</span>
			<span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span><span class="p">,</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">,</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span><span class="p">,</span> \
				<span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">subHeaderFormat</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">8</span><span class="p">])</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="mi">8</span>
			<span class="n">giDataPos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span><span class="o">-</span><span class="mi">2</span>
			<span class="n">giList</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>
			<span class="n">giList</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">giDataPos</span><span class="p">:</span><span class="n">giDataPos</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">giList</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
			<span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span> <span class="o">=</span> <span class="n">giList</span>
			<span class="n">subHeaderList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subHeader</span><span class="p">)</span>
		<span class="c1"># How this gets processed.</span>
		<span class="c1"># Charcodes may be one or two bytes.</span>
		<span class="c1"># The first byte of a charcode is mapped through the subHeaderKeys, to select</span>
		<span class="c1"># a subHeader. For any subheader but 0, the next byte is then mapped through the</span>
		<span class="c1"># selected subheader. If subheader Index 0 is selected, then the byte itself is</span>
		<span class="c1"># mapped through the subheader, and there is no second byte.</span>
		<span class="c1"># Then assume that the subsequent byte is the first byte of the next charcode,and repeat.</span>
		<span class="c1">#</span>
		<span class="c1"># Each subheader references a range in the glyphIndexArray whose length is entryCount.</span>
		<span class="c1"># The range in glyphIndexArray referenced by a sunheader may overlap with the range in glyphIndexArray</span>
		<span class="c1"># referenced by another subheader.</span>
		<span class="c1"># The only subheader that will be referenced by more than one first-byte value is the subheader</span>
		<span class="c1"># that maps the entire range of glyphID values to glyphIndex 0, e.g notdef:</span>
		<span class="c1">#	 {firstChar 0, EntryCount 0,idDelta 0,idRangeOffset xx}</span>
		<span class="c1"># A byte being mapped though a subheader is treated as in index into a mapping of array index to font glyphIndex.</span>
		<span class="c1"># A subheader specifies a subrange within (0...256) by the</span>
		<span class="c1"># firstChar and EntryCount values. If the byte value is outside the subrange, then the glyphIndex is zero</span>
		<span class="c1"># (e.g. glyph not in font).</span>
		<span class="c1"># If the byte index is in the subrange, then an offset index is calculated as (byteIndex - firstChar).</span>
		<span class="c1"># The index to glyphIndex mapping is a subrange of the glyphIndexArray. You find the start of the subrange by</span>
		<span class="c1"># counting idRangeOffset bytes from the idRangeOffset word. The first value in this subrange is the</span>
		<span class="c1"># glyphIndex for the index firstChar. The offset index should then be used in this array to get the glyphIndex.</span>
		<span class="c1"># Example for Logocut-Medium</span>
		<span class="c1"># first byte of charcode = 129; selects subheader 1.</span>
		<span class="c1"># subheader 1 = {firstChar 64, EntryCount 108,idDelta 42,idRangeOffset 0252}</span>
		<span class="c1"># second byte of charCode = 66</span>
		<span class="c1"># the index offset = 66-64 = 2.</span>
		<span class="c1"># The subrange of the glyphIndexArray starting at 0x0252 bytes from the idRangeOffset word is:</span>
		<span class="c1"># [glyphIndexArray index], [subrange array index] = glyphIndex</span>
		<span class="c1"># [256], [0]=1 	from charcode [129, 64]</span>
		<span class="c1"># [257], [1]=2  	from charcode [129, 65]</span>
		<span class="c1"># [258], [2]=3  	from charcode [129, 66]</span>
		<span class="c1"># [259], [3]=4  	from charcode [129, 67]</span>
		<span class="c1"># So, the glyphIndex = 3 from the array. Then if idDelta is not zero and the glyph ID is not zero,</span>
		<span class="c1"># add it to the glyphID to get the final glyphIndex</span>
		<span class="c1"># value. In this case the final glyph index = 3+ 42 -&gt; 45 for the final glyphIndex. Whew!</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">notdefGI</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">firstByte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
			<span class="n">subHeadindex</span> <span class="o">=</span> <span class="n">subHeaderKeys</span><span class="p">[</span><span class="n">firstByte</span><span class="p">]</span>
			<span class="n">subHeader</span> <span class="o">=</span> <span class="n">subHeaderList</span><span class="p">[</span><span class="n">subHeadindex</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">subHeadindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">firstByte</span> <span class="o">&lt;</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">firstByte</span> <span class="o">&gt;=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">):</span>
					<span class="k">continue</span> <span class="c1"># gi is notdef.</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">charCode</span> <span class="o">=</span> <span class="n">firstByte</span>
					<span class="n">offsetIndex</span> <span class="o">=</span> <span class="n">firstByte</span> <span class="o">-</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span>
					<span class="n">gi</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">[</span><span class="n">offsetIndex</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">gi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">gi</span> <span class="o">=</span> <span class="p">(</span><span class="n">gi</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x10000</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">continue</span> <span class="c1"># gi is notdef.</span>
				<span class="n">cmap</span><span class="p">[</span><span class="n">charCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">gi</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">:</span>
					<span class="n">charCodeOffset</span> <span class="o">=</span> <span class="n">firstByte</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span>
					<span class="k">for</span> <span class="n">offsetIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">):</span>
						<span class="n">charCode</span> <span class="o">=</span> <span class="n">charCodeOffset</span> <span class="o">+</span> <span class="n">offsetIndex</span>
						<span class="n">gi</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">[</span><span class="n">offsetIndex</span><span class="p">]</span>
						<span class="k">if</span> <span class="n">gi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
							<span class="n">gi</span> <span class="o">=</span> <span class="p">(</span><span class="n">gi</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x10000</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="k">continue</span>
						<span class="n">cmap</span><span class="p">[</span><span class="n">charCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">gi</span>
				<span class="c1"># If not subHeader.entryCount, then all char codes with this first byte are</span>
				<span class="c1"># mapped to .notdef. We can skip this subtable, and leave the glyphs un-encoded, which is the</span>
				<span class="c1"># same as mapping it to .notdef.</span>

		<span class="n">gids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
		<span class="n">charCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">_make_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="p">,</span> <span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">)</span></div>

<div class="viewcode-block" id="cmap_format_2.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_2.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="n">kEmptyTwoCharCodeRange</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="n">notdefGI</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="n">charCodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
		<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
		<span class="n">nameMap</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">()</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">gids</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="n">nameMap</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">(</span><span class="n">rebuild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">gids</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="c1"># allow virtual GIDs in format 2 tables</span>
				<span class="n">gids</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">gid</span> <span class="o">=</span> <span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
					<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gid&#39;</span><span class="p">):</span>
								<span class="n">gid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">gid</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

					<span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>

		<span class="c1"># Process the (char code to gid) item list in char code order.</span>
		<span class="c1"># By definition, all one byte char codes map to subheader 0.</span>
		<span class="c1"># For all the two byte char codes, we assume that the first byte maps maps to the empty subhead (with an entry count of 0,</span>
		<span class="c1"># which defines all char codes in its range to map to notdef) unless proven otherwise.</span>
		<span class="c1"># Note that since the char code items are processed in char code order, all the char codes with the</span>
		<span class="c1"># same first byte are in sequential order.</span>

		<span class="n">subHeaderKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">kEmptyTwoCharCodeRange</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]</span> <span class="c1"># list of indices into subHeaderList.</span>
		<span class="n">subHeaderList</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="c1"># We force this subheader entry 0 to exist in the subHeaderList in the case where some one comes up</span>
		<span class="c1"># with a cmap where all the one byte char codes map to notdef,</span>
		<span class="c1"># with the result that the subhead 0 would not get created just by processing the item list.</span>
		<span class="n">charCode</span> <span class="o">=</span> <span class="n">charCodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">charCode</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
			<span class="n">subHeader</span> <span class="o">=</span> <span class="n">SubHeader</span><span class="p">()</span>
			<span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">subHeaderList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subHeader</span><span class="p">)</span>

		<span class="n">lastFirstByte</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">charCode</span><span class="p">,</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">gid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">firstbyte</span> <span class="o">=</span> <span class="n">charCode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
			<span class="n">secondByte</span> <span class="o">=</span> <span class="n">charCode</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span>

			<span class="k">if</span> <span class="n">firstbyte</span> <span class="o">!=</span> <span class="n">lastFirstByte</span><span class="p">:</span> <span class="c1"># Need to update the current subhead, and start a new one.</span>
				<span class="k">if</span> <span class="n">lastFirstByte</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
					<span class="c1"># fix GI&#39;s and iDelta of current subheader.</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">setIDDelta</span><span class="p">(</span><span class="n">subHeader</span><span class="p">)</span>

					<span class="c1"># If it was sunheader 0 for one-byte charCodes, then we need to set the subHeaderKeys value to zero</span>
					<span class="c1"># for the indices matching the char codes.</span>
					<span class="k">if</span> <span class="n">lastFirstByte</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">):</span>
							<span class="n">charCode</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">+</span> <span class="n">index</span>
							<span class="n">subHeaderKeys</span><span class="p">[</span><span class="n">charCode</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

					<span class="k">assert</span> <span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">)),</span> <span class="s2">&quot;Error - subhead entry count does not match len of glyphID subrange.&quot;</span>
				<span class="c1"># init new subheader</span>
				<span class="n">subHeader</span> <span class="o">=</span> <span class="n">SubHeader</span><span class="p">()</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">=</span> <span class="n">secondByte</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
				<span class="n">subHeaderList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subHeader</span><span class="p">)</span>
				<span class="n">subHeaderKeys</span><span class="p">[</span><span class="n">firstbyte</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subHeaderList</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
				<span class="n">lastFirstByte</span> <span class="o">=</span> <span class="n">firstbyte</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># need to fill in with notdefs all the code points between the last charCode and the current charCode.</span>
				<span class="n">codeDiff</span> <span class="o">=</span> <span class="n">secondByte</span> <span class="o">-</span> <span class="p">(</span><span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">codeDiff</span><span class="p">):</span>
					<span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notdefGI</span><span class="p">)</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">=</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">+</span> <span class="n">codeDiff</span> <span class="o">+</span> <span class="mi">1</span>

		<span class="c1"># fix GI&#39;s and iDelta of last subheader that we we added to the subheader array.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setIDDelta</span><span class="p">(</span><span class="n">subHeader</span><span class="p">)</span>

		<span class="c1"># Now we add a final subheader for the subHeaderKeys which maps to empty two byte charcode ranges.</span>
		<span class="n">subHeader</span> <span class="o">=</span> <span class="n">SubHeader</span><span class="p">()</span>
		<span class="n">subHeader</span><span class="o">.</span><span class="n">firstCode</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">subHeader</span><span class="o">.</span><span class="n">idDelta</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">subHeaderList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subHeader</span><span class="p">)</span>
		<span class="n">emptySubheadIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subHeaderList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
		<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">subHeaderKeys</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">kEmptyTwoCharCodeRange</span><span class="p">:</span>
				<span class="n">subHeaderKeys</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">emptySubheadIndex</span>
		<span class="c1"># Since this is the last subheader, the GlyphIndex Array starts two bytes after the start of the</span>
		<span class="c1"># idRangeOffset word of this subHeader. We can safely point to the first entry in the GlyphIndexArray,</span>
		<span class="c1"># since the first subrange of the GlyphIndexArray is for subHeader 0, which always starts with</span>
		<span class="c1"># charcode 0 and GID 0.</span>

		<span class="n">idRangeOffset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subHeaderList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="c1"># offset to beginning of glyphIDArray from first subheader idRangeOffset.</span>
		<span class="n">subheadRangeLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subHeaderList</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># skip last special empty-set subheader; we&#39;ve already hardocodes its idRangeOffset to 2.</span>
		<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">subheadRangeLen</span><span class="p">):</span>
			<span class="n">subHeader</span> <span class="o">=</span> <span class="n">subHeaderList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
			<span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
				<span class="n">prevSubhead</span> <span class="o">=</span> <span class="n">subHeaderList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">prevSubhead</span><span class="o">.</span><span class="n">glyphIndexArray</span> <span class="o">==</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">:</span> <span class="c1"># use the glyphIndexArray subarray</span>
					<span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">=</span> <span class="n">prevSubhead</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">-</span> <span class="p">(</span><span class="n">index</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span>
					<span class="n">subHeader</span><span class="o">.</span><span class="n">glyphIndexArray</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">break</span>
			<span class="k">if</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># didn&#39;t find one.</span>
				<span class="n">subHeader</span><span class="o">.</span><span class="n">idRangeOffset</span> <span class="o">=</span> <span class="n">idRangeOffset</span>
				<span class="n">idRangeOffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">idRangeOffset</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">subHeader</span><span class="o">.</span><span class="n">entryCount</span><span class="o">*</span><span class="mi">2</span> <span class="c1"># one less subheader, one more subArray.</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">idRangeOffset</span> <span class="o">=</span> <span class="n">idRangeOffset</span> <span class="o">-</span> <span class="mi">8</span>  <span class="c1"># one less subheader</span>

		<span class="c1"># Now we can write out the data!</span>
		<span class="n">length</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">512</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">subHeaderList</span><span class="p">)</span> <span class="c1"># header, 256 subHeaderKeys, and subheader array.</span>
		<span class="k">for</span> <span class="n">subhead</span> <span class="ow">in</span> 	<span class="n">subHeaderList</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="n">length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subhead</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>  <span class="c1"># We can&#39;t use subhead.entryCount, as some of the subhead may share subArrays.</span>
		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">subHeaderKeys</span><span class="p">:</span>
			<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">subhead</span> <span class="ow">in</span> 	<span class="n">subHeaderList</span><span class="p">:</span>
			<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">subHeaderFormat</span><span class="p">,</span> <span class="n">subhead</span><span class="o">.</span><span class="n">firstCode</span><span class="p">,</span> <span class="n">subhead</span><span class="o">.</span><span class="n">entryCount</span><span class="p">,</span> <span class="n">subhead</span><span class="o">.</span><span class="n">idDelta</span><span class="p">,</span> <span class="n">subhead</span><span class="o">.</span><span class="n">idRangeOffset</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">subhead</span> <span class="ow">in</span> 	<span class="n">subHeaderList</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="k">for</span> <span class="n">gi</span> <span class="ow">in</span> <span class="n">subhead</span><span class="o">.</span><span class="n">glyphIndexArray</span><span class="p">:</span>
				<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">gi</span><span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span>
		<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">),</span> <span class="s2">&quot;Error: cmap format 2 is not same length as calculated! actual: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">+</span> <span class="s2">&quot; calc : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="cmap_format_2.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_2.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>

		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">cmap</span><span class="p">[</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span></div></div>


<span class="n">cmap_format_4_format</span> <span class="o">=</span> <span class="s2">&quot;&gt;7H&quot;</span>

<span class="c1">#uint16  endCode[segCount]          # Ending character code for each segment, last = 0xFFFF.</span>
<span class="c1">#uint16  reservedPad                # This value should be zero</span>
<span class="c1">#uint16  startCode[segCount]        # Starting character code for each segment</span>
<span class="c1">#uint16  idDelta[segCount]          # Delta for all character codes in segment</span>
<span class="c1">#uint16  idRangeOffset[segCount]    # Offset in bytes to glyph indexArray, or 0</span>
<span class="c1">#uint16  glyphIndexArray[variable]  # Glyph index array</span>

<div class="viewcode-block" id="splitRange"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.splitRange">[docs]</a><span class="k">def</span> <span class="nf">splitRange</span><span class="p">(</span><span class="n">startCode</span><span class="p">,</span> <span class="n">endCode</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
	<span class="c1"># Try to split a range of character codes into subranges with consecutive</span>
	<span class="c1"># glyph IDs in such a way that the cmap4 subtable can be stored &quot;most&quot;</span>
	<span class="c1"># efficiently. I can&#39;t prove I&#39;ve got the optimal solution, but it seems</span>
	<span class="c1"># to do well with the fonts I tested: none became bigger, many became smaller.</span>
	<span class="k">if</span> <span class="n">startCode</span> <span class="o">==</span> <span class="n">endCode</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[],</span> <span class="p">[</span><span class="n">endCode</span><span class="p">]</span>

	<span class="n">lastID</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">[</span><span class="n">startCode</span><span class="p">]</span>
	<span class="n">lastCode</span> <span class="o">=</span> <span class="n">startCode</span>
	<span class="n">inOrder</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="n">orderedBegin</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="n">subRanges</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="c1"># Gather subranges in which the glyph IDs are consecutive.</span>
	<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startCode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endCode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">glyphID</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>

		<span class="k">if</span> <span class="n">glyphID</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">lastID</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">inOrder</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">inOrder</span><span class="p">:</span>
				<span class="n">inOrder</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="n">orderedBegin</span> <span class="o">=</span> <span class="n">lastCode</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">inOrder</span><span class="p">:</span>
				<span class="n">inOrder</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="n">subRanges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">orderedBegin</span><span class="p">,</span> <span class="n">lastCode</span><span class="p">))</span>
				<span class="n">orderedBegin</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="n">lastID</span> <span class="o">=</span> <span class="n">glyphID</span>
		<span class="n">lastCode</span> <span class="o">=</span> <span class="n">code</span>

	<span class="k">if</span> <span class="n">inOrder</span><span class="p">:</span>
		<span class="n">subRanges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">orderedBegin</span><span class="p">,</span> <span class="n">lastCode</span><span class="p">))</span>
	<span class="k">assert</span> <span class="n">lastCode</span> <span class="o">==</span> <span class="n">endCode</span>

	<span class="c1"># Now filter out those new subranges that would only make the data bigger.</span>
	<span class="c1"># A new segment cost 8 bytes, not using a new segment costs 2 bytes per</span>
	<span class="c1"># character.</span>
	<span class="n">newRanges</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">subRanges</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">startCode</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">==</span> <span class="n">endCode</span><span class="p">:</span>
			<span class="k">break</span>  <span class="c1"># the whole range, we&#39;re fine</span>
		<span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">startCode</span> <span class="ow">or</span> <span class="n">e</span> <span class="o">==</span> <span class="n">endCode</span><span class="p">:</span>
			<span class="n">threshold</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># split costs one more segment</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">threshold</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># split costs two more segments</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
			<span class="n">newRanges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
	<span class="n">subRanges</span> <span class="o">=</span> <span class="n">newRanges</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">subRanges</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[],</span> <span class="p">[</span><span class="n">endCode</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">subRanges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">startCode</span><span class="p">:</span>
		<span class="n">subRanges</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">startCode</span><span class="p">,</span> <span class="n">subRanges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">subRanges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">endCode</span><span class="p">:</span>
		<span class="n">subRanges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">subRanges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endCode</span><span class="p">))</span>

	<span class="c1"># Fill the &quot;holes&quot; in the segments list -- those are the segments in which</span>
	<span class="c1"># the glyph IDs are _not_ consecutive.</span>
	<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subRanges</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">subRanges</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">subRanges</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
			<span class="n">subRanges</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">subRanges</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subRanges</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

	<span class="c1"># Transform the ranges into startCode/endCode lists.</span>
	<span class="n">start</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">end</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">subRanges</span><span class="p">:</span>
		<span class="n">start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
		<span class="n">end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
	<span class="n">start</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span></div>


<div class="viewcode-block" id="cmap_format_4"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_4">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_4</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

<div class="viewcode-block" id="cmap_format_4.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_4.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># we usually get here indirectly from the subtable __getattr__ function, in which case both args must be None.</span>
		<span class="c1"># If not, someone is calling the subtable decompile() directly, and must provide both args.</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span>

		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c1"># decompileHeader assigns the data after the header to self.data</span>
		<span class="p">(</span><span class="n">segCountX2</span><span class="p">,</span> <span class="n">searchRange</span><span class="p">,</span> <span class="n">entrySelector</span><span class="p">,</span> <span class="n">rangeShift</span><span class="p">)</span> <span class="o">=</span> \
					<span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;4H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
		<span class="n">segCount</span> <span class="o">=</span> <span class="n">segCountX2</span> <span class="o">//</span> <span class="mi">2</span>

		<span class="n">allCodes</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>
		<span class="n">allCodes</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">allCodes</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>

		<span class="c1"># divide the data</span>
		<span class="n">endCode</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[:</span><span class="n">segCount</span><span class="p">]</span>
		<span class="n">allCodes</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[</span><span class="n">segCount</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># the +1 is skipping the reservedPad field</span>
		<span class="n">startCode</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[:</span><span class="n">segCount</span><span class="p">]</span>
		<span class="n">allCodes</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[</span><span class="n">segCount</span><span class="p">:]</span>
		<span class="n">idDelta</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[:</span><span class="n">segCount</span><span class="p">]</span>
		<span class="n">allCodes</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[</span><span class="n">segCount</span><span class="p">:]</span>
		<span class="n">idRangeOffset</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[:</span><span class="n">segCount</span><span class="p">]</span>
		<span class="n">glyphIndexArray</span> <span class="o">=</span> <span class="n">allCodes</span><span class="p">[</span><span class="n">segCount</span><span class="p">:]</span>
		<span class="n">lenGIArray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphIndexArray</span><span class="p">)</span>

		<span class="c1"># build 2-byte character mapping</span>
		<span class="n">charCodes</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">gids</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">startCode</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>	<span class="c1"># don&#39;t do 0xffff!</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">startCode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="n">idDelta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">rangeOffset</span> <span class="o">=</span> <span class="n">idRangeOffset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="c1"># *someone* needs to get killed.</span>
			<span class="n">partial</span> <span class="o">=</span> <span class="n">rangeOffset</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">idRangeOffset</span><span class="p">)</span>

			<span class="n">rangeCharCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">startCode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">endCode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">charCodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rangeCharCodes</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">rangeOffset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">gids</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">charCode</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span> <span class="k">for</span> <span class="n">charCode</span> <span class="ow">in</span> <span class="n">rangeCharCodes</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">charCode</span> <span class="ow">in</span> <span class="n">rangeCharCodes</span><span class="p">:</span>
					<span class="n">index</span> <span class="o">=</span> <span class="n">charCode</span> <span class="o">+</span> <span class="n">partial</span>
					<span class="k">assert</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">lenGIArray</span><span class="p">),</span> <span class="s2">&quot;In format 4 cmap, range (</span><span class="si">%d</span><span class="s2">), the calculated index (</span><span class="si">%d</span><span class="s2">) into the glyph index array is not less than the length of the array (</span><span class="si">%d</span><span class="s2">) !&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">lenGIArray</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">glyphIndexArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if not missing glyph</span>
						<span class="n">glyphID</span> <span class="o">=</span> <span class="n">glyphIndexArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">glyphID</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># missing glyph</span>
					<span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphID</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">_make_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="p">,</span> <span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">)</span></div>

<div class="viewcode-block" id="cmap_format_4.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_4.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

		<span class="n">charCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">charCodes</span><span class="p">:</span>
			<span class="n">startCode</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xffff</span><span class="p">]</span>
			<span class="n">endCode</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xffff</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">charCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
			<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">charCodes</span><span class="p">]</span>
			<span class="n">nameMap</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">()</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">gids</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">nameMap</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">(</span><span class="n">rebuild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">gids</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="c1"># allow virtual GIDs in format 4 tables</span>
					<span class="n">gids</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="n">gid</span> <span class="o">=</span> <span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
						<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gid&#39;</span><span class="p">):</span>
									<span class="n">gid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">gid</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

						<span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
			<span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># code:glyphID mapping</span>
			<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">gid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">):</span>
				<span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">gid</span>

			<span class="c1"># Build startCode and endCode lists.</span>
			<span class="c1"># Split the char codes in ranges of consecutive char codes, then split</span>
			<span class="c1"># each range in more ranges of consecutive/not consecutive glyph IDs.</span>
			<span class="c1"># See splitRange().</span>
			<span class="n">lastCode</span> <span class="o">=</span> <span class="n">charCodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">endCode</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">startCode</span> <span class="o">=</span> <span class="p">[</span><span class="n">lastCode</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">charCode</span> <span class="ow">in</span> <span class="n">charCodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># skip the first code, it&#39;s the first start code</span>
				<span class="k">if</span> <span class="n">charCode</span> <span class="o">==</span> <span class="n">lastCode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">lastCode</span> <span class="o">=</span> <span class="n">charCode</span>
					<span class="k">continue</span>
				<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">splitRange</span><span class="p">(</span><span class="n">startCode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lastCode</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
				<span class="n">startCode</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
				<span class="n">endCode</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
				<span class="n">startCode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">charCode</span><span class="p">)</span>
				<span class="n">lastCode</span> <span class="o">=</span> <span class="n">charCode</span>
			<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">splitRange</span><span class="p">(</span><span class="n">startCode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lastCode</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
			<span class="n">startCode</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
			<span class="n">endCode</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
			<span class="n">startCode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mh">0xffff</span><span class="p">)</span>
			<span class="n">endCode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mh">0xffff</span><span class="p">)</span>

		<span class="c1"># build up rest of cruft</span>
		<span class="n">idDelta</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">idRangeOffset</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">glyphIndexArray</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">endCode</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># skip the closing codes (0xffff)</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">charCode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startCode</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">endCode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
				<span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="n">charCode</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">indices</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)))):</span>
				<span class="n">idDelta</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">startCode</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="mh">0x10000</span><span class="p">)</span>
				<span class="n">idRangeOffset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># someone *definitely* needs to get killed.</span>
				<span class="n">idDelta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
				<span class="n">idRangeOffset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">endCode</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphIndexArray</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
				<span class="n">glyphIndexArray</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
		<span class="n">idDelta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 0xffff + 1 == (tadaa!) 0. So this end code maps to .notdef</span>
		<span class="n">idRangeOffset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

		<span class="c1"># Insane.</span>
		<span class="n">segCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">endCode</span><span class="p">)</span>
		<span class="n">segCountX2</span> <span class="o">=</span> <span class="n">segCount</span> <span class="o">*</span> <span class="mi">2</span>
		<span class="n">searchRange</span><span class="p">,</span> <span class="n">entrySelector</span><span class="p">,</span> <span class="n">rangeShift</span> <span class="o">=</span> <span class="n">getSearchRange</span><span class="p">(</span><span class="n">segCount</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

		<span class="n">charCodeArray</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">endCode</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">startCode</span><span class="p">)</span>
		<span class="n">idDeltaArray</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">idDelta</span><span class="p">)</span>
		<span class="n">restArray</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">idRangeOffset</span> <span class="o">+</span> <span class="n">glyphIndexArray</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">charCodeArray</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">idDeltaArray</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">restArray</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">charCodeArray</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="o">+</span> <span class="n">idDeltaArray</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="o">+</span> <span class="n">restArray</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

		<span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">cmap_format_4_format</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">header</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">cmap_format_4_format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
				<span class="n">segCountX2</span><span class="p">,</span> <span class="n">searchRange</span><span class="p">,</span> <span class="n">entrySelector</span><span class="p">,</span> <span class="n">rangeShift</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">header</span> <span class="o">+</span> <span class="n">data</span></div>

<div class="viewcode-block" id="cmap_format_4.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_4.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>

		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">nameMap</span><span class="p">,</span> <span class="n">attrsMap</span><span class="p">,</span> <span class="n">dummyContent</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">nameMap</span> <span class="o">!=</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
				<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Unrecognized keyword in cmap subtable&quot;</span>
			<span class="n">cmap</span><span class="p">[</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrsMap</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">attrsMap</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="cmap_format_6"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_6">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_6</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

<div class="viewcode-block" id="cmap_format_6.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_6.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># we usually get here indirectly from the subtable __getattr__ function, in which case both args must be None.</span>
		<span class="c1"># If not, someone is calling the subtable decompile() directly, and must provide both args.</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span>

		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c1"># decompileHeader assigns the data after the header to self.data</span>
		<span class="n">firstCode</span><span class="p">,</span> <span class="n">entryCount</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
		<span class="n">firstCode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">firstCode</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
		<span class="c1">#assert len(data) == 2 * entryCount  # XXX not true in Apple&#39;s Helvetica!!!</span>
		<span class="n">gids</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>
		<span class="n">gids</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">entryCount</span><span class="p">)])</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">gids</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="n">charCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">firstCode</span><span class="p">,</span> <span class="n">firstCode</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">_make_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="p">,</span> <span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">)</span></div>

<div class="viewcode-block" id="cmap_format_6.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_6.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="n">codes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">codes</span><span class="p">:</span> <span class="c1"># yes, there are empty cmap tables.</span>
			<span class="n">codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">codes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">codes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">firstCode</span> <span class="o">=</span> <span class="n">codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">valueList</span> <span class="o">=</span> <span class="p">[</span>
				<span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">])</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">cmap</span> <span class="k">else</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span>
			<span class="p">]</span>
			<span class="n">gids</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">valueList</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">gids</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">gids</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
			<span class="n">firstCode</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">header</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHHHH&quot;</span><span class="p">,</span>
				<span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">firstCode</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">header</span> <span class="o">+</span> <span class="n">data</span></div>

<div class="viewcode-block" id="cmap_format_6.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_6.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>

		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">cmap</span><span class="p">[</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="cmap_format_12_or_13"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12_or_13">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_12_or_13</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="cmap_format_12_or_13.decompileHeader"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12_or_13.decompileHeader">[docs]</a>	<span class="k">def</span> <span class="nf">decompileHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="nb">format</span><span class="p">,</span> <span class="n">reserved</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">nGroups</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HHLLL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">16</span><span class="p">])</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="n">nGroups</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="s2">&quot;corrupt cmap table format </span><span class="si">%d</span><span class="s2"> (data length: </span><span class="si">%d</span><span class="s2">, header length: </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">length</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">reserved</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nGroups</span> <span class="o">=</span> <span class="n">nGroups</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span> <span class="o">=</span> <span class="n">ttFont</span></div>

<div class="viewcode-block" id="cmap_format_12_or_13.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12_or_13.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># we usually get here indirectly from the subtable __getattr__ function, in which case both args must be None.</span>
		<span class="c1"># If not, someone is calling the subtable decompile() directly, and must provide both args.</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span>

		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c1"># decompileHeader assigns the data after the header to self.data</span>
		<span class="n">charCodes</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">gids</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nGroups</span><span class="p">):</span>
			<span class="n">startCharCode</span><span class="p">,</span> <span class="n">endCharCode</span><span class="p">,</span> <span class="n">glyphID</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;LLL&quot;</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span> <span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="mi">12</span>
			<span class="n">lenGroup</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">endCharCode</span> <span class="o">-</span> <span class="n">startCharCode</span>
			<span class="n">charCodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">startCharCode</span><span class="p">,</span> <span class="n">endCharCode</span> <span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
			<span class="n">gids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_computeGIDs</span><span class="p">(</span><span class="n">glyphID</span><span class="p">,</span> <span class="n">lenGroup</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">_make_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="p">,</span> <span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">)</span></div>

<div class="viewcode-block" id="cmap_format_12_or_13.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12_or_13.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHLLL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGroups</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="n">charCodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
		<span class="n">nameMap</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">()</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">gids</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="n">nameMap</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">(</span><span class="n">rebuild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">gids</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="c1"># allow virtual GIDs in format 12 tables</span>
				<span class="n">gids</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">gid</span> <span class="o">=</span> <span class="n">nameMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
					<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gid&#39;</span><span class="p">):</span>
								<span class="n">gid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">gid</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

					<span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>

		<span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># code:glyphID mapping</span>
		<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">gid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">charCodes</span><span class="p">,</span> <span class="n">gids</span><span class="p">):</span>
			<span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">gid</span>

		<span class="n">charCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
		<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">startCharCode</span> <span class="o">=</span> <span class="n">charCodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">startGlyphID</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">[</span><span class="n">startCharCode</span><span class="p">]</span>
		<span class="n">lastGlyphID</span> <span class="o">=</span> <span class="n">startGlyphID</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_step</span>
		<span class="n">lastCharCode</span> <span class="o">=</span> <span class="n">startCharCode</span> <span class="o">-</span> <span class="mi">1</span>
		<span class="n">nGroups</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">maxIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">charCodes</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxIndex</span><span class="p">):</span>
			<span class="n">charCode</span> <span class="o">=</span> <span class="n">charCodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
			<span class="n">glyphID</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">[</span><span class="n">charCode</span><span class="p">]</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IsInSameRun</span><span class="p">(</span><span class="n">glyphID</span><span class="p">,</span> <span class="n">lastGlyphID</span><span class="p">,</span> <span class="n">charCode</span><span class="p">,</span> <span class="n">lastCharCode</span><span class="p">):</span>
				<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;LLL&quot;</span><span class="p">,</span> <span class="n">startCharCode</span><span class="p">,</span> <span class="n">lastCharCode</span><span class="p">,</span> <span class="n">startGlyphID</span><span class="p">))</span>
				<span class="n">startCharCode</span> <span class="o">=</span> <span class="n">charCode</span>
				<span class="n">startGlyphID</span> <span class="o">=</span> <span class="n">glyphID</span>
				<span class="n">nGroups</span> <span class="o">=</span> <span class="n">nGroups</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">lastGlyphID</span> <span class="o">=</span> <span class="n">glyphID</span>
			<span class="n">lastCharCode</span> <span class="o">=</span> <span class="n">charCode</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;LLL&quot;</span><span class="p">,</span> <span class="n">startCharCode</span><span class="p">,</span> <span class="n">lastCharCode</span><span class="p">,</span> <span class="n">startGlyphID</span><span class="p">))</span>
		<span class="n">nGroups</span> <span class="o">=</span> <span class="n">nGroups</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span>
		<span class="n">lengthSubtable</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span><span class="mi">16</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">nGroups</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">lengthSubtable</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHLLL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">,</span> <span class="n">lengthSubtable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">nGroups</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span></div>

<div class="viewcode-block" id="cmap_format_12_or_13.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12_or_13.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">[</span>
				<span class="p">(</span><span class="s2">&quot;platformID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platformID</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;platEncID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;reserved&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;nGroups&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGroups</span><span class="p">),</span>
				<span class="p">])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">codes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeCodes</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="cmap_format_12_or_13.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12_or_13.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;reserved&quot;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nGroups</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;nGroups&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>

		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">cmap</span><span class="p">[</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="cmap_format_12"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_12">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_12</span><span class="p">(</span><span class="n">cmap_format_12_or_13</span><span class="p">):</span>

	<span class="n">_format_step</span> <span class="o">=</span> <span class="mi">1</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
		<span class="n">cmap_format_12_or_13</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_computeGIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startingGlyph</span><span class="p">,</span> <span class="n">numberOfGlyphs</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">startingGlyph</span><span class="p">,</span> <span class="n">startingGlyph</span> <span class="o">+</span> <span class="n">numberOfGlyphs</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">_IsInSameRun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphID</span><span class="p">,</span> <span class="n">lastGlyphID</span><span class="p">,</span> <span class="n">charCode</span><span class="p">,</span> <span class="n">lastCharCode</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">glyphID</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lastGlyphID</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">charCode</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lastCharCode</span><span class="p">)</span></div>


<div class="viewcode-block" id="cmap_format_13"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_13">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_13</span><span class="p">(</span><span class="n">cmap_format_12_or_13</span><span class="p">):</span>

	<span class="n">_format_step</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="mi">13</span><span class="p">):</span>
		<span class="n">cmap_format_12_or_13</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_computeGIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startingGlyph</span><span class="p">,</span> <span class="n">numberOfGlyphs</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">startingGlyph</span><span class="p">]</span> <span class="o">*</span> <span class="n">numberOfGlyphs</span>

	<span class="k">def</span> <span class="nf">_IsInSameRun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphID</span><span class="p">,</span> <span class="n">lastGlyphID</span><span class="p">,</span> <span class="n">charCode</span><span class="p">,</span> <span class="n">lastCharCode</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">glyphID</span> <span class="o">==</span> <span class="n">lastGlyphID</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">charCode</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lastCharCode</span><span class="p">)</span></div>


<div class="viewcode-block" id="cvtToUVS"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cvtToUVS">[docs]</a><span class="k">def</span> <span class="nf">cvtToUVS</span><span class="p">(</span><span class="n">threeByteString</span><span class="p">):</span>
	<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">threeByteString</span>
	<span class="n">val</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="cvtFromUVS"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cvtFromUVS">[docs]</a><span class="k">def</span> <span class="nf">cvtFromUVS</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
	<span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mh">0x1000000</span>
	<span class="n">fourByteString</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">fourByteString</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>


<div class="viewcode-block" id="cmap_format_14"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_14">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_14</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

<div class="viewcode-block" id="cmap_format_14.decompileHeader"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_14.decompileHeader">[docs]</a>	<span class="k">def</span> <span class="nf">decompileHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="nb">format</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">numVarSelectorRecords</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HLL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">numVarSelectorRecords</span> <span class="o">=</span> <span class="n">numVarSelectorRecords</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span> <span class="o">=</span> <span class="n">ttFont</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="c1"># has no language.</span></div>

<div class="viewcode-block" id="cmap_format_14.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_14.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># so that clients that expect this to exist in a cmap table won&#39;t fail.</span>
		<span class="n">uvsDict</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">recOffset</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numVarSelectorRecords</span><span class="p">):</span>
			<span class="n">uvs</span><span class="p">,</span> <span class="n">defOVSOffset</span><span class="p">,</span> <span class="n">nonDefUVSOffset</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;3sLL&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">recOffset</span><span class="p">:</span><span class="n">recOffset</span> <span class="o">+</span><span class="mi">11</span><span class="p">])</span>
			<span class="n">recOffset</span> <span class="o">+=</span> <span class="mi">11</span>
			<span class="n">varUVS</span> <span class="o">=</span> <span class="n">cvtToUVS</span><span class="p">(</span><span class="n">uvs</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">defOVSOffset</span><span class="p">:</span>
				<span class="n">startOffset</span> <span class="o">=</span> <span class="n">defOVSOffset</span> <span class="o">-</span> <span class="mi">10</span>
				<span class="n">numValues</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">startOffset</span><span class="p">:</span><span class="n">startOffset</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
				<span class="n">startOffset</span> <span class="o">+=</span><span class="mi">4</span>
				<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numValues</span><span class="p">):</span>
					<span class="n">uv</span><span class="p">,</span> <span class="n">addtlCnt</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;3sB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">startOffset</span><span class="p">:</span><span class="n">startOffset</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
					<span class="n">startOffset</span> <span class="o">+=</span> <span class="mi">4</span>
					<span class="n">firstBaseUV</span> <span class="o">=</span> <span class="n">cvtToUVS</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span>
					<span class="n">cnt</span> <span class="o">=</span> <span class="n">addtlCnt</span><span class="o">+</span><span class="mi">1</span>
					<span class="n">baseUVList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">firstBaseUV</span><span class="p">,</span> <span class="n">firstBaseUV</span><span class="o">+</span><span class="n">cnt</span><span class="p">))</span>
					<span class="n">glyphList</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">cnt</span>
					<span class="n">localUVList</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">baseUVList</span><span class="p">,</span> <span class="n">glyphList</span><span class="p">)</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">uvsDict</span><span class="p">[</span><span class="n">varUVS</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">localUVList</span><span class="p">)</span>
					<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
						<span class="n">uvsDict</span><span class="p">[</span><span class="n">varUVS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">localUVList</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">nonDefUVSOffset</span><span class="p">:</span>
				<span class="n">startOffset</span> <span class="o">=</span> <span class="n">nonDefUVSOffset</span> <span class="o">-</span> <span class="mi">10</span>
				<span class="n">numRecs</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">startOffset</span><span class="p">:</span><span class="n">startOffset</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
				<span class="n">startOffset</span> <span class="o">+=</span><span class="mi">4</span>
				<span class="n">localUVList</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numRecs</span><span class="p">):</span>
					<span class="n">uv</span><span class="p">,</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;3sH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">startOffset</span><span class="p">:</span><span class="n">startOffset</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
					<span class="n">startOffset</span> <span class="o">+=</span> <span class="mi">5</span>
					<span class="n">uv</span> <span class="o">=</span> <span class="n">cvtToUVS</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span>
					<span class="n">glyphName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
					<span class="n">localUVList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">uv</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">))</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">uvsDict</span><span class="p">[</span><span class="n">varUVS</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">localUVList</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="n">uvsDict</span><span class="p">[</span><span class="n">varUVS</span><span class="p">]</span> <span class="o">=</span> <span class="n">localUVList</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">uvsDict</span> <span class="o">=</span> <span class="n">uvsDict</span></div>

<div class="viewcode-block" id="cmap_format_14.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_14.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">[</span>
				<span class="p">(</span><span class="s2">&quot;platformID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platformID</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;platEncID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span><span class="p">),</span>
				<span class="p">])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">uvsDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvsDict</span>
		<span class="n">uvsList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">uvsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">uvs</span> <span class="ow">in</span> <span class="n">uvsList</span><span class="p">:</span>
			<span class="n">uvList</span> <span class="o">=</span> <span class="n">uvsDict</span><span class="p">[</span><span class="n">uvs</span><span class="p">]</span>
			<span class="n">uvList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
			<span class="k">for</span> <span class="n">uv</span><span class="p">,</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">uvList</span><span class="p">:</span>
				<span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;uv&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">uv</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;uvs&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">uvs</span><span class="p">))]</span>
				<span class="k">if</span> <span class="n">gname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">gname</span><span class="p">))</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="cmap_format_14.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_14.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="c1"># provide a value so that CmapSubtable.__lt__() won&#39;t fail</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cmap&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># so that clients that expect this to exist in a cmap table won&#39;t fail.</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;uvsDict&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">uvsDict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">uvsDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvsDict</span>

		<span class="c1"># For backwards compatibility reasons we accept &quot;None&quot; as an indicator</span>
		<span class="c1"># for &quot;default mapping&quot;, unless the font actually has a glyph named</span>
		<span class="c1"># &quot;None&quot;.</span>
		<span class="n">_hasGlyphNamedNone</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">uvs</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;uvs&quot;</span><span class="p">])</span>
			<span class="n">uv</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;uv&quot;</span><span class="p">])</span>
			<span class="n">gname</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">gname</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">_hasGlyphNamedNone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">_hasGlyphNamedNone</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">_hasGlyphNamedNone</span><span class="p">:</span>
					<span class="n">gname</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">uvsDict</span><span class="p">[</span><span class="n">uvs</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">uv</span><span class="p">,</span> <span class="n">gname</span><span class="p">))</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">uvsDict</span><span class="p">[</span><span class="n">uvs</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">uv</span><span class="p">,</span> <span class="n">gname</span><span class="p">)]</span></div>

<div class="viewcode-block" id="cmap_format_14.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_14.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HLL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numVarSelectorRecords</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

		<span class="n">uvsDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvsDict</span>
		<span class="n">uvsList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">uvsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">numVarSelectorRecords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uvsList</span><span class="p">)</span>
		<span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">numVarSelectorRecords</span><span class="o">*</span><span class="mi">11</span> <span class="c1"># current value is end of VarSelectorRecords block.</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">varSelectorRecords</span> <span class="o">=</span><span class="p">[]</span>
		<span class="k">for</span> <span class="n">uvs</span> <span class="ow">in</span> <span class="n">uvsList</span><span class="p">:</span>
			<span class="n">entryList</span> <span class="o">=</span> <span class="n">uvsDict</span><span class="p">[</span><span class="n">uvs</span><span class="p">]</span>

			<span class="n">defList</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entryList</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">defList</span><span class="p">:</span>
				<span class="n">defList</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">defList</span><span class="p">]</span>
				<span class="n">defOVSOffset</span> <span class="o">=</span> <span class="n">offset</span>
				<span class="n">defList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

				<span class="n">lastUV</span> <span class="o">=</span> <span class="n">defList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">cnt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
				<span class="n">defRecs</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">defEntry</span> <span class="ow">in</span> <span class="n">defList</span><span class="p">:</span>
					<span class="n">cnt</span> <span class="o">+=</span><span class="mi">1</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lastUV</span><span class="o">+</span><span class="n">cnt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">defEntry</span><span class="p">:</span>
						<span class="n">rec</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;3sB&quot;</span><span class="p">,</span> <span class="n">cvtFromUVS</span><span class="p">(</span><span class="n">lastUV</span><span class="p">),</span> <span class="n">cnt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
						<span class="n">lastUV</span> <span class="o">=</span> <span class="n">defEntry</span>
						<span class="n">defRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
						<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>

				<span class="n">rec</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;3sB&quot;</span><span class="p">,</span> <span class="n">cvtFromUVS</span><span class="p">(</span><span class="n">lastUV</span><span class="p">),</span> <span class="n">cnt</span><span class="p">)</span>
				<span class="n">defRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

				<span class="n">numDefRecs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">defRecs</span><span class="p">)</span>
				<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">numDefRecs</span><span class="p">))</span>
				<span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">defRecs</span><span class="p">)</span>
				<span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">numDefRecs</span><span class="o">*</span><span class="mi">4</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">defOVSOffset</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="n">ndefList</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entryList</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">ndefList</span><span class="p">:</span>
				<span class="n">nonDefUVSOffset</span> <span class="o">=</span> <span class="n">offset</span>
				<span class="n">ndefList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
				<span class="n">numNonDefRecs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndefList</span><span class="p">)</span>
				<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">numNonDefRecs</span><span class="p">))</span>
				<span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">numNonDefRecs</span><span class="o">*</span><span class="mi">5</span>

				<span class="k">for</span> <span class="n">uv</span><span class="p">,</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">ndefList</span><span class="p">:</span>
					<span class="n">gid</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>
					<span class="n">ndrec</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;3sH&quot;</span><span class="p">,</span> <span class="n">cvtFromUVS</span><span class="p">(</span><span class="n">uv</span><span class="p">),</span> <span class="n">gid</span><span class="p">)</span>
					<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ndrec</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">nonDefUVSOffset</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="n">vrec</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;3sLL&quot;</span><span class="p">,</span> <span class="n">cvtFromUVS</span><span class="p">(</span><span class="n">uvs</span><span class="p">),</span> <span class="n">defOVSOffset</span><span class="p">,</span> <span class="n">nonDefUVSOffset</span><span class="p">)</span>
			<span class="n">varSelectorRecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vrec</span><span class="p">)</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">varSelectorRecords</span><span class="p">)</span> <span class="o">+</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">headerdata</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HLL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numVarSelectorRecords</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">headerdata</span> <span class="o">+</span> <span class="n">data</span></div></div>


<div class="viewcode-block" id="cmap_format_unknown"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_unknown">[docs]</a><span class="k">class</span> <span class="nc">cmap_format_unknown</span><span class="p">(</span><span class="n">CmapSubtable</span><span class="p">):</span>

<div class="viewcode-block" id="cmap_format_unknown.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_unknown.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">cmapName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="n">cmapName</span><span class="p">,</span> <span class="p">[</span>
				<span class="p">(</span><span class="s2">&quot;platformID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platformID</span><span class="p">),</span>
				<span class="p">(</span><span class="s2">&quot;platEncID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platEncID</span><span class="p">),</span>
				<span class="p">])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">dumphex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="n">cmapName</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="cmap_format_unknown.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_unknown.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">readHex</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="cmap_format_unknown.decompileHeader"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_unknown.decompileHeader">[docs]</a>	<span class="k">def</span> <span class="nf">decompileHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># dummy value</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="cmap_format_unknown.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_unknown.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># we usually get here indirectly from the subtable __getattr__ function, in which case both args must be None.</span>
		<span class="c1"># If not, someone is calling the subtable decompile() directly, and must provide both args.</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ttFont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Need both data and ttFont arguments&quot;</span></div>

<div class="viewcode-block" id="cmap_format_unknown.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._c_m_a_p.cmap_format_unknown.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span></div></div>

<span class="n">cmap_classes</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">:</span> <span class="n">cmap_format_0</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">:</span> <span class="n">cmap_format_2</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">:</span> <span class="n">cmap_format_4</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">:</span> <span class="n">cmap_format_6</span><span class="p">,</span>
		<span class="mi">12</span><span class="p">:</span> <span class="n">cmap_format_12</span><span class="p">,</span>
		<span class="mi">13</span><span class="p">:</span> <span class="n">cmap_format_13</span><span class="p">,</span>
		<span class="mi">14</span><span class="p">:</span> <span class="n">cmap_format_14</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>