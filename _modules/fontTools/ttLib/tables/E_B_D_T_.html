

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.ttLib.tables.E_B_D_T_ &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ttLib.html">fontTools.ttLib</a> &raquo;</li>
        
      <li>fontTools.ttLib.tables.E_B_D_T_</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.ttLib.tables.E_B_D_T_</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">sstruct</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.textTools</span> <span class="k">import</span> <span class="n">safeEval</span><span class="p">,</span> <span class="n">readHex</span><span class="p">,</span> <span class="n">hexStr</span><span class="p">,</span> <span class="n">deHexStr</span>
<span class="kn">from</span> <span class="nn">.BitmapGlyphMetrics</span> <span class="k">import</span> <span class="n">BigGlyphMetrics</span><span class="p">,</span> <span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="n">SmallGlyphMetrics</span><span class="p">,</span> <span class="n">smallGlyphMetricsFormat</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">DefaultTable</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">logging</span>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">ebdtTableVersionFormat</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">	&gt; # big endian</span>
<span class="s2">	version: 16.16F</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ebdtComponentFormat</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">	&gt; # big endian</span>
<span class="s2">	glyphCode: H</span>
<span class="s2">	xOffset:   b</span>
<span class="s2">	yOffset:   b</span>
<span class="s2">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="table_E_B_D_T_"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.table_E_B_D_T_">[docs]</a><span class="k">class</span> <span class="nc">table_E_B_D_T_</span><span class="p">(</span><span class="n">DefaultTable</span><span class="o">.</span><span class="n">DefaultTable</span><span class="p">):</span>

	<span class="c1"># Keep a reference to the name of the data locator table.</span>
	<span class="n">locatorName</span> <span class="o">=</span> <span class="s1">&#39;EBLC&#39;</span>

	<span class="c1"># This method can be overridden in subclasses to support new formats</span>
	<span class="c1"># without changing the other implementation. Also can be used as a</span>
	<span class="c1"># convenience method for coverting a font file to an alternative format.</span>
<div class="viewcode-block" id="table_E_B_D_T_.getImageFormatClass"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.table_E_B_D_T_.getImageFormatClass">[docs]</a>	<span class="k">def</span> <span class="nf">getImageFormatClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageFormat</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">ebdt_bitmap_classes</span><span class="p">[</span><span class="n">imageFormat</span><span class="p">]</span></div>

<div class="viewcode-block" id="table_E_B_D_T_.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.table_E_B_D_T_.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># Get the version but don&#39;t advance the slice.</span>
		<span class="c1"># Most of the lookup for this table is done relative</span>
		<span class="c1"># to the begining so slice by the offsets provided</span>
		<span class="c1"># in the EBLC table.</span>
		<span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">ebdtTableVersionFormat</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

		<span class="c1"># Keep a dict of glyphs that have been seen so they aren&#39;t remade.</span>
		<span class="c1"># This dict maps intervals of data to the BitmapGlyph.</span>
		<span class="n">glyphDict</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="c1"># Pull out the EBLC table and loop through glyphs.</span>
		<span class="c1"># A strike is a concept that spans both tables.</span>
		<span class="c1"># The actual bitmap data is stored in the EBDT.</span>
		<span class="n">locator</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">locatorName</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">curStrike</span> <span class="ow">in</span> <span class="n">locator</span><span class="o">.</span><span class="n">strikes</span><span class="p">:</span>
			<span class="n">bitmapGlyphDict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bitmapGlyphDict</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">indexSubTable</span> <span class="ow">in</span> <span class="n">curStrike</span><span class="o">.</span><span class="n">indexSubTables</span><span class="p">:</span>
				<span class="n">dataIter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexSubTable</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">indexSubTable</span><span class="o">.</span><span class="n">locations</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">curName</span><span class="p">,</span> <span class="n">curLoc</span> <span class="ow">in</span> <span class="n">dataIter</span><span class="p">:</span>
					<span class="c1"># Don&#39;t create duplicate data entries for the same glyphs.</span>
					<span class="c1"># Instead just use the structures that already exist if they exist.</span>
					<span class="k">if</span> <span class="n">curLoc</span> <span class="ow">in</span> <span class="n">glyphDict</span><span class="p">:</span>
						<span class="n">curGlyph</span> <span class="o">=</span> <span class="n">glyphDict</span><span class="p">[</span><span class="n">curLoc</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">curGlyphData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">curLoc</span><span class="p">)]</span>
						<span class="n">imageFormatClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageFormatClass</span><span class="p">(</span><span class="n">indexSubTable</span><span class="o">.</span><span class="n">imageFormat</span><span class="p">)</span>
						<span class="n">curGlyph</span> <span class="o">=</span> <span class="n">imageFormatClass</span><span class="p">(</span><span class="n">curGlyphData</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
						<span class="n">glyphDict</span><span class="p">[</span><span class="n">curLoc</span><span class="p">]</span> <span class="o">=</span> <span class="n">curGlyph</span>
					<span class="n">bitmapGlyphDict</span><span class="p">[</span><span class="n">curName</span><span class="p">]</span> <span class="o">=</span> <span class="n">curGlyph</span></div>

<div class="viewcode-block" id="table_E_B_D_T_.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.table_E_B_D_T_.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>

		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ebdtTableVersionFormat</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
		<span class="n">dataSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

		<span class="c1"># Keep a dict of glyphs that have been seen so they aren&#39;t remade.</span>
		<span class="c1"># This dict maps the id of the BitmapGlyph to the interval</span>
		<span class="c1"># in the data.</span>
		<span class="n">glyphDict</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="c1"># Go through the bitmap glyph data. Just in case the data for a glyph</span>
		<span class="c1"># changed the size metrics should be recalculated. There are a variety</span>
		<span class="c1"># of formats and they get stored in the EBLC table. That is why</span>
		<span class="c1"># recalculation is defered to the EblcIndexSubTable class and just</span>
		<span class="c1"># pass what is known about bitmap glyphs from this particular table.</span>
		<span class="n">locator</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">locatorName</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">curStrike</span><span class="p">,</span> <span class="n">curGlyphDict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">locator</span><span class="o">.</span><span class="n">strikes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">curIndexSubTable</span> <span class="ow">in</span> <span class="n">curStrike</span><span class="o">.</span><span class="n">indexSubTables</span><span class="p">:</span>
				<span class="n">dataLocations</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">curName</span> <span class="ow">in</span> <span class="n">curIndexSubTable</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
					<span class="c1"># Handle the data placement based on seeing the glyph or not.</span>
					<span class="c1"># Just save a reference to the location if the glyph has already</span>
					<span class="c1"># been saved in compile. This code assumes that glyphs will only</span>
					<span class="c1"># be referenced multiple times from indexFormat5. By luck the</span>
					<span class="c1"># code may still work when referencing poorly ordered fonts with</span>
					<span class="c1"># duplicate references. If there is a font that is unlucky the</span>
					<span class="c1"># respective compile methods for the indexSubTables will fail</span>
					<span class="c1"># their assertions. All fonts seem to follow this assumption.</span>
					<span class="c1"># More complicated packing may be needed if a counter-font exists.</span>
					<span class="n">glyph</span> <span class="o">=</span> <span class="n">curGlyphDict</span><span class="p">[</span><span class="n">curName</span><span class="p">]</span>
					<span class="n">objectId</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">objectId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">glyphDict</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ttFont</span><span class="p">)</span>
						<span class="n">data</span> <span class="o">=</span> <span class="n">curIndexSubTable</span><span class="o">.</span><span class="n">padBitmapData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
						<span class="n">startByte</span> <span class="o">=</span> <span class="n">dataSize</span>
						<span class="n">dataSize</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
						<span class="n">endByte</span> <span class="o">=</span> <span class="n">dataSize</span>
						<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
						<span class="n">dataLoc</span> <span class="o">=</span> <span class="p">(</span><span class="n">startByte</span><span class="p">,</span> <span class="n">endByte</span><span class="p">)</span>
						<span class="n">glyphDict</span><span class="p">[</span><span class="n">objectId</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataLoc</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">dataLoc</span> <span class="o">=</span> <span class="n">glyphDict</span><span class="p">[</span><span class="n">objectId</span><span class="p">]</span>
					<span class="n">dataLocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataLoc</span><span class="p">)</span>
				<span class="c1"># Just use the new data locations in the indexSubTable.</span>
				<span class="c1"># The respective compile implementations will take care</span>
				<span class="c1"># of any of the problems in the convertion that may arise.</span>
				<span class="n">curIndexSubTable</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="n">dataLocations</span>

		<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span></div>

<div class="viewcode-block" id="table_E_B_D_T_.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.table_E_B_D_T_.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># When exporting to XML if one of the data export formats</span>
		<span class="c1"># requires metrics then those metrics may be in the locator.</span>
		<span class="c1"># In this case populate the bitmaps with &quot;export metrics&quot;.</span>
		<span class="k">if</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">bitmapGlyphDataFormat</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;bitwise&#39;</span><span class="p">):</span>
			<span class="n">locator</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">locatorName</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">curStrike</span><span class="p">,</span> <span class="n">curGlyphDict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">locator</span><span class="o">.</span><span class="n">strikes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">curIndexSubTable</span> <span class="ow">in</span> <span class="n">curStrike</span><span class="o">.</span><span class="n">indexSubTables</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">curName</span> <span class="ow">in</span> <span class="n">curIndexSubTable</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
						<span class="n">glyph</span> <span class="o">=</span> <span class="n">curGlyphDict</span><span class="p">[</span><span class="n">curName</span><span class="p">]</span>
						<span class="c1"># I&#39;m not sure which metrics have priority here.</span>
						<span class="c1"># For now if both metrics exist go with glyph metrics.</span>
						<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="s1">&#39;metrics&#39;</span><span class="p">):</span>
							<span class="n">glyph</span><span class="o">.</span><span class="n">exportMetrics</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">metrics</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">glyph</span><span class="o">.</span><span class="n">exportMetrics</span> <span class="o">=</span> <span class="n">curIndexSubTable</span><span class="o">.</span><span class="n">metrics</span>
						<span class="n">glyph</span><span class="o">.</span><span class="n">exportBitDepth</span> <span class="o">=</span> <span class="n">curStrike</span><span class="o">.</span><span class="n">bitmapSizeTable</span><span class="o">.</span><span class="n">bitDepth</span>

		<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">locator</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">locatorName</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">strikeIndex</span><span class="p">,</span> <span class="n">bitmapGlyphDict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">):</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;strikedata&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">strikeIndex</span><span class="p">)])</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">curName</span><span class="p">,</span> <span class="n">curBitmap</span> <span class="ow">in</span> <span class="n">bitmapGlyphDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="n">curBitmap</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">curName</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;strikedata&#39;</span><span class="p">)</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="table_E_B_D_T_.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.table_E_B_D_T_.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;strikedata&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;strikeData&#39;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">strikeIndex</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>

			<span class="n">bitmapGlyphDict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
					<span class="k">continue</span>
				<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
				<span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_bitmapGlyphSubclassPrefix</span><span class="p">[</span><span class="mi">4</span><span class="p">:]):</span>
					<span class="n">imageFormat</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_bitmapGlyphSubclassPrefix</span><span class="p">):])</span>
					<span class="n">glyphName</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
					<span class="n">imageFormatClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageFormatClass</span><span class="p">(</span><span class="n">imageFormat</span><span class="p">)</span>
					<span class="n">curGlyph</span> <span class="o">=</span> <span class="n">imageFormatClass</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
					<span class="n">curGlyph</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
					<span class="k">assert</span> <span class="n">glyphName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bitmapGlyphDict</span><span class="p">,</span> <span class="s2">&quot;Duplicate glyphs with the same name &#39;</span><span class="si">%s</span><span class="s2">&#39; in the same strike.&quot;</span> <span class="o">%</span> <span class="n">glyphName</span>
					<span class="n">bitmapGlyphDict</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">curGlyph</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> being ignored by </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

			<span class="c1"># Grow the strike data array to the appropriate size. The XML</span>
			<span class="c1"># format allows the strike index value to be out of order.</span>
			<span class="k">if</span> <span class="n">strikeIndex</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span> <span class="o">+=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">strikeIndex</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">))</span>
			<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">[</span><span class="n">strikeIndex</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Duplicate strike EBDT indices.&quot;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">strikeData</span><span class="p">[</span><span class="n">strikeIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitmapGlyphDict</span></div></div>

<div class="viewcode-block" id="EbdtComponent"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.EbdtComponent">[docs]</a><span class="k">class</span> <span class="nc">EbdtComponent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="EbdtComponent.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.EbdtComponent.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;ebdtComponent&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">componentName</span> <span class="ow">in</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">getformat</span><span class="p">(</span><span class="n">ebdtComponentFormat</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]:</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="n">componentName</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">componentName</span><span class="p">))</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;ebdtComponent&#39;</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="EbdtComponent.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.EbdtComponent.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
		<span class="n">componentNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sstruct</span><span class="o">.</span><span class="n">getformat</span><span class="p">(</span><span class="n">ebdtComponentFormat</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">componentNames</span><span class="p">:</span>
				<span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;unknown name &#39;</span><span class="si">%s</span><span class="s2">&#39; being ignored by EbdtComponent.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div></div>

<span class="c1"># Helper functions for dealing with binary.</span>

<span class="k">def</span> <span class="nf">_data2binary</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numBits</span><span class="p">):</span>
	<span class="n">binaryList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">curByte</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">curByte</span><span class="p">)</span>
		<span class="n">numBitsCut</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">numBits</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numBitsCut</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
				<span class="n">binaryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">binaryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
		<span class="n">numBits</span> <span class="o">-=</span> <span class="n">numBitsCut</span>
	<span class="k">return</span> <span class="n">strjoin</span><span class="p">(</span><span class="n">binaryList</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_binary2data</span><span class="p">(</span><span class="n">binary</span><span class="p">):</span>
	<span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">bitLoc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">binary</span><span class="p">),</span> <span class="mi">8</span><span class="p">):</span>
		<span class="n">byteString</span> <span class="o">=</span> <span class="n">binary</span><span class="p">[</span><span class="n">bitLoc</span><span class="p">:</span><span class="n">bitLoc</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
		<span class="n">curByte</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">curBit</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">byteString</span><span class="p">):</span>
			<span class="n">curByte</span> <span class="o">=</span> <span class="n">curByte</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="n">curBit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
				<span class="n">curByte</span> <span class="o">|=</span> <span class="mi">1</span>
		<span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bytechr</span><span class="p">(</span><span class="n">curByte</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">byteList</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_memoize</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
	<span class="k">class</span> <span class="nc">memodict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span>
			<span class="k">return</span> <span class="n">ret</span>
	<span class="k">return</span> <span class="n">memodict</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span>

<span class="c1"># 00100111 -&gt; 11100100 per byte, not to be confused with little/big endian.</span>
<span class="c1"># Bitmap data per byte is in the order that binary is written on the page</span>
<span class="c1"># with the least significant bit as far right as possible. This is the</span>
<span class="c1"># opposite of what makes sense algorithmically and hence this function.</span>
<span class="nd">@_memoize</span>
<span class="k">def</span> <span class="nf">_reverseBytes</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_reverseBytes</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
	<span class="n">byte</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
	<span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
		<span class="n">result</span> <span class="o">|=</span> <span class="n">byte</span> <span class="o">&amp;</span> <span class="mi">1</span>
		<span class="n">byte</span> <span class="o">=</span> <span class="n">byte</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">bytechr</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># This section of code is for reading and writing image data to/from XML.</span>

<span class="k">def</span> <span class="nf">_writeRawImageData</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">bitmapObject</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;rawimagedata&#39;</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">dumphex</span><span class="p">(</span><span class="n">bitmapObject</span><span class="o">.</span><span class="n">imageData</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;rawimagedata&#39;</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_readRawImageData</span><span class="p">(</span><span class="n">bitmapObject</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">bitmapObject</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">readHex</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_writeRowImageData</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">bitmapObject</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">metrics</span> <span class="o">=</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportMetrics</span>
	<span class="k">del</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportMetrics</span>
	<span class="n">bitDepth</span> <span class="o">=</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportBitDepth</span>
	<span class="k">del</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportBitDepth</span>

	<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;rowimagedata&#39;</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="n">bitDepth</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">curRow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
		<span class="n">rowData</span> <span class="o">=</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">curRow</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">hexStr</span><span class="p">(</span><span class="n">rowData</span><span class="p">))</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;rowimagedata&#39;</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_readRowImageData</span><span class="p">(</span><span class="n">bitmapObject</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">bitDepth</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;bitDepth&#39;</span><span class="p">])</span>
	<span class="n">metrics</span> <span class="o">=</span> <span class="n">SmallGlyphMetrics</span><span class="p">()</span>
	<span class="n">metrics</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span>
	<span class="n">metrics</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>

	<span class="n">dataRows</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="k">continue</span>
		<span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
		<span class="c1"># Chop off &#39;imagedata&#39; from the tag to get just the option.</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
			<span class="n">dataRows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deHexStr</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
	<span class="n">bitmapObject</span><span class="o">.</span><span class="n">setRows</span><span class="p">(</span><span class="n">dataRows</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_writeBitwiseImageData</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">bitmapObject</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">metrics</span> <span class="o">=</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportMetrics</span>
	<span class="k">del</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportMetrics</span>
	<span class="n">bitDepth</span> <span class="o">=</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportBitDepth</span>
	<span class="k">del</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">exportBitDepth</span>

	<span class="c1"># A dict for mapping binary to more readable/artistic ASCII characters.</span>
	<span class="n">binaryConv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="s1">&#39;@&#39;</span><span class="p">}</span>

	<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;bitwiseimagedata&#39;</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="n">bitDepth</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">curRow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
		<span class="n">rowData</span> <span class="o">=</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">curRow</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">reverseBytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">rowData</span> <span class="o">=</span> <span class="n">_data2binary</span><span class="p">(</span><span class="n">rowData</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
		<span class="c1"># Make the output a readable ASCII art form.</span>
		<span class="n">rowData</span> <span class="o">=</span> <span class="n">strjoin</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">binaryConv</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">rowData</span><span class="p">))</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rowData</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;bitwiseimagedata&#39;</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_readBitwiseImageData</span><span class="p">(</span><span class="n">bitmapObject</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">bitDepth</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;bitDepth&#39;</span><span class="p">])</span>
	<span class="n">metrics</span> <span class="o">=</span> <span class="n">SmallGlyphMetrics</span><span class="p">()</span>
	<span class="n">metrics</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span>
	<span class="n">metrics</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>

	<span class="c1"># A dict for mapping from ASCII to binary. All characters are considered</span>
	<span class="c1"># a &#39;1&#39; except space, period and &#39;0&#39; which maps to &#39;0&#39;.</span>
	<span class="n">binaryConv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39; &#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">}</span>

	<span class="n">dataRows</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="k">continue</span>
		<span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
			<span class="n">mapParams</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">))</span>
			<span class="n">rowData</span> <span class="o">=</span> <span class="n">strjoin</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">binaryConv</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">mapParams</span><span class="p">))</span>
			<span class="n">dataRows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_binary2data</span><span class="p">(</span><span class="n">rowData</span><span class="p">))</span>

	<span class="n">bitmapObject</span><span class="o">.</span><span class="n">setRows</span><span class="p">(</span><span class="n">dataRows</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">reverseBytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_writeExtFileImageData</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">bitmapObject</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
		<span class="c1"># fall back to current directory if output file&#39;s directory isn&#39;t found</span>
		<span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
	<span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;bitmaps&#39;</span><span class="p">)</span>
	<span class="n">filename</span> <span class="o">=</span> <span class="n">glyphName</span> <span class="o">+</span> <span class="n">bitmapObject</span><span class="o">.</span><span class="n">fileExtension</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
		<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
	<span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;strike</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strikeIndex</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
		<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

	<span class="n">fullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s1">&#39;extfileimagedata&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">fullPath</span><span class="p">)</span>
	<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullPath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bitmapObject</span><span class="o">.</span><span class="n">imageData</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_readExtFileImageData</span><span class="p">(</span><span class="n">bitmapObject</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
	<span class="n">fullPath</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullPath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		<span class="n">bitmapObject</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># End of XML writing code.</span>

<span class="c1"># Important information about the naming scheme. Used for identifying formats</span>
<span class="c1"># in XML.</span>
<span class="n">_bitmapGlyphSubclassPrefix</span> <span class="o">=</span> <span class="s1">&#39;ebdt_bitmap_format_&#39;</span>

<div class="viewcode-block" id="BitmapGlyph"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph">[docs]</a><span class="k">class</span> <span class="nc">BitmapGlyph</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="c1"># For the external file format. This can be changed in subclasses. This way</span>
	<span class="c1"># when the extfile option is turned on files have the form: glyphName.ext</span>
	<span class="c1"># The default is just a flat binary file with no meaning.</span>
	<span class="n">fileExtension</span> <span class="o">=</span> <span class="s1">&#39;.bin&#39;</span>

	<span class="c1"># Keep track of reading and writing of various forms.</span>
	<span class="n">xmlDataFunctions</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;raw&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="n">_writeRawImageData</span><span class="p">,</span> <span class="n">_readRawImageData</span><span class="p">),</span>
		<span class="s1">&#39;row&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="n">_writeRowImageData</span><span class="p">,</span> <span class="n">_readRowImageData</span><span class="p">),</span>
		<span class="s1">&#39;bitwise&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="n">_writeBitwiseImageData</span><span class="p">,</span> <span class="n">_readBitwiseImageData</span><span class="p">),</span>
		<span class="s1">&#39;extfile&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="n">_writeExtFileImageData</span><span class="p">,</span> <span class="n">_readExtFileImageData</span><span class="p">),</span>
		<span class="p">}</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span> <span class="o">=</span> <span class="n">ttFont</span>
		<span class="c1"># TODO Currently non-lazy decompilation is untested here...</span>
		<span class="c1">#if not ttFont.lazy:</span>
		<span class="c1">#	self.decompile()</span>
		<span class="c1">#	del self.data</span>

	<span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
		<span class="c1"># Allow lazy decompile.</span>
		<span class="k">if</span> <span class="n">attr</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;__&#39;</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">decompile</span><span class="p">()</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

	<span class="c1"># Not a fan of this but it is needed for safer safety checking.</span>
<div class="viewcode-block" id="BitmapGlyph.getFormat"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.getFormat">[docs]</a>	<span class="k">def</span> <span class="nf">getFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">safeEval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_bitmapGlyphSubclassPrefix</span><span class="p">):])</span></div>

<div class="viewcode-block" id="BitmapGlyph.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">)])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">writeMetrics</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="c1"># Use the internal write method to write using the correct output format.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">writeData</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>

		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="BitmapGlyph.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">readMetrics</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;imagedata&#39;</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="c1"># Chop off &#39;imagedata&#39; from the tag to get just the option.</span>
			<span class="n">option</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;imagedata&#39;</span><span class="p">)]</span>
			<span class="k">assert</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">xmlDataFunctions</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span></div>

	<span class="c1"># Some of the glyphs have the metrics. This allows for metrics to be</span>
	<span class="c1"># added if the glyph format has them. Default behavior is to do nothing.</span>
<div class="viewcode-block" id="BitmapGlyph.writeMetrics"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.writeMetrics">[docs]</a>	<span class="k">def</span> <span class="nf">writeMetrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">pass</span></div>

	<span class="c1"># The opposite of write metrics.</span>
<div class="viewcode-block" id="BitmapGlyph.readMetrics"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.readMetrics">[docs]</a>	<span class="k">def</span> <span class="nf">readMetrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">pass</span></div>

<div class="viewcode-block" id="BitmapGlyph.writeData"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.writeData">[docs]</a>	<span class="k">def</span> <span class="nf">writeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">writeFunc</span><span class="p">,</span> <span class="n">readFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">xmlDataFunctions</span><span class="p">[</span><span class="n">ttFont</span><span class="o">.</span><span class="n">bitmapGlyphDataFormat</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="n">writeFunc</span> <span class="o">=</span> <span class="n">_writeRawImageData</span>
		<span class="n">writeFunc</span><span class="p">(</span><span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span></div>

<div class="viewcode-block" id="BitmapGlyph.readData"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitmapGlyph.readData">[docs]</a>	<span class="k">def</span> <span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="c1"># Chop off &#39;imagedata&#39; from the tag to get just the option.</span>
		<span class="n">option</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;imagedata&#39;</span><span class="p">)]</span>
		<span class="n">writeFunc</span><span class="p">,</span> <span class="n">readFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">xmlDataFunctions</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
		<span class="n">readFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span></div></div>


<span class="c1"># A closure for creating a mixin for the two types of metrics handling.</span>
<span class="c1"># Most of the code is very similar so its easier to deal with here.</span>
<span class="c1"># Everything works just by passing the class that the mixin is for.</span>
<span class="k">def</span> <span class="nf">_createBitmapPlusMetricsMixin</span><span class="p">(</span><span class="n">metricsClass</span><span class="p">):</span>
	<span class="c1"># Both metrics names are listed here to make meaningful error messages.</span>
	<span class="n">metricStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">BigGlyphMetrics</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SmallGlyphMetrics</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
	<span class="n">curMetricsName</span> <span class="o">=</span> <span class="n">metricsClass</span><span class="o">.</span><span class="vm">__name__</span>
	<span class="c1"># Find which metrics this is for and determine the opposite name.</span>
	<span class="n">metricsId</span> <span class="o">=</span> <span class="n">metricStrings</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curMetricsName</span><span class="p">)</span>
	<span class="n">oppositeMetricsName</span> <span class="o">=</span> <span class="n">metricStrings</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">metricsId</span><span class="p">]</span>

	<span class="k">class</span> <span class="nc">BitmapPlusMetricsMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

		<span class="k">def</span> <span class="nf">writeMetrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>

		<span class="k">def</span> <span class="nf">readMetrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
					<span class="k">continue</span>
				<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
				<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">curMetricsName</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metricsClass</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
				<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="n">oppositeMetricsName</span><span class="p">:</span>
					<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning: </span><span class="si">%s</span><span class="s2"> being ignored in format </span><span class="si">%d</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">oppositeMetricsName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFormat</span><span class="p">())</span>

	<span class="k">return</span> <span class="n">BitmapPlusMetricsMixin</span>

<span class="c1"># Since there are only two types of mixin&#39;s just create them here.</span>
<span class="n">BitmapPlusBigMetricsMixin</span> <span class="o">=</span> <span class="n">_createBitmapPlusMetricsMixin</span><span class="p">(</span><span class="n">BigGlyphMetrics</span><span class="p">)</span>
<span class="n">BitmapPlusSmallMetricsMixin</span> <span class="o">=</span> <span class="n">_createBitmapPlusMetricsMixin</span><span class="p">(</span><span class="n">SmallGlyphMetrics</span><span class="p">)</span>

<span class="c1"># Data that is bit aligned can be tricky to deal with. These classes implement</span>
<span class="c1"># helper functionality for dealing with the data and getting a particular row</span>
<span class="c1"># of bitwise data. Also helps implement fancy data export/import in XML.</span>
<div class="viewcode-block" id="BitAlignedBitmapMixin"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitAlignedBitmapMixin">[docs]</a><span class="k">class</span> <span class="nc">BitAlignedBitmapMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">_getBitRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
		<span class="n">rowBits</span> <span class="o">=</span> <span class="p">(</span><span class="n">bitDepth</span> <span class="o">*</span> <span class="n">metrics</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
		<span class="n">bitOffset</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">rowBits</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">bitOffset</span><span class="p">,</span> <span class="n">bitOffset</span><span class="o">+</span><span class="n">rowBits</span><span class="p">)</span>

<div class="viewcode-block" id="BitAlignedBitmapMixin.getRow"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitAlignedBitmapMixin.getRow">[docs]</a>	<span class="k">def</span> <span class="nf">getRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverseBytes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span>
		<span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="ow">and</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;Illegal row access in bitmap&quot;</span>

		<span class="c1"># Loop through each byte. This can cover two bytes in the original data or</span>
		<span class="c1"># a single byte if things happen to be aligned. The very last entry might</span>
		<span class="c1"># not be aligned so take care to trim the binary data to size and pad with</span>
		<span class="c1"># zeros in the row data. Bit aligned data is somewhat tricky.</span>
		<span class="c1">#</span>
		<span class="c1"># Example of data cut. Data cut represented in x&#39;s.</span>
		<span class="c1"># &#39;|&#39; represents byte boundary.</span>
		<span class="c1"># data = ...0XX|XXXXXX00|000... =&gt; XXXXXXXX</span>
		<span class="c1">#		or</span>
		<span class="c1"># data = ...0XX|XXXX0000|000... =&gt; XXXXXX00</span>
		<span class="c1">#   or</span>
		<span class="c1"># data = ...000|XXXXXXXX|000... =&gt; XXXXXXXX</span>
		<span class="c1">#   or</span>
		<span class="c1"># data = ...000|00XXXX00|000... =&gt; XXXX0000</span>
		<span class="c1">#</span>
		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">bitRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getBitRange</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
		<span class="n">stepRange</span> <span class="o">=</span> <span class="n">bitRange</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span>
		<span class="k">for</span> <span class="n">curBit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">stepRange</span><span class="p">):</span>
			<span class="n">endBit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">curBit</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">bitRange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">numBits</span> <span class="o">=</span> <span class="n">endBit</span> <span class="o">-</span> <span class="n">curBit</span>
			<span class="n">cutPoint</span> <span class="o">=</span> <span class="n">curBit</span> <span class="o">%</span> <span class="mi">8</span>
			<span class="n">firstByteLoc</span> <span class="o">=</span> <span class="n">curBit</span> <span class="o">//</span> <span class="mi">8</span>
			<span class="n">secondByteLoc</span> <span class="o">=</span> <span class="n">endBit</span> <span class="o">//</span> <span class="mi">8</span>
			<span class="k">if</span> <span class="n">firstByteLoc</span> <span class="o">&lt;</span> <span class="n">secondByteLoc</span><span class="p">:</span>
				<span class="n">numBitsCut</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">cutPoint</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">numBitsCut</span> <span class="o">=</span> <span class="n">endBit</span> <span class="o">-</span> <span class="n">curBit</span>
			<span class="n">curByte</span> <span class="o">=</span> <span class="n">_reverseBytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageData</span><span class="p">[</span><span class="n">firstByteLoc</span><span class="p">])</span>
			<span class="n">firstHalf</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">curByte</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">cutPoint</span>
			<span class="n">firstHalf</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">numBitsCut</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">firstHalf</span>
			<span class="n">newByte</span> <span class="o">=</span> <span class="n">firstHalf</span>
			<span class="k">if</span> <span class="n">firstByteLoc</span> <span class="o">&lt;</span> <span class="n">secondByteLoc</span> <span class="ow">and</span> <span class="n">secondByteLoc</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageData</span><span class="p">):</span>
				<span class="n">curByte</span> <span class="o">=</span> <span class="n">_reverseBytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageData</span><span class="p">[</span><span class="n">secondByteLoc</span><span class="p">])</span>
				<span class="n">secondHalf</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">curByte</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">numBitsCut</span>
				<span class="n">newByte</span> <span class="o">=</span> <span class="p">(</span><span class="n">firstHalf</span> <span class="o">|</span> <span class="n">secondHalf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">numBits</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bytechr</span><span class="p">(</span><span class="n">newByte</span><span class="p">))</span>

		<span class="c1"># The way the data is kept is opposite the algorithm used.</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">reverseBytes</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">_reverseBytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="BitAlignedBitmapMixin.setRows"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.BitAlignedBitmapMixin.setRows">[docs]</a>	<span class="k">def</span> <span class="nf">setRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRows</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverseBytes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">reverseBytes</span><span class="p">:</span>
			<span class="n">dataRows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_reverseBytes</span><span class="p">,</span> <span class="n">dataRows</span><span class="p">))</span>

		<span class="c1"># Keep track of a list of ordinal values as they are easier to modify</span>
		<span class="c1"># than a list of strings. Map to actual strings later.</span>
		<span class="n">numBytes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getBitRange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataRows</span><span class="p">),</span> <span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
		<span class="n">ordDataList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numBytes</span>
		<span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataRows</span><span class="p">):</span>
			<span class="n">bitRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getBitRange</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
			<span class="n">stepRange</span> <span class="o">=</span> <span class="n">bitRange</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span>
			<span class="k">for</span> <span class="n">curBit</span><span class="p">,</span> <span class="n">curByte</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">stepRange</span><span class="p">),</span> <span class="n">data</span><span class="p">):</span>
				<span class="n">endBit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">curBit</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">bitRange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
				<span class="n">cutPoint</span> <span class="o">=</span> <span class="n">curBit</span> <span class="o">%</span> <span class="mi">8</span>
				<span class="n">firstByteLoc</span> <span class="o">=</span> <span class="n">curBit</span> <span class="o">//</span> <span class="mi">8</span>
				<span class="n">secondByteLoc</span> <span class="o">=</span> <span class="n">endBit</span> <span class="o">//</span> <span class="mi">8</span>
				<span class="k">if</span> <span class="n">firstByteLoc</span> <span class="o">&lt;</span> <span class="n">secondByteLoc</span><span class="p">:</span>
					<span class="n">numBitsCut</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">cutPoint</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">numBitsCut</span> <span class="o">=</span> <span class="n">endBit</span> <span class="o">-</span> <span class="n">curBit</span>
				<span class="n">curByte</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">curByte</span><span class="p">)</span>
				<span class="n">firstByte</span> <span class="o">=</span> <span class="n">curByte</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">numBitsCut</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">ordDataList</span><span class="p">[</span><span class="n">firstByteLoc</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="n">firstByte</span> <span class="o">&lt;&lt;</span> <span class="n">cutPoint</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">firstByteLoc</span> <span class="o">&lt;</span> <span class="n">secondByteLoc</span> <span class="ow">and</span> <span class="n">secondByteLoc</span> <span class="o">&lt;</span> <span class="n">numBytes</span><span class="p">:</span>
					<span class="n">secondByte</span> <span class="o">=</span> <span class="p">(</span><span class="n">curByte</span> <span class="o">&gt;&gt;</span> <span class="n">numBitsCut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">-</span><span class="n">numBitsCut</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
					<span class="n">ordDataList</span><span class="p">[</span><span class="n">secondByteLoc</span><span class="p">]</span> <span class="o">|=</span> <span class="n">secondByte</span>

		<span class="c1"># Save the image data with the bits going the correct way.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">_reverseBytes</span><span class="p">(</span><span class="n">bytesjoin</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">bytechr</span><span class="p">,</span> <span class="n">ordDataList</span><span class="p">)))</span></div></div>

<div class="viewcode-block" id="ByteAlignedBitmapMixin"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ByteAlignedBitmapMixin">[docs]</a><span class="k">class</span> <span class="nc">ByteAlignedBitmapMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">_getByteRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
		<span class="n">rowBytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">bitDepth</span> <span class="o">*</span> <span class="n">metrics</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
		<span class="n">byteOffset</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">rowBytes</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">byteOffset</span><span class="p">,</span> <span class="n">byteOffset</span><span class="o">+</span><span class="n">rowBytes</span><span class="p">)</span>

<div class="viewcode-block" id="ByteAlignedBitmapMixin.getRow"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ByteAlignedBitmapMixin.getRow">[docs]</a>	<span class="k">def</span> <span class="nf">getRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverseBytes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span>
		<span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="ow">and</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;Illegal row access in bitmap&quot;</span>
		<span class="n">byteRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getByteRange</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">bitDepth</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">byteRange</span><span class="p">)]</span>
		<span class="k">if</span> <span class="n">reverseBytes</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">_reverseBytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ByteAlignedBitmapMixin.setRows"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ByteAlignedBitmapMixin.setRows">[docs]</a>	<span class="k">def</span> <span class="nf">setRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRows</span><span class="p">,</span> <span class="n">bitDepth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverseBytes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span>
		<span class="k">if</span> <span class="n">reverseBytes</span><span class="p">:</span>
			<span class="n">dataRows</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">_reverseBytes</span><span class="p">,</span> <span class="n">dataRows</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataRows</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="ebdt_bitmap_format_1"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_1">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_1</span><span class="p">(</span><span class="n">ByteAlignedBitmapMixin</span><span class="p">,</span> <span class="n">BitmapPlusSmallMetricsMixin</span><span class="p">,</span> <span class="n">BitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_1.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_1.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">SmallGlyphMetrics</span><span class="p">()</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">smallGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_1.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_1.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">smallGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span></div></div>


<div class="viewcode-block" id="ebdt_bitmap_format_2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_2">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_2</span><span class="p">(</span><span class="n">BitAlignedBitmapMixin</span><span class="p">,</span> <span class="n">BitmapPlusSmallMetricsMixin</span><span class="p">,</span> <span class="n">BitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_2.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_2.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">SmallGlyphMetrics</span><span class="p">()</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">smallGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_2.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_2.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">smallGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span></div></div>


<div class="viewcode-block" id="ebdt_bitmap_format_5"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_5">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_5</span><span class="p">(</span><span class="n">BitAlignedBitmapMixin</span><span class="p">,</span> <span class="n">BitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_5.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_5.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_5.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_5.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span></div></div>

<div class="viewcode-block" id="ebdt_bitmap_format_6"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_6">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_6</span><span class="p">(</span><span class="n">ByteAlignedBitmapMixin</span><span class="p">,</span> <span class="n">BitmapPlusBigMetricsMixin</span><span class="p">,</span> <span class="n">BitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_6.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_6.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">BigGlyphMetrics</span><span class="p">()</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_6.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_6.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span></div></div>


<div class="viewcode-block" id="ebdt_bitmap_format_7"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_7">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_7</span><span class="p">(</span><span class="n">BitAlignedBitmapMixin</span><span class="p">,</span> <span class="n">BitmapPlusBigMetricsMixin</span><span class="p">,</span> <span class="n">BitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_7.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_7.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">BigGlyphMetrics</span><span class="p">()</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_7.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_7.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span></div></div>


<div class="viewcode-block" id="ComponentBitmapGlyph"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ComponentBitmapGlyph">[docs]</a><span class="k">class</span> <span class="nc">ComponentBitmapGlyph</span><span class="p">(</span><span class="n">BitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ComponentBitmapGlyph.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ComponentBitmapGlyph.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strikeIndex</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">)])</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">writeMetrics</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>

		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;components&#39;</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">curComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="p">:</span>
			<span class="n">curComponent</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;components&#39;</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="ComponentBitmapGlyph.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ComponentBitmapGlyph.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">readMetrics</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;components&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">compElement</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compElement</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
						<span class="k">continue</span>
					<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">compElement</span>
					<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ebdtComponent&#39;</span><span class="p">:</span>
						<span class="n">curComponent</span> <span class="o">=</span> <span class="n">EbdtComponent</span><span class="p">()</span>
						<span class="n">curComponent</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curComponent</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; being ignored in component array.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ebdt_bitmap_format_8"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_8">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_8</span><span class="p">(</span><span class="n">BitmapPlusSmallMetricsMixin</span><span class="p">,</span> <span class="n">ComponentBitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_8.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_8.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">SmallGlyphMetrics</span><span class="p">()</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">smallGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

		<span class="p">(</span><span class="n">numComponents</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numComponents</span><span class="p">):</span>
			<span class="n">curComponent</span> <span class="o">=</span> <span class="n">EbdtComponent</span><span class="p">()</span>
			<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">ebdtComponentFormat</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">curComponent</span><span class="p">)</span>
			<span class="n">curComponent</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">curComponent</span><span class="o">.</span><span class="n">glyphCode</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curComponent</span><span class="p">)</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_8.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_8.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">smallGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">))</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="p">)))</span>
		<span class="k">for</span> <span class="n">curComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="p">:</span>
			<span class="n">curComponent</span><span class="o">.</span><span class="n">glyphCode</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">curComponent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
			<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ebdtComponentFormat</span><span class="p">,</span> <span class="n">curComponent</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ebdt_bitmap_format_9"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_9">[docs]</a><span class="k">class</span> <span class="nc">ebdt_bitmap_format_9</span><span class="p">(</span><span class="n">BitmapPlusBigMetricsMixin</span><span class="p">,</span> <span class="n">ComponentBitmapGlyph</span><span class="p">):</span>

<div class="viewcode-block" id="ebdt_bitmap_format_9.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_9.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">BigGlyphMetrics</span><span class="p">()</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
		<span class="p">(</span><span class="n">numComponents</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numComponents</span><span class="p">):</span>
			<span class="n">curComponent</span> <span class="o">=</span> <span class="n">EbdtComponent</span><span class="p">()</span>
			<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">ebdtComponentFormat</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">curComponent</span><span class="p">)</span>
			<span class="n">curComponent</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">curComponent</span><span class="o">.</span><span class="n">glyphCode</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curComponent</span><span class="p">)</span></div>

<div class="viewcode-block" id="ebdt_bitmap_format_9.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables.C_B_D_T_.ebdt_bitmap_format_9.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">bigGlyphMetricsFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">))</span>
		<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="p">)))</span>
		<span class="k">for</span> <span class="n">curComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">componentArray</span><span class="p">:</span>
			<span class="n">curComponent</span><span class="o">.</span><span class="n">glyphCode</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">curComponent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
			<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ebdtComponentFormat</span><span class="p">,</span> <span class="n">curComponent</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span></div></div>


<span class="c1"># Dictionary of bitmap formats to the class representing that format</span>
<span class="c1"># currently only the ones listed in this map are the ones supported.</span>
<span class="n">ebdt_bitmap_classes</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">1</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_1</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_2</span><span class="p">,</span>
		<span class="mi">5</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_5</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_6</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_7</span><span class="p">,</span>
		<span class="mi">8</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_8</span><span class="p">,</span>
		<span class="mi">9</span><span class="p">:</span> <span class="n">ebdt_bitmap_format_9</span><span class="p">,</span>
	<span class="p">}</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>