

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.ttLib.tables.otTables &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ttLib.html">fontTools.ttLib</a> &raquo;</li>
        
      <li>fontTools.ttLib.tables.otTables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.ttLib.tables.otTables</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="sd">&quot;&quot;&quot;fontTools.ttLib.tables.otTables -- A collection of classes representing the various</span>
<span class="sd">OpenType subtables.</span>

<span class="sd">Most are constructed upon import from data in otData.py, all are populated with</span>
<span class="sd">converter objects from otConverters.py.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">IntEnum</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.fixedTools</span> <span class="k">import</span> <span class="n">otRound</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.textTools</span> <span class="k">import</span> <span class="n">pad</span><span class="p">,</span> <span class="n">safeEval</span>
<span class="kn">from</span> <span class="nn">.otBase</span> <span class="k">import</span> <span class="n">BaseTable</span><span class="p">,</span> <span class="n">FormatSwitchingBaseTable</span><span class="p">,</span> <span class="n">ValueRecord</span><span class="p">,</span> <span class="n">CountReference</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">struct</span>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="AATStateTable"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AATStateTable">[docs]</a><span class="k">class</span> <span class="nc">AATStateTable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">GlyphClasses</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># GlyphID --&gt; GlyphClass</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">States</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of AATState, indexed by state number</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">PerGlyphLookups</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [{GlyphID:GlyphID}, ...]</span></div>


<div class="viewcode-block" id="AATState"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AATState">[docs]</a><span class="k">class</span> <span class="nc">AATState</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Transitions</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># GlyphClass --&gt; AATAction</span></div>


<div class="viewcode-block" id="AATAction"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AATAction">[docs]</a><span class="k">class</span> <span class="nc">AATAction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="n">_FLAGS</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="AATAction.compileActions"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AATAction.compileActions">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">compileActions</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_writeFlagsToXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">):</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FLAGS</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">f</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">flags</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Flags&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flags</span><span class="p">))</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span>
				<span class="s2">&quot;ReservedFlags&quot;</span><span class="p">,</span>
				<span class="n">value</span><span class="o">=</span><span class="s1">&#39;0x</span><span class="si">%04X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">_setFlag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">flag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FLAGS</span><span class="p">,</span> <span class="s2">&quot;unsupported flag </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">flag</span>
		<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="RearrangementMorphAction"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.RearrangementMorphAction">[docs]</a><span class="k">class</span> <span class="nc">RearrangementMorphAction</span><span class="p">(</span><span class="n">AATAction</span><span class="p">):</span>
	<span class="n">staticSize</span> <span class="o">=</span> <span class="mi">4</span>
	<span class="n">actionHeaderSize</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">_FLAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MarkFirst&quot;</span><span class="p">,</span> <span class="s2">&quot;DontAdvance&quot;</span><span class="p">,</span> <span class="s2">&quot;MarkLast&quot;</span><span class="p">]</span>

	<span class="n">_VERBS</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;no change&quot;</span><span class="p">,</span>
		<span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Ax ⇒ xA&quot;</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;xD ⇒ Dx&quot;</span><span class="p">,</span>
		<span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;AxD ⇒ DxA&quot;</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;ABx ⇒ xAB&quot;</span><span class="p">,</span>
		<span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;ABx ⇒ xBA&quot;</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;xCD ⇒ CDx&quot;</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;xCD ⇒ DCx&quot;</span><span class="p">,</span>
		<span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;AxCD ⇒ CDxA&quot;</span><span class="p">,</span>
		<span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;AxCD ⇒ DCxA&quot;</span><span class="p">,</span>
		<span class="mi">10</span><span class="p">:</span> <span class="s2">&quot;ABxD ⇒ DxAB&quot;</span><span class="p">,</span>
		<span class="mi">11</span><span class="p">:</span> <span class="s2">&quot;ABxD ⇒ DxBA&quot;</span><span class="p">,</span>
		<span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;ABxCD ⇒ CDxAB&quot;</span><span class="p">,</span>
		<span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;ABxCD ⇒ CDxBA&quot;</span><span class="p">,</span>
		<span class="mi">14</span><span class="p">:</span> <span class="s2">&quot;ABxCD ⇒ DCxAB&quot;</span><span class="p">,</span>
		<span class="mi">15</span><span class="p">:</span> <span class="s2">&quot;ABxCD ⇒ DCxBA&quot;</span><span class="p">,</span>
        <span class="p">}</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkFirst</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkLast</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="RearrangementMorphAction.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.RearrangementMorphAction.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionIndex</span> <span class="ow">is</span> <span class="kc">None</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verb</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkFirst</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x8000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x4000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkLast</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x2000</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span></div>

<div class="viewcode-block" id="RearrangementMorphAction.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.RearrangementMorphAction.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionReader</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionReader</span> <span class="ow">is</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0xF</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkFirst</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x4000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkLast</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x2000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x1FF0</span></div>

<div class="viewcode-block" id="RearrangementMorphAction.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.RearrangementMorphAction.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;NewState&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeFlagsToXML</span><span class="p">(</span><span class="n">xmlWriter</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Verb&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Verb</span><span class="p">)</span>
		<span class="n">verbComment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VERBS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Verb</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">verbComment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">verbComment</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="RearrangementMorphAction.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.RearrangementMorphAction.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkFirst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkLast</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">eltName</span><span class="p">,</span> <span class="n">eltAttrs</span><span class="p">,</span> <span class="n">eltContent</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;NewState&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;Verb&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Verb</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;ReservedFlags&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;Flags&quot;</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_setFlag</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="ContextualMorphAction"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ContextualMorphAction">[docs]</a><span class="k">class</span> <span class="nc">ContextualMorphAction</span><span class="p">(</span><span class="n">AATAction</span><span class="p">):</span>
	<span class="n">staticSize</span> <span class="o">=</span> <span class="mi">8</span>
	<span class="n">actionHeaderSize</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">_FLAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SetMark&quot;</span><span class="p">,</span> <span class="s2">&quot;DontAdvance&quot;</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetMark</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurrentIndex</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="mh">0xFFFF</span>

<div class="viewcode-block" id="ContextualMorphAction.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ContextualMorphAction.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionIndex</span> <span class="ow">is</span> <span class="kc">None</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetMark</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x8000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x4000</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MarkIndex</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CurrentIndex</span><span class="p">)</span></div>

<div class="viewcode-block" id="ContextualMorphAction.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ContextualMorphAction.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionReader</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionReader</span> <span class="ow">is</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetMark</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x4000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x3FFF</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkIndex</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CurrentIndex</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span></div>

<div class="viewcode-block" id="ContextualMorphAction.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ContextualMorphAction.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;NewState&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeFlagsToXML</span><span class="p">(</span><span class="n">xmlWriter</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;MarkIndex&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MarkIndex</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;CurrentIndex&quot;</span><span class="p">,</span>
		                    <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CurrentIndex</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="ContextualMorphAction.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ContextualMorphAction.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetMark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurrentIndex</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="mh">0xFFFF</span>
		<span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">eltName</span><span class="p">,</span> <span class="n">eltAttrs</span><span class="p">,</span> <span class="n">eltContent</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;NewState&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;Flags&quot;</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_setFlag</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;ReservedFlags&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;MarkIndex&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">MarkIndex</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;CurrentIndex&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">CurrentIndex</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="LigAction"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigAction">[docs]</a><span class="k">class</span> <span class="nc">LigAction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Store</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="c1"># GlyphIndexDelta is a (possibly negative) delta that gets</span>
		<span class="c1"># added to the glyph ID at the top of the AAT runtime</span>
		<span class="c1"># execution stack. It is *not* a byte offset into the</span>
		<span class="c1"># morx table. The result of the addition, which is performed</span>
		<span class="c1"># at run time by the shaping engine, is an index into</span>
		<span class="c1"># the ligature components table. See &#39;morx&#39; specification.</span>
		<span class="c1"># In the AAT specification, this field is called Offset;</span>
		<span class="c1"># but its meaning is quite different from other offsets</span>
		<span class="c1"># in either AAT or OpenType, so we use a different name.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">GlyphIndexDelta</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="LigatureMorphAction"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction">[docs]</a><span class="k">class</span> <span class="nc">LigatureMorphAction</span><span class="p">(</span><span class="n">AATAction</span><span class="p">):</span>
	<span class="n">staticSize</span> <span class="o">=</span> <span class="mi">6</span>

	<span class="c1"># 4 bytes for each of {action,ligComponents,ligatures}Offset</span>
	<span class="n">actionHeaderSize</span> <span class="o">=</span> <span class="mi">12</span>

	<span class="n">_FLAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SetComponent&quot;</span><span class="p">,</span> <span class="s2">&quot;DontAdvance&quot;</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetComponent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Actions</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="LigatureMorphAction.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetComponent</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x8000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x4000</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x2000</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compileLigActions</span><span class="p">()</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">actionIndex</span><span class="p">[</span><span class="n">actions</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="LigatureMorphAction.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionReader</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionReader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetComponent</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x4000</span><span class="p">)</span>
		<span class="n">performAction</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x2000</span><span class="p">)</span>
		<span class="c1"># As of 2017-09-12, the &#39;morx&#39; specification says that</span>
		<span class="c1"># the reserved bitmask in ligature subtables is 0x3FFF.</span>
		<span class="c1"># However, the specification also defines a flag 0x2000,</span>
		<span class="c1"># so the reserved value should actually be 0x1FFF.</span>
		<span class="c1"># TODO: Report this specification bug to Apple.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x1FFF</span>
		<span class="n">actionIndex</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">performAction</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decompileLigActions</span><span class="p">(</span>
				<span class="n">actionReader</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Actions</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="LigatureMorphAction.compileActions"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction.compileActions">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">compileActions</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
		<span class="n">result</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">actionIndex</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(),</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">_glyphClass</span><span class="p">,</span> <span class="n">trans</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="n">actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">compileLigActions</span><span class="p">())</span>
		<span class="c1"># Sort the compiled actions in decreasing order of</span>
		<span class="c1"># length, so that the longer sequence come before the</span>
		<span class="c1"># shorter ones.  For each compiled action ABCD, its</span>
		<span class="c1"># suffixes BCD, CD, and D do not be encoded separately</span>
		<span class="c1"># (in case they occur); instead, we can just store an</span>
		<span class="c1"># index that points into the middle of the longer</span>
		<span class="c1"># sequence. Every compiled AAT ligature sequence is</span>
		<span class="c1"># terminated with an end-of-sequence flag, which can</span>
		<span class="c1"># only be set on the last element of the sequence.</span>
		<span class="c1"># Therefore, it is sufficient to consider just the</span>
		<span class="c1"># suffixes.</span>
		<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actionIndex</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">4</span><span class="p">):</span>
					<span class="n">suffix</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
					<span class="n">suffixIndex</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
					<span class="n">actionIndex</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
						<span class="n">suffix</span><span class="p">,</span> <span class="n">suffixIndex</span><span class="p">)</span>
				<span class="n">result</span> <span class="o">+=</span> <span class="n">a</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">)</span></div>

<div class="viewcode-block" id="LigatureMorphAction.compileLigActions"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction.compileLigActions">[docs]</a>	<span class="k">def</span> <span class="nf">compileLigActions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Actions</span><span class="p">):</span>
			<span class="n">last</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Actions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">GlyphIndexDelta</span> <span class="o">&amp;</span> <span class="mh">0x3FFFFFFF</span>
			<span class="n">value</span> <span class="o">|=</span> <span class="mh">0x80000000</span> <span class="k">if</span> <span class="n">last</span> <span class="k">else</span> <span class="mi">0</span>
			<span class="n">value</span> <span class="o">|=</span> <span class="mh">0x40000000</span> <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">Store</span> <span class="k">else</span> <span class="mi">0</span>
			<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;L&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_decompileLigActions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actionReader</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">):</span>
		<span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">last</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">reader</span> <span class="o">=</span> <span class="n">actionReader</span><span class="o">.</span><span class="n">getSubReader</span><span class="p">(</span>
			<span class="n">actionReader</span><span class="o">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">actionIndex</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
		<span class="k">while</span> <span class="ow">not</span> <span class="n">last</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readULong</span><span class="p">()</span>
			<span class="n">last</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)</span>
			<span class="n">action</span> <span class="o">=</span> <span class="n">LigAction</span><span class="p">()</span>
			<span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
			<span class="n">action</span><span class="o">.</span><span class="n">Store</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x40000000</span><span class="p">)</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x3FFFFFFF</span>
			<span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="mh">0x20000000</span><span class="p">:</span> <span class="c1"># sign-extend 30-bit value</span>
				<span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mh">0x40000000</span> <span class="o">+</span> <span class="n">delta</span>
			<span class="n">action</span><span class="o">.</span><span class="n">GlyphIndexDelta</span> <span class="o">=</span> <span class="n">delta</span>
		<span class="k">return</span> <span class="n">actions</span>

<div class="viewcode-block" id="LigatureMorphAction.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetComponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Actions</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">eltName</span><span class="p">,</span> <span class="n">eltAttrs</span><span class="p">,</span> <span class="n">eltContent</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;NewState&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;Flags&quot;</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_setFlag</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;ReservedFlags&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;Action&quot;</span><span class="p">:</span>
				<span class="n">action</span> <span class="o">=</span> <span class="n">LigAction</span><span class="p">()</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="n">eltAttrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Flags&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span>
				<span class="n">action</span><span class="o">.</span><span class="n">Store</span> <span class="o">=</span> <span class="s2">&quot;Store&quot;</span> <span class="ow">in</span> <span class="n">flags</span>
				<span class="n">action</span><span class="o">.</span><span class="n">GlyphIndexDelta</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span>
					<span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;GlyphIndexDelta&quot;</span><span class="p">])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span></div>

<div class="viewcode-block" id="LigatureMorphAction.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureMorphAction.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;NewState&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeFlagsToXML</span><span class="p">(</span><span class="n">xmlWriter</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Actions</span><span class="p">:</span>
			<span class="n">attribs</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;GlyphIndexDelta&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">GlyphIndexDelta</span><span class="p">)]</span>
			<span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">Store</span><span class="p">:</span>
				<span class="n">attribs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Flags&quot;</span><span class="p">,</span> <span class="s2">&quot;Store&quot;</span><span class="p">))</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Action&quot;</span><span class="p">,</span> <span class="n">attribs</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="InsertionMorphAction"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.InsertionMorphAction">[docs]</a><span class="k">class</span> <span class="nc">InsertionMorphAction</span><span class="p">(</span><span class="n">AATAction</span><span class="p">):</span>
	<span class="n">staticSize</span> <span class="o">=</span> <span class="mi">8</span>
	<span class="n">actionHeaderSize</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># 4 bytes for actionOffset</span>
	<span class="n">_FLAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SetMark&quot;</span><span class="p">,</span> <span class="s2">&quot;DontAdvance&quot;</span><span class="p">,</span>
	          <span class="s2">&quot;CurrentIsKashidaLike&quot;</span><span class="p">,</span> <span class="s2">&quot;MarkedIsKashidaLike&quot;</span><span class="p">,</span>
	          <span class="s2">&quot;CurrentInsertBefore&quot;</span><span class="p">,</span> <span class="s2">&quot;MarkedInsertBefore&quot;</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FLAGS</span><span class="p">:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<div class="viewcode-block" id="InsertionMorphAction.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.InsertionMorphAction.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReservedFlags</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetMark</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x8000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x4000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurrentIsKashidaLike</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x2000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkedIsKashidaLike</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x1000</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertBefore</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x0800</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertBefore</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x0400</span>
		<span class="n">flags</span> <span class="o">|=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>
		<span class="n">flags</span> <span class="o">|=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">currentIndex</span> <span class="o">=</span> <span class="n">actionIndex</span><span class="p">[</span>
				<span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="p">)]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">currentIndex</span> <span class="o">=</span> <span class="mh">0xFFFF</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">currentIndex</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">markedIndex</span> <span class="o">=</span> <span class="n">actionIndex</span><span class="p">[</span>
				<span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span><span class="p">)]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">markedIndex</span> <span class="o">=</span> <span class="mh">0xFFFF</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeUShort</span><span class="p">(</span><span class="n">markedIndex</span><span class="p">)</span></div>

<div class="viewcode-block" id="InsertionMorphAction.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.InsertionMorphAction.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">actionReader</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">actionReader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SetMark</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DontAdvance</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x4000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CurrentIsKashidaLike</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x2000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkedIsKashidaLike</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x1000</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertBefore</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x0800</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertBefore</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x0400</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decompileInsertionAction</span><span class="p">(</span>
			<span class="n">actionReader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span>
			<span class="n">index</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">(),</span>
			<span class="n">count</span><span class="o">=</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x03E0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decompileInsertionAction</span><span class="p">(</span>
			<span class="n">actionReader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span>
			<span class="n">index</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">readUShort</span><span class="p">(),</span>
			<span class="n">count</span><span class="o">=</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x001F</span><span class="p">))</span></div>

	<span class="k">def</span> <span class="nf">_decompileInsertionAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actionReader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mh">0xFFFF</span> <span class="ow">or</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="n">reader</span> <span class="o">=</span> <span class="n">actionReader</span><span class="o">.</span><span class="n">getSubReader</span><span class="p">(</span>
			<span class="n">actionReader</span><span class="o">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">index</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">font</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">glyphID</span><span class="p">)</span>
		        <span class="k">for</span> <span class="n">glyphID</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">readUShortArray</span><span class="p">(</span><span class="n">count</span><span class="p">)]</span>

<div class="viewcode-block" id="InsertionMorphAction.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.InsertionMorphAction.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;NewState&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NewState</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeFlagsToXML</span><span class="p">(</span><span class="n">xmlWriter</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;CurrentInsertionAction&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;MarkedInsertionAction&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="InsertionMorphAction.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.InsertionMorphAction.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
		<span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">eltName</span><span class="p">,</span> <span class="n">eltAttrs</span><span class="p">,</span> <span class="n">eltContent</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;NewState&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">NewState</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;Flags&quot;</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_setFlag</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;CurrentInsertionAction&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
					<span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">eltName</span> <span class="o">==</span> <span class="s2">&quot;MarkedInsertionAction&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">MarkedInsertionAction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
					<span class="n">eltAttrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">eltName</span></div>

<div class="viewcode-block" id="InsertionMorphAction.compileActions"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.InsertionMorphAction.compileActions">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">compileActions</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
		<span class="n">actions</span><span class="p">,</span> <span class="n">actionIndex</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="p">{},</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
		<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">_glyphClass</span><span class="p">,</span> <span class="n">trans</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">Transitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">trans</span><span class="o">.</span><span class="n">CurrentInsertionAction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">CurrentInsertionAction</span><span class="p">))</span>
				<span class="k">if</span> <span class="n">trans</span><span class="o">.</span><span class="n">MarkedInsertionAction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">MarkedInsertionAction</span><span class="p">))</span>
		<span class="c1"># Sort the compiled actions in decreasing order of</span>
		<span class="c1"># length, so that the longer sequence come before the</span>
		<span class="c1"># shorter ones.</span>
		<span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)):</span>
			<span class="c1"># We insert all sub-sequences of the action glyph sequence</span>
			<span class="c1"># into actionIndex. For example, if one action triggers on</span>
			<span class="c1"># glyph sequence [A, B, C, D, E] and another action triggers</span>
			<span class="c1"># on [C, D], we return result=[A, B, C, D, E] (as list of</span>
			<span class="c1"># encoded glyph IDs), and actionIndex={(&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;D&#39;,&#39;E&#39;): 0,</span>
			<span class="c1"># (&#39;C&#39;,&#39;D&#39;): 2}.</span>
			<span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actionIndex</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)):</span>
				<span class="n">startIndex</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">start</span>
				<span class="k">for</span> <span class="n">limit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)):</span>
					<span class="n">glyphs</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
					<span class="n">actionIndex</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">action</span><span class="p">:</span>
				<span class="n">glyphID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
				<span class="n">result</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">glyphID</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">actionIndex</span></div></div>


<div class="viewcode-block" id="FeatureParams"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.FeatureParams">[docs]</a><span class="k">class</span> <span class="nc">FeatureParams</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="FeatureParams.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.FeatureParams.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="k">assert</span> <span class="n">featureParamTypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">writer</span><span class="p">[</span><span class="s1">&#39;FeatureTag&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">&quot;Wrong FeatureParams type for feature &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">writer</span><span class="p">[</span><span class="s1">&#39;FeatureTag&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">BaseTable</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureParams.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.FeatureParams.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="n">BaseTable</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="FeatureParamsSize"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.FeatureParamsSize">[docs]</a><span class="k">class</span> <span class="nc">FeatureParamsSize</span><span class="p">(</span><span class="n">FeatureParams</span><span class="p">):</span>
	<span class="k">pass</span></div>

<div class="viewcode-block" id="FeatureParamsStylisticSet"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.FeatureParamsStylisticSet">[docs]</a><span class="k">class</span> <span class="nc">FeatureParamsStylisticSet</span><span class="p">(</span><span class="n">FeatureParams</span><span class="p">):</span>
	<span class="k">pass</span></div>

<div class="viewcode-block" id="FeatureParamsCharacterVariants"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.FeatureParamsCharacterVariants">[docs]</a><span class="k">class</span> <span class="nc">FeatureParamsCharacterVariants</span><span class="p">(</span><span class="n">FeatureParams</span><span class="p">):</span>
	<span class="k">pass</span></div>

<div class="viewcode-block" id="Coverage"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.Coverage">[docs]</a><span class="k">class</span> <span class="nc">Coverage</span><span class="p">(</span><span class="n">FormatSwitchingBaseTable</span><span class="p">):</span>

	<span class="c1"># manual implementation to get rid of glyphID dependencies</span>

<div class="viewcode-block" id="Coverage.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.Coverage.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;glyphs&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Coverage.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.Coverage.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="c1"># TODO only allow glyphs that are valid?</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;GlyphArray&quot;</span><span class="p">]</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">glyphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">ranges</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;RangeRecord&quot;</span><span class="p">]</span>
			<span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
			<span class="c1"># Some SIL fonts have coverage entries that don&#39;t have sorted</span>
			<span class="c1"># StartCoverageIndex.  If it is so, fixup and warn.  We undo</span>
			<span class="c1"># this when writing font out.</span>
			<span class="n">sorted_ranges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">StartCoverageIndex</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">ranges</span> <span class="o">!=</span> <span class="n">sorted_ranges</span><span class="p">:</span>
				<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;GSUB/GPOS Coverage is not sorted by glyph ids.&quot;</span><span class="p">)</span>
				<span class="n">ranges</span> <span class="o">=</span> <span class="n">sorted_ranges</span>
			<span class="k">del</span> <span class="n">sorted_ranges</span>
			<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
				<span class="k">assert</span> <span class="n">r</span><span class="o">.</span><span class="n">StartCoverageIndex</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphs</span><span class="p">),</span> \
					<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">StartCoverageIndex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphs</span><span class="p">))</span>
				<span class="n">start</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Start</span>
				<span class="n">end</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">End</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">startID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">requireReal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Coverage table has start glyph ID out of range: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
					<span class="k">continue</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">endID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">requireReal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="c1"># Apparently some tools use 65535 to &quot;match all&quot; the range</span>
					<span class="k">if</span> <span class="n">end</span> <span class="o">!=</span> <span class="s1">&#39;glyph65535&#39;</span><span class="p">:</span>
						<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Coverage table has end glyph ID out of range: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
					<span class="c1"># NOTE: We clobber out-of-range things here.  There are legit uses for those,</span>
					<span class="c1"># but none that we have seen in the wild.</span>
					<span class="n">endID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">)</span>
				<span class="n">glyphs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">[</span><span class="n">glyphID</span><span class="p">]</span> <span class="k">for</span> <span class="n">glyphID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startID</span><span class="p">,</span> <span class="n">endID</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown Coverage format: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coverage.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.Coverage.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">glyphs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;glyphs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">glyphs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">glyphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="nb">format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;GlyphArray&quot;</span><span class="p">:</span> <span class="n">glyphs</span><span class="p">}</span>
		<span class="n">getGlyphID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span>
		<span class="k">if</span> <span class="n">glyphs</span><span class="p">:</span>
			<span class="c1"># find out whether Format 2 is more compact or not</span>
			<span class="n">glyphIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span> <span class="k">for</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="n">glyphs</span> <span class="p">]</span>
			<span class="n">brokenOrder</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glyphIDs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">glyphIDs</span>

			<span class="n">last</span> <span class="o">=</span> <span class="n">glyphIDs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">ranges</span> <span class="o">=</span> <span class="p">[[</span><span class="n">last</span><span class="p">]]</span>
			<span class="k">for</span> <span class="n">glyphID</span> <span class="ow">in</span> <span class="n">glyphIDs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
				<span class="k">if</span> <span class="n">glyphID</span> <span class="o">!=</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">ranges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
					<span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">glyphID</span><span class="p">])</span>
				<span class="n">last</span> <span class="o">=</span> <span class="n">glyphID</span>
			<span class="n">ranges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">brokenOrder</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphs</span><span class="p">):</span>  <span class="c1"># 3 words vs. 1 word</span>
				<span class="c1"># Format 2 is more compact</span>
				<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)):</span>
					<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">RangeRecord</span><span class="p">()</span>
					<span class="n">r</span><span class="o">.</span><span class="n">StartID</span> <span class="o">=</span> <span class="n">start</span>
					<span class="n">r</span><span class="o">.</span><span class="n">Start</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
					<span class="n">r</span><span class="o">.</span><span class="n">End</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
					<span class="n">r</span><span class="o">.</span><span class="n">StartCoverageIndex</span> <span class="o">=</span> <span class="n">index</span>
					<span class="n">ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
					<span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="k">if</span> <span class="n">brokenOrder</span><span class="p">:</span>
					<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;GSUB/GPOS Coverage is not sorted by glyph ids.&quot;</span><span class="p">)</span>
					<span class="n">ranges</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">StartID</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
					<span class="k">del</span> <span class="n">r</span><span class="o">.</span><span class="n">StartID</span>
				<span class="nb">format</span> <span class="o">=</span> <span class="mi">2</span>
				<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RangeRecord&quot;</span><span class="p">:</span> <span class="n">ranges</span><span class="p">}</span>
			<span class="c1">#else:</span>
			<span class="c1">#	fallthrough; Format 1 is more compact</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="nb">format</span>
		<span class="k">return</span> <span class="n">rawTable</span></div>

<div class="viewcode-block" id="Coverage.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.Coverage.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;glyphs&quot;</span><span class="p">,</span> <span class="p">[]):</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Glyph&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">glyphName</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coverage.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.Coverage.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">glyphs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;glyphs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">glyphs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">glyphs</span>
		<span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="VarIdxMap"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarIdxMap">[docs]</a><span class="k">class</span> <span class="nc">VarIdxMap</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="VarIdxMap.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarIdxMap.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="VarIdxMap.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarIdxMap.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="k">assert</span> <span class="p">(</span><span class="n">rawTable</span><span class="p">[</span><span class="s1">&#39;EntryFormat&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFC0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
		<span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
		<span class="n">mapList</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">]</span>
		<span class="n">mapList</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mapList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapList</span><span class="p">)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">,</span> <span class="n">mapList</span><span class="p">))</span></div>

<div class="viewcode-block" id="VarIdxMap.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarIdxMap.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glyphOrder</span><span class="p">]</span>
		<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mapping</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">mapping</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="k">del</span> <span class="n">mapping</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

		<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;mapping&#39;</span><span class="p">:</span> <span class="n">mapping</span> <span class="p">}</span>
		<span class="n">rawTable</span><span class="p">[</span><span class="s1">&#39;MappingCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

		<span class="n">ored</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
			<span class="n">ored</span> <span class="o">|=</span> <span class="n">idx</span>

		<span class="n">inner</span> <span class="o">=</span> <span class="n">ored</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
		<span class="n">innerBits</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="n">inner</span><span class="p">:</span>
			<span class="n">innerBits</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="n">inner</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
		<span class="n">innerBits</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">innerBits</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">assert</span> <span class="n">innerBits</span> <span class="o">&lt;=</span> <span class="mi">16</span>

		<span class="n">ored</span> <span class="o">=</span> <span class="p">(</span><span class="n">ored</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">16</span><span class="o">-</span><span class="n">innerBits</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">ored</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">innerBits</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
		<span class="k">if</span>   <span class="n">ored</span> <span class="o">&lt;=</span> <span class="mh">0x000000FF</span><span class="p">:</span>
			<span class="n">entrySize</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">elif</span> <span class="n">ored</span> <span class="o">&lt;=</span> <span class="mh">0x0000FFFF</span><span class="p">:</span>
			<span class="n">entrySize</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">elif</span> <span class="n">ored</span> <span class="o">&lt;=</span> <span class="mh">0x00FFFFFF</span><span class="p">:</span>
			<span class="n">entrySize</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">entrySize</span> <span class="o">=</span> <span class="mi">4</span>

		<span class="n">entryFormat</span> <span class="o">=</span> <span class="p">((</span><span class="n">entrySize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">innerBits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

		<span class="n">rawTable</span><span class="p">[</span><span class="s1">&#39;EntryFormat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entryFormat</span>
		<span class="k">return</span> <span class="n">rawTable</span></div>

<div class="viewcode-block" id="VarIdxMap.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarIdxMap.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="n">attrs</span> <span class="o">=</span> <span class="p">(</span>
				<span class="p">(</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span> <span class="n">glyph</span><span class="p">),</span>
				<span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">),</span>
				<span class="p">(</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">),</span>
			<span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Map&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="VarIdxMap.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarIdxMap.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;glyph&#39;</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span> <span class="c1"># https://github.com/fonttools/fonttools/commit/21cbab8ce9ded3356fef3745122da64dcaf314e9#commitcomment-27649836</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()[</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span>
		<span class="n">outer</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;outer&#39;</span><span class="p">])</span>
		<span class="n">inner</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;inner&#39;</span><span class="p">])</span>
		<span class="k">assert</span> <span class="n">inner</span> <span class="o">&lt;=</span> <span class="mh">0xFFFF</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outer</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">inner</span></div></div>


<div class="viewcode-block" id="VarRegionList"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarRegionList">[docs]</a><span class="k">class</span> <span class="nc">VarRegionList</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="VarRegionList.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VarRegionList.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="c1"># The OT spec says VarStore.VarRegionList.RegionAxisCount should always</span>
		<span class="c1"># be equal to the fvar.axisCount, and OTS &lt; v8.0.0 enforces this rule</span>
		<span class="c1"># even when the VarRegionList is empty. We can&#39;t treat RegionAxisCount</span>
		<span class="c1"># like a normal propagated count (== len(Region[i].VarRegionAxis)),</span>
		<span class="c1"># otherwise it would default to 0 if VarRegionList is empty.</span>
		<span class="c1"># Thus, we force it to always be equal to fvar.axisCount.</span>
		<span class="c1"># https://github.com/khaledhosny/ots/pull/192</span>
		<span class="n">fvarTable</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fvar&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">fvarTable</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RegionAxisCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fvarTable</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span>
			<span class="s2">&quot;RegionAxisCount&quot;</span><span class="p">:</span> <span class="n">CountReference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="s2">&quot;RegionAxisCount&quot;</span><span class="p">)</span>
		<span class="p">}</span></div></div>


<div class="viewcode-block" id="SingleSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.SingleSubst">[docs]</a><span class="k">class</span> <span class="nc">SingleSubst</span><span class="p">(</span><span class="n">FormatSwitchingBaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="SingleSubst.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.SingleSubst.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="SingleSubst.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.SingleSubst.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="nb">input</span> <span class="o">=</span> <span class="n">_getGlyphsFromCoverageTable</span><span class="p">(</span><span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Coverage&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;DeltaGlyphID&quot;</span><span class="p">]</span>
			<span class="n">inputGIDS</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">input</span> <span class="p">]</span>
			<span class="n">outGIDS</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">glyphID</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">%</span> <span class="mi">65536</span> <span class="k">for</span> <span class="n">glyphID</span> <span class="ow">in</span> <span class="n">inputGIDS</span> <span class="p">]</span>
			<span class="n">outNames</span> <span class="o">=</span> <span class="p">[</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="n">glyphID</span><span class="p">)</span> <span class="k">for</span> <span class="n">glyphID</span> <span class="ow">in</span> <span class="n">outGIDS</span> <span class="p">]</span>
			<span class="k">for</span> <span class="n">inp</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">outNames</span><span class="p">):</span>
				<span class="n">mapping</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;GlyphCount&quot;</span><span class="p">],</span> \
					<span class="s2">&quot;invalid SingleSubstFormat2 table&quot;</span>
			<span class="n">subst</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Substitute&quot;</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">inp</span><span class="p">,</span> <span class="n">sub</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">subst</span><span class="p">):</span>
				<span class="n">mapping</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unknown format: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span></div>

<div class="viewcode-block" id="SingleSubst.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.SingleSubst.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="n">getGlyphID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span>
		<span class="n">gidItems</span> <span class="o">=</span> <span class="p">[(</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">getGlyphID</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
		<span class="n">sortableItems</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gidItems</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>

		<span class="c1"># figure out format</span>
		<span class="nb">format</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">delta</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">inID</span><span class="p">,</span> <span class="n">outID</span> <span class="ow">in</span> <span class="n">gidItems</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">delta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">outID</span> <span class="o">-</span> <span class="n">inID</span><span class="p">)</span> <span class="o">%</span> <span class="mi">65536</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">inID</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">%</span> <span class="mi">65536</span> <span class="o">!=</span> <span class="n">outID</span><span class="p">:</span>
					<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">delta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="c1"># the mapping is empty, better use format 2</span>
				<span class="nb">format</span> <span class="o">=</span> <span class="mi">2</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">format</span> <span class="o">=</span> <span class="mi">1</span>

		<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="nb">format</span>
		<span class="n">cov</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">()</span>
		<span class="nb">input</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">item</span> <span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sortableItems</span><span class="p">]</span>
		<span class="n">subst</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">item</span> <span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sortableItems</span><span class="p">]</span>
		<span class="n">cov</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="nb">input</span>
		<span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cov</span>
		<span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">assert</span> <span class="n">delta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
			<span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;DeltaGlyphID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Substitute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subst</span>
		<span class="k">return</span> <span class="n">rawTable</span></div>

<div class="viewcode-block" id="SingleSubst.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.SingleSubst.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">inGlyph</span><span class="p">,</span> <span class="n">outGlyph</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Substitution&quot;</span><span class="p">,</span>
					<span class="p">[(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">inGlyph</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">outGlyph</span><span class="p">)])</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleSubst.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.SingleSubst.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="MultipleSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst">[docs]</a><span class="k">class</span> <span class="nc">MultipleSubst</span><span class="p">(</span><span class="n">FormatSwitchingBaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="MultipleSubst.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="MultipleSubst.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">glyphs</span> <span class="o">=</span> <span class="n">_getGlyphsFromCoverageTable</span><span class="p">(</span><span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Coverage&quot;</span><span class="p">])</span>
			<span class="n">subst</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">Substitute</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Sequence&quot;</span><span class="p">]]</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="n">subst</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unknown format: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span></div>

<div class="viewcode-block" id="MultipleSubst.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">cov</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">()</span>
		<span class="n">cov</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;Coverage&quot;</span><span class="p">:</span> <span class="n">cov</span><span class="p">,</span>
                        <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">makeSequence_</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">])</span>
                                     <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">cov</span><span class="o">.</span><span class="n">glyphs</span><span class="p">],</span>
                <span class="p">}</span>
		<span class="k">return</span> <span class="n">rawTable</span></div>

<div class="viewcode-block" id="MultipleSubst.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">inGlyph</span><span class="p">,</span> <span class="n">outGlyphs</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outGlyphs</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Substitution&quot;</span><span class="p">,</span>
					<span class="p">[(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">inGlyph</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)])</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultipleSubst.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>

		<span class="c1"># TTX v3.0 and earlier.</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Coverage&quot;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">old_coverage_</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
					<span class="k">continue</span>
				<span class="n">element_name</span><span class="p">,</span> <span class="n">element_attrs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">element</span>
				<span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;Glyph&quot;</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">old_coverage_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_attrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
			<span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)))</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_coverage_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
			<span class="n">glyph_mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
					<span class="k">continue</span>
				<span class="n">element_name</span><span class="p">,</span> <span class="n">element_attrs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">element</span>
				<span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;Substitute&quot;</span><span class="p">:</span>
					<span class="n">glyph_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_attrs</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
			<span class="k">return</span>

                <span class="c1"># TTX v3.1 and later.</span>
		<span class="n">outGlyphs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">outGlyphs</span><span class="p">]</span></div>

<div class="viewcode-block" id="MultipleSubst.makeSequence_"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.MultipleSubst.makeSequence_">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">makeSequence_</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
		<span class="n">seq</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">()</span>
		<span class="n">seq</span><span class="o">.</span><span class="n">Substitute</span> <span class="o">=</span> <span class="n">g</span>
		<span class="k">return</span> <span class="n">seq</span></div></div>


<div class="viewcode-block" id="ClassDef"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ClassDef">[docs]</a><span class="k">class</span> <span class="nc">ClassDef</span><span class="p">(</span><span class="n">FormatSwitchingBaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="ClassDef.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ClassDef.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;classDefs&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="ClassDef.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ClassDef.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">classDefs</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;StartGlyph&quot;</span><span class="p">]</span>
			<span class="n">classList</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;ClassValueArray&quot;</span><span class="p">]</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">startID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">requireReal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ClassDef table has start glyph ID out of range: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
				<span class="n">startID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">)</span>
			<span class="n">endID</span> <span class="o">=</span> <span class="n">startID</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">classList</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">endID</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">):</span>
				<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ClassDef table has entries for out of range glyph IDs: </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
					<span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">classList</span><span class="p">))</span>
				<span class="c1"># NOTE: We clobber out-of-range things here.  There are legit uses for those,</span>
				<span class="c1"># but none that we have seen in the wild.</span>
				<span class="n">endID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">glyphID</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">startID</span><span class="p">,</span> <span class="n">endID</span><span class="p">),</span> <span class="n">classList</span><span class="p">):</span>
				<span class="k">if</span> <span class="bp">cls</span><span class="p">:</span>
					<span class="n">classDefs</span><span class="p">[</span><span class="n">glyphOrder</span><span class="p">[</span><span class="n">glyphID</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">cls</span>

		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">records</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;ClassRangeRecord&quot;</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
				<span class="n">start</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">Start</span>
				<span class="n">end</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">End</span>
				<span class="bp">cls</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">Class</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">startID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">requireReal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ClassDef table has start glyph ID out of range: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
					<span class="k">continue</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">endID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">requireReal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="c1"># Apparently some tools use 65535 to &quot;match all&quot; the range</span>
					<span class="k">if</span> <span class="n">end</span> <span class="o">!=</span> <span class="s1">&#39;glyph65535&#39;</span><span class="p">:</span>
						<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ClassDef table has end glyph ID out of range: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
					<span class="c1"># NOTE: We clobber out-of-range things here.  There are legit uses for those,</span>
					<span class="c1"># but none that we have seen in the wild.</span>
					<span class="n">endID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphOrder</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">glyphID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startID</span><span class="p">,</span> <span class="n">endID</span><span class="p">):</span>
					<span class="k">if</span> <span class="bp">cls</span><span class="p">:</span>
						<span class="n">classDefs</span><span class="p">[</span><span class="n">glyphOrder</span><span class="p">[</span><span class="n">glyphID</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">cls</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown ClassDef format: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="n">classDefs</span></div>

	<span class="k">def</span> <span class="nf">_getClassRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">classDefs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;classDefs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">classDefs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">return</span>
		<span class="n">getGlyphID</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span>
		<span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">glyphName</span><span class="p">),</span> <span class="n">glyphName</span><span class="p">,</span> <span class="bp">cls</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">items</span><span class="p">:</span>
			<span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
			<span class="n">last</span><span class="p">,</span> <span class="n">lastName</span><span class="p">,</span> <span class="n">lastCls</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">ranges</span> <span class="o">=</span> <span class="p">[[</span><span class="n">lastCls</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">lastName</span><span class="p">]]</span>
			<span class="k">for</span> <span class="n">glyphID</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
				<span class="k">if</span> <span class="n">glyphID</span> <span class="o">!=</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">cls</span> <span class="o">!=</span> <span class="n">lastCls</span><span class="p">:</span>
					<span class="n">ranges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">last</span><span class="p">,</span> <span class="n">lastName</span><span class="p">])</span>
					<span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">cls</span><span class="p">,</span> <span class="n">glyphID</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">])</span>
				<span class="n">last</span> <span class="o">=</span> <span class="n">glyphID</span>
				<span class="n">lastName</span> <span class="o">=</span> <span class="n">glyphName</span>
				<span class="n">lastCls</span> <span class="o">=</span> <span class="bp">cls</span>
			<span class="n">ranges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">last</span><span class="p">,</span> <span class="n">lastName</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">ranges</span>

<div class="viewcode-block" id="ClassDef.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ClassDef.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="nb">format</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ClassRangeRecord&quot;</span><span class="p">:</span> <span class="p">[]}</span>
		<span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getClassRanges</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">ranges</span><span class="p">:</span>
			<span class="n">startGlyph</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">endGlyph</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
			<span class="n">glyphCount</span> <span class="o">=</span> <span class="n">endGlyph</span> <span class="o">-</span> <span class="n">startGlyph</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="n">glyphCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
				<span class="c1"># Format 2 is more compact</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)):</span>
					<span class="bp">cls</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">startName</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">endName</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
					<span class="n">rec</span> <span class="o">=</span> <span class="n">ClassRangeRecord</span><span class="p">()</span>
					<span class="n">rec</span><span class="o">.</span><span class="n">Start</span> <span class="o">=</span> <span class="n">startName</span>
					<span class="n">rec</span><span class="o">.</span><span class="n">End</span> <span class="o">=</span> <span class="n">endName</span>
					<span class="n">rec</span><span class="o">.</span><span class="n">Class</span> <span class="o">=</span> <span class="bp">cls</span>
					<span class="n">ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
				<span class="nb">format</span> <span class="o">=</span> <span class="mi">2</span>
				<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ClassRangeRecord&quot;</span><span class="p">:</span> <span class="n">ranges</span><span class="p">}</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># Format 1 is more compact</span>
				<span class="n">startGlyphName</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
				<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">glyphCount</span>
				<span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">startName</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">endName</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="n">startGlyph</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">startGlyph</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
						<span class="n">classes</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
				<span class="nb">format</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="n">rawTable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;StartGlyph&quot;</span><span class="p">:</span> <span class="n">startGlyphName</span><span class="p">,</span> <span class="s2">&quot;ClassValueArray&quot;</span><span class="p">:</span> <span class="n">classes</span><span class="p">}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="nb">format</span>
		<span class="k">return</span> <span class="n">rawTable</span></div>

<div class="viewcode-block" id="ClassDef.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ClassDef.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classDefs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;ClassDef&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;glyph&quot;</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)])</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="ClassDef.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ClassDef.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">classDefs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;classDefs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">classDefs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">classDefs</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="n">classDefs</span>
		<span class="n">classDefs</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="AlternateSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AlternateSubst">[docs]</a><span class="k">class</span> <span class="nc">AlternateSubst</span><span class="p">(</span><span class="n">FormatSwitchingBaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="AlternateSubst.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AlternateSubst.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;alternates&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="AlternateSubst.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AlternateSubst.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">alternates</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="nb">input</span> <span class="o">=</span> <span class="n">_getGlyphsFromCoverageTable</span><span class="p">(</span><span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Coverage&quot;</span><span class="p">])</span>
			<span class="n">alts</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;AlternateSet&quot;</span><span class="p">]</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">alts</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">inp</span><span class="p">,</span><span class="n">alt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">alts</span><span class="p">):</span>
				<span class="n">alternates</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Alternate</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unknown format: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="n">alternates</span></div>

<div class="viewcode-block" id="AlternateSubst.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AlternateSubst.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">alternates</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;alternates&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">alternates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">alternates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alternates</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
			<span class="n">glyphName</span><span class="p">,</span> <span class="nb">set</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">glyphName</span><span class="p">),</span> <span class="n">glyphName</span><span class="p">,</span> <span class="nb">set</span>
		<span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
		<span class="n">cov</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">()</span>
		<span class="n">cov</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
		<span class="n">alternates</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">setList</span> <span class="o">=</span> <span class="p">[</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
		<span class="k">for</span> <span class="nb">set</span> <span class="ow">in</span> <span class="n">setList</span><span class="p">:</span>
			<span class="n">alts</span> <span class="o">=</span> <span class="n">AlternateSet</span><span class="p">()</span>
			<span class="n">alts</span><span class="o">.</span><span class="n">Alternate</span> <span class="o">=</span> <span class="nb">set</span>
			<span class="n">alternates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alts</span><span class="p">)</span>
		<span class="c1"># a special case to deal with the fact that several hundred Adobe Japan1-5</span>
		<span class="c1"># CJK fonts will overflow an offset if the coverage table isn&#39;t pushed to the end.</span>
		<span class="c1"># Also useful in that when splitting a sub-table because of an offset overflow</span>
		<span class="c1"># I don&#39;t need to calculate the change in the subtable offset due to the change in the coverage table size.</span>
		<span class="c1"># Allows packing more rules in subtable.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sortCoverageLast</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Coverage&quot;</span><span class="p">:</span> <span class="n">cov</span><span class="p">,</span> <span class="s2">&quot;AlternateSet&quot;</span><span class="p">:</span> <span class="n">alternates</span><span class="p">}</span></div>

<div class="viewcode-block" id="AlternateSubst.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AlternateSubst.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alternates</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">alternates</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s2">&quot;AlternateSet&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="n">glyphName</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">alternates</span><span class="p">:</span>
				<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Alternate&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="n">alt</span><span class="p">)</span>
				<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s2">&quot;AlternateSet&quot;</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="AlternateSubst.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.AlternateSubst.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">alternates</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;alternates&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">alternates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">alternates</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="n">alternates</span>
		<span class="n">glyphName</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">]</span>
		<span class="nb">set</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">alternates</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="nb">set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="LigatureSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureSubst">[docs]</a><span class="k">class</span> <span class="nc">LigatureSubst</span><span class="p">(</span><span class="n">FormatSwitchingBaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="LigatureSubst.populateDefaults"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureSubst.populateDefaults">[docs]</a>	<span class="k">def</span> <span class="nf">populateDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ligatures&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="LigatureSubst.postRead"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureSubst.postRead">[docs]</a>	<span class="k">def</span> <span class="nf">postRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawTable</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">ligatures</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="nb">input</span> <span class="o">=</span> <span class="n">_getGlyphsFromCoverageTable</span><span class="p">(</span><span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;Coverage&quot;</span><span class="p">])</span>
			<span class="n">ligSets</span> <span class="o">=</span> <span class="n">rawTable</span><span class="p">[</span><span class="s2">&quot;LigatureSet&quot;</span><span class="p">]</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ligSets</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)):</span>
				<span class="n">ligatures</span><span class="p">[</span><span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ligSets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Ligature</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unknown format: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="n">ligatures</span></div>

<div class="viewcode-block" id="LigatureSubst.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureSubst.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">ligatures</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;ligatures&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">ligatures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ligatures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="k">if</span> <span class="n">ligatures</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ligatures</span><span class="p">)),</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="c1"># New high-level API in v3.1 and later.  Note that we just support compiling this</span>
			<span class="c1"># for now.  We don&#39;t load to this API, and don&#39;t do XML with it.</span>

			<span class="c1"># ligatures is map from components-sequence to lig-glyph</span>
			<span class="n">newLigatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">comps</span><span class="p">,</span><span class="n">lig</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ligatures</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
				<span class="n">ligature</span> <span class="o">=</span> <span class="n">Ligature</span><span class="p">()</span>
				<span class="n">ligature</span><span class="o">.</span><span class="n">Component</span> <span class="o">=</span> <span class="n">comps</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
				<span class="n">ligature</span><span class="o">.</span><span class="n">CompCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span>
				<span class="n">ligature</span><span class="o">.</span><span class="n">LigGlyph</span> <span class="o">=</span> <span class="n">lig</span>
				<span class="n">newLigatures</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">comps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ligature</span><span class="p">)</span>
			<span class="n">ligatures</span> <span class="o">=</span> <span class="n">newLigatures</span>

		<span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ligatures</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
			<span class="n">glyphName</span><span class="p">,</span> <span class="nb">set</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">glyphName</span><span class="p">),</span> <span class="n">glyphName</span><span class="p">,</span> <span class="nb">set</span>
		<span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
		<span class="n">cov</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">()</span>
		<span class="n">cov</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>

		<span class="n">ligSets</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">setList</span> <span class="o">=</span> <span class="p">[</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="p">]</span>
		<span class="k">for</span> <span class="nb">set</span> <span class="ow">in</span> <span class="n">setList</span><span class="p">:</span>
			<span class="n">ligSet</span> <span class="o">=</span> <span class="n">LigatureSet</span><span class="p">()</span>
			<span class="n">ligs</span> <span class="o">=</span> <span class="n">ligSet</span><span class="o">.</span><span class="n">Ligature</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">lig</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">:</span>
				<span class="n">ligs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lig</span><span class="p">)</span>
			<span class="n">ligSets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ligSet</span><span class="p">)</span>
		<span class="c1"># Useful in that when splitting a sub-table because of an offset overflow</span>
		<span class="c1"># I don&#39;t need to calculate the change in subtabl offset due to the coverage table size.</span>
		<span class="c1"># Allows packing more rules in subtable.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sortCoverageLast</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Coverage&quot;</span><span class="p">:</span> <span class="n">cov</span><span class="p">,</span> <span class="s2">&quot;LigatureSet&quot;</span><span class="p">:</span> <span class="n">ligSets</span><span class="p">}</span></div>

<div class="viewcode-block" id="LigatureSubst.toXML2"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureSubst.toXML2">[docs]</a>	<span class="k">def</span> <span class="nf">toXML2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlWriter</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">ligSets</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s2">&quot;LigatureSet&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="n">glyphName</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">lig</span> <span class="ow">in</span> <span class="n">ligSets</span><span class="p">:</span>
				<span class="n">xmlWriter</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;Ligature&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="n">lig</span><span class="o">.</span><span class="n">LigGlyph</span><span class="p">,</span>
					<span class="n">components</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lig</span><span class="o">.</span><span class="n">Component</span><span class="p">))</span>
				<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s2">&quot;LigatureSet&quot;</span><span class="p">)</span>
			<span class="n">xmlWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="LigatureSubst.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.LigatureSubst.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="n">ligatures</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;ligatures&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">ligatures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ligatures</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="n">ligatures</span>
		<span class="n">glyphName</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">]</span>
		<span class="n">ligs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">ligatures</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligs</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="n">lig</span> <span class="o">=</span> <span class="n">Ligature</span><span class="p">()</span>
			<span class="n">lig</span><span class="o">.</span><span class="n">LigGlyph</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;glyph&quot;</span><span class="p">]</span>
			<span class="n">components</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span>
			<span class="n">lig</span><span class="o">.</span><span class="n">Component</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">components</span> <span class="k">else</span> <span class="p">[]</span>
			<span class="n">lig</span><span class="o">.</span><span class="n">CompCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lig</span><span class="o">.</span><span class="n">Component</span><span class="p">)</span>
			<span class="n">ligs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lig</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="COLR"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.COLR">[docs]</a><span class="k">class</span> <span class="nc">COLR</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="COLR.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.COLR.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="c1"># COLRv0 is exceptional in that LayerRecordCount appears *after* the</span>
		<span class="c1"># LayerRecordArray it counts, but the parser logic expects Count fields</span>
		<span class="c1"># to always precede the arrays. Here we work around this by parsing the</span>
		<span class="c1"># LayerRecordCount before the rest of the table, and storing it in</span>
		<span class="c1"># the reader&#39;s local state.</span>
		<span class="n">subReader</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getSubReader</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">conv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConverters</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">conv</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;LayerRecordCount&quot;</span><span class="p">:</span>
				<span class="n">subReader</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">conv</span><span class="o">.</span><span class="n">staticSize</span><span class="p">)</span>
				<span class="k">continue</span>
			<span class="n">conv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConverterByName</span><span class="p">(</span><span class="s2">&quot;LayerRecordCount&quot;</span><span class="p">)</span>
			<span class="n">reader</span><span class="p">[</span><span class="n">conv</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">subReader</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">tableDict</span><span class="o">=</span><span class="p">{})</span>
			<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;LayerRecordCount converter not found&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">BaseTable</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span></div>

<div class="viewcode-block" id="COLR.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.COLR.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="c1"># The writer similarly assumes Count values precede the things counted,</span>
		<span class="c1"># thus here we pre-initialize a CountReference; the actual count value</span>
		<span class="c1"># will be set to the lenght of the array by the time this is assembled.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">LayerRecordCount</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span>
			<span class="s2">&quot;LayerRecordCount&quot;</span><span class="p">:</span> <span class="n">CountReference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="s2">&quot;LayerRecordCount&quot;</span><span class="p">)</span>
		<span class="p">}</span></div></div>


<div class="viewcode-block" id="BaseGlyphRecordArray"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.BaseGlyphRecordArray">[docs]</a><span class="k">class</span> <span class="nc">BaseGlyphRecordArray</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="BaseGlyphRecordArray.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.BaseGlyphRecordArray.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">BaseGlyphRecord</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">BaseGlyphRecord</span><span class="p">,</span>
			<span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">BaseGlyph</span><span class="p">)</span>
		<span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="BaseGlyphV1Array"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.BaseGlyphV1Array">[docs]</a><span class="k">class</span> <span class="nc">BaseGlyphV1Array</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>

<div class="viewcode-block" id="BaseGlyphV1Array.preWrite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.BaseGlyphV1Array.preWrite">[docs]</a>	<span class="k">def</span> <span class="nf">preWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">BaseGlyphV1Record</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">BaseGlyphV1Record</span><span class="p">,</span>
			<span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">BaseGlyph</span><span class="p">)</span>
		<span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div></div>



<div class="viewcode-block" id="VariableValue"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VariableValue">[docs]</a><span class="k">class</span> <span class="nc">VariableValue</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;VariableValue&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;varIdx&quot;</span><span class="p">])):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

	<span class="n">_value_mapper</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">varIdx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
			<span class="bp">cls</span><span class="p">,</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">_value_mapper</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value_mapper</span> <span class="k">else</span> <span class="n">value</span><span class="p">,</span>
			<span class="n">varIdx</span>
		<span class="p">)</span>

	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value_mapper</span><span class="p">:</span>
			<span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
				<span class="k">pass</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value_mapper</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
				<span class="n">iterable</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">((</span><span class="n">value</span><span class="p">,),</span> <span class="n">it</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span></div>


<div class="viewcode-block" id="VariableFloat"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VariableFloat">[docs]</a><span class="k">class</span> <span class="nc">VariableFloat</span><span class="p">(</span><span class="n">VariableValue</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
	<span class="n">_value_mapper</span> <span class="o">=</span> <span class="nb">float</span></div>


<div class="viewcode-block" id="VariableInt"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.VariableInt">[docs]</a><span class="k">class</span> <span class="nc">VariableInt</span><span class="p">(</span><span class="n">VariableValue</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
	<span class="n">_value_mapper</span> <span class="o">=</span> <span class="n">otRound</span></div>


<div class="viewcode-block" id="ExtendMode"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.ExtendMode">[docs]</a><span class="k">class</span> <span class="nc">ExtendMode</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
	<span class="n">PAD</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">REPEAT</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">REFLECT</span> <span class="o">=</span> <span class="mi">2</span></div>


<span class="c1"># For each subtable format there is a class. However, we don&#39;t really distinguish</span>
<span class="c1"># between &quot;field name&quot; and &quot;format name&quot;: often these are the same. Yet there&#39;s</span>
<span class="c1"># a whole bunch of fields with different names. The following dict is a mapping</span>
<span class="c1"># from &quot;format name&quot; to &quot;field name&quot;. _buildClasses() uses this to create a</span>
<span class="c1"># subclass for each alternate field name.</span>
<span class="c1">#</span>
<span class="n">_equivalents</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s1">&#39;MarkArray&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Mark1Array&quot;</span><span class="p">,),</span>
	<span class="s1">&#39;LangSys&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DefaultLangSys&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;Coverage&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;MarkCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;BaseCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;LigatureCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark1Coverage&#39;</span><span class="p">,</span>
			<span class="s1">&#39;Mark2Coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;BacktrackCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;InputCoverage&#39;</span><span class="p">,</span>
			<span class="s1">&#39;LookAheadCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;VertGlyphCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;HorizGlyphCoverage&#39;</span><span class="p">,</span>
			<span class="s1">&#39;TopAccentCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;ExtendedShapeCoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;MathKernCoverage&#39;</span><span class="p">),</span>
	<span class="s1">&#39;ClassDef&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ClassDef1&#39;</span><span class="p">,</span> <span class="s1">&#39;ClassDef2&#39;</span><span class="p">,</span> <span class="s1">&#39;BacktrackClassDef&#39;</span><span class="p">,</span> <span class="s1">&#39;InputClassDef&#39;</span><span class="p">,</span>
			<span class="s1">&#39;LookAheadClassDef&#39;</span><span class="p">,</span> <span class="s1">&#39;GlyphClassDef&#39;</span><span class="p">,</span> <span class="s1">&#39;MarkAttachClassDef&#39;</span><span class="p">),</span>
	<span class="s1">&#39;Anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;EntryAnchor&#39;</span><span class="p">,</span> <span class="s1">&#39;ExitAnchor&#39;</span><span class="p">,</span> <span class="s1">&#39;BaseAnchor&#39;</span><span class="p">,</span> <span class="s1">&#39;LigatureAnchor&#39;</span><span class="p">,</span>
			<span class="s1">&#39;Mark2Anchor&#39;</span><span class="p">,</span> <span class="s1">&#39;MarkAnchor&#39;</span><span class="p">),</span>
	<span class="s1">&#39;Device&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;XPlaDevice&#39;</span><span class="p">,</span> <span class="s1">&#39;YPlaDevice&#39;</span><span class="p">,</span> <span class="s1">&#39;XAdvDevice&#39;</span><span class="p">,</span> <span class="s1">&#39;YAdvDevice&#39;</span><span class="p">,</span>
			<span class="s1">&#39;XDeviceTable&#39;</span><span class="p">,</span> <span class="s1">&#39;YDeviceTable&#39;</span><span class="p">,</span> <span class="s1">&#39;DeviceTable&#39;</span><span class="p">),</span>
	<span class="s1">&#39;Axis&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;HorizAxis&#39;</span><span class="p">,</span> <span class="s1">&#39;VertAxis&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;MinMax&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DefaultMinMax&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;BaseCoord&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;MinCoord&#39;</span><span class="p">,</span> <span class="s1">&#39;MaxCoord&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;JstfLangSys&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DefJstfLangSys&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;JstfGSUBModList&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ShrinkageEnableGSUB&#39;</span><span class="p">,</span> <span class="s1">&#39;ShrinkageDisableGSUB&#39;</span><span class="p">,</span> <span class="s1">&#39;ExtensionEnableGSUB&#39;</span><span class="p">,</span>
			<span class="s1">&#39;ExtensionDisableGSUB&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;JstfGPOSModList&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ShrinkageEnableGPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;ShrinkageDisableGPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;ExtensionEnableGPOS&#39;</span><span class="p">,</span>
			<span class="s1">&#39;ExtensionDisableGPOS&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;JstfMax&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ShrinkageJstfMax&#39;</span><span class="p">,</span> <span class="s1">&#39;ExtensionJstfMax&#39;</span><span class="p">,),</span>
	<span class="s1">&#39;MathKern&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TopRightMathKern&#39;</span><span class="p">,</span> <span class="s1">&#39;TopLeftMathKern&#39;</span><span class="p">,</span> <span class="s1">&#39;BottomRightMathKern&#39;</span><span class="p">,</span>
			<span class="s1">&#39;BottomLeftMathKern&#39;</span><span class="p">),</span>
	<span class="s1">&#39;MathGlyphConstruction&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;VertGlyphConstruction&#39;</span><span class="p">,</span> <span class="s1">&#39;HorizGlyphConstruction&#39;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1">#</span>
<span class="c1"># OverFlow logic, to automatically create ExtensionLookups</span>
<span class="c1"># XXX This should probably move to otBase.py</span>
<span class="c1">#</span>

<div class="viewcode-block" id="fixLookupOverFlows"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.fixLookupOverFlows">[docs]</a><span class="k">def</span> <span class="nf">fixLookupOverFlows</span><span class="p">(</span><span class="n">ttf</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; Either the offset from the LookupList to a lookup overflowed, or</span>
<span class="sd">	an offset from a lookup to a subtable overflowed.</span>
<span class="sd">	The table layout is:</span>
<span class="sd">	GPSO/GUSB</span>
<span class="sd">		Script List</span>
<span class="sd">		Feature List</span>
<span class="sd">		LookUpList</span>
<span class="sd">			Lookup[0] and contents</span>
<span class="sd">				SubTable offset list</span>
<span class="sd">					SubTable[0] and contents</span>
<span class="sd">					...</span>
<span class="sd">					SubTable[n] and contents</span>
<span class="sd">			...</span>
<span class="sd">			Lookup[n] and contents</span>
<span class="sd">				SubTable offset list</span>
<span class="sd">					SubTable[0] and contents</span>
<span class="sd">					...</span>
<span class="sd">					SubTable[n] and contents</span>
<span class="sd">	If the offset to a lookup overflowed (SubTableIndex is None)</span>
<span class="sd">		we must promote the *previous*	lookup to an Extension type.</span>
<span class="sd">	If the offset from a lookup to subtable overflowed, then we must promote it</span>
<span class="sd">		to an Extension Lookup type.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">lookupIndex</span> <span class="o">=</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">LookupListIndex</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">SubTableIndex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">lookupIndex</span> <span class="o">=</span> <span class="n">lookupIndex</span> <span class="o">-</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">lookupIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">ok</span>
	<span class="k">if</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span> <span class="o">==</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">:</span>
		<span class="n">extType</span> <span class="o">=</span> <span class="mi">7</span>
	<span class="k">elif</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span> <span class="o">==</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">:</span>
		<span class="n">extType</span> <span class="o">=</span> <span class="mi">9</span>

	<span class="n">lookups</span> <span class="o">=</span> <span class="n">ttf</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">]</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span>
	<span class="n">lookup</span> <span class="o">=</span> <span class="n">lookups</span><span class="p">[</span><span class="n">lookupIndex</span><span class="p">]</span>
	<span class="c1"># If the previous lookup is an extType, look further back. Very unlikely, but possible.</span>
	<span class="k">while</span> <span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">LookupType</span> <span class="o">==</span> <span class="n">extType</span><span class="p">:</span>
		<span class="n">lookupIndex</span> <span class="o">=</span> <span class="n">lookupIndex</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="n">lookupIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">ok</span>
		<span class="n">lookup</span> <span class="o">=</span> <span class="n">lookups</span><span class="p">[</span><span class="n">lookupIndex</span><span class="p">]</span>

	<span class="n">lookup</span><span class="o">.</span><span class="n">LookupType</span> <span class="o">=</span> <span class="n">extType</span>
	<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="p">)):</span>
		<span class="n">subTable</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="p">[</span><span class="n">si</span><span class="p">]</span>
		<span class="n">extSubTableClass</span> <span class="o">=</span> <span class="n">lookupTypes</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">][</span><span class="n">extType</span><span class="p">]</span>
		<span class="n">extSubTable</span> <span class="o">=</span> <span class="n">extSubTableClass</span><span class="p">()</span>
		<span class="n">extSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">extSubTable</span><span class="o">.</span><span class="n">ExtSubTable</span> <span class="o">=</span> <span class="n">subTable</span>
		<span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="p">[</span><span class="n">si</span><span class="p">]</span> <span class="o">=</span> <span class="n">extSubTable</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">ok</span></div>

<div class="viewcode-block" id="splitMultipleSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.splitMultipleSubst">[docs]</a><span class="k">def</span> <span class="nf">splitMultipleSubst</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">newSubTable</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span>
	<span class="n">oldMapping</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
	<span class="n">oldLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldMapping</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemName</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;RangeRecord&#39;</span><span class="p">]:</span>
		<span class="c1"># Coverage table is written last. Overflow is to or within the</span>
		<span class="c1"># the coverage table. We will just cut the subtable in half.</span>
		<span class="n">newLen</span> <span class="o">=</span> <span class="n">oldLen</span> <span class="o">//</span> <span class="mi">2</span>

	<span class="k">elif</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemName</span> <span class="o">==</span> <span class="s1">&#39;Sequence&#39;</span><span class="p">:</span>
		<span class="c1"># We just need to back up by two items from the overflowed</span>
		<span class="c1"># Sequence index to make sure the offset to the Coverage table</span>
		<span class="c1"># doesn&#39;t overflow.</span>
		<span class="n">newLen</span> <span class="o">=</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemIndex</span> <span class="o">-</span> <span class="mi">1</span>

	<span class="n">newSubTable</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">newLen</span><span class="p">,</span> <span class="n">oldLen</span><span class="p">):</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">oldMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

	<span class="k">return</span> <span class="n">ok</span></div>

<div class="viewcode-block" id="splitAlternateSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.splitAlternateSubst">[docs]</a><span class="k">def</span> <span class="nf">splitAlternateSubst</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">newSubTable</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span>
	<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="s1">&#39;sortCoverageLast&#39;</span><span class="p">):</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">sortCoverageLast</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">sortCoverageLast</span>

	<span class="n">oldAlts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">alternates</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
	<span class="n">oldLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldAlts</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemName</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;Coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;RangeRecord&#39;</span><span class="p">]:</span>
		<span class="c1"># Coverage table is written last. overflow is to or within the</span>
		<span class="c1"># the coverage table. We will just cut the subtable in half.</span>
		<span class="n">newLen</span> <span class="o">=</span> <span class="n">oldLen</span><span class="o">//</span><span class="mi">2</span>

	<span class="k">elif</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemName</span> <span class="o">==</span> <span class="s1">&#39;AlternateSet&#39;</span><span class="p">:</span>
		<span class="c1"># We just need to back up by two items</span>
		<span class="c1"># from the overflowed AlternateSet index to make sure the offset</span>
		<span class="c1"># to the Coverage table doesn&#39;t overflow.</span>
		<span class="n">newLen</span> <span class="o">=</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemIndex</span> <span class="o">-</span> <span class="mi">1</span>

	<span class="n">newSubTable</span><span class="o">.</span><span class="n">alternates</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">newLen</span><span class="p">,</span> <span class="n">oldLen</span><span class="p">):</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">oldAlts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">alternates</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">alternates</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

	<span class="k">return</span> <span class="n">ok</span></div>


<div class="viewcode-block" id="splitLigatureSubst"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.splitLigatureSubst">[docs]</a><span class="k">def</span> <span class="nf">splitLigatureSubst</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">newSubTable</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span>
	<span class="n">oldLigs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">ligatures</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
	<span class="n">oldLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldLigs</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemName</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;Coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;RangeRecord&#39;</span><span class="p">]:</span>
		<span class="c1"># Coverage table is written last. overflow is to or within the</span>
		<span class="c1"># the coverage table. We will just cut the subtable in half.</span>
		<span class="n">newLen</span> <span class="o">=</span> <span class="n">oldLen</span><span class="o">//</span><span class="mi">2</span>

	<span class="k">elif</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemName</span> <span class="o">==</span> <span class="s1">&#39;LigatureSet&#39;</span><span class="p">:</span>
		<span class="c1"># We just need to back up by two items</span>
		<span class="c1"># from the overflowed AlternateSet index to make sure the offset</span>
		<span class="c1"># to the Coverage table doesn&#39;t overflow.</span>
		<span class="n">newLen</span> <span class="o">=</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">itemIndex</span> <span class="o">-</span> <span class="mi">1</span>

	<span class="n">newSubTable</span><span class="o">.</span><span class="n">ligatures</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">newLen</span><span class="p">,</span> <span class="n">oldLen</span><span class="p">):</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">oldLigs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">ligatures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">ligatures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

	<span class="k">return</span> <span class="n">ok</span></div>


<div class="viewcode-block" id="splitPairPos"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.splitPairPos">[docs]</a><span class="k">def</span> <span class="nf">splitPairPos</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">newSubTable</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="n">st</span> <span class="o">=</span> <span class="n">oldSubTable</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span>
	<span class="k">if</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">PairSet</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="s1">&#39;ValueFormat1&#39;</span><span class="p">,</span> <span class="s1">&#39;ValueFormat2&#39;</span><span class="p">:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">newSubTable</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

		<span class="c1"># Move top half of coverage to new subtable</span>

		<span class="n">newSubTable</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>

		<span class="n">coverage</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span>
		<span class="n">records</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">PairSet</span>

		<span class="n">oldCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">PairSet</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">coverage</span><span class="p">[:</span><span class="n">oldCount</span><span class="p">]</span>
		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">PairSet</span> <span class="o">=</span> <span class="n">records</span><span class="p">[:</span><span class="n">oldCount</span><span class="p">]</span>

		<span class="n">newSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">coverage</span><span class="p">[</span><span class="n">oldCount</span><span class="p">:]</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">PairSet</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="n">oldCount</span><span class="p">:]</span>

		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">PairSetCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">PairSet</span><span class="p">)</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">PairSetCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newSubTable</span><span class="o">.</span><span class="n">PairSet</span><span class="p">)</span>

		<span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

	<span class="k">elif</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="s1">&#39;Class2Count&#39;</span><span class="p">):</span>
			<span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class2Count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Class2Record</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="s1">&#39;Class2Count&#39;</span><span class="p">,</span> <span class="s1">&#39;ClassDef2&#39;</span><span class="p">,</span> <span class="s1">&#39;ValueFormat1&#39;</span><span class="p">,</span> <span class="s1">&#39;ValueFormat2&#39;</span><span class="p">:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">newSubTable</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

		<span class="c1"># The two subtables will still have the same ClassDef2 and the table</span>
		<span class="c1"># sharing will still cause the sharing to overflow.  As such, disable</span>
		<span class="c1"># sharing on the one that is serialized second (that&#39;s oldSubTable).</span>
		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">DontShare</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="c1"># Move top half of class numbers to new subtable</span>

		<span class="n">newSubTable</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">ClassDef1</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">ClassDef1</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>

		<span class="n">coverage</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span>
		<span class="n">classDefs</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">ClassDef1</span><span class="o">.</span><span class="n">classDefs</span>
		<span class="n">records</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Record</span>

		<span class="n">oldCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
		<span class="n">newGlyphs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">oldCount</span><span class="p">)</span>

		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">coverage</span> <span class="k">if</span> <span class="n">g</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newGlyphs</span><span class="p">]</span>
		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">ClassDef1</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">oldCount</span><span class="p">}</span>
		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Record</span> <span class="o">=</span> <span class="n">records</span><span class="p">[:</span><span class="n">oldCount</span><span class="p">]</span>

		<span class="n">newSubTable</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">coverage</span> <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">newGlyphs</span><span class="p">]</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">ClassDef1</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:(</span><span class="n">v</span><span class="o">-</span><span class="n">oldCount</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">oldCount</span><span class="p">}</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">Class1Record</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="n">oldCount</span><span class="p">:]</span>

		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldSubTable</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">)</span>
		<span class="n">newSubTable</span><span class="o">.</span><span class="n">Class1Count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newSubTable</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">)</span>

		<span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

	<span class="k">return</span> <span class="n">ok</span></div>


<div class="viewcode-block" id="splitMarkBasePos"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.splitMarkBasePos">[docs]</a><span class="k">def</span> <span class="nf">splitMarkBasePos</span><span class="p">(</span><span class="n">oldSubTable</span><span class="p">,</span> <span class="n">newSubTable</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="c1"># split half of the mark classes to the new subtable</span>
	<span class="n">classCount</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">ClassCount</span>
	<span class="k">if</span> <span class="n">classCount</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
		<span class="c1"># oh well, not much left to split...</span>
		<span class="k">return</span> <span class="kc">False</span>

	<span class="n">oldClassCount</span> <span class="o">=</span> <span class="n">classCount</span> <span class="o">//</span> <span class="mi">2</span>
	<span class="n">newClassCount</span> <span class="o">=</span> <span class="n">classCount</span> <span class="o">-</span> <span class="n">oldClassCount</span>

	<span class="n">oldMarkCoverage</span><span class="p">,</span> <span class="n">oldMarkRecords</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="n">newMarkCoverage</span><span class="p">,</span> <span class="n">newMarkRecords</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">markRecord</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
		<span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkArray</span><span class="o">.</span><span class="n">MarkRecord</span>
	<span class="p">):</span>
		<span class="k">if</span> <span class="n">markRecord</span><span class="o">.</span><span class="n">Class</span> <span class="o">&lt;</span> <span class="n">oldClassCount</span><span class="p">:</span>
			<span class="n">oldMarkCoverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>
			<span class="n">oldMarkRecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">markRecord</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">markRecord</span><span class="o">.</span><span class="n">Class</span> <span class="o">-=</span> <span class="n">oldClassCount</span>
			<span class="n">newMarkCoverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>
			<span class="n">newMarkRecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">markRecord</span><span class="p">)</span>

	<span class="n">oldBaseRecords</span><span class="p">,</span> <span class="n">newBaseRecords</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">BaseArray</span><span class="o">.</span><span class="n">BaseRecord</span><span class="p">:</span>
		<span class="n">oldBaseRecord</span><span class="p">,</span> <span class="n">newBaseRecord</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(),</span> <span class="n">rec</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
		<span class="n">oldBaseRecord</span><span class="o">.</span><span class="n">BaseAnchor</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">BaseAnchor</span><span class="p">[:</span><span class="n">oldClassCount</span><span class="p">]</span>
		<span class="n">newBaseRecord</span><span class="o">.</span><span class="n">BaseAnchor</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">BaseAnchor</span><span class="p">[</span><span class="n">oldClassCount</span><span class="p">:]</span>
		<span class="n">oldBaseRecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oldBaseRecord</span><span class="p">)</span>
		<span class="n">newBaseRecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newBaseRecord</span><span class="p">)</span>

	<span class="n">newSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">Format</span>

	<span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">oldMarkCoverage</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="o">.</span><span class="n">Format</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="n">newMarkCoverage</span>

	<span class="c1"># share the same BaseCoverage in both halves</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">BaseCoverage</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">BaseCoverage</span>

	<span class="n">oldSubTable</span><span class="o">.</span><span class="n">ClassCount</span> <span class="o">=</span> <span class="n">oldClassCount</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">ClassCount</span> <span class="o">=</span> <span class="n">newClassCount</span>

	<span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkArray</span><span class="o">.</span><span class="n">MarkRecord</span> <span class="o">=</span> <span class="n">oldMarkRecords</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">MarkArray</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkArray</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">MarkArray</span><span class="o">.</span><span class="n">MarkRecord</span> <span class="o">=</span> <span class="n">newMarkRecords</span>

	<span class="n">oldSubTable</span><span class="o">.</span><span class="n">MarkArray</span><span class="o">.</span><span class="n">MarkCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldMarkRecords</span><span class="p">)</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">MarkArray</span><span class="o">.</span><span class="n">MarkCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newMarkRecords</span><span class="p">)</span>

	<span class="n">oldSubTable</span><span class="o">.</span><span class="n">BaseArray</span><span class="o">.</span><span class="n">BaseRecord</span> <span class="o">=</span> <span class="n">oldBaseRecords</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">BaseArray</span> <span class="o">=</span> <span class="n">oldSubTable</span><span class="o">.</span><span class="n">BaseArray</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">BaseArray</span><span class="o">.</span><span class="n">BaseRecord</span> <span class="o">=</span> <span class="n">newBaseRecords</span>

	<span class="n">oldSubTable</span><span class="o">.</span><span class="n">BaseArray</span><span class="o">.</span><span class="n">BaseCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldBaseRecords</span><span class="p">)</span>
	<span class="n">newSubTable</span><span class="o">.</span><span class="n">BaseArray</span><span class="o">.</span><span class="n">BaseCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newBaseRecords</span><span class="p">)</span>

	<span class="k">return</span> <span class="kc">True</span></div>


<span class="n">splitTable</span> <span class="o">=</span> <span class="p">{</span>	<span class="s1">&#39;GSUB&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="c1">#					1: splitSingleSubst,</span>
					<span class="mi">2</span><span class="p">:</span> <span class="n">splitMultipleSubst</span><span class="p">,</span>
					<span class="mi">3</span><span class="p">:</span> <span class="n">splitAlternateSubst</span><span class="p">,</span>
					<span class="mi">4</span><span class="p">:</span> <span class="n">splitLigatureSubst</span><span class="p">,</span>
<span class="c1">#					5: splitContextSubst,</span>
<span class="c1">#					6: splitChainContextSubst,</span>
<span class="c1">#					7: splitExtensionSubst,</span>
<span class="c1">#					8: splitReverseChainSingleSubst,</span>
					<span class="p">},</span>
				<span class="s1">&#39;GPOS&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="c1">#					1: splitSinglePos,</span>
					<span class="mi">2</span><span class="p">:</span> <span class="n">splitPairPos</span><span class="p">,</span>
<span class="c1">#					3: splitCursivePos,</span>
					<span class="mi">4</span><span class="p">:</span> <span class="n">splitMarkBasePos</span><span class="p">,</span>
<span class="c1">#					5: splitMarkLigPos,</span>
<span class="c1">#					6: splitMarkMarkPos,</span>
<span class="c1">#					7: splitContextPos,</span>
<span class="c1">#					8: splitChainContextPos,</span>
<span class="c1">#					9: splitExtensionPos,</span>
					<span class="p">}</span>

			<span class="p">}</span>

<div class="viewcode-block" id="fixSubTableOverFlows"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.mtiLib.fixSubTableOverFlows">[docs]</a><span class="k">def</span> <span class="nf">fixSubTableOverFlows</span><span class="p">(</span><span class="n">ttf</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	An offset has overflowed within a sub-table. We need to divide this subtable into smaller parts.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">table</span> <span class="o">=</span> <span class="n">ttf</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">]</span><span class="o">.</span><span class="n">table</span>
	<span class="n">lookup</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">LookupListIndex</span><span class="p">]</span>
	<span class="n">subIndex</span> <span class="o">=</span> <span class="n">overflowRecord</span><span class="o">.</span><span class="n">SubTableIndex</span>
	<span class="n">subtable</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="p">[</span><span class="n">subIndex</span><span class="p">]</span>

	<span class="c1"># First, try not sharing anything for this subtable...</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subtable</span><span class="p">,</span> <span class="s2">&quot;DontShare&quot;</span><span class="p">):</span>
		<span class="n">subtable</span><span class="o">.</span><span class="n">DontShare</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="kc">True</span>

	<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subtable</span><span class="p">,</span> <span class="s1">&#39;ExtSubTable&#39;</span><span class="p">):</span>
		<span class="c1"># We split the subtable of the Extension table, and add a new Extension table</span>
		<span class="c1"># to contain the new subtable.</span>

		<span class="n">subTableType</span> <span class="o">=</span> <span class="n">subtable</span><span class="o">.</span><span class="n">ExtSubTable</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">LookupType</span>
		<span class="n">extSubTable</span> <span class="o">=</span> <span class="n">subtable</span>
		<span class="n">subtable</span> <span class="o">=</span> <span class="n">extSubTable</span><span class="o">.</span><span class="n">ExtSubTable</span>
		<span class="n">newExtSubTableClass</span> <span class="o">=</span> <span class="n">lookupTypes</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">][</span><span class="n">extSubTable</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">LookupType</span><span class="p">]</span>
		<span class="n">newExtSubTable</span> <span class="o">=</span> <span class="n">newExtSubTableClass</span><span class="p">()</span>
		<span class="n">newExtSubTable</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="n">extSubTable</span><span class="o">.</span><span class="n">Format</span>
		<span class="n">toInsert</span> <span class="o">=</span> <span class="n">newExtSubTable</span>

		<span class="n">newSubTableClass</span> <span class="o">=</span> <span class="n">lookupTypes</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">][</span><span class="n">subTableType</span><span class="p">]</span>
		<span class="n">newSubTable</span> <span class="o">=</span> <span class="n">newSubTableClass</span><span class="p">()</span>
		<span class="n">newExtSubTable</span><span class="o">.</span><span class="n">ExtSubTable</span> <span class="o">=</span> <span class="n">newSubTable</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">subTableType</span> <span class="o">=</span> <span class="n">subtable</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">LookupType</span>
		<span class="n">newSubTableClass</span> <span class="o">=</span> <span class="n">lookupTypes</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">][</span><span class="n">subTableType</span><span class="p">]</span>
		<span class="n">newSubTable</span> <span class="o">=</span> <span class="n">newSubTableClass</span><span class="p">()</span>
		<span class="n">toInsert</span> <span class="o">=</span> <span class="n">newSubTable</span>

	<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookup</span><span class="p">,</span> <span class="s1">&#39;SubTableCount&#39;</span><span class="p">):</span> <span class="c1"># may not be defined yet.</span>
		<span class="n">lookup</span><span class="o">.</span><span class="n">SubTableCount</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">SubTableCount</span> <span class="o">+</span> <span class="mi">1</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">splitFunc</span> <span class="o">=</span> <span class="n">splitTable</span><span class="p">[</span><span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">][</span><span class="n">subTableType</span><span class="p">]</span>
	<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
		<span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
			<span class="s2">&quot;Don&#39;t know how to split </span><span class="si">%s</span><span class="s2"> lookup type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
			<span class="n">overflowRecord</span><span class="o">.</span><span class="n">tableType</span><span class="p">,</span>
			<span class="n">subTableType</span><span class="p">,</span>
		<span class="p">)</span>
		<span class="k">return</span> <span class="kc">False</span>

	<span class="n">ok</span> <span class="o">=</span> <span class="n">splitFunc</span><span class="p">(</span><span class="n">subtable</span><span class="p">,</span> <span class="n">newSubTable</span><span class="p">,</span> <span class="n">overflowRecord</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
		<span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">subIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">toInsert</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">ok</span></div>

<span class="c1"># End of OverFlow logic</span>


<span class="k">def</span> <span class="nf">_buildClasses</span><span class="p">():</span>
	<span class="kn">import</span> <span class="nn">re</span>
	<span class="kn">from</span> <span class="nn">.otData</span> <span class="k">import</span> <span class="n">otData</span>

	<span class="n">formatPat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Za-z0-9]+)Format(\d+)$&quot;</span><span class="p">)</span>
	<span class="n">namespace</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>

	<span class="c1"># populate module with classes</span>
	<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">otData</span><span class="p">:</span>
		<span class="n">baseClass</span> <span class="o">=</span> <span class="n">BaseTable</span>
		<span class="n">m</span> <span class="o">=</span> <span class="n">formatPat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">m</span><span class="p">:</span>
			<span class="c1"># XxxFormatN subtable, we only add the &quot;base&quot; table</span>
			<span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">baseClass</span> <span class="o">=</span> <span class="n">FormatSwitchingBaseTable</span>
		<span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">namespace</span><span class="p">:</span>
			<span class="c1"># the class doesn&#39;t exist yet, so the base implementation is used.</span>
			<span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">baseClass</span><span class="p">,),</span> <span class="p">{})</span>
			<span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">):</span>
				<span class="bp">cls</span><span class="o">.</span><span class="n">DontShare</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">namespace</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>

	<span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">alts</span> <span class="ow">in</span> <span class="n">_equivalents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">base</span> <span class="o">=</span> <span class="n">namespace</span><span class="p">[</span><span class="n">base</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">alts</span><span class="p">:</span>
			<span class="n">namespace</span><span class="p">[</span><span class="n">alt</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span>

	<span class="k">global</span> <span class="n">lookupTypes</span>
	<span class="n">lookupTypes</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;GSUB&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="mi">1</span><span class="p">:</span> <span class="n">SingleSubst</span><span class="p">,</span>
			<span class="mi">2</span><span class="p">:</span> <span class="n">MultipleSubst</span><span class="p">,</span>
			<span class="mi">3</span><span class="p">:</span> <span class="n">AlternateSubst</span><span class="p">,</span>
			<span class="mi">4</span><span class="p">:</span> <span class="n">LigatureSubst</span><span class="p">,</span>
			<span class="mi">5</span><span class="p">:</span> <span class="n">ContextSubst</span><span class="p">,</span>
			<span class="mi">6</span><span class="p">:</span> <span class="n">ChainContextSubst</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">:</span> <span class="n">ExtensionSubst</span><span class="p">,</span>
			<span class="mi">8</span><span class="p">:</span> <span class="n">ReverseChainSingleSubst</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="s1">&#39;GPOS&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="mi">1</span><span class="p">:</span> <span class="n">SinglePos</span><span class="p">,</span>
			<span class="mi">2</span><span class="p">:</span> <span class="n">PairPos</span><span class="p">,</span>
			<span class="mi">3</span><span class="p">:</span> <span class="n">CursivePos</span><span class="p">,</span>
			<span class="mi">4</span><span class="p">:</span> <span class="n">MarkBasePos</span><span class="p">,</span>
			<span class="mi">5</span><span class="p">:</span> <span class="n">MarkLigPos</span><span class="p">,</span>
			<span class="mi">6</span><span class="p">:</span> <span class="n">MarkMarkPos</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">:</span> <span class="n">ContextPos</span><span class="p">,</span>
			<span class="mi">8</span><span class="p">:</span> <span class="n">ChainContextPos</span><span class="p">,</span>
			<span class="mi">9</span><span class="p">:</span> <span class="n">ExtensionPos</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="s1">&#39;mort&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="mi">4</span><span class="p">:</span> <span class="n">NoncontextualMorph</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="s1">&#39;morx&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="mi">0</span><span class="p">:</span> <span class="n">RearrangementMorph</span><span class="p">,</span>
			<span class="mi">1</span><span class="p">:</span> <span class="n">ContextualMorph</span><span class="p">,</span>
			<span class="mi">2</span><span class="p">:</span> <span class="n">LigatureMorph</span><span class="p">,</span>
			<span class="c1"># 3: Reserved,</span>
			<span class="mi">4</span><span class="p">:</span> <span class="n">NoncontextualMorph</span><span class="p">,</span>
			<span class="mi">5</span><span class="p">:</span> <span class="n">InsertionMorph</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>
	<span class="n">lookupTypes</span><span class="p">[</span><span class="s1">&#39;JSTF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookupTypes</span><span class="p">[</span><span class="s1">&#39;GPOS&#39;</span><span class="p">]</span>  <span class="c1"># JSTF contains GPOS</span>
	<span class="k">for</span> <span class="n">lookupEnum</span> <span class="ow">in</span> <span class="n">lookupTypes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
		<span class="k">for</span> <span class="n">enum</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">lookupEnum</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">LookupType</span> <span class="o">=</span> <span class="n">enum</span>

	<span class="k">global</span> <span class="n">featureParamTypes</span>
	<span class="n">featureParamTypes</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">FeatureParamsSize</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">featureParamTypes</span><span class="p">[</span><span class="s1">&#39;ss</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeatureParamsStylisticSet</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">featureParamTypes</span><span class="p">[</span><span class="s1">&#39;cv</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeatureParamsCharacterVariants</span>

	<span class="c1"># add converters to classes</span>
	<span class="kn">from</span> <span class="nn">.otConverters</span> <span class="k">import</span> <span class="n">buildConverters</span>
	<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">otData</span><span class="p">:</span>
		<span class="n">m</span> <span class="o">=</span> <span class="n">formatPat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">m</span><span class="p">:</span>
			<span class="c1"># XxxFormatN subtable, add converter to &quot;base&quot; table</span>
			<span class="n">name</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
			<span class="nb">format</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
			<span class="bp">cls</span> <span class="o">=</span> <span class="n">namespace</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;converters&quot;</span><span class="p">):</span>
				<span class="bp">cls</span><span class="o">.</span><span class="n">converters</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="bp">cls</span><span class="o">.</span><span class="n">convertersByName</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">converters</span><span class="p">,</span> <span class="n">convertersByName</span> <span class="o">=</span> <span class="n">buildConverters</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">namespace</span><span class="p">)</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">converters</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">converters</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">convertersByName</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">convertersByName</span>
			<span class="c1"># XXX Add staticSize?</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">cls</span> <span class="o">=</span> <span class="n">namespace</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">converters</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">convertersByName</span> <span class="o">=</span> <span class="n">buildConverters</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
			<span class="c1"># XXX Add staticSize?</span>


<span class="n">_buildClasses</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_getGlyphsFromCoverageTable</span><span class="p">(</span><span class="n">coverage</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">coverage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="c1"># empty coverage table</span>
		<span class="k">return</span> <span class="p">[]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">coverage</span><span class="o">.</span><span class="n">glyphs</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>