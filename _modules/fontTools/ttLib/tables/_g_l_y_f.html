

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.ttLib.tables._g_l_y_f &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ttLib.html">fontTools.ttLib</a> &raquo;</li>
        
      <li>fontTools.ttLib.tables._g_l_y_f</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.ttLib.tables._g_l_y_f</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;_g_l_y_f.py -- Converter classes for the &#39;glyf&#39; table.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">sstruct</span>
<span class="kn">from</span> <span class="nn">fontTools</span> <span class="k">import</span> <span class="n">ttLib</span>
<span class="kn">from</span> <span class="nn">fontTools</span> <span class="k">import</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.textTools</span> <span class="k">import</span> <span class="n">safeEval</span><span class="p">,</span> <span class="n">pad</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.arrayTools</span> <span class="k">import</span> <span class="n">calcBounds</span><span class="p">,</span> <span class="n">calcIntBounds</span><span class="p">,</span> <span class="n">pointInRect</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.bezierTools</span> <span class="k">import</span> <span class="n">calcQuadraticBounds</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.fixedTools</span> <span class="k">import</span> <span class="p">(</span>
	<span class="n">fixedToFloat</span> <span class="k">as</span> <span class="n">fi2fl</span><span class="p">,</span>
	<span class="n">floatToFixed</span> <span class="k">as</span> <span class="n">fl2fi</span><span class="p">,</span>
	<span class="n">floatToFixedToStr</span> <span class="k">as</span> <span class="n">fl2str</span><span class="p">,</span>
	<span class="n">strToFixedToFloat</span> <span class="k">as</span> <span class="n">str2fl</span><span class="p">,</span>
	<span class="n">otRound</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="k">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">DefaultTable</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">ttProgram</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">xmlWriter</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.filenames</span> <span class="k">import</span> <span class="n">userNameToFileName</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># We compute the version the same as is computed in ttlib/__init__</span>
<span class="c1"># so that we can write &#39;ttLibVersion&#39; attribute of the glyf TTX files</span>
<span class="c1"># when glyf is written to separate files.</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>

<span class="c1">#</span>
<span class="c1"># The Apple and MS rasterizers behave differently for</span>
<span class="c1"># scaled composite components: one does scale first and then translate</span>
<span class="c1"># and the other does it vice versa. MS defined some flags to indicate</span>
<span class="c1"># the difference, but it seems nobody actually _sets_ those flags.</span>
<span class="c1">#</span>
<span class="c1"># Funny thing: Apple seems to _only_ do their thing in the</span>
<span class="c1"># WE_HAVE_A_SCALE (eg. Chicago) case, and not when it&#39;s WE_HAVE_AN_X_AND_Y_SCALE</span>
<span class="c1"># (eg. Charcoal)...</span>
<span class="c1">#</span>
<span class="n">SCALE_COMPONENT_OFFSET_DEFAULT</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># 0 == MS, 1 == Apple</span>


<div class="viewcode-block" id="table__g_l_y_f"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f">[docs]</a><span class="k">class</span> <span class="nc">table__g_l_y_f</span><span class="p">(</span><span class="n">DefaultTable</span><span class="o">.</span><span class="n">DefaultTable</span><span class="p">):</span>

	<span class="c1"># this attribute controls the amount of padding applied to glyph data upon compile.</span>
	<span class="c1"># Glyph lenghts are aligned to multiples of the specified value. </span>
	<span class="c1"># Allowed values are (0, 1, 2, 4). &#39;0&#39; means no padding; &#39;1&#39; (default) also means</span>
	<span class="c1"># no padding, except for when padding would allow to use short loca offsets.</span>
	<span class="n">padding</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="table__g_l_y_f.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">loca</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="s1">&#39;loca&#39;</span><span class="p">]</span>
		<span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">loca</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">nextPos</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">noname</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loca</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">glyphName</span> <span class="o">=</span> <span class="n">glyphOrder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
				<span class="n">noname</span> <span class="o">=</span> <span class="n">noname</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">glyphName</span> <span class="o">=</span> <span class="s1">&#39;ttxautoglyph</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span>
			<span class="n">nextPos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">loca</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">glyphdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">nextPos</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphdata</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">nextPos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">TTLibError</span><span class="p">(</span><span class="s2">&quot;not enough &#39;glyf&#39; table data&quot;</span><span class="p">)</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">Glyph</span><span class="p">(</span><span class="n">glyphdata</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">glyph</span>
			<span class="n">pos</span> <span class="o">=</span> <span class="n">nextPos</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">nextPos</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
				<span class="s2">&quot;too much &#39;glyf&#39; table data: expected </span><span class="si">%d</span><span class="s2">, received </span><span class="si">%d</span><span class="s2"> bytes&quot;</span><span class="p">,</span>
				<span class="n">nextPos</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">noname</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> glyphs have no name&#39;</span><span class="p">,</span> <span class="n">noname</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">lazy</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># Be lazy for None and True</span>
			<span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
				<span class="n">glyph</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="table__g_l_y_f.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;glyphOrder&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
		<span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span>
		<span class="k">assert</span> <span class="n">padding</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">currentLocation</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">recalcBBoxes</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">recalcBBoxes</span>
		<span class="k">for</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="p">:</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
			<span class="n">glyphData</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recalcBBoxes</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">padding</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">glyphData</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">glyphData</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
			<span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentLocation</span><span class="p">)</span>
			<span class="n">currentLocation</span> <span class="o">=</span> <span class="n">currentLocation</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphData</span><span class="p">)</span>
			<span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphData</span><span class="p">)</span>
		<span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentLocation</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">padding</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">currentLocation</span> <span class="o">&lt;</span> <span class="mh">0x20000</span><span class="p">:</span>
			<span class="c1"># See if we can pad any odd-lengthed glyphs to allow loca</span>
			<span class="c1"># table to use the short offsets.</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">glyphData</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphData</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">indices</span> <span class="ow">and</span> <span class="n">currentLocation</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mh">0x20000</span><span class="p">:</span>
				<span class="c1"># It fits.  Do it.</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
					<span class="n">dataList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span>
				<span class="n">currentLocation</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">glyphData</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataList</span><span class="p">):</span>
					<span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentLocation</span>
					<span class="n">currentLocation</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphData</span><span class="p">)</span>
				<span class="n">locations</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dataList</span><span class="p">)]</span> <span class="o">=</span> <span class="n">currentLocation</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;loca&#39;</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="p">:</span>
			<span class="n">ttFont</span><span class="p">[</span><span class="s1">&#39;loca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;maxp&#39;</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="p">:</span>
			<span class="n">ttFont</span><span class="p">[</span><span class="s1">&#39;maxp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">numGlyphs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
		<span class="c1"># As a special case when all glyph in the font are empty, add a zero byte</span>
		<span class="c1"># to the table, so that OTS doesn’t reject it, and to make the table work</span>
		<span class="c1"># on Windows as well.</span>
		<span class="c1"># See https://github.com/khaledhosny/ots/issues/52</span>
			<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="table__g_l_y_f.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">,</span> <span class="n">splitGlyphs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="n">notice</span> <span class="o">=</span> <span class="p">(</span>
			<span class="s2">&quot;The xMin, yMin, xMax and yMax values</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="s2">&quot;will be recalculated by the compiler.&quot;</span><span class="p">)</span>
		<span class="n">glyphNames</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphNames</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">splitGlyphs</span><span class="p">:</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">notice</span><span class="p">)</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="n">numGlyphs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyphNames</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">splitGlyphs</span><span class="p">:</span>
			<span class="n">path</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
			<span class="n">existingGlyphFiles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="n">glyphNames</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">glyphName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
				<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;glyph &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist in glyf table&quot;</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">)</span>
				<span class="k">continue</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">glyph</span><span class="o">.</span><span class="n">numberOfContours</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">splitGlyphs</span><span class="p">:</span>
					<span class="n">glyphPath</span> <span class="o">=</span> <span class="n">userNameToFileName</span><span class="p">(</span>
						<span class="n">tounicode</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
						<span class="n">existingGlyphFiles</span><span class="p">,</span>
						<span class="n">prefix</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
						<span class="n">suffix</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
					<span class="n">existingGlyphFiles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">glyphPath</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
					<span class="n">glyphWriter</span> <span class="o">=</span> <span class="n">xmlWriter</span><span class="o">.</span><span class="n">XMLWriter</span><span class="p">(</span>
						<span class="n">glyphPath</span><span class="p">,</span> <span class="n">idlefunc</span><span class="o">=</span><span class="n">writer</span><span class="o">.</span><span class="n">idlefunc</span><span class="p">,</span>
						<span class="n">newlinestr</span><span class="o">=</span><span class="n">writer</span><span class="o">.</span><span class="n">newlinestr</span><span class="p">)</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s2">&quot;ttFont&quot;</span><span class="p">,</span> <span class="n">ttLibVersion</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s2">&quot;glyf&quot;</span><span class="p">)</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">notice</span><span class="p">)</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
					<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;TTGlyph&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">glyphPath</span><span class="p">))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">glyphWriter</span> <span class="o">=</span> <span class="n">writer</span>
				<span class="n">glyphWriter</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s1">&#39;TTGlyph&#39;</span><span class="p">,</span> <span class="p">[</span>
							<span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">),</span>
							<span class="p">(</span><span class="s2">&quot;xMin&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">.</span><span class="n">xMin</span><span class="p">),</span>
							<span class="p">(</span><span class="s2">&quot;yMin&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">.</span><span class="n">yMin</span><span class="p">),</span>
							<span class="p">(</span><span class="s2">&quot;xMax&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">.</span><span class="n">xMax</span><span class="p">),</span>
							<span class="p">(</span><span class="s2">&quot;yMax&quot;</span><span class="p">,</span> <span class="n">glyph</span><span class="o">.</span><span class="n">yMax</span><span class="p">),</span>
							<span class="p">])</span>
				<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
				<span class="n">glyph</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">glyphWriter</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
				<span class="n">glyphWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s1">&#39;TTGlyph&#39;</span><span class="p">)</span>
				<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">splitGlyphs</span><span class="p">:</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s2">&quot;glyf&quot;</span><span class="p">)</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s2">&quot;ttFont&quot;</span><span class="p">)</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
					<span class="n">glyphWriter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s1">&#39;TTGlyph&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">glyphName</span><span class="p">)</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="s2">&quot;contains no outline data&quot;</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">splitGlyphs</span><span class="p">:</span>
					<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="table__g_l_y_f.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;TTGlyph&quot;</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;glyphs&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;glyphOrder&quot;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">getGlyphOrder</span><span class="p">()</span>
		<span class="n">glyphName</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
		<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;unpacking glyph &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">)</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="n">Glyph</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xMin&#39;</span><span class="p">,</span> <span class="s1">&#39;yMin&#39;</span><span class="p">,</span> <span class="s1">&#39;xMax&#39;</span><span class="p">,</span> <span class="s1">&#39;yMax&#39;</span><span class="p">]:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">glyph</span>
		<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
			<span class="n">glyph</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">ttFont</span><span class="o">.</span><span class="n">recalcBBoxes</span><span class="p">:</span>
			<span class="n">glyph</span><span class="o">.</span><span class="n">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="table__g_l_y_f.setGlyphOrder"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.setGlyphOrder">[docs]</a>	<span class="k">def</span> <span class="nf">setGlyphOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphOrder</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span> <span class="o">=</span> <span class="n">glyphOrder</span></div>

<div class="viewcode-block" id="table__g_l_y_f.getGlyphName"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.getGlyphName">[docs]</a>	<span class="k">def</span> <span class="nf">getGlyphName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphID</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="p">[</span><span class="n">glyphID</span><span class="p">]</span></div>

<div class="viewcode-block" id="table__g_l_y_f.getGlyphID"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.getGlyphID">[docs]</a>	<span class="k">def</span> <span class="nf">getGlyphID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">):</span>
		<span class="c1"># XXX optimize with reverse dict!!!</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span></div>

<div class="viewcode-block" id="table__g_l_y_f.removeHinting"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.removeHinting">[docs]</a>	<span class="k">def</span> <span class="nf">removeHinting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
			<span class="n">glyph</span><span class="o">.</span><span class="n">removeHinting</span><span class="p">()</span></div>

<div class="viewcode-block" id="table__g_l_y_f.keys"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.keys">[docs]</a>	<span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="table__g_l_y_f.has_key"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.has_key">[docs]</a>	<span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span></div>

	<span class="fm">__contains__</span> <span class="o">=</span> <span class="n">has_key</span>

	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">):</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="n">glyph</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">glyph</span>

	<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">glyph</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">glyph</span>
		<span class="k">if</span> <span class="n">glyphName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">):</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glyphOrder</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)</span>

<div class="viewcode-block" id="table__g_l_y_f.getPhantomPoints"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.getPhantomPoints">[docs]</a>	<span class="k">def</span> <span class="nf">getPhantomPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">,</span> <span class="n">defaultVerticalOrigin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Compute the four &quot;phantom points&quot; for the given glyph from its bounding box</span>
<span class="sd">		and the horizontal and vertical advance widths and sidebearings stored in the</span>
<span class="sd">		ttFont&#39;s &quot;hmtx&quot; and &quot;vmtx&quot; tables.</span>

<span class="sd">		If the ttFont doesn&#39;t contain a &quot;vmtx&quot; table, the hhea.ascent is used as the</span>
<span class="sd">		vertical origin, and the head.unitsPerEm as the vertical advance.</span>

<span class="sd">		The &quot;defaultVerticalOrigin&quot; (Optional[int]) is needed when the ttFont contains</span>
<span class="sd">		neither a &quot;vmtx&quot; nor an &quot;hhea&quot; table, as may happen with &#39;sparse&#39; masters.</span>
<span class="sd">		The value should be the hhea.ascent of the default master.</span>

<span class="sd">		https://docs.microsoft.com/en-us/typography/opentype/spec/tt_instructing_glyphs#phantoms</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="k">assert</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;hmtx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;hmtx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span>
		<span class="n">horizontalAdvanceWidth</span><span class="p">,</span> <span class="n">leftSideBearing</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;hmtx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="s1">&#39;xMin&#39;</span><span class="p">):</span>
			<span class="n">glyph</span><span class="o">.</span><span class="n">recalcBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
		<span class="n">leftSideX</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">xMin</span> <span class="o">-</span> <span class="n">leftSideBearing</span>
		<span class="n">rightSideX</span> <span class="o">=</span> <span class="n">leftSideX</span> <span class="o">+</span> <span class="n">horizontalAdvanceWidth</span>
		<span class="k">if</span> <span class="s2">&quot;vmtx&quot;</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="p">:</span>
			<span class="n">verticalAdvanceWidth</span><span class="p">,</span> <span class="n">topSideBearing</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;vmtx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
			<span class="n">topSideY</span> <span class="o">=</span> <span class="n">topSideBearing</span> <span class="o">+</span> <span class="n">glyph</span><span class="o">.</span><span class="n">yMax</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># without vmtx, use ascent as vertical origin and UPEM as vertical advance</span>
			<span class="c1"># like HarfBuzz does</span>
			<span class="n">verticalAdvanceWidth</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unitsPerEm</span>
			<span class="k">if</span> <span class="s2">&quot;hhea&quot;</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="p">:</span>
				<span class="n">topSideY</span> <span class="o">=</span> <span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;hhea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ascent</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># sparse masters may not contain an hhea table; use the ascent</span>
				<span class="c1"># of the default master as the vertical origin</span>
				<span class="k">if</span> <span class="n">defaultVerticalOrigin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">topSideY</span> <span class="o">=</span> <span class="n">defaultVerticalOrigin</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
						<span class="s2">&quot;font is missing both &#39;vmtx&#39; and &#39;hhea&#39; tables, &quot;</span>
						<span class="s2">&quot;and no &#39;defaultVerticalOrigin&#39; was provided; &quot;</span>
						<span class="s2">&quot;the vertical phantom points may be incorrect.&quot;</span>
					<span class="p">)</span>
					<span class="n">topSideY</span> <span class="o">=</span> <span class="n">verticalAdvanceWidth</span>
		<span class="n">bottomSideY</span> <span class="o">=</span> <span class="n">topSideY</span> <span class="o">-</span> <span class="n">verticalAdvanceWidth</span>
		<span class="k">return</span> <span class="p">[</span>
			<span class="p">(</span><span class="n">leftSideX</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="p">(</span><span class="n">rightSideX</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">topSideY</span><span class="p">),</span>
			<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottomSideY</span><span class="p">),</span>
		<span class="p">]</span></div>

<div class="viewcode-block" id="table__g_l_y_f.getCoordinatesAndControls"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.getCoordinatesAndControls">[docs]</a>	<span class="k">def</span> <span class="nf">getCoordinatesAndControls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">,</span> <span class="n">defaultVerticalOrigin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return glyph coordinates and controls as expected by &quot;gvar&quot; table.</span>

<span class="sd">		The coordinates includes four &quot;phantom points&quot; for the glyph metrics,</span>
<span class="sd">		as mandated by the &quot;gvar&quot; spec.</span>

<span class="sd">		The glyph controls is a namedtuple with the following attributes:</span>
<span class="sd">			- numberOfContours: -1 for composite glyphs.</span>
<span class="sd">			- endPts: list of indices of end points for each contour in simple</span>
<span class="sd">			glyphs, or component indices in composite glyphs (used for IUP</span>
<span class="sd">			optimization).</span>
<span class="sd">			- flags: array of contour point flags for simple glyphs (None for</span>
<span class="sd">			composite glyphs).</span>
<span class="sd">			- components: list of base glyph names (str) for each component in</span>
<span class="sd">			composite glyphs (None for simple glyphs).</span>

<span class="sd">		The &quot;ttFont&quot; and &quot;defaultVerticalOrigin&quot; args are used to compute the</span>
<span class="sd">		&quot;phantom points&quot; (see &quot;getPhantomPoints&quot; method).</span>

<span class="sd">		Return None if the requested glyphName is not present.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">glyphName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">glyph</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="n">coords</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="p">(</span>
				<span class="p">[(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">glyph</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
			<span class="p">)</span>
			<span class="n">controls</span> <span class="o">=</span> <span class="n">_GlyphControls</span><span class="p">(</span>
				<span class="n">numberOfContours</span><span class="o">=</span><span class="n">glyph</span><span class="o">.</span><span class="n">numberOfContours</span><span class="p">,</span>
				<span class="n">endPts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">glyph</span><span class="o">.</span><span class="n">components</span><span class="p">))),</span>
				<span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
				<span class="n">components</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">glyphName</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">glyph</span><span class="o">.</span><span class="n">components</span><span class="p">],</span>
			<span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">coords</span><span class="p">,</span> <span class="n">endPts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
			<span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="n">controls</span> <span class="o">=</span> <span class="n">_GlyphControls</span><span class="p">(</span>
				<span class="n">numberOfContours</span><span class="o">=</span><span class="n">glyph</span><span class="o">.</span><span class="n">numberOfContours</span><span class="p">,</span>
				<span class="n">endPts</span><span class="o">=</span><span class="n">endPts</span><span class="p">,</span>
				<span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
				<span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
			<span class="p">)</span>
		<span class="c1"># Add phantom points for (left, right, top, bottom) positions.</span>
		<span class="n">phantomPoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhantomPoints</span><span class="p">(</span>
			<span class="n">glyphName</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">,</span> <span class="n">defaultVerticalOrigin</span><span class="o">=</span><span class="n">defaultVerticalOrigin</span>
		<span class="p">)</span>
		<span class="n">coords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">phantomPoints</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">controls</span></div>

<div class="viewcode-block" id="table__g_l_y_f.setCoordinates"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.table__g_l_y_f.setCoordinates">[docs]</a>	<span class="k">def</span> <span class="nf">setCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Set coordinates and metrics for the given glyph.</span>

<span class="sd">		&quot;coord&quot; is an array of GlyphCoordinates which must include the &quot;phantom</span>
<span class="sd">		points&quot; as the last four coordinates.</span>

<span class="sd">		Both the horizontal/vertical advances and left/top sidebearings in &quot;hmtx&quot;</span>
<span class="sd">		and &quot;vmtx&quot; tables (if any) are updated from four phantom points and</span>
<span class="sd">		the glyph&#39;s bounding boxes.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># TODO: Create new glyph if not already present</span>
		<span class="k">assert</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>

		<span class="c1"># Handle phantom points for (left, right, top, bottom) positions.</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span>
		<span class="n">leftSideX</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">rightSideX</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">topSideY</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">bottomSideY</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

		<span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

		<span class="k">if</span> <span class="n">glyph</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyph</span><span class="o">.</span><span class="n">components</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">glyph</span><span class="o">.</span><span class="n">components</span><span class="p">):</span>
				<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">):</span>
					<span class="n">comp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">p</span>
		<span class="k">elif</span> <span class="n">glyph</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">glyph</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
			<span class="n">glyph</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

		<span class="n">glyph</span><span class="o">.</span><span class="n">recalcBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="n">horizontalAdvanceWidth</span> <span class="o">=</span> <span class="n">otRound</span><span class="p">(</span><span class="n">rightSideX</span> <span class="o">-</span> <span class="n">leftSideX</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">horizontalAdvanceWidth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="c1"># unlikely, but it can happen, see:</span>
			<span class="c1"># https://github.com/fonttools/fonttools/pull/1198</span>
			<span class="n">horizontalAdvanceWidth</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">leftSideBearing</span> <span class="o">=</span> <span class="n">otRound</span><span class="p">(</span><span class="n">glyph</span><span class="o">.</span><span class="n">xMin</span> <span class="o">-</span> <span class="n">leftSideX</span><span class="p">)</span>
		<span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;hmtx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">horizontalAdvanceWidth</span><span class="p">,</span> <span class="n">leftSideBearing</span>

		<span class="k">if</span> <span class="s2">&quot;vmtx&quot;</span> <span class="ow">in</span> <span class="n">ttFont</span><span class="p">:</span>
			<span class="n">verticalAdvanceWidth</span> <span class="o">=</span> <span class="n">otRound</span><span class="p">(</span><span class="n">topSideY</span> <span class="o">-</span> <span class="n">bottomSideY</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">verticalAdvanceWidth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># unlikely but do the same as horizontal</span>
				<span class="n">verticalAdvanceWidth</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">topSideBearing</span> <span class="o">=</span> <span class="n">otRound</span><span class="p">(</span><span class="n">topSideY</span> <span class="o">-</span> <span class="n">glyph</span><span class="o">.</span><span class="n">yMax</span><span class="p">)</span>
			<span class="n">ttFont</span><span class="p">[</span><span class="s2">&quot;vmtx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">glyphName</span><span class="p">]</span> <span class="o">=</span> <span class="n">verticalAdvanceWidth</span><span class="p">,</span> <span class="n">topSideBearing</span></div></div>


<span class="n">_GlyphControls</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
	<span class="s2">&quot;_GlyphControls&quot;</span><span class="p">,</span> <span class="s2">&quot;numberOfContours endPts flags components&quot;</span>
<span class="p">)</span>


<span class="n">glyphHeaderFormat</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">		&gt;	# big endian</span>
<span class="s2">		numberOfContours:	h</span>
<span class="s2">		xMin:				h</span>
<span class="s2">		yMin:				h</span>
<span class="s2">		xMax:				h</span>
<span class="s2">		yMax:				h</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># flags</span>
<span class="n">flagOnCurve</span> <span class="o">=</span> <span class="mh">0x01</span>
<span class="n">flagXShort</span> <span class="o">=</span> <span class="mh">0x02</span>
<span class="n">flagYShort</span> <span class="o">=</span> <span class="mh">0x04</span>
<span class="n">flagRepeat</span> <span class="o">=</span> <span class="mh">0x08</span>
<span class="n">flagXsame</span> <span class="o">=</span>  <span class="mh">0x10</span>
<span class="n">flagYsame</span> <span class="o">=</span> <span class="mh">0x20</span>
<span class="n">flagOverlapSimple</span> <span class="o">=</span> <span class="mh">0x40</span>
<span class="n">flagReserved</span> <span class="o">=</span> <span class="mh">0x80</span>

<span class="c1"># These flags are kept for XML output after decompiling the coordinates</span>
<span class="n">keepFlags</span> <span class="o">=</span> <span class="n">flagOnCurve</span> <span class="o">+</span> <span class="n">flagOverlapSimple</span>

<span class="n">_flagSignBytes</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">flagXsame</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">flagXShort</span><span class="o">|</span><span class="n">flagXsame</span><span class="p">:</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">flagXShort</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">flagYsame</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">flagYShort</span><span class="o">|</span><span class="n">flagYsame</span><span class="p">:</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">flagYShort</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<div class="viewcode-block" id="flagBest"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.flagBest">[docs]</a><span class="k">def</span> <span class="nf">flagBest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">onCurve</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;For a given x,y delta pair, returns the flag that packs this pair</span>
<span class="sd">	most efficiently, as well as the number of byte cost of such flag.&quot;&quot;&quot;</span>

	<span class="n">flag</span> <span class="o">=</span> <span class="n">flagOnCurve</span> <span class="k">if</span> <span class="n">onCurve</span> <span class="k">else</span> <span class="mi">0</span>
	<span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="c1"># do x</span>
	<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagXsame</span>
	<span class="k">elif</span> <span class="o">-</span><span class="mi">255</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">:</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagXShort</span>
		<span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagXsame</span>
		<span class="n">cost</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">cost</span> <span class="o">+=</span> <span class="mi">2</span>
	<span class="c1"># do y</span>
	<span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagYsame</span>
	<span class="k">elif</span> <span class="o">-</span><span class="mi">255</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">:</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagYShort</span>
		<span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagYsame</span>
		<span class="n">cost</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">cost</span> <span class="o">+=</span> <span class="mi">2</span>
	<span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">cost</span></div>

<div class="viewcode-block" id="flagFits"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.flagFits">[docs]</a><span class="k">def</span> <span class="nf">flagFits</span><span class="p">(</span><span class="n">newFlag</span><span class="p">,</span> <span class="n">oldFlag</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
	<span class="n">newBytes</span> <span class="o">=</span> <span class="n">_flagSignBytes</span><span class="p">[</span><span class="n">newFlag</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">]</span>
	<span class="n">oldBytes</span> <span class="o">=</span> <span class="n">_flagSignBytes</span><span class="p">[</span><span class="n">oldFlag</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">newBytes</span> <span class="o">==</span> <span class="n">oldBytes</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">newBytes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">oldBytes</span><span class="p">)</span></div>

<div class="viewcode-block" id="flagSupports"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.flagSupports">[docs]</a><span class="k">def</span> <span class="nf">flagSupports</span><span class="p">(</span><span class="n">newFlag</span><span class="p">,</span> <span class="n">oldFlag</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">((</span><span class="n">oldFlag</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">newFlag</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">)</span> <span class="ow">and</span>
		<span class="n">flagFits</span><span class="p">(</span><span class="n">newFlag</span><span class="p">,</span> <span class="n">oldFlag</span><span class="p">,</span> <span class="n">flagXsame</span><span class="o">|</span><span class="n">flagXShort</span><span class="p">)</span> <span class="ow">and</span>
		<span class="n">flagFits</span><span class="p">(</span><span class="n">newFlag</span><span class="p">,</span> <span class="n">oldFlag</span><span class="p">,</span> <span class="n">flagYsame</span><span class="o">|</span><span class="n">flagYShort</span><span class="p">))</span></div>

<div class="viewcode-block" id="flagEncodeCoord"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.flagEncodeCoord">[docs]</a><span class="k">def</span> <span class="nf">flagEncodeCoord</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">coordBytes</span><span class="p">):</span>
	<span class="n">byteCount</span> <span class="o">=</span> <span class="n">_flagSignBytes</span><span class="p">[</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">byteCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="n">coordBytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">byteCount</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
		<span class="n">coordBytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">coord</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">byteCount</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
		<span class="n">coordBytes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coord</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span>
		<span class="n">coordBytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span></div>

<div class="viewcode-block" id="flagEncodeCoords"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.flagEncodeCoords">[docs]</a><span class="k">def</span> <span class="nf">flagEncodeCoords</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xBytes</span><span class="p">,</span> <span class="n">yBytes</span><span class="p">):</span>
	<span class="n">flagEncodeCoord</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">flagXsame</span><span class="o">|</span><span class="n">flagXShort</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xBytes</span><span class="p">)</span>
	<span class="n">flagEncodeCoord</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">flagYsame</span><span class="o">|</span><span class="n">flagYShort</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yBytes</span><span class="p">)</span></div>


<span class="n">ARG_1_AND_2_ARE_WORDS</span>		<span class="o">=</span> <span class="mh">0x0001</span>  <span class="c1"># if set args are words otherwise they are bytes</span>
<span class="n">ARGS_ARE_XY_VALUES</span>		<span class="o">=</span> <span class="mh">0x0002</span>  <span class="c1"># if set args are xy values, otherwise they are points</span>
<span class="n">ROUND_XY_TO_GRID</span>		<span class="o">=</span> <span class="mh">0x0004</span>  <span class="c1"># for the xy values if above is true</span>
<span class="n">WE_HAVE_A_SCALE</span>			<span class="o">=</span> <span class="mh">0x0008</span>  <span class="c1"># Sx = Sy, otherwise scale == 1.0</span>
<span class="n">NON_OVERLAPPING</span>			<span class="o">=</span> <span class="mh">0x0010</span>  <span class="c1"># set to same value for all components (obsolete!)</span>
<span class="n">MORE_COMPONENTS</span>			<span class="o">=</span> <span class="mh">0x0020</span>  <span class="c1"># indicates at least one more glyph after this one</span>
<span class="n">WE_HAVE_AN_X_AND_Y_SCALE</span>	<span class="o">=</span> <span class="mh">0x0040</span>  <span class="c1"># Sx, Sy</span>
<span class="n">WE_HAVE_A_TWO_BY_TWO</span>		<span class="o">=</span> <span class="mh">0x0080</span>  <span class="c1"># t00, t01, t10, t11</span>
<span class="n">WE_HAVE_INSTRUCTIONS</span>		<span class="o">=</span> <span class="mh">0x0100</span>  <span class="c1"># instructions follow</span>
<span class="n">USE_MY_METRICS</span>			<span class="o">=</span> <span class="mh">0x0200</span>  <span class="c1"># apply these metrics to parent glyph</span>
<span class="n">OVERLAP_COMPOUND</span>		<span class="o">=</span> <span class="mh">0x0400</span>  <span class="c1"># used by Apple in GX fonts</span>
<span class="n">SCALED_COMPONENT_OFFSET</span>		<span class="o">=</span> <span class="mh">0x0800</span>  <span class="c1"># composite designed to have the component offset scaled (designed for Apple)</span>
<span class="n">UNSCALED_COMPONENT_OFFSET</span>	<span class="o">=</span> <span class="mh">0x1000</span>  <span class="c1"># composite designed not to have the component offset scaled (designed for MS)</span>


<span class="n">CompositeMaxpValues</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;CompositeMaxpValues&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;nPoints&#39;</span><span class="p">,</span> <span class="s1">&#39;nContours&#39;</span><span class="p">,</span> <span class="s1">&#39;maxComponentDepth&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="Glyph"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph">[docs]</a><span class="k">class</span> <span class="nc">Glyph</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
			<span class="c1"># empty char</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">return</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<div class="viewcode-block" id="Glyph.compact"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.compact">[docs]</a>	<span class="k">def</span> <span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">,</span> <span class="n">recalcBBoxes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">,</span> <span class="n">recalcBBoxes</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Glyph.expand"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.expand">[docs]</a>	<span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
			<span class="c1"># already unpacked</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="c1"># empty char</span>
			<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">return</span>
		<span class="n">dummy</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">unpack2</span><span class="p">(</span><span class="n">glyphHeaderFormat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="c1"># Some fonts (eg. Neirizi.ttf) have a 0 for numberOfContours in</span>
		<span class="c1"># some glyphs; decompileCoordinates assumes that there&#39;s at least</span>
		<span class="c1"># one, so short-circuit here.</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileComponents</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decompileCoordinates</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">,</span> <span class="n">recalcBBoxes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">recalcBBoxes</span><span class="p">:</span>
				<span class="c1"># must unpack glyph in order to recalculate bounding box</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="s2">&quot;&quot;</span>
		<span class="k">if</span> <span class="n">recalcBBoxes</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">recalcBounds</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">sstruct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">glyphHeaderFormat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">compileComponents</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">compileCoordinates</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Glyph.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">compo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
				<span class="n">compo</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
			<span class="n">haveInstructions</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;program&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span><span class="p">):</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s2">&quot;contour&quot;</span><span class="p">)</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
					<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span>
							<span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
							<span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
							<span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">),</span>
						<span class="p">]</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOverlapSimple</span><span class="p">:</span>
						<span class="c1"># Apple&#39;s rasterizer uses flagOverlapSimple in the first contour/first pt to flag glyphs that contain overlapping contours</span>
						<span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;overlap&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
					<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
					<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
				<span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s2">&quot;contour&quot;</span><span class="p">)</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
			<span class="n">haveInstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">&gt;</span> <span class="mi">0</span>
		<span class="k">if</span> <span class="n">haveInstructions</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="p">:</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="s2">&quot;instructions&quot;</span><span class="p">)</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="s2">&quot;instructions&quot;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;instructions&quot;</span><span class="p">)</span>
			<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="Glyph.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;contour&quot;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">TTLibError</span><span class="p">(</span><span class="s2">&quot;can&#39;t mix composites and contours in glyph&quot;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">coordinates</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="p">()</span>
			<span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
					<span class="k">continue</span>
				<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
				<span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;pt&quot;</span><span class="p">:</span>
					<span class="k">continue</span>  <span class="c1"># ignore anything but &quot;pt&quot;</span>
				<span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]),</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])))</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="ow">not</span> <span class="ow">not</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;on&quot;</span><span class="p">])</span>
				<span class="k">if</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;overlap&quot;</span><span class="p">])):</span>
					<span class="n">flag</span> <span class="o">|=</span> <span class="n">flagOverlapSimple</span>
				<span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
			<span class="n">flags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">extend</span> <span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;component&quot;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">TTLibError</span><span class="p">(</span><span class="s2">&quot;can&#39;t mix composites and contours in glyph&quot;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;components&quot;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">component</span> <span class="o">=</span> <span class="n">GlyphComponent</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
			<span class="n">component</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;instructions&quot;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">ttProgram</span><span class="o">.</span><span class="n">Program</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
					<span class="k">continue</span>
				<span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">element</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">fromXML</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.getCompositeMaxpValues"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.getCompositeMaxpValues">[docs]</a>	<span class="k">def</span> <span class="nf">getCompositeMaxpValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">,</span> <span class="n">maxComponentDepth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">()</span>
		<span class="n">nContours</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">nPoints</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">compo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
			<span class="n">baseGlyph</span> <span class="o">=</span> <span class="n">glyfTable</span><span class="p">[</span><span class="n">compo</span><span class="o">.</span><span class="n">glyphName</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">baseGlyph</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="k">elif</span> <span class="n">baseGlyph</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">nP</span><span class="p">,</span> <span class="n">nC</span> <span class="o">=</span> <span class="n">baseGlyph</span><span class="o">.</span><span class="n">getMaxpValues</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">nP</span><span class="p">,</span> <span class="n">nC</span><span class="p">,</span> <span class="n">maxComponentDepth</span> <span class="o">=</span> <span class="n">baseGlyph</span><span class="o">.</span><span class="n">getCompositeMaxpValues</span><span class="p">(</span>
						<span class="n">glyfTable</span><span class="p">,</span> <span class="n">maxComponentDepth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">nPoints</span> <span class="o">=</span> <span class="n">nPoints</span> <span class="o">+</span> <span class="n">nP</span>
			<span class="n">nContours</span> <span class="o">=</span> <span class="n">nContours</span> <span class="o">+</span> <span class="n">nC</span>
		<span class="k">return</span> <span class="n">CompositeMaxpValues</span><span class="p">(</span><span class="n">nPoints</span><span class="p">,</span> <span class="n">nContours</span><span class="p">,</span> <span class="n">maxComponentDepth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.getMaxpValues"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.getMaxpValues">[docs]</a>	<span class="k">def</span> <span class="nf">getMaxpValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">&gt;</span> <span class="mi">0</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.decompileComponents"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.decompileComponents">[docs]</a>	<span class="k">def</span> <span class="nf">decompileComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">more</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">haveInstructions</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="n">more</span><span class="p">:</span>
			<span class="n">component</span> <span class="o">=</span> <span class="n">GlyphComponent</span><span class="p">()</span>
			<span class="n">more</span><span class="p">,</span> <span class="n">haveInstr</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">)</span>
			<span class="n">haveInstructions</span> <span class="o">=</span> <span class="n">haveInstructions</span> <span class="o">|</span> <span class="n">haveInstr</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">haveInstructions</span><span class="p">:</span>
			<span class="n">numInstructions</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">ttProgram</span><span class="o">.</span><span class="n">Program</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">fromBytecode</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">numInstructions</span><span class="p">])</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">numInstructions</span><span class="p">:]</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
				<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
					<span class="s2">&quot;too much glyph data at the end of composite glyph: </span><span class="si">%d</span><span class="s2"> excess bytes&quot;</span><span class="p">,</span>
					<span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="Glyph.decompileCoordinates"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.decompileCoordinates">[docs]</a>	<span class="k">def</span> <span class="nf">decompileCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="n">endPtsOfContours</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
		<span class="n">endPtsOfContours</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">endPtsOfContours</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span> <span class="o">=</span> <span class="n">endPtsOfContours</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span><span class="p">:]</span>

		<span class="n">instructionLength</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">ttProgram</span><span class="o">.</span><span class="n">Program</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">fromBytecode</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">instructionLength</span><span class="p">])</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">instructionLength</span><span class="p">:]</span>
		<span class="n">nCoordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">flags</span><span class="p">,</span> <span class="n">xCoordinates</span><span class="p">,</span> <span class="n">yCoordinates</span> <span class="o">=</span> \
				<span class="bp">self</span><span class="o">.</span><span class="n">decompileCoordinatesRaw</span><span class="p">(</span><span class="n">nCoordinates</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

		<span class="c1"># fill in repetitions and apply signs</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nCoordinates</span><span class="p">)</span>
		<span class="n">xIndex</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">yIndex</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nCoordinates</span><span class="p">):</span>
			<span class="n">flag</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="c1"># x coordinate</span>
			<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXShort</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXsame</span><span class="p">:</span>
					<span class="n">x</span> <span class="o">=</span> <span class="n">xCoordinates</span><span class="p">[</span><span class="n">xIndex</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">xCoordinates</span><span class="p">[</span><span class="n">xIndex</span><span class="p">]</span>
				<span class="n">xIndex</span> <span class="o">=</span> <span class="n">xIndex</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">elif</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXsame</span><span class="p">:</span>
				<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">x</span> <span class="o">=</span> <span class="n">xCoordinates</span><span class="p">[</span><span class="n">xIndex</span><span class="p">]</span>
				<span class="n">xIndex</span> <span class="o">=</span> <span class="n">xIndex</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="c1"># y coordinate</span>
			<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYShort</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYsame</span><span class="p">:</span>
					<span class="n">y</span> <span class="o">=</span> <span class="n">yCoordinates</span><span class="p">[</span><span class="n">yIndex</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">yCoordinates</span><span class="p">[</span><span class="n">yIndex</span><span class="p">]</span>
				<span class="n">yIndex</span> <span class="o">=</span> <span class="n">yIndex</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">elif</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYsame</span><span class="p">:</span>
				<span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">y</span> <span class="o">=</span> <span class="n">yCoordinates</span><span class="p">[</span><span class="n">yIndex</span><span class="p">]</span>
				<span class="n">yIndex</span> <span class="o">=</span> <span class="n">yIndex</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
		<span class="k">assert</span> <span class="n">xIndex</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">xCoordinates</span><span class="p">)</span>
		<span class="k">assert</span> <span class="n">yIndex</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yCoordinates</span><span class="p">)</span>
		<span class="n">coordinates</span><span class="o">.</span><span class="n">relativeToAbsolute</span><span class="p">()</span>
		<span class="c1"># discard all flags except &quot;keepFlags&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span> <span class="o">&amp;</span> <span class="n">keepFlags</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">))</span></div>

<div class="viewcode-block" id="Glyph.decompileCoordinatesRaw"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.decompileCoordinatesRaw">[docs]</a>	<span class="k">def</span> <span class="nf">decompileCoordinatesRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nCoordinates</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="c1"># unpack flags and prepare unpacking of coordinates</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nCoordinates</span><span class="p">)</span>
		<span class="c1"># Warning: deep Python trickery going on. We use the struct module to unpack</span>
		<span class="c1"># the coordinates. We build a format string based on the flags, so we can</span>
		<span class="c1"># unpack the coordinates in one struct.unpack() call.</span>
		<span class="n">xFormat</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span> <span class="c1"># big endian</span>
		<span class="n">yFormat</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span> <span class="c1"># big endian</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">flag</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagRepeat</span><span class="p">:</span>
				<span class="n">repeat</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXShort</span><span class="p">:</span>
					<span class="n">xFormat</span> <span class="o">=</span> <span class="n">xFormat</span> <span class="o">+</span> <span class="s1">&#39;B&#39;</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXsame</span><span class="p">):</span>
					<span class="n">xFormat</span> <span class="o">=</span> <span class="n">xFormat</span> <span class="o">+</span> <span class="s1">&#39;h&#39;</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYShort</span><span class="p">:</span>
					<span class="n">yFormat</span> <span class="o">=</span> <span class="n">yFormat</span> <span class="o">+</span> <span class="s1">&#39;B&#39;</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYsame</span><span class="p">):</span>
					<span class="n">yFormat</span> <span class="o">=</span> <span class="n">yFormat</span> <span class="o">+</span> <span class="s1">&#39;h&#39;</span>
				<span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span>
				<span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">nCoordinates</span><span class="p">:</span>
				<span class="k">break</span>
		<span class="k">assert</span> <span class="n">j</span> <span class="o">==</span> <span class="n">nCoordinates</span><span class="p">,</span> <span class="s2">&quot;bad glyph flags&quot;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
		<span class="c1"># unpack raw coordinates, krrrrrr-tching!</span>
		<span class="n">xDataLen</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">xFormat</span><span class="p">)</span>
		<span class="n">yDataLen</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">yFormat</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">xDataLen</span> <span class="o">+</span> <span class="n">yDataLen</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
				<span class="s2">&quot;too much glyph data: </span><span class="si">%d</span><span class="s2"> excess bytes&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">xDataLen</span> <span class="o">+</span> <span class="n">yDataLen</span><span class="p">))</span>
		<span class="n">xCoordinates</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">xFormat</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="n">xDataLen</span><span class="p">])</span>
		<span class="n">yCoordinates</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">yFormat</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">xDataLen</span><span class="p">:</span><span class="n">xDataLen</span><span class="o">+</span><span class="n">yDataLen</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">flags</span><span class="p">,</span> <span class="n">xCoordinates</span><span class="p">,</span> <span class="n">yCoordinates</span></div>

<div class="viewcode-block" id="Glyph.compileComponents"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.compileComponents">[docs]</a>	<span class="k">def</span> <span class="nf">compileComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
		<span class="n">lastcomponent</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
		<span class="n">more</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">haveInstructions</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">lastcomponent</span><span class="p">:</span>
				<span class="n">haveInstructions</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;program&quot;</span><span class="p">)</span>
				<span class="n">more</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">compo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">compo</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">more</span><span class="p">,</span> <span class="n">haveInstructions</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">haveInstructions</span><span class="p">:</span>
			<span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">getBytecode</span><span class="p">()</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">))</span> <span class="o">+</span> <span class="n">instructions</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Glyph.compileCoordinates"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.compileCoordinates">[docs]</a>	<span class="k">def</span> <span class="nf">compileCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">endPtsOfContours</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="n">endPtsOfContours</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
		<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">endPtsOfContours</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
		<span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">getBytecode</span><span class="p">()</span>
		<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)))</span>
		<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>

		<span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">deltas</span><span class="o">.</span><span class="n">isFloat</span><span class="p">():</span>
			<span class="c1"># Warn?</span>
			<span class="n">deltas</span><span class="o">.</span><span class="n">toInt</span><span class="p">()</span>
		<span class="n">deltas</span><span class="o">.</span><span class="n">absoluteToRelative</span><span class="p">()</span>

		<span class="c1"># TODO(behdad): Add a configuration option for this?</span>
		<span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compileDeltasGreedy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="n">deltas</span><span class="p">)</span>
		<span class="c1">#deltas = self.compileDeltasOptimal(self.flags, deltas)</span>

		<span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.compileDeltasGreedy"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.compileDeltasGreedy">[docs]</a>	<span class="k">def</span> <span class="nf">compileDeltasGreedy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">deltas</span><span class="p">):</span>
		<span class="c1"># Implements greedy algorithm for packing coordinate deltas:</span>
		<span class="c1"># uses shortest representation one coordinate at a time.</span>
		<span class="n">compressedflags</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">xPoints</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">yPoints</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">lastflag</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">repeat</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">flag</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">deltas</span><span class="p">):</span>
			<span class="c1"># Oh, the horrors of TrueType</span>
			<span class="c1"># do x</span>
			<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagXsame</span>
			<span class="k">elif</span> <span class="o">-</span><span class="mi">255</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">:</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagXShort</span>
				<span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagXsame</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
				<span class="n">xPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bytechr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">xPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
			<span class="c1"># do y</span>
			<span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagYsame</span>
			<span class="k">elif</span> <span class="o">-</span><span class="mi">255</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">:</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagYShort</span>
				<span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagYsame</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>
				<span class="n">yPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bytechr</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">yPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
			<span class="c1"># handle repeating flags</span>
			<span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="n">lastflag</span> <span class="ow">and</span> <span class="n">repeat</span> <span class="o">!=</span> <span class="mi">255</span><span class="p">:</span>
				<span class="n">repeat</span> <span class="o">=</span> <span class="n">repeat</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="k">if</span> <span class="n">repeat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">compressedflags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">compressedflags</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">|</span> <span class="n">flagRepeat</span>
					<span class="n">compressedflags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeat</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">repeat</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="n">compressedflags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
			<span class="n">lastflag</span> <span class="o">=</span> <span class="n">flag</span>
		<span class="n">compressedFlags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">compressedflags</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
		<span class="n">compressedXs</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">xPoints</span><span class="p">)</span>
		<span class="n">compressedYs</span> <span class="o">=</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">yPoints</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">compressedFlags</span><span class="p">,</span> <span class="n">compressedXs</span><span class="p">,</span> <span class="n">compressedYs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.compileDeltasOptimal"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.compileDeltasOptimal">[docs]</a>	<span class="k">def</span> <span class="nf">compileDeltasOptimal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">deltas</span><span class="p">):</span>
		<span class="c1"># Implements optimal, dynaic-programming, algorithm for packing coordinate</span>
		<span class="c1"># deltas.  The savings are negligible :(.</span>
		<span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">bestTuple</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">bestCost</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">repeat</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">flag</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">deltas</span><span class="p">):</span>
			<span class="c1"># Oh, the horrors of TrueType</span>
			<span class="n">flag</span><span class="p">,</span> <span class="n">coordBytes</span> <span class="o">=</span> <span class="n">flagBest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
			<span class="n">bestCost</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">coordBytes</span>
			<span class="n">newCandidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bestCost</span><span class="p">,</span> <span class="n">bestTuple</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">coordBytes</span><span class="p">),</span>
							<span class="p">(</span><span class="n">bestCost</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bestTuple</span><span class="p">,</span> <span class="p">(</span><span class="n">flag</span><span class="o">|</span><span class="n">flagRepeat</span><span class="p">),</span> <span class="n">coordBytes</span><span class="p">)]</span>
			<span class="k">for</span> <span class="n">lastCost</span><span class="p">,</span><span class="n">lastTuple</span><span class="p">,</span><span class="n">lastFlag</span><span class="p">,</span><span class="n">coordBytes</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">lastCost</span> <span class="o">+</span> <span class="n">coordBytes</span> <span class="o">&lt;=</span> <span class="n">bestCost</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lastFlag</span> <span class="o">&amp;</span> <span class="n">flagRepeat</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lastFlag</span> <span class="o">&lt;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="ow">and</span> <span class="n">flagSupports</span><span class="p">(</span><span class="n">lastFlag</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lastFlag</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">flag</span><span class="o">|</span><span class="n">flagRepeat</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lastCost</span> <span class="o">==</span> <span class="n">bestCost</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
						<span class="k">continue</span>
					<span class="n">newCandidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lastCost</span> <span class="o">+</span> <span class="n">coordBytes</span><span class="p">,</span> <span class="n">lastTuple</span><span class="p">,</span> <span class="n">lastFlag</span><span class="o">+</span><span class="mi">256</span><span class="p">,</span> <span class="n">coordBytes</span><span class="p">))</span>
			<span class="n">candidates</span> <span class="o">=</span> <span class="n">newCandidates</span>
			<span class="n">bestTuple</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">bestCost</span> <span class="o">=</span> <span class="n">bestTuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">while</span> <span class="n">bestTuple</span><span class="p">:</span>
			<span class="n">cost</span><span class="p">,</span> <span class="n">bestTuple</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">coordBytes</span> <span class="o">=</span> <span class="n">bestTuple</span>
			<span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
		<span class="n">flags</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

		<span class="n">compressedFlags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
		<span class="n">compressedXs</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
		<span class="n">compressedYs</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
		<span class="n">coords</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span>
		<span class="n">ff</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
			<span class="n">repeatCount</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
			<span class="n">compressedFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagRepeat</span><span class="p">:</span>
				<span class="k">assert</span><span class="p">(</span><span class="n">repeatCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">compressedFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repeatCount</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span><span class="p">(</span><span class="n">repeatCount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">repeatCount</span><span class="p">):</span>
				<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
				<span class="n">flagEncodeCoords</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">compressedXs</span><span class="p">,</span> <span class="n">compressedYs</span><span class="p">)</span>
				<span class="n">ff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="nb">next</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;internal error&quot;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="n">compressedFlags</span> <span class="o">=</span> <span class="n">compressedFlags</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
		<span class="n">compressedXs</span> <span class="o">=</span> <span class="n">compressedXs</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
		<span class="n">compressedYs</span> <span class="o">=</span> <span class="n">compressedYs</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

		<span class="k">return</span> <span class="p">(</span><span class="n">compressedFlags</span><span class="p">,</span> <span class="n">compressedXs</span><span class="p">,</span> <span class="n">compressedYs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.recalcBounds"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.recalcBounds">[docs]</a>	<span class="k">def</span> <span class="nf">recalcBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="n">coords</span><span class="p">,</span> <span class="n">endPts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
				<span class="c1"># This branch calculates exact glyph outline bounds</span>
				<span class="c1"># analytically, handling cases without on-curve</span>
				<span class="c1"># extremas, etc.  However, the glyf table header</span>
				<span class="c1"># simply says that the bounds should be min/max x/y</span>
				<span class="c1"># &quot;for coordinate data&quot;, so I suppose that means no</span>
				<span class="c1"># fancy thing here, just get extremas of all coord</span>
				<span class="c1"># points (on and off).  As such, this branch is</span>
				<span class="c1"># disabled.</span>

				<span class="c1"># Collect on-curve points</span>
				<span class="n">onCurveCoords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span>
								<span class="k">if</span> <span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">]</span>
				<span class="c1"># Add implicit on-curve points</span>
				<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">endPts</span><span class="p">:</span>
					<span class="n">last</span> <span class="o">=</span> <span class="n">end</span>
					<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">|</span> <span class="n">flags</span><span class="p">[</span><span class="n">last</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">):</span>
							<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">last</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
							<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">last</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
							<span class="n">onCurveCoords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
						<span class="n">last</span> <span class="o">=</span> <span class="n">j</span>
					<span class="n">start</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="c1"># Add bounds for curves without an explicit extrema</span>
				<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">endPts</span><span class="p">:</span>
					<span class="n">last</span> <span class="o">=</span> <span class="n">end</span>
					<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">):</span>
							<span class="nb">next</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">end</span> <span class="k">else</span> <span class="n">start</span>
							<span class="n">bbox</span> <span class="o">=</span> <span class="n">calcBounds</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="nb">next</span><span class="p">]])</span>
							<span class="k">if</span> <span class="ow">not</span> <span class="n">pointInRect</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">bbox</span><span class="p">):</span>
								<span class="c1"># Ouch!</span>
								<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Outline has curve with implicit extrema.&quot;</span><span class="p">)</span>
								<span class="c1"># Ouch!  Find analytical curve bounds.</span>
								<span class="n">pthis</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
								<span class="n">plast</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">last</span><span class="p">]</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">):</span>
									<span class="n">plast</span> <span class="o">=</span> <span class="p">((</span><span class="n">pthis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">plast</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">pthis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">plast</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
								<span class="n">pnext</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="nb">next</span><span class="p">]</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="nb">next</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span><span class="p">):</span>
									<span class="n">pnext</span> <span class="o">=</span> <span class="p">((</span><span class="n">pthis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">pnext</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">pthis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">pnext</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
								<span class="n">bbox</span> <span class="o">=</span> <span class="n">calcQuadraticBounds</span><span class="p">(</span><span class="n">plast</span><span class="p">,</span> <span class="n">pthis</span><span class="p">,</span> <span class="n">pnext</span><span class="p">)</span>
								<span class="n">onCurveCoords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
								<span class="n">onCurveCoords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
						<span class="n">last</span> <span class="o">=</span> <span class="n">j</span>
					<span class="n">start</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">xMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMax</span> <span class="o">=</span> <span class="n">calcIntBounds</span><span class="p">(</span><span class="n">onCurveCoords</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">xMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMax</span> <span class="o">=</span> <span class="n">calcIntBounds</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.isComposite"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.isComposite">[docs]</a>	<span class="k">def</span> <span class="nf">isComposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Can be called on compact or expanded glyph.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span></div>

	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">componentIndex</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="k">raise</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">TTLibError</span><span class="p">(</span><span class="s2">&quot;can&#39;t use glyph as sequence&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">componentIndex</span><span class="p">]</span>

<div class="viewcode-block" id="Glyph.getCoordinates"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.getCoordinates">[docs]</a>	<span class="k">def</span> <span class="nf">getCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfContours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPtsOfContours</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="c1"># it&#39;s a composite</span>
			<span class="n">allCoords</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="p">()</span>
			<span class="n">allFlags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
			<span class="n">allEndPts</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">compo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
				<span class="n">g</span> <span class="o">=</span> <span class="n">glyfTable</span><span class="p">[</span><span class="n">compo</span><span class="o">.</span><span class="n">glyphName</span><span class="p">]</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">coordinates</span><span class="p">,</span> <span class="n">endPts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">RecursionError</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">TTLibError</span><span class="p">(</span><span class="s2">&quot;glyph &#39;</span><span class="si">%s</span><span class="s2">&#39; contains a recursive component reference&quot;</span> <span class="o">%</span> <span class="n">compo</span><span class="o">.</span><span class="n">glyphName</span><span class="p">)</span>
				<span class="n">coordinates</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
				<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">compo</span><span class="p">,</span> <span class="s2">&quot;firstPt&quot;</span><span class="p">):</span>
					<span class="c1"># component uses two reference points: we apply the transform _before_</span>
					<span class="c1"># computing the offset between the points</span>
					<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">compo</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">):</span>
						<span class="n">coordinates</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">compo</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
					<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">allCoords</span><span class="p">[</span><span class="n">compo</span><span class="o">.</span><span class="n">firstPt</span><span class="p">]</span>
					<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">compo</span><span class="o">.</span><span class="n">secondPt</span><span class="p">]</span>
					<span class="n">move</span> <span class="o">=</span> <span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">-</span><span class="n">y2</span>
					<span class="n">coordinates</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="c1"># component uses XY offsets</span>
					<span class="n">move</span> <span class="o">=</span> <span class="n">compo</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">compo</span><span class="o">.</span><span class="n">y</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">compo</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">):</span>
						<span class="n">coordinates</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">apple_way</span> <span class="o">=</span> <span class="n">compo</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SCALED_COMPONENT_OFFSET</span>
						<span class="n">ms_way</span> <span class="o">=</span> <span class="n">compo</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">UNSCALED_COMPONENT_OFFSET</span>
						<span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">apple_way</span> <span class="ow">and</span> <span class="n">ms_way</span><span class="p">)</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">apple_way</span> <span class="ow">or</span> <span class="n">ms_way</span><span class="p">):</span>
							<span class="n">scale_component_offset</span> <span class="o">=</span> <span class="n">SCALE_COMPONENT_OFFSET_DEFAULT</span>  <span class="c1"># see top of this file</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">scale_component_offset</span> <span class="o">=</span> <span class="n">apple_way</span>
						<span class="k">if</span> <span class="n">scale_component_offset</span><span class="p">:</span>
							<span class="c1"># the Apple way: first move, then scale (ie. scale the component offset)</span>
							<span class="n">coordinates</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
							<span class="n">coordinates</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">compo</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="c1"># the MS way: first scale, then move</span>
							<span class="n">coordinates</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">compo</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
							<span class="n">coordinates</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
				<span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">allCoords</span><span class="p">)</span>
				<span class="n">allEndPts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">endPts</span><span class="p">)</span>
				<span class="n">allCoords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
				<span class="n">allFlags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">allCoords</span><span class="p">,</span> <span class="n">allEndPts</span><span class="p">,</span> <span class="n">allFlags</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">GlyphCoordinates</span><span class="p">(),</span> <span class="p">[],</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.getComponentNames"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.getComponentNames">[docs]</a>	<span class="k">def</span> <span class="nf">getComponentNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
				<span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">glyphName</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">[]</span>

		<span class="c1"># Extract components without expanding glyph</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span>  <span class="c1"># Not composite</span>

		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>
		<span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">more</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">while</span> <span class="n">more</span><span class="p">:</span>
			<span class="n">flags</span><span class="p">,</span> <span class="n">glyphID</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
			<span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
			<span class="n">flags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
			<span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyfTable</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">glyphID</span><span class="p">)))</span>

			<span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ARG_1_AND_2_ARE_WORDS</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
			<span class="k">else</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
			<span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_A_SCALE</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
			<span class="k">elif</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_AN_X_AND_Y_SCALE</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
			<span class="k">elif</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_A_TWO_BY_TWO</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">8</span>
			<span class="n">more</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MORE_COMPONENTS</span>

		<span class="k">return</span> <span class="n">components</span></div>

<div class="viewcode-block" id="Glyph.trim"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.trim">[docs]</a>	<span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remove_hinting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Remove padding and, if requested, hinting, from a glyph.</span>
<span class="sd">			This works on both expanded and compacted glyphs, without</span>
<span class="sd">			expanding it.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">remove_hinting</span><span class="p">:</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
					<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;program&quot;</span><span class="p">):</span>
						<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">program</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">ttProgram</span><span class="o">.</span><span class="n">Program</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">fromBytecode</span><span class="p">([])</span>
			<span class="c1"># No padding to trim.</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="n">numContours</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
		<span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>
		<span class="k">if</span> <span class="n">numContours</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numContours</span> <span class="c1"># endPtsOfContours</span>
			<span class="n">nCoordinates</span> <span class="o">=</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">instructionLen</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">remove_hinting</span><span class="p">:</span>
				<span class="c1"># Zero instruction length</span>
				<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
				<span class="k">if</span> <span class="n">instructionLen</span><span class="p">:</span>
					<span class="c1"># Splice it out</span>
					<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">instructionLen</span><span class="p">:]</span>
				<span class="n">instructionLen</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">instructionLen</span>

			<span class="n">coordBytes</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
				<span class="n">flag</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagRepeat</span><span class="p">:</span>
					<span class="n">repeat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
					<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">xBytes</span> <span class="o">=</span> <span class="n">yBytes</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXShort</span><span class="p">:</span>
					<span class="n">xBytes</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagXsame</span><span class="p">):</span>
					<span class="n">xBytes</span> <span class="o">=</span> <span class="mi">2</span>
				<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYShort</span><span class="p">:</span>
					<span class="n">yBytes</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">flagYsame</span><span class="p">):</span>
					<span class="n">yBytes</span> <span class="o">=</span> <span class="mi">2</span>
				<span class="n">coordBytes</span> <span class="o">+=</span> <span class="p">(</span><span class="n">xBytes</span> <span class="o">+</span> <span class="n">yBytes</span><span class="p">)</span> <span class="o">*</span> <span class="n">repeat</span>
				<span class="n">j</span> <span class="o">+=</span> <span class="n">repeat</span>
				<span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">nCoordinates</span><span class="p">:</span>
					<span class="k">break</span>
			<span class="k">assert</span> <span class="n">j</span> <span class="o">==</span> <span class="n">nCoordinates</span><span class="p">,</span> <span class="s2">&quot;bad glyph flags&quot;</span>
			<span class="n">i</span> <span class="o">+=</span> <span class="n">coordBytes</span>
			<span class="c1"># Remove padding</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">more</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="n">we_have_instructions</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">while</span> <span class="n">more</span><span class="p">:</span>
				<span class="n">flags</span> <span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">remove_hinting</span><span class="p">:</span>
					<span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">WE_HAVE_INSTRUCTIONS</span>
				<span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_INSTRUCTIONS</span><span class="p">:</span>
					<span class="n">we_have_instructions</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
				<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
				<span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>

				<span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ARG_1_AND_2_ARE_WORDS</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
				<span class="k">else</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
				<span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_A_SCALE</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
				<span class="k">elif</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_AN_X_AND_Y_SCALE</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
				<span class="k">elif</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_A_TWO_BY_TWO</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">8</span>
				<span class="n">more</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MORE_COMPONENTS</span>
			<span class="k">if</span> <span class="n">we_have_instructions</span><span class="p">:</span>
				<span class="n">instructionLen</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">instructionLen</span>
			<span class="c1"># Remove padding</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span></div>

<div class="viewcode-block" id="Glyph.removeHinting"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.removeHinting">[docs]</a>	<span class="k">def</span> <span class="nf">removeHinting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">trim</span> <span class="p">(</span><span class="n">remove_hinting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glyph.draw"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.draw">[docs]</a>	<span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
				<span class="n">glyphName</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">getComponentInfo</span><span class="p">()</span>
				<span class="n">pen</span><span class="o">.</span><span class="n">addComponent</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>
			<span class="k">return</span>

		<span class="n">coordinates</span><span class="p">,</span> <span class="n">endPts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
			<span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="n">coordinates</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">endPts</span><span class="p">:</span>
			<span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">contour</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
			<span class="n">cFlags</span> <span class="o">=</span> <span class="p">[</span><span class="n">flagOnCurve</span> <span class="o">&amp;</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]]</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
			<span class="k">if</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cFlags</span><span class="p">:</span>
				<span class="c1"># There is not a single on-curve point on the curve,</span>
				<span class="c1"># use pen.qCurveTo&#39;s special case by specifying None</span>
				<span class="c1"># as the on-curve point.</span>
				<span class="n">contour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
				<span class="n">pen</span><span class="o">.</span><span class="n">qCurveTo</span><span class="p">(</span><span class="o">*</span><span class="n">contour</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># Shuffle the points so that contour the is guaranteed</span>
				<span class="c1"># to *end* in an on-curve point, which we&#39;ll use for</span>
				<span class="c1"># the moveTo.</span>
				<span class="n">firstOnCurve</span> <span class="o">=</span> <span class="n">cFlags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">contour</span> <span class="o">=</span> <span class="n">contour</span><span class="p">[</span><span class="n">firstOnCurve</span><span class="p">:]</span> <span class="o">+</span> <span class="n">contour</span><span class="p">[:</span><span class="n">firstOnCurve</span><span class="p">]</span>
				<span class="n">cFlags</span> <span class="o">=</span> <span class="n">cFlags</span><span class="p">[</span><span class="n">firstOnCurve</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cFlags</span><span class="p">[:</span><span class="n">firstOnCurve</span><span class="p">]</span>
				<span class="n">pen</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">contour</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
				<span class="k">while</span> <span class="n">contour</span><span class="p">:</span>
					<span class="n">nextOnCurve</span> <span class="o">=</span> <span class="n">cFlags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
					<span class="k">if</span> <span class="n">nextOnCurve</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="c1"># Skip a final lineTo(), as it is implied by</span>
						<span class="c1"># pen.closePath()</span>
						<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">pen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">contour</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">pen</span><span class="o">.</span><span class="n">qCurveTo</span><span class="p">(</span><span class="o">*</span><span class="n">contour</span><span class="p">[:</span><span class="n">nextOnCurve</span><span class="p">])</span>
					<span class="n">contour</span> <span class="o">=</span> <span class="n">contour</span><span class="p">[</span><span class="n">nextOnCurve</span><span class="p">:]</span>
					<span class="n">cFlags</span> <span class="o">=</span> <span class="n">cFlags</span><span class="p">[</span><span class="n">nextOnCurve</span><span class="p">:]</span>
			<span class="n">pen</span><span class="o">.</span><span class="n">closePath</span><span class="p">()</span></div>

<div class="viewcode-block" id="Glyph.drawPoints"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.Glyph.drawPoints">[docs]</a>	<span class="k">def</span> <span class="nf">drawPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Draw the glyph using the supplied pointPen. Opposed to Glyph.draw(),</span>
<span class="sd">		this will not change the point indices.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isComposite</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
				<span class="n">glyphName</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">getComponentInfo</span><span class="p">()</span>
				<span class="n">pen</span><span class="o">.</span><span class="n">addComponent</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>
			<span class="k">return</span>

		<span class="n">coordinates</span><span class="p">,</span> <span class="n">endPts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">glyfTable</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
			<span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="n">coordinates</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">endPts</span><span class="p">:</span>
			<span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="n">contour</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
			<span class="n">cFlags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
			<span class="n">pen</span><span class="o">.</span><span class="n">beginPath</span><span class="p">()</span>
			<span class="c1"># Start with the appropriate segment type based on the final segment</span>
			<span class="n">segmentType</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span> <span class="k">if</span> <span class="n">cFlags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;qcurve&quot;</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contour</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">cFlags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flagOnCurve</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">pen</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">segmentType</span><span class="o">=</span><span class="n">segmentType</span><span class="p">)</span>
					<span class="n">segmentType</span> <span class="o">=</span> <span class="s2">&quot;line&quot;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">pen</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
					<span class="n">segmentType</span> <span class="o">=</span> <span class="s2">&quot;qcurve&quot;</span>
			<span class="n">pen</span><span class="o">.</span><span class="n">endPath</span><span class="p">()</span></div>

	<span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">NotImplemented</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span>

	<span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="k">else</span> <span class="ow">not</span> <span class="n">result</span></div>

<div class="viewcode-block" id="GlyphComponent"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphComponent">[docs]</a><span class="k">class</span> <span class="nc">GlyphComponent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">pass</span>

<div class="viewcode-block" id="GlyphComponent.getComponentInfo"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphComponent.getComponentInfo">[docs]</a>	<span class="k">def</span> <span class="nf">getComponentInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return the base glyph name and a transform.&quot;&quot;&quot;</span>
		<span class="c1"># XXX Ignoring self.firstPt &amp; self.lastpt for now: I need to implement</span>
		<span class="c1"># something equivalent in fontTools.objects.glyph (I&#39;d rather not</span>
		<span class="c1"># convert it to an absolute offset, since it is valuable information).</span>
		<span class="c1"># This method will now raise &quot;AttributeError: x&quot; on glyphs that use</span>
		<span class="c1"># this TT feature.</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">):</span>
			<span class="p">[[</span><span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">],</span> <span class="p">[</span><span class="n">yx</span><span class="p">,</span> <span class="n">yy</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
			<span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphName</span><span class="p">,</span> <span class="n">trans</span></div>

<div class="viewcode-block" id="GlyphComponent.decompile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphComponent.decompile">[docs]</a>	<span class="k">def</span> <span class="nf">decompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="n">flags</span><span class="p">,</span> <span class="n">glyphID</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
		<span class="n">glyphID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">glyphID</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphName</span> <span class="o">=</span> <span class="n">glyfTable</span><span class="o">.</span><span class="n">getGlyphName</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">glyphID</span><span class="p">))</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ARG_1_AND_2_ARE_WORDS</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ARGS_ARE_XY_VALUES</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;hh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ARGS_ARE_XY_VALUES</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;bb&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;BB&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_A_SCALE</span><span class="p">:</span>
			<span class="n">scale</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fi2fl</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">fi2fl</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="mi">14</span><span class="p">)]]</span>  <span class="c1"># fixed 2.14</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_AN_X_AND_Y_SCALE</span><span class="p">:</span>
			<span class="n">xscale</span><span class="p">,</span> <span class="n">yscale</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;hh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fi2fl</span><span class="p">(</span><span class="n">xscale</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">fi2fl</span><span class="p">(</span><span class="n">yscale</span><span class="p">,</span><span class="mi">14</span><span class="p">)]]</span>  <span class="c1"># fixed 2.14</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_A_TWO_BY_TWO</span><span class="p">:</span>
			<span class="p">(</span><span class="n">xscale</span><span class="p">,</span> <span class="n">scale01</span><span class="p">,</span>
					<span class="n">scale10</span><span class="p">,</span> <span class="n">yscale</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;hhhh&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fi2fl</span><span class="p">(</span><span class="n">xscale</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">fi2fl</span><span class="p">(</span><span class="n">scale01</span><span class="p">,</span><span class="mi">14</span><span class="p">)],</span>
							<span class="p">[</span><span class="n">fi2fl</span><span class="p">(</span><span class="n">scale10</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">fi2fl</span><span class="p">(</span><span class="n">yscale</span><span class="p">,</span><span class="mi">14</span><span class="p">)]]</span> <span class="c1"># fixed 2.14</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
		<span class="n">more</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MORE_COMPONENTS</span>
		<span class="n">haveInstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WE_HAVE_INSTRUCTIONS</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ROUND_XY_TO_GRID</span> <span class="o">|</span> <span class="n">USE_MY_METRICS</span> <span class="o">|</span>
				<span class="n">SCALED_COMPONENT_OFFSET</span> <span class="o">|</span> <span class="n">UNSCALED_COMPONENT_OFFSET</span> <span class="o">|</span>
				<span class="n">NON_OVERLAPPING</span> <span class="o">|</span> <span class="n">OVERLAP_COMPOUND</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">more</span><span class="p">,</span> <span class="n">haveInstructions</span><span class="p">,</span> <span class="n">data</span></div>

<div class="viewcode-block" id="GlyphComponent.compile"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphComponent.compile">[docs]</a>	<span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">more</span><span class="p">,</span> <span class="n">haveInstructions</span><span class="p">,</span> <span class="n">glyfTable</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

		<span class="c1"># reset all flags we will calculate ourselves</span>
		<span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ROUND_XY_TO_GRID</span> <span class="o">|</span> <span class="n">USE_MY_METRICS</span> <span class="o">|</span>
				<span class="n">SCALED_COMPONENT_OFFSET</span> <span class="o">|</span> <span class="n">UNSCALED_COMPONENT_OFFSET</span> <span class="o">|</span>
				<span class="n">NON_OVERLAPPING</span> <span class="o">|</span> <span class="n">OVERLAP_COMPOUND</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">more</span><span class="p">:</span>
			<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">MORE_COMPONENTS</span>
		<span class="k">if</span> <span class="n">haveInstructions</span><span class="p">:</span>
			<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">WE_HAVE_INSTRUCTIONS</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;firstPt&quot;</span><span class="p">):</span>
			<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">):</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;BB&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span><span class="p">)</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ARG_1_AND_2_ARE_WORDS</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">otRound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">otRound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
			<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ARGS_ARE_XY_VALUES</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">):</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;bb&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;hh&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ARG_1_AND_2_ARE_WORDS</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">):</span>
			<span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fl2fi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">WE_HAVE_A_TWO_BY_TWO</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;hhhh&quot;</span><span class="p">,</span>
						<span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
						<span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">elif</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">WE_HAVE_AN_X_AND_Y_SCALE</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;hh&quot;</span><span class="p">,</span>
						<span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">WE_HAVE_A_SCALE</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;h&quot;</span><span class="p">,</span>
						<span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

		<span class="n">glyphID</span> <span class="o">=</span> <span class="n">glyfTable</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glyphName</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">glyphID</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span></div>

<div class="viewcode-block" id="GlyphComponent.toXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphComponent.toXML">[docs]</a>	<span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;glyphName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphName</span><span class="p">)]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;firstPt&quot;</span><span class="p">):</span>
			<span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;firstPt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;secondPt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span><span class="p">)]</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">):</span>
			<span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
			<span class="k">if</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
				<span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="o">+</span> <span class="p">[</span>
					<span class="p">(</span><span class="s2">&quot;scalex&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">14</span><span class="p">)),</span>
					<span class="p">(</span><span class="s2">&quot;scale01&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">14</span><span class="p">)),</span>
					<span class="p">(</span><span class="s2">&quot;scale10&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">14</span><span class="p">)),</span>
					<span class="p">(</span><span class="s2">&quot;scaley&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">14</span><span class="p">)),</span>
				<span class="p">]</span>
			<span class="k">elif</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
				<span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="o">+</span> <span class="p">[</span>
					<span class="p">(</span><span class="s2">&quot;scalex&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">14</span><span class="p">)),</span>
					<span class="p">(</span><span class="s2">&quot;scaley&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">14</span><span class="p">)),</span>
				<span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">fl2str</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">14</span><span class="p">))]</span>
		<span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))]</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">simpletag</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>

<div class="viewcode-block" id="GlyphComponent.fromXML"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphComponent.fromXML">[docs]</a>	<span class="k">def</span> <span class="nf">fromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">ttFont</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">glyphName</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;glyphName&quot;</span><span class="p">]</span>
		<span class="k">if</span> <span class="s2">&quot;firstPt&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;firstPt&quot;</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">secondPt</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;secondPt&quot;</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="s2">&quot;scale01&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
			<span class="n">scalex</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scalex&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="n">scale01</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scale01&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="n">scale10</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scale10&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="n">scaley</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scaley&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">scalex</span><span class="p">,</span> <span class="n">scale01</span><span class="p">],</span> <span class="p">[</span><span class="n">scale10</span><span class="p">,</span> <span class="n">scaley</span><span class="p">]]</span>
		<span class="k">elif</span> <span class="s2">&quot;scalex&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
			<span class="n">scalex</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scalex&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="n">scaley</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scaley&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">scalex</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">scaley</span><span class="p">]]</span>
		<span class="k">elif</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
			<span class="n">scale</span> <span class="o">=</span> <span class="n">str2fl</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="p">[[</span><span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="p">]]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">safeEval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">])</span></div>

	<span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">NotImplemented</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span>

	<span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="k">else</span> <span class="ow">not</span> <span class="n">result</span></div>

<div class="viewcode-block" id="GlyphCoordinates"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates">[docs]</a><span class="k">class</span> <span class="nc">GlyphCoordinates</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="p">[],</span> <span class="n">typecode</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">typecode</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>

<div class="viewcode-block" id="GlyphCoordinates.isFloat"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.isFloat">[docs]</a>	<span class="k">def</span> <span class="nf">isFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">typecode</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span></div>

	<span class="k">def</span> <span class="nf">_ensureFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFloat</span><span class="p">():</span>
			<span class="k">return</span>
		<span class="c1"># The conversion to list() is to work around Jython bug</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">_checkFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFloat</span><span class="p">():</span>
			<span class="k">return</span> <span class="n">p</span>
		<span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mh">0x7FFF</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mh">0x8000</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_ensureFloat</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">p</span>
		<span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
			<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_ensureFloat</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">p</span>

<div class="viewcode-block" id="GlyphCoordinates.zeros"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.zeros">[docs]</a>	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">GlyphCoordinates</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlyphCoordinates.copy"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.copy">[docs]</a>	<span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">GlyphCoordinates</span><span class="p">(</span><span class="n">typecode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">typecode</span><span class="p">)</span>
		<span class="n">c</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">c</span></div>

	<span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
			<span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
			<span class="c1"># XXX This only works if len(v) == len(indices)</span>
			<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
				<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
			<span class="k">return</span>
		<span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkFloat</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

	<span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s1">&#39;GlyphCoordinates([&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;])&#39;</span>

<div class="viewcode-block" id="GlyphCoordinates.append"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.append">[docs]</a>	<span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
		<span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkFloat</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">))</span></div>

<div class="viewcode-block" id="GlyphCoordinates.extend"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.extend">[docs]</a>	<span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
			<span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkFloat</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlyphCoordinates.toInt"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.toInt">[docs]</a>	<span class="k">def</span> <span class="nf">toInt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFloat</span><span class="p">():</span>
			<span class="k">return</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">:</span>
			<span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">otRound</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">a</span></div>

<div class="viewcode-block" id="GlyphCoordinates.relativeToAbsolute"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.relativeToAbsolute">[docs]</a>	<span class="k">def</span> <span class="nf">relativeToAbsolute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span>  <span class="p">]</span> <span class="o">+</span> <span class="n">x</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span>
			<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlyphCoordinates.absoluteToRelative"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.absoluteToRelative">[docs]</a>	<span class="k">def</span> <span class="nf">absoluteToRelative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
			<span class="n">dx</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span>  <span class="p">]</span> <span class="o">-</span> <span class="n">x</span>
			<span class="n">dy</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span>  <span class="p">]</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
			<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlyphCoordinates.translate"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.translate">[docs]</a>	<span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; GlyphCoordinates([(1,2)]).translate((.5,0))</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkFloat</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
			<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlyphCoordinates.scale"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.scale">[docs]</a>	<span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; GlyphCoordinates([(1,2)]).scale((.5,0))</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkFloat</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
			<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlyphCoordinates.transform"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.GlyphCoordinates.transform">[docs]</a>	<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; GlyphCoordinates([(1,2)]).transform(((.5,0),(.2,.5)))</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span>  <span class="p">]</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">px</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">py</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
			<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g2 = GlyphCoordinates([(1.0,2)])</span>
<span class="sd">		&gt;&gt;&gt; g3 = GlyphCoordinates([(1.5,2)])</span>
<span class="sd">		&gt;&gt;&gt; g == g2</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; g == g3</span>
<span class="sd">		False</span>
<span class="sd">		&gt;&gt;&gt; g2 == g3</span>
<span class="sd">		False</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">NotImplemented</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_a</span>

	<span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g2 = GlyphCoordinates([(1.0,2)])</span>
<span class="sd">		&gt;&gt;&gt; g3 = GlyphCoordinates([(1.5,2)])</span>
<span class="sd">		&gt;&gt;&gt; g != g2</span>
<span class="sd">		False</span>
<span class="sd">		&gt;&gt;&gt; g != g3</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; g2 != g3</span>
<span class="sd">		True</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="k">else</span> <span class="ow">not</span> <span class="n">result</span>

	<span class="c1"># Math operations</span>

	<span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(1, 2)])</span>
<span class="sd">		&gt;&gt;&gt; g2 = +g</span>
<span class="sd">		&gt;&gt;&gt; g2</span>
<span class="sd">		GlyphCoordinates([(1, 2)])</span>
<span class="sd">		&gt;&gt;&gt; g2.translate((1,0))</span>
<span class="sd">		&gt;&gt;&gt; g2</span>
<span class="sd">		GlyphCoordinates([(2, 2)])</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(1, 2)])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(1, 2)])</span>
<span class="sd">		&gt;&gt;&gt; g2 = -g</span>
<span class="sd">		&gt;&gt;&gt; g2</span>
<span class="sd">		GlyphCoordinates([(-1, -2)])</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(1, 2)])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">_a</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
			<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">r</span>
	<span class="k">def</span> <span class="nf">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Note: This is Python 3 only.  Python 2 does not call __round__.</span>
<span class="sd">		As such, we cannot test this method either. :(</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">r</span><span class="o">.</span><span class="n">toInt</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">r</span>

	<span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="fm">__isub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="fm">__itruediv__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

	<span class="fm">__radd__</span> <span class="o">=</span> <span class="fm">__add__</span>
	<span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>
	<span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g += (.5,0)</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(1.5, 2.0)])</span>
<span class="sd">		&gt;&gt;&gt; g2 = GlyphCoordinates([(3,4)])</span>
<span class="sd">		&gt;&gt;&gt; g += g2</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(4.5, 6.0)])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">2</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GlyphCoordinates</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">isFloat</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensureFloat</span><span class="p">()</span>
			<span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_a</span>
			<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
				<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">return</span> <span class="bp">NotImplemented</span>

	<span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g -= (.5,0)</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(0.5, 2.0)])</span>
<span class="sd">		&gt;&gt;&gt; g2 = GlyphCoordinates([(3,4)])</span>
<span class="sd">		&gt;&gt;&gt; g -= g2</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(-2.5, -2.0)])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">2</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="o">-</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GlyphCoordinates</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">isFloat</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensureFloat</span><span class="p">()</span>
			<span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_a</span>
			<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
				<span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">return</span> <span class="bp">NotImplemented</span>

	<span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g *= (2,.5)</span>
<span class="sd">		&gt;&gt;&gt; g *= 2</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(4.0, 2.0)])</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,2)])</span>
<span class="sd">		&gt;&gt;&gt; g *= 2</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(2, 4)])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
			<span class="n">other</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
				<span class="k">return</span> <span class="bp">self</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">2</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">return</span> <span class="bp">NotImplemented</span>

	<span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(1,3)])</span>
<span class="sd">		&gt;&gt;&gt; g /= (.5,1.5)</span>
<span class="sd">		&gt;&gt;&gt; g /= 2</span>
<span class="sd">		&gt;&gt;&gt; g</span>
<span class="sd">		GlyphCoordinates([(1.0, 1.0)])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
			<span class="n">other</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
				<span class="k">return</span> <span class="bp">self</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">2</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">1.</span><span class="o">/</span><span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
			<span class="k">return</span> <span class="bp">self</span>
		<span class="k">return</span> <span class="bp">NotImplemented</span>

	<span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([])</span>
<span class="sd">		&gt;&gt;&gt; bool(g)</span>
<span class="sd">		False</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(0,0), (0.,0)])</span>
<span class="sd">		&gt;&gt;&gt; bool(g)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(0,0), (1,0)])</span>
<span class="sd">		&gt;&gt;&gt; bool(g)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; g = GlyphCoordinates([(0,.5), (0,0)])</span>
<span class="sd">		&gt;&gt;&gt; bool(g)</span>
<span class="sd">		True</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span>

	<span class="n">__nonzero__</span> <span class="o">=</span> <span class="fm">__bool__</span></div>


<div class="viewcode-block" id="reprflag"><a class="viewcode-back" href="../../../../ttLib/tables.html#fontTools.ttLib.tables._g_l_y_f.reprflag">[docs]</a><span class="k">def</span> <span class="nf">reprflag</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
	<span class="nb">bin</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">byteord</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
	<span class="k">while</span> <span class="n">flag</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">:</span>
			<span class="nb">bin</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">+</span> <span class="nb">bin</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">bin</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nb">bin</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
	<span class="nb">bin</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">))</span> <span class="o">*</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nb">bin</span>
	<span class="k">return</span> <span class="nb">bin</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>