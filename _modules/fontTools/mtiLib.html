

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.mtiLib &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>fontTools.mtiLib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.mtiLib</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>

<span class="c1"># FontDame-to-FontTools for OpenType Layout tables</span>
<span class="c1">#</span>
<span class="c1"># Source language spec is available at:</span>
<span class="c1"># http://monotype.github.io/OpenType_Table_Source/otl_source.html</span>
<span class="c1"># https://github.com/Monotype/OpenType_Table_Source/</span>

<span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools</span> <span class="k">import</span> <span class="n">ttLib</span>
<span class="kn">from</span> <span class="nn">fontTools.ttLib.tables._c_m_a_p</span> <span class="k">import</span> <span class="n">cmap_classes</span>
<span class="kn">from</span> <span class="nn">fontTools.ttLib.tables</span> <span class="k">import</span> <span class="n">otTables</span> <span class="k">as</span> <span class="n">ot</span>
<span class="kn">from</span> <span class="nn">fontTools.ttLib.tables.otBase</span> <span class="k">import</span> <span class="n">ValueRecord</span><span class="p">,</span> <span class="n">valueRecordFormatDict</span>
<span class="kn">from</span> <span class="nn">fontTools.otlLib</span> <span class="k">import</span> <span class="n">builder</span> <span class="k">as</span> <span class="n">otl</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">setitem</span>
<span class="kn">import</span> <span class="nn">logging</span>

<div class="viewcode-block" id="MtiLibError"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.MtiLibError">[docs]</a><span class="k">class</span> <span class="nc">MtiLibError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="ReferenceNotFoundError"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.ReferenceNotFoundError">[docs]</a><span class="k">class</span> <span class="nc">ReferenceNotFoundError</span><span class="p">(</span><span class="n">MtiLibError</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="FeatureNotFoundError"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.FeatureNotFoundError">[docs]</a><span class="k">class</span> <span class="nc">FeatureNotFoundError</span><span class="p">(</span><span class="n">ReferenceNotFoundError</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="LookupNotFoundError"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.LookupNotFoundError">[docs]</a><span class="k">class</span> <span class="nc">LookupNotFoundError</span><span class="p">(</span><span class="n">ReferenceNotFoundError</span><span class="p">):</span> <span class="k">pass</span></div>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;fontTools.mtiLib&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="makeGlyph"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeGlyph">[docs]</a><span class="k">def</span> <span class="nf">makeGlyph</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">s</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;U &#39;</span><span class="p">,</span> <span class="s1">&#39;u &#39;</span><span class="p">]:</span>
		<span class="k">return</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">TTFont</span><span class="o">.</span><span class="n">_makeGlyphName</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">16</span><span class="p">))</span>
	<span class="k">elif</span> <span class="n">s</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;# &#39;</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;glyph</span><span class="si">%.5d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
	<span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Space found in glyph name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span>
	<span class="k">assert</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Glyph name is empty&quot;</span>
	<span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="makeGlyphs"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeGlyphs">[docs]</a><span class="k">def</span> <span class="nf">makeGlyphs</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">makeGlyph</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span></div>

<div class="viewcode-block" id="mapLookup"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.mapLookup">[docs]</a><span class="k">def</span> <span class="nf">mapLookup</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
	<span class="c1"># Lookups are addressed by name.  So resolved them using a map if available.</span>
	<span class="c1"># Fallback to parsing as lookup index if a map isn&#39;t provided.</span>
	<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">LookupNotFoundError</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="mapFeature"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.mapFeature">[docs]</a><span class="k">def</span> <span class="nf">mapFeature</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
	<span class="c1"># Features are referenced by index according the spec.  So, if symbol is an</span>
	<span class="c1"># integer, use it directly.  Otherwise look up in the map if provided.</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">FeatureNotFoundError</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="setReference"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.setReference">[docs]</a><span class="k">def</span> <span class="nf">setReference</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">mapped</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">ReferenceNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">mapping</span><span class="o">.</span><span class="n">addDeferredMapping</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ref</span><span class="p">:</span> <span class="n">setter</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">ref</span><span class="p">),</span> <span class="n">sym</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
				<span class="k">return</span>
		<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">raise</span>
	<span class="n">setter</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mapped</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeferredMapping"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.DeferredMapping">[docs]</a><span class="k">class</span> <span class="nc">DeferredMapping</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_deferredMappings</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="DeferredMapping.addDeferredMapping"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.DeferredMapping.addDeferredMapping">[docs]</a>	<span class="k">def</span> <span class="nf">addDeferredMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
		<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding deferred mapping for symbol &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_deferredMappings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">setter</span><span class="p">,</span><span class="n">sym</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="DeferredMapping.applyDeferredMappings"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.DeferredMapping.applyDeferredMappings">[docs]</a>	<span class="k">def</span> <span class="nf">applyDeferredMappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">setter</span><span class="p">,</span><span class="n">sym</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferredMappings</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Applying deferred mapping for symbol &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">mapped</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">e</span>
			<span class="n">setter</span><span class="p">(</span><span class="n">mapped</span><span class="p">)</span>
			<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Set to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mapped</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_deferredMappings</span> <span class="o">=</span> <span class="p">[]</span></div></div>


<div class="viewcode-block" id="parseScriptList"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseScriptList">[docs]</a><span class="k">def</span> <span class="nf">parseScriptList</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">featureMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ScriptList</span><span class="p">()</span>
	<span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;script table&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
				<span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">scriptTag</span><span class="p">,</span> <span class="n">langSysTag</span><span class="p">,</span> <span class="n">defaultFeature</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="n">line</span>
			<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding script </span><span class="si">%s</span><span class="s2"> language-system </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">scriptTag</span><span class="p">,</span> <span class="n">langSysTag</span><span class="p">)</span>

			<span class="n">langSys</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LangSys</span><span class="p">()</span>
			<span class="n">langSys</span><span class="o">.</span><span class="n">LookupOrder</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">if</span> <span class="n">defaultFeature</span><span class="p">:</span>
				<span class="n">setReference</span><span class="p">(</span><span class="n">mapFeature</span><span class="p">,</span> <span class="n">featureMap</span><span class="p">,</span> <span class="n">defaultFeature</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">langSys</span><span class="p">,</span> <span class="s1">&#39;ReqFeatureIndex&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">langSys</span><span class="o">.</span><span class="n">ReqFeatureIndex</span> <span class="o">=</span> <span class="mh">0xFFFF</span>
			<span class="n">syms</span> <span class="o">=</span> <span class="n">stripSplitComma</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
			<span class="n">langSys</span><span class="o">.</span><span class="n">FeatureIndex</span> <span class="o">=</span> <span class="n">theList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">syms</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">sym</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syms</span><span class="p">):</span>
				<span class="n">setReference</span><span class="p">(</span><span class="n">mapFeature</span><span class="p">,</span> <span class="n">featureMap</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">setitem</span><span class="p">,</span> <span class="n">theList</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
			<span class="n">langSys</span><span class="o">.</span><span class="n">FeatureCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">langSys</span><span class="o">.</span><span class="n">FeatureIndex</span><span class="p">)</span>

			<span class="n">script</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">records</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">ScriptTag</span> <span class="o">==</span> <span class="n">scriptTag</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">script</span><span class="p">:</span>
				<span class="n">script</span> <span class="o">=</span> <span class="n">script</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Script</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">scriptRec</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ScriptRecord</span><span class="p">()</span>
				<span class="n">scriptRec</span><span class="o">.</span><span class="n">ScriptTag</span> <span class="o">=</span> <span class="n">scriptTag</span>
				<span class="n">scriptRec</span><span class="o">.</span><span class="n">Script</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
				<span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scriptRec</span><span class="p">)</span>
				<span class="n">script</span> <span class="o">=</span> <span class="n">scriptRec</span><span class="o">.</span><span class="n">Script</span>
				<span class="n">script</span><span class="o">.</span><span class="n">DefaultLangSys</span> <span class="o">=</span> <span class="kc">None</span>
				<span class="n">script</span><span class="o">.</span><span class="n">LangSysRecord</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="n">script</span><span class="o">.</span><span class="n">LangSysCount</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="k">if</span> <span class="n">langSysTag</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
				<span class="n">script</span><span class="o">.</span><span class="n">DefaultLangSys</span> <span class="o">=</span> <span class="n">langSys</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">langSysRec</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="p">()</span>
				<span class="n">langSysRec</span><span class="o">.</span><span class="n">LangSysTag</span> <span class="o">=</span> <span class="n">langSysTag</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">langSysTag</span><span class="p">))</span>
				<span class="n">langSysRec</span><span class="o">.</span><span class="n">LangSys</span> <span class="o">=</span> <span class="n">langSys</span>
				<span class="n">script</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">langSysRec</span><span class="p">)</span>
				<span class="n">script</span><span class="o">.</span><span class="n">LangSysCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
		<span class="n">script</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">LangSysRecord</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">Script</span><span class="o">.</span><span class="n">LangSysRecord</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">LangSysTag</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">ScriptRecord</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">ScriptTag</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">ScriptCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ScriptRecord</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseFeatureList"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseFeatureList">[docs]</a><span class="k">def</span> <span class="nf">parseFeatureList</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">featureMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FeatureList</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">FeatureRecord</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;feature table&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="n">name</span><span class="p">,</span> <span class="n">featureTag</span><span class="p">,</span> <span class="n">lookups</span> <span class="o">=</span> <span class="n">line</span>
			<span class="k">if</span> <span class="n">featureMap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">featureMap</span><span class="p">,</span> <span class="s2">&quot;Duplicate feature name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span>
				<span class="n">featureMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">)</span>
			<span class="c1"># If feature name is integer, make sure it matches its index.</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">))</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>
			<span class="n">featureRec</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">()</span>
			<span class="n">featureRec</span><span class="o">.</span><span class="n">FeatureTag</span> <span class="o">=</span> <span class="n">featureTag</span>
			<span class="n">featureRec</span><span class="o">.</span><span class="n">Feature</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Feature</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureRec</span><span class="p">)</span>
			<span class="n">feature</span> <span class="o">=</span> <span class="n">featureRec</span><span class="o">.</span><span class="n">Feature</span>
			<span class="n">feature</span><span class="o">.</span><span class="n">FeatureParams</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">syms</span> <span class="o">=</span> <span class="n">stripSplitComma</span><span class="p">(</span><span class="n">lookups</span><span class="p">)</span>
			<span class="n">feature</span><span class="o">.</span><span class="n">LookupListIndex</span> <span class="o">=</span> <span class="n">theList</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">syms</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">sym</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syms</span><span class="p">):</span>
				<span class="n">setReference</span><span class="p">(</span><span class="n">mapLookup</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">setitem</span><span class="p">,</span> <span class="n">theList</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
			<span class="n">feature</span><span class="o">.</span><span class="n">LookupCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">LookupListIndex</span><span class="p">)</span>

	<span class="bp">self</span><span class="o">.</span><span class="n">FeatureCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FeatureRecord</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseLookupFlags"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseLookupFlags">[docs]</a><span class="k">def</span> <span class="nf">parseLookupFlags</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">filterset</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="n">allFlags</span> <span class="o">=</span> <span class="p">[</span>
		<span class="s1">&#39;righttoleft&#39;</span><span class="p">,</span>
		<span class="s1">&#39;ignorebaseglyphs&#39;</span><span class="p">,</span>
		<span class="s1">&#39;ignoreligatures&#39;</span><span class="p">,</span>
		<span class="s1">&#39;ignoremarks&#39;</span><span class="p">,</span>
		<span class="s1">&#39;markattachmenttype&#39;</span><span class="p">,</span>
		<span class="s1">&#39;markfiltertype&#39;</span><span class="p">,</span>
	<span class="p">]</span>
	<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allFlags</span><span class="p">:</span>
		<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="p">{</span>
			<span class="s1">&#39;righttoleft&#39;</span><span class="p">:</span>		<span class="mh">0x0001</span><span class="p">,</span>
			<span class="s1">&#39;ignorebaseglyphs&#39;</span><span class="p">:</span>	<span class="mh">0x0002</span><span class="p">,</span>
			<span class="s1">&#39;ignoreligatures&#39;</span><span class="p">:</span>	<span class="mh">0x0004</span><span class="p">,</span>
			<span class="s1">&#39;ignoremarks&#39;</span><span class="p">:</span>		<span class="mh">0x0008</span><span class="p">,</span>
			<span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
			<span class="k">assert</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
				<span class="n">flags</span> <span class="o">|=</span> <span class="n">flag</span>
			<span class="k">continue</span>
		<span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;markattachmenttype&#39;</span><span class="p">:</span>
			<span class="n">flags</span> <span class="o">|=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
			<span class="k">continue</span>
		<span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;markfiltertype&#39;</span><span class="p">:</span>
			<span class="n">flags</span> <span class="o">|=</span> <span class="mh">0x10</span>
			<span class="n">filterset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">flags</span><span class="p">,</span> <span class="n">filterset</span></div>

<div class="viewcode-block" id="parseSingleSubst"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseSingleSubst">[docs]</a><span class="k">def</span> <span class="nf">parseSingleSubst</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">makeGlyphs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildSingleSubstSubtable</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseMultiple"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseMultiple">[docs]</a><span class="k">def</span> <span class="nf">parseMultiple</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">makeGlyphs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildMultipleSubstSubtable</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseAlternate"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseAlternate">[docs]</a><span class="k">def</span> <span class="nf">parseAlternate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">makeGlyphs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildAlternateSubstSubtable</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseLigature"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseLigature">[docs]</a><span class="k">def</span> <span class="nf">parseLigature</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">makeGlyphs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="n">mapping</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildLigatureSubstSubtable</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseSinglePos"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseSinglePos">[docs]</a><span class="k">def</span> <span class="nf">parseSinglePos</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">line</span>
		<span class="n">w</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">assert</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">valueRecordFormatDict</span>
		<span class="n">g</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">g</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
			<span class="n">values</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">ValueRecord</span><span class="p">()</span>
		<span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">g</span><span class="p">],</span> <span class="n">w</span><span class="p">),</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">g</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildSinglePosSubtable</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">font</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">())</span></div>

<div class="viewcode-block" id="parsePair"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parsePair">[docs]</a><span class="k">def</span> <span class="nf">parsePair</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PairPos</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat2</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="n">line</span>
			<span class="n">side</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="k">assert</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">),</span> <span class="n">side</span>
			<span class="n">what</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">side</span><span class="p">):]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">mask</span> <span class="o">=</span> <span class="n">valueRecordFormatDict</span><span class="p">[</span><span class="n">what</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">glyph1</span><span class="p">,</span> <span class="n">glyph2</span> <span class="o">=</span> <span class="n">makeGlyphs</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">glyph1</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">glyph1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">glyph2</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="n">glyph1</span><span class="p">]:</span> <span class="n">values</span><span class="p">[</span><span class="n">glyph1</span><span class="p">][</span><span class="n">glyph2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ValueRecord</span><span class="p">(),</span><span class="n">ValueRecord</span><span class="p">())</span>
			<span class="n">rec2</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">glyph1</span><span class="p">][</span><span class="n">glyph2</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat1</span> <span class="o">|=</span> <span class="n">mask</span>
				<span class="n">vr</span> <span class="o">=</span> <span class="n">rec2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat2</span> <span class="o">|=</span> <span class="n">mask</span>
				<span class="n">vr</span> <span class="o">=</span> <span class="n">rec2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">what</span><span class="p">),</span> <span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">font</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">PairSet</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">glyph1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">:</span>
			<span class="n">values1</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">glyph1</span><span class="p">]</span>
			<span class="n">pairset</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PairSet</span><span class="p">()</span>
			<span class="n">records</span> <span class="o">=</span> <span class="n">pairset</span><span class="o">.</span><span class="n">PairValueRecord</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">glyph2</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values1</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">):</span>
				<span class="n">values2</span> <span class="o">=</span> <span class="n">values1</span><span class="p">[</span><span class="n">glyph2</span><span class="p">]</span>
				<span class="n">pair</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PairValueRecord</span><span class="p">()</span>
				<span class="n">pair</span><span class="o">.</span><span class="n">SecondGlyph</span> <span class="o">=</span> <span class="n">glyph2</span>
				<span class="n">pair</span><span class="o">.</span><span class="n">Value1</span> <span class="o">=</span> <span class="n">values2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">pair</span><span class="o">.</span><span class="n">Value2</span> <span class="o">=</span> <span class="n">values2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat2</span> <span class="k">else</span> <span class="kc">None</span>
				<span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
			<span class="n">pairset</span><span class="o">.</span><span class="n">PairValueCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairset</span><span class="o">.</span><span class="n">PairValueRecord</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">PairSet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pairset</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">PairSetCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PairSet</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">typ</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">classDefs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
		<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;class definition begin&quot;</span><span class="p">):</span>
			<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;class definition begin&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="n">idx</span><span class="p">,</span><span class="n">klass</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s1">&#39;first&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">ClassDef1</span><span class="p">),</span>
				<span class="s1">&#39;second&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">ClassDef2</span><span class="p">),</span>
			<span class="p">}[</span><span class="n">typ</span><span class="p">]</span>
			<span class="k">assert</span> <span class="n">classDefs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
			<span class="n">classDefs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">parseClassDef</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ClassDef1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ClassDef2</span> <span class="o">=</span> <span class="n">classDefs</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Class1Count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Class2Count</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">classDefs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Class1Record</span> <span class="o">=</span> <span class="p">[</span><span class="n">ot</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Class1Count</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">rec1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">:</span>
			<span class="n">rec1</span><span class="o">.</span><span class="n">Class2Record</span> <span class="o">=</span> <span class="p">[</span><span class="n">ot</span><span class="o">.</span><span class="n">Class2Record</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Class2Count</span><span class="p">)]</span>
			<span class="k">for</span> <span class="n">rec2</span> <span class="ow">in</span> <span class="n">rec1</span><span class="o">.</span><span class="n">Class2Record</span><span class="p">:</span>
				<span class="n">rec2</span><span class="o">.</span><span class="n">Value1</span> <span class="o">=</span> <span class="n">ValueRecord</span><span class="p">()</span>
				<span class="n">rec2</span><span class="o">.</span><span class="n">Value2</span> <span class="o">=</span> <span class="n">ValueRecord</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="n">line</span>
			<span class="n">side</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="k">assert</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">),</span> <span class="n">side</span>
			<span class="n">what</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">side</span><span class="p">):]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">mask</span> <span class="o">=</span> <span class="n">valueRecordFormatDict</span><span class="p">[</span><span class="n">what</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">class1</span><span class="p">,</span> <span class="n">class2</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
			<span class="n">rec2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">[</span><span class="n">class1</span><span class="p">]</span><span class="o">.</span><span class="n">Class2Record</span><span class="p">[</span><span class="n">class2</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat1</span> <span class="o">|=</span> <span class="n">mask</span>
				<span class="n">vr</span> <span class="o">=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">Value1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat2</span> <span class="o">|=</span> <span class="n">mask</span>
				<span class="n">vr</span> <span class="o">=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">Value2</span>
			<span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">what</span><span class="p">),</span> <span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">rec1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Class1Record</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">rec2</span> <span class="ow">in</span> <span class="n">rec1</span><span class="o">.</span><span class="n">Class2Record</span><span class="p">:</span>
				<span class="n">rec2</span><span class="o">.</span><span class="n">Value1</span> <span class="o">=</span> <span class="n">ValueRecord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat1</span><span class="p">,</span> <span class="n">rec2</span><span class="o">.</span><span class="n">Value1</span><span class="p">)</span>
				<span class="n">rec2</span><span class="o">.</span><span class="n">Value2</span> <span class="o">=</span> <span class="n">ValueRecord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat2</span><span class="p">,</span> <span class="n">rec2</span><span class="o">.</span><span class="n">Value2</span><span class="p">)</span> \
						<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ValueFormat2</span> <span class="k">else</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ClassDef1</span><span class="o">.</span><span class="n">classDefs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">font</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="n">typ</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseKernset"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseKernset">[docs]</a><span class="k">def</span> <span class="nf">parseKernset</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">):</span>
		<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">until</span><span class="p">((</span><span class="s2">&quot;firstclass definition begin&quot;</span><span class="p">,</span> <span class="s2">&quot;secondclass definition begin&quot;</span><span class="p">)):</span>
			<span class="k">return</span> <span class="n">parsePair</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">parsePair</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span></div>

<div class="viewcode-block" id="makeAnchor"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeAnchor">[docs]</a><span class="k">def</span> <span class="nf">makeAnchor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">Anchor</span><span class="p">):</span>
	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span>
	<span class="n">anchor</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
	<span class="n">anchor</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">anchor</span><span class="o">.</span><span class="n">XCoordinate</span><span class="p">,</span><span class="n">anchor</span><span class="o">.</span><span class="n">YCoordinate</span> <span class="o">=</span> <span class="n">intSplitComma</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
		<span class="n">anchor</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">anchor</span><span class="o">.</span><span class="n">AnchorPoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">anchor</span></div>

<div class="viewcode-block" id="parseCursive"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseCursive">[docs]</a><span class="k">def</span> <span class="nf">parseCursive</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">records</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span>
		<span class="n">idx</span><span class="p">,</span><span class="n">klass</span> <span class="o">=</span> <span class="p">{</span>
			<span class="s1">&#39;entry&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">EntryAnchor</span><span class="p">),</span>
			<span class="s1">&#39;exit&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">ExitAnchor</span><span class="p">),</span>
		<span class="p">}[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">glyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
			<span class="n">records</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
		<span class="k">assert</span> <span class="n">records</span><span class="p">[</span><span class="n">glyph</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">records</span><span class="p">[</span><span class="n">glyph</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeAnchor</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">klass</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildCursivePosSubtable</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">font</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">())</span></div>

<div class="viewcode-block" id="makeMarkRecords"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeMarkRecords">[docs]</a><span class="k">def</span> <span class="nf">makeMarkRecords</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
	<span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">:</span>
		<span class="n">klass</span><span class="p">,</span> <span class="n">anchor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span>
		<span class="n">record</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkRecordClass</span><span class="p">()</span>
		<span class="n">record</span><span class="o">.</span><span class="n">Class</span> <span class="o">=</span> <span class="n">klass</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkAnchor</span><span class="p">,</span> <span class="n">anchor</span><span class="p">)</span>
		<span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">records</span></div>

<div class="viewcode-block" id="makeBaseRecords"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeBaseRecords">[docs]</a><span class="k">def</span> <span class="nf">makeBaseRecords</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">classCount</span><span class="p">):</span>
	<span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">idx</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">:</span>
		<span class="n">idx</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
		<span class="n">record</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseRecordClass</span><span class="p">()</span>
		<span class="n">anchors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">classCount</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseAnchor</span><span class="p">,</span> <span class="n">anchors</span><span class="p">)</span>
		<span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span><span class="n">klass</span><span class="p">),</span><span class="n">anchor</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">record</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">glyph</span><span class="p">]]</span>
		<span class="n">anchors</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseAnchor</span><span class="p">)</span>
		<span class="k">assert</span> <span class="n">anchors</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span>
		<span class="n">anchors</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span> <span class="o">=</span> <span class="n">anchor</span>
	<span class="k">return</span> <span class="n">records</span></div>

<div class="viewcode-block" id="makeLigatureRecords"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeLigatureRecords">[docs]</a><span class="k">def</span> <span class="nf">makeLigatureRecords</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">classCount</span><span class="p">):</span>
	<span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)</span>
	<span class="n">idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span><span class="n">klass</span><span class="p">,</span><span class="n">compIdx</span><span class="p">,</span><span class="n">compCount</span><span class="p">),</span><span class="n">anchor</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">record</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">glyph</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">record</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">glyph</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LigatureAttach</span><span class="p">()</span>
			<span class="n">record</span><span class="o">.</span><span class="n">ComponentCount</span> <span class="o">=</span> <span class="n">compCount</span>
			<span class="n">record</span><span class="o">.</span><span class="n">ComponentRecord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ot</span><span class="o">.</span><span class="n">ComponentRecord</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">compCount</span><span class="p">)]</span>
			<span class="k">for</span> <span class="n">compRec</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">ComponentRecord</span><span class="p">:</span>
				<span class="n">compRec</span><span class="o">.</span><span class="n">LigatureAnchor</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">classCount</span>
		<span class="k">assert</span> <span class="n">record</span><span class="o">.</span><span class="n">ComponentCount</span> <span class="o">==</span> <span class="n">compCount</span><span class="p">,</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">ComponentCount</span><span class="p">,</span> <span class="n">compCount</span><span class="p">)</span>

		<span class="n">anchors</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">ComponentRecord</span><span class="p">[</span><span class="n">compIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">LigatureAnchor</span>
		<span class="k">assert</span> <span class="n">anchors</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="n">compIdx</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span>
		<span class="n">anchors</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span> <span class="o">=</span> <span class="n">anchor</span>
	<span class="k">return</span> <span class="n">records</span></div>

<div class="viewcode-block" id="parseMarkToSomething"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseMarkToSomething">[docs]</a><span class="k">def</span> <span class="nf">parseMarkToSomething</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Type</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">markData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">baseData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">Data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;mark&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="n">markData</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkAnchorClass</span><span class="p">),</span>
		<span class="s1">&#39;base&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="n">baseData</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseAnchorClass</span><span class="p">),</span>
		<span class="s1">&#39;ligature&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="n">baseData</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseAnchorClass</span><span class="p">),</span>
	<span class="p">}</span>
	<span class="n">maxKlass</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="n">typ</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">assert</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;mark&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;ligature&#39;</span><span class="p">)</span>
		<span class="n">glyph</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">data</span><span class="p">,</span> <span class="n">anchorClass</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
		<span class="n">extraItems</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;ligature&#39;</span> <span class="k">else</span> <span class="mi">0</span>
		<span class="n">extras</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="o">+</span><span class="n">extraItems</span><span class="p">])</span>
		<span class="n">klass</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="n">extraItems</span><span class="p">])</span>
		<span class="n">anchor</span> <span class="o">=</span> <span class="n">makeAnchor</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="n">extraItems</span><span class="p">:],</span> <span class="n">anchorClass</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;mark&#39;</span><span class="p">:</span>
			<span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">glyph</span><span class="p">,(</span><span class="n">klass</span><span class="p">,</span><span class="n">anchor</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="p">((</span><span class="n">glyph</span><span class="p">,</span><span class="n">klass</span><span class="p">)</span><span class="o">+</span><span class="n">extras</span><span class="p">),</span><span class="n">anchor</span>
		<span class="k">assert</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">,</span> <span class="n">key</span>
		<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="n">maxKlass</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxKlass</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span>

	<span class="c1"># Mark</span>
	<span class="n">markCoverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">markData</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkCoverageClass</span><span class="p">)</span>
	<span class="n">markArray</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkArrayClass</span><span class="p">()</span>
	<span class="n">markRecords</span> <span class="o">=</span> <span class="n">makeMarkRecords</span><span class="p">(</span><span class="n">markData</span><span class="p">,</span> <span class="n">markCoverage</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="n">markArray</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkRecord</span><span class="p">,</span> <span class="n">markRecords</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="n">markArray</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkCount</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">markRecords</span><span class="p">))</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkCoverage</span><span class="p">,</span> <span class="n">markCoverage</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MarkArray</span><span class="p">,</span> <span class="n">markArray</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">ClassCount</span> <span class="o">=</span> <span class="n">maxKlass</span> <span class="o">+</span> <span class="mi">1</span>

	<span class="c1"># Base</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">classCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">baseData</span> <span class="k">else</span> <span class="mi">1</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">baseData</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
	<span class="n">baseCoverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">baseData</span><span class="o">.</span><span class="n">keys</span><span class="p">()]),</span> <span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseCoverageClass</span><span class="p">)</span>
	<span class="n">baseArray</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseArrayClass</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Base</span> <span class="o">==</span> <span class="s1">&#39;Ligature&#39;</span><span class="p">:</span>
		<span class="n">baseRecords</span> <span class="o">=</span> <span class="n">makeLigatureRecords</span><span class="p">(</span><span class="n">baseData</span><span class="p">,</span> <span class="n">baseCoverage</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classCount</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">baseRecords</span> <span class="o">=</span> <span class="n">makeBaseRecords</span><span class="p">(</span><span class="n">baseData</span><span class="p">,</span> <span class="n">baseCoverage</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classCount</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="n">baseArray</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseRecord</span><span class="p">,</span> <span class="n">baseRecords</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="n">baseArray</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseCount</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseRecords</span><span class="p">))</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseCoverage</span><span class="p">,</span> <span class="n">baseCoverage</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">BaseArray</span><span class="p">,</span> <span class="n">baseArray</span><span class="p">)</span>

	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="MarkHelper"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.MarkHelper">[docs]</a><span class="k">class</span> <span class="nc">MarkHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">Which</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;Base&#39;</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">What</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;Array&#39;</span><span class="p">,</span> <span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="s1">&#39;Record&#39;</span><span class="p">,</span> <span class="s1">&#39;Anchor&#39;</span><span class="p">):</span>
				<span class="n">key</span> <span class="o">=</span> <span class="n">Which</span> <span class="o">+</span> <span class="n">What</span>
				<span class="k">if</span> <span class="n">Which</span> <span class="o">==</span> <span class="s1">&#39;Mark&#39;</span> <span class="ow">and</span> <span class="n">What</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="s1">&#39;Record&#39;</span><span class="p">,</span> <span class="s1">&#39;Anchor&#39;</span><span class="p">):</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">key</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Which</span><span class="p">)</span> <span class="o">+</span> <span class="n">What</span>
				<span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;LigatureRecord&#39;</span><span class="p">:</span>
					<span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;LigatureAttach&#39;</span>
				<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">What</span> <span class="o">!=</span> <span class="s1">&#39;Count&#39;</span><span class="p">:</span>
					<span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ot</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
					<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">+</span><span class="s1">&#39;Class&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkToBaseHelper"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.MarkToBaseHelper">[docs]</a><span class="k">class</span> <span class="nc">MarkToBaseHelper</span><span class="p">(</span><span class="n">MarkHelper</span><span class="p">):</span>
	<span class="n">Mark</span> <span class="o">=</span> <span class="s1">&#39;Mark&#39;</span>
	<span class="n">Base</span> <span class="o">=</span> <span class="s1">&#39;Base&#39;</span>
	<span class="n">Type</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MarkBasePos</span></div>
<div class="viewcode-block" id="MarkToMarkHelper"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.MarkToMarkHelper">[docs]</a><span class="k">class</span> <span class="nc">MarkToMarkHelper</span><span class="p">(</span><span class="n">MarkHelper</span><span class="p">):</span>
	<span class="n">Mark</span> <span class="o">=</span> <span class="s1">&#39;Mark1&#39;</span>
	<span class="n">Base</span> <span class="o">=</span> <span class="s1">&#39;Mark2&#39;</span>
	<span class="n">Type</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MarkMarkPos</span></div>
<div class="viewcode-block" id="MarkToLigatureHelper"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.MarkToLigatureHelper">[docs]</a><span class="k">class</span> <span class="nc">MarkToLigatureHelper</span><span class="p">(</span><span class="n">MarkHelper</span><span class="p">):</span>
	<span class="n">Mark</span> <span class="o">=</span> <span class="s1">&#39;Mark&#39;</span>
	<span class="n">Base</span> <span class="o">=</span> <span class="s1">&#39;Ligature&#39;</span>
	<span class="n">Type</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MarkLigPos</span></div>

<div class="viewcode-block" id="parseMarkToBase"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseMarkToBase">[docs]</a><span class="k">def</span> <span class="nf">parseMarkToBase</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseMarkToSomething</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">MarkToBaseHelper</span><span class="p">())</span></div>
<div class="viewcode-block" id="parseMarkToMark"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseMarkToMark">[docs]</a><span class="k">def</span> <span class="nf">parseMarkToMark</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseMarkToSomething</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">MarkToMarkHelper</span><span class="p">())</span></div>
<div class="viewcode-block" id="parseMarkToLigature"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseMarkToLigature">[docs]</a><span class="k">def</span> <span class="nf">parseMarkToLigature</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseMarkToSomething</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">MarkToLigatureHelper</span><span class="p">())</span></div>

<div class="viewcode-block" id="stripSplitComma"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.stripSplitComma">[docs]</a><span class="k">def</span> <span class="nf">stripSplitComma</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">line</span> <span class="k">else</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="intSplitComma"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.intSplitComma">[docs]</a><span class="k">def</span> <span class="nf">intSplitComma</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">line</span> <span class="k">else</span> <span class="p">[]</span></div>

<span class="c1"># Copied from fontTools.subset</span>
<div class="viewcode-block" id="ContextHelper"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.ContextHelper">[docs]</a><span class="k">class</span> <span class="nc">ContextHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klassName</span><span class="p">,</span> <span class="n">Format</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">klassName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Subst&#39;</span><span class="p">):</span>
			<span class="n">Typ</span> <span class="o">=</span> <span class="s1">&#39;Sub&#39;</span>
			<span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;Subst&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">Typ</span> <span class="o">=</span> <span class="s1">&#39;Pos&#39;</span>
			<span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;Pos&#39;</span>
		<span class="k">if</span> <span class="n">klassName</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Chain&#39;</span><span class="p">):</span>
			<span class="n">Chain</span> <span class="o">=</span> <span class="s1">&#39;Chain&#39;</span>
			<span class="n">InputIdx</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="n">DataLen</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">Chain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
			<span class="n">InputIdx</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">DataLen</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">ChainTyp</span> <span class="o">=</span> <span class="n">Chain</span><span class="o">+</span><span class="n">Typ</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">Typ</span> <span class="o">=</span> <span class="n">Typ</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Chain</span> <span class="o">=</span> <span class="n">Chain</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ChainTyp</span> <span class="o">=</span> <span class="n">ChainTyp</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">InputIdx</span> <span class="o">=</span> <span class="n">InputIdx</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DataLen</span> <span class="o">=</span> <span class="n">DataLen</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">LookupRecord</span> <span class="o">=</span> <span class="n">Type</span><span class="o">+</span><span class="s1">&#39;LookupRecord&#39;</span>

		<span class="k">if</span> <span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">Coverage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">Coverage</span>
			<span class="n">ChainCoverage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">Coverage</span>
			<span class="n">ContextData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="kc">None</span><span class="p">,)</span>
			<span class="n">ChainContextData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
			<span class="n">SetContextData</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">SetChainContextData</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">RuleData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">Input</span><span class="p">,)</span>
			<span class="n">ChainRuleData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">Backtrack</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">LookAhead</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">SetRuleData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Input</span><span class="p">,)</span> <span class="o">=</span> <span class="n">d</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">GlyphCount</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">ChainSetRuleData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Backtrack</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">LookAhead</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackGlyphCount</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">InputGlyphCount</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">LookAheadGlyphCount</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
		<span class="k">elif</span> <span class="n">Format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">Coverage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">Coverage</span>
			<span class="n">ChainCoverage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">Coverage</span>
			<span class="n">ContextData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">,)</span>
			<span class="n">ChainContextData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackClassDef</span><span class="p">,</span>
						     <span class="n">r</span><span class="o">.</span><span class="n">InputClassDef</span><span class="p">,</span>
						     <span class="n">r</span><span class="o">.</span><span class="n">LookAheadClassDef</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">SetContextData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">,)</span> <span class="o">=</span> <span class="n">d</span>
			<span class="k">def</span> <span class="nf">SetChainContextData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackClassDef</span><span class="p">,</span>
				 <span class="n">r</span><span class="o">.</span><span class="n">InputClassDef</span><span class="p">,</span>
				 <span class="n">r</span><span class="o">.</span><span class="n">LookAheadClassDef</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
			<span class="n">RuleData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">Class</span><span class="p">,)</span>
			<span class="n">ChainRuleData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">Backtrack</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">LookAhead</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">SetRuleData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Class</span><span class="p">,)</span> <span class="o">=</span> <span class="n">d</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">GlyphCount</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">ChainSetRuleData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Backtrack</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">LookAhead</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackGlyphCount</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">InputGlyphCount</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">LookAheadGlyphCount</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
		<span class="k">elif</span> <span class="n">Format</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">Coverage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">Coverage</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">ChainCoverage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">InputCoverage</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">ContextData</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">ChainContextData</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">SetContextData</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">SetChainContextData</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">RuleData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">Coverage</span>
			<span class="n">ChainRuleData</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackCoverage</span> <span class="o">+</span>
						  <span class="n">r</span><span class="o">.</span><span class="n">InputCoverage</span> <span class="o">+</span>
						  <span class="n">r</span><span class="o">.</span><span class="n">LookAheadCoverage</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">SetRuleData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Coverage</span><span class="p">,)</span> <span class="o">=</span> <span class="n">d</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">GlyphCount</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">ChainSetRuleData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackCoverage</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">InputCoverage</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">LookAheadCoverage</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
				<span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">BacktrackGlyphCount</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">InputGlyphCount</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">LookAheadGlyphCount</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unknown format: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Format</span>

		<span class="k">if</span> <span class="n">Chain</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">ChainCoverage</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ContextData</span> <span class="o">=</span> <span class="n">ChainContextData</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">SetContextData</span> <span class="o">=</span> <span class="n">SetChainContextData</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleData</span> <span class="o">=</span> <span class="n">ChainRuleData</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">SetRuleData</span> <span class="o">=</span> <span class="n">ChainSetRuleData</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">Coverage</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ContextData</span> <span class="o">=</span> <span class="n">ContextData</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">SetContextData</span> <span class="o">=</span> <span class="n">SetContextData</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleData</span> <span class="o">=</span> <span class="n">RuleData</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">SetRuleData</span> <span class="o">=</span> <span class="n">SetRuleData</span>

		<span class="k">if</span> <span class="n">Format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Rule</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;Rule&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleCount</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;RuleCount&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleSet</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;RuleSet&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleSetCount</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;RuleSetCount&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Intersect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">glyphs</span> <span class="k">else</span> <span class="p">[]</span>
		<span class="k">elif</span> <span class="n">Format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Rule</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;ClassRule&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleCount</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;ClassRuleCount&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleSet</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;ClassSet&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">RuleSetCount</span> <span class="o">=</span> <span class="n">ChainTyp</span><span class="o">+</span><span class="s1">&#39;ClassSetCount&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Intersect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">intersect_class</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span>
							       <span class="k">else</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()))</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">ClassDef</span> <span class="o">=</span> <span class="s1">&#39;InputClassDef&#39;</span> <span class="k">if</span> <span class="n">Chain</span> <span class="k">else</span> <span class="s1">&#39;ClassDef&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ClassDefIndex</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">Chain</span> <span class="k">else</span> <span class="mi">0</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Input</span> <span class="o">=</span> <span class="s1">&#39;Input&#39;</span> <span class="k">if</span> <span class="n">Chain</span> <span class="k">else</span> <span class="s1">&#39;Class&#39;</span></div>

<div class="viewcode-block" id="parseLookupRecords"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseLookupRecords">[docs]</a><span class="k">def</span> <span class="nf">parseLookupRecords</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">klassName</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ot</span><span class="p">,</span> <span class="n">klassName</span><span class="p">)</span>
	<span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
		<span class="n">rec</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">stripSplitComma</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">assert</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span>
		<span class="n">rec</span><span class="o">.</span><span class="n">SequenceIndex</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span>
		<span class="n">setReference</span><span class="p">(</span><span class="n">mapLookup</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="s1">&#39;LookupListIndex&#39;</span><span class="p">)</span>
		<span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">lst</span></div>

<div class="viewcode-block" id="makeClassDef"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeClassDef">[docs]</a><span class="k">def</span> <span class="nf">makeClassDef</span><span class="p">(</span><span class="n">classDefs</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">Coverage</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">classDefs</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">classDefs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">classDefs</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseClassDef"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseClassDef">[docs]</a><span class="k">def</span> <span class="nf">parseClassDef</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">):</span>
	<span class="n">classDefs</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;class definition&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">assert</span> <span class="n">glyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="p">,</span> <span class="n">glyph</span>
			<span class="n">classDefs</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">makeClassDef</span><span class="p">(</span><span class="n">classDefs</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span></div>

<div class="viewcode-block" id="makeCoverage"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeCoverage">[docs]</a><span class="k">def</span> <span class="nf">makeCoverage</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">Coverage</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">glyphs</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
		<span class="n">glyphs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glyphs</span><span class="p">)</span>
	<span class="n">coverage</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
	<span class="n">coverage</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">glyphs</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">font</span><span class="o">.</span><span class="n">getGlyphID</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">coverage</span></div>

<div class="viewcode-block" id="parseCoverage"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseCoverage">[docs]</a><span class="k">def</span> <span class="nf">parseCoverage</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">Coverage</span><span class="p">):</span>
	<span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;coverage definition&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
	<span class="k">return</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="n">glyphs</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span></div>

<div class="viewcode-block" id="bucketizeRules"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.bucketizeRules">[docs]</a><span class="k">def</span> <span class="nf">bucketizeRules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="n">bucketKeys</span><span class="p">):</span>
	<span class="n">buckets</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">seq</span><span class="p">,</span><span class="n">recs</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
		<span class="n">buckets</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">InputIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">c</span><span class="o">.</span><span class="n">InputIdx</span> <span class="k">else</span> <span class="mi">0</span><span class="p">:]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">)),</span> <span class="n">recs</span><span class="p">))</span>

	<span class="n">rulesets</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">firstGlyph</span> <span class="ow">in</span> <span class="n">bucketKeys</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">firstGlyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">:</span>
			<span class="n">rulesets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="n">thisRules</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">seq</span><span class="p">,</span><span class="n">recs</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">[</span><span class="n">firstGlyph</span><span class="p">]:</span>
			<span class="n">rule</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ot</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Rule</span><span class="p">)()</span>
			<span class="n">c</span><span class="o">.</span><span class="n">SetRuleData</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Type</span><span class="o">+</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">recs</span><span class="p">))</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">LookupRecord</span><span class="p">,</span> <span class="n">recs</span><span class="p">)</span>
			<span class="n">thisRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

		<span class="n">ruleset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ot</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">RuleSet</span><span class="p">)()</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">ruleset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Rule</span><span class="p">,</span> <span class="n">thisRules</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">ruleset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">RuleCount</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisRules</span><span class="p">))</span>
		<span class="n">rulesets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ruleset</span><span class="p">)</span>

	<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">RuleSet</span><span class="p">,</span> <span class="n">rulesets</span><span class="p">)</span>
	<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">RuleSetCount</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rulesets</span><span class="p">))</span></div>

<div class="viewcode-block" id="parseContext"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseContext">[docs]</a><span class="k">def</span> <span class="nf">parseContext</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ot</span><span class="p">,</span> <span class="n">Type</span><span class="p">)()</span>
	<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;glyph&#39;</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing </span><span class="si">%s</span><span class="s2"> format </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">ContextHelper</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">assert</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;glyph&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">seq</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">makeGlyphs</span><span class="p">(</span><span class="n">stripSplitComma</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">])</span>
			<span class="n">recs</span> <span class="o">=</span> <span class="n">parseLookupRecords</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">:],</span> <span class="n">c</span><span class="o">.</span><span class="n">LookupRecord</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">)</span>
			<span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seq</span><span class="p">,</span> <span class="n">recs</span><span class="p">))</span>

		<span class="n">firstGlyphs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">InputIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">seq</span><span class="p">,</span><span class="n">recs</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="n">firstGlyphs</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
		<span class="n">bucketizeRules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">typ</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing </span><span class="si">%s</span><span class="s2"> format </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">ContextHelper</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="n">classDefs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">DataLen</span>
		<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;class definition begin&quot;</span><span class="p">):</span>
			<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;class definition begin&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="n">idx</span><span class="p">,</span><span class="n">klass</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
				<span class="s1">&#39;&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">),</span>
			<span class="p">},</span>
			<span class="mi">3</span><span class="p">:</span> <span class="p">{</span>
				<span class="s1">&#39;backtrack&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">BacktrackClassDef</span><span class="p">),</span>
				<span class="s1">&#39;&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">InputClassDef</span><span class="p">),</span>
				<span class="s1">&#39;lookahead&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">LookAheadClassDef</span><span class="p">),</span>
			<span class="p">},</span>
			<span class="p">}[</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">][</span><span class="n">typ</span><span class="p">]</span>
			<span class="k">assert</span> <span class="n">classDefs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">idx</span>
			<span class="n">classDefs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">parseClassDef</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">)</span>
		<span class="n">c</span><span class="o">.</span><span class="n">SetContextData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classDefs</span><span class="p">)</span>
		<span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">assert</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">),</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">seq</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">intSplitComma</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">])</span>
			<span class="n">recs</span> <span class="o">=</span> <span class="n">parseLookupRecords</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">:],</span> <span class="n">c</span><span class="o">.</span><span class="n">LookupRecord</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">)</span>
			<span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seq</span><span class="p">,</span> <span class="n">recs</span><span class="p">))</span>
		<span class="n">firstClasses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">InputIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">seq</span><span class="p">,</span><span class="n">recs</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">)</span>
		<span class="n">firstGlyphs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">classDefs</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">InputIdx</span><span class="p">]</span><span class="o">.</span><span class="n">classDefs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">firstClasses</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="n">firstGlyphs</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
		<span class="n">bucketizeRules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">firstClasses</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
	<span class="k">elif</span> <span class="n">typ</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing </span><span class="si">%s</span><span class="s2"> format </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">ContextHelper</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
		<span class="n">coverages</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">))</span>
		<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;coverage definition begin&quot;</span><span class="p">):</span>
			<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;coverage definition begin&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
			<span class="n">idx</span><span class="p">,</span><span class="n">klass</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
				<span class="s1">&#39;&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">Coverage</span><span class="p">),</span>
			<span class="p">},</span>
			<span class="mi">3</span><span class="p">:</span> <span class="p">{</span>
				<span class="s1">&#39;backtrack&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">BacktrackCoverage</span><span class="p">),</span>
				<span class="s1">&#39;input&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">InputCoverage</span><span class="p">),</span>
				<span class="s1">&#39;lookahead&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">LookAheadCoverage</span><span class="p">),</span>
			<span class="p">},</span>
			<span class="p">}[</span><span class="n">c</span><span class="o">.</span><span class="n">DataLen</span><span class="p">][</span><span class="n">typ</span><span class="p">]</span>
			<span class="n">coverages</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parseCoverage</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">))</span>
		<span class="n">c</span><span class="o">.</span><span class="n">SetRuleData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coverages</span><span class="p">)</span>
		<span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">assert</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;coverage&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">recs</span> <span class="o">=</span> <span class="n">parseLookupRecords</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">c</span><span class="o">.</span><span class="n">LookupRecord</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Type</span><span class="o">+</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">recs</span><span class="p">))</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">LookupRecord</span><span class="p">,</span> <span class="n">recs</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="n">typ</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseContextSubst"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseContextSubst">[docs]</a><span class="k">def</span> <span class="nf">parseContextSubst</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseContext</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="s2">&quot;ContextSubst&quot;</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="n">lookupMap</span><span class="p">)</span></div>
<div class="viewcode-block" id="parseContextPos"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseContextPos">[docs]</a><span class="k">def</span> <span class="nf">parseContextPos</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseContext</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="s2">&quot;ContextPos&quot;</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="n">lookupMap</span><span class="p">)</span></div>
<div class="viewcode-block" id="parseChainedSubst"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseChainedSubst">[docs]</a><span class="k">def</span> <span class="nf">parseChainedSubst</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseContext</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="s2">&quot;ChainContextSubst&quot;</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="n">lookupMap</span><span class="p">)</span></div>
<div class="viewcode-block" id="parseChainedPos"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseChainedPos">[docs]</a><span class="k">def</span> <span class="nf">parseChainedPos</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseContext</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="s2">&quot;ChainContextPos&quot;</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="n">lookupMap</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseReverseChainedSubst"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseReverseChainedSubst">[docs]</a><span class="k">def</span> <span class="nf">parseReverseChainedSubst</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">_lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ReverseChainSingleSubst</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Format</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">coverages</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[])</span>
	<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;coverage definition begin&quot;</span><span class="p">):</span>
		<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;coverage definition begin&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="n">idx</span><span class="p">,</span><span class="n">klass</span> <span class="o">=</span> <span class="p">{</span>
			<span class="s1">&#39;backtrack&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">BacktrackCoverage</span><span class="p">),</span>
			<span class="s1">&#39;lookahead&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ot</span><span class="o">.</span><span class="n">LookAheadCoverage</span><span class="p">),</span>
		<span class="p">}[</span><span class="n">typ</span><span class="p">]</span>
		<span class="n">coverages</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parseCoverage</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">))</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">BacktrackCoverage</span> <span class="o">=</span> <span class="n">coverages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">BacktrackGlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BacktrackCoverage</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">LookAheadCoverage</span> <span class="o">=</span> <span class="n">coverages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">LookAheadGlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LookAheadCoverage</span><span class="p">)</span>
	<span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">makeGlyphs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="n">mapping</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">font</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Substitute</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span><span class="o">.</span><span class="n">glyphs</span><span class="p">]</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">GlyphCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Substitute</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseLookup"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseLookup">[docs]</a><span class="k">def</span> <span class="nf">parseLookup</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">tableTag</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;lookup&#39;</span><span class="p">)</span>
	<span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="n">line</span>
	<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing lookup type </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
	<span class="n">lookup</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Lookup</span><span class="p">()</span>
	<span class="n">lookup</span><span class="o">.</span><span class="n">LookupFlag</span><span class="p">,</span><span class="n">filterset</span> <span class="o">=</span> <span class="n">parseLookupFlags</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">filterset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">lookup</span><span class="o">.</span><span class="n">MarkFilteringSet</span> <span class="o">=</span> <span class="n">filterset</span>
	<span class="n">lookup</span><span class="o">.</span><span class="n">LookupType</span><span class="p">,</span> <span class="n">parseLookupSubTable</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;GSUB&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;single&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="n">parseSingleSubst</span><span class="p">),</span>
			<span class="s1">&#39;multiple&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="n">parseMultiple</span><span class="p">),</span>
			<span class="s1">&#39;alternate&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">3</span><span class="p">,</span>	<span class="n">parseAlternate</span><span class="p">),</span>
			<span class="s1">&#39;ligature&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">4</span><span class="p">,</span>	<span class="n">parseLigature</span><span class="p">),</span>
			<span class="s1">&#39;context&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">5</span><span class="p">,</span>	<span class="n">parseContextSubst</span><span class="p">),</span>
			<span class="s1">&#39;chained&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">6</span><span class="p">,</span>	<span class="n">parseChainedSubst</span><span class="p">),</span>
			<span class="s1">&#39;reversechained&#39;</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span>	<span class="n">parseReverseChainedSubst</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="s1">&#39;GPOS&#39;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s1">&#39;single&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="n">parseSinglePos</span><span class="p">),</span>
			<span class="s1">&#39;pair&#39;</span><span class="p">:</span>		<span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="n">parsePair</span><span class="p">),</span>
			<span class="s1">&#39;kernset&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="n">parseKernset</span><span class="p">),</span>
			<span class="s1">&#39;cursive&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">3</span><span class="p">,</span>	<span class="n">parseCursive</span><span class="p">),</span>
			<span class="s1">&#39;mark to base&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">4</span><span class="p">,</span>	<span class="n">parseMarkToBase</span><span class="p">),</span>
			<span class="s1">&#39;mark to ligature&#39;</span><span class="p">:(</span><span class="mi">5</span><span class="p">,</span>	<span class="n">parseMarkToLigature</span><span class="p">),</span>
			<span class="s1">&#39;mark to mark&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">6</span><span class="p">,</span>	<span class="n">parseMarkToMark</span><span class="p">),</span>
			<span class="s1">&#39;context&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">7</span><span class="p">,</span>	<span class="n">parseContextPos</span><span class="p">),</span>
			<span class="s1">&#39;chained&#39;</span><span class="p">:</span>	<span class="p">(</span><span class="mi">8</span><span class="p">,</span>	<span class="n">parseChainedPos</span><span class="p">),</span>
		<span class="p">},</span>
	<span class="p">}[</span><span class="n">tableTag</span><span class="p">][</span><span class="n">typ</span><span class="p">]</span>

	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="s1">&#39;lookup end&#39;</span><span class="p">):</span>
		<span class="n">subtables</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">():</span>
			<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">until</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">ubtable&#39;</span><span class="p">,</span> <span class="s1">&#39;subtable end&#39;</span><span class="p">)):</span>
				<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">():</span>
					<span class="n">subtable</span> <span class="o">=</span> <span class="n">parseLookupSubTable</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">)</span>
					<span class="k">assert</span> <span class="n">lookup</span><span class="o">.</span><span class="n">LookupType</span> <span class="o">==</span> <span class="n">subtable</span><span class="o">.</span><span class="n">LookupType</span>
					<span class="n">subtables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subtable</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">ubtable&#39;</span><span class="p">,</span> <span class="s1">&#39;subtable end&#39;</span><span class="p">):</span>
				<span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
	<span class="n">lines</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;lookup end&#39;</span><span class="p">)</span>

	<span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span> <span class="o">=</span> <span class="n">subtables</span>
	<span class="n">lookup</span><span class="o">.</span><span class="n">SubTableCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">SubTable</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">lookup</span><span class="o">.</span><span class="n">SubTableCount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="c1"># Remove this return when following is fixed:</span>
		<span class="c1"># https://github.com/fonttools/fonttools/issues/789</span>
		<span class="k">return</span> <span class="kc">None</span>
	<span class="k">return</span> <span class="n">lookup</span></div>

<div class="viewcode-block" id="parseGSUBGPOS"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseGSUBGPOS">[docs]</a><span class="k">def</span> <span class="nf">parseGSUBGPOS</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">tableTag</span><span class="p">):</span>
	<span class="n">container</span> <span class="o">=</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">getTableClass</span><span class="p">(</span><span class="n">tableTag</span><span class="p">)()</span>
	<span class="n">lookupMap</span> <span class="o">=</span> <span class="n">DeferredMapping</span><span class="p">()</span>
	<span class="n">featureMap</span> <span class="o">=</span> <span class="n">DeferredMapping</span><span class="p">()</span>
	<span class="k">assert</span> <span class="n">tableTag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GSUB&#39;</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">)</span>
	<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tableTag</span><span class="p">)</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ot</span><span class="p">,</span> <span class="n">tableTag</span><span class="p">)()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="mh">0x00010000</span>
	<span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;script table begin&#39;</span><span class="p">:</span>
		<span class="p">(</span><span class="s1">&#39;ScriptList&#39;</span><span class="p">,</span>
		 <span class="k">lambda</span> <span class="n">lines</span><span class="p">:</span> <span class="n">parseScriptList</span> <span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">featureMap</span><span class="p">)),</span>
		<span class="s1">&#39;feature table begin&#39;</span><span class="p">:</span>
		<span class="p">(</span><span class="s1">&#39;FeatureList&#39;</span><span class="p">,</span>
		 <span class="k">lambda</span> <span class="n">lines</span><span class="p">:</span> <span class="n">parseFeatureList</span> <span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">,</span> <span class="n">featureMap</span><span class="p">)),</span>
		<span class="s1">&#39;lookup&#39;</span><span class="p">:</span>
		<span class="p">(</span><span class="s1">&#39;LookupList&#39;</span><span class="p">,</span>
		 <span class="kc">None</span><span class="p">),</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span><span class="n">parser</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
	<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Skipping </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">())</span>
			<span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="n">attr</span><span class="p">,</span><span class="n">parser</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;lookup&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LookupList</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
			<span class="n">lookup</span> <span class="o">=</span> <span class="n">parseLookup</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">tableTag</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">lookupMap</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">lookupMap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lookupMap</span><span class="p">,</span> <span class="s2">&quot;Duplicate lookup name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span>
				<span class="n">lookupMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lookup</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attr</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">parser</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">LookupCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LookupList</span><span class="o">.</span><span class="n">Lookup</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">lookupMap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">lookupMap</span><span class="o">.</span><span class="n">applyDeferredMappings</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">featureMap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">featureMap</span><span class="o">.</span><span class="n">applyDeferredMappings</span><span class="p">()</span>
	<span class="n">container</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span>
	<span class="k">return</span> <span class="n">container</span></div>

<div class="viewcode-block" id="parseGSUB"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseGSUB">[docs]</a><span class="k">def</span> <span class="nf">parseGSUB</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseGSUBGPOS</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="s1">&#39;GSUB&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="parseGPOS"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseGPOS">[docs]</a><span class="k">def</span> <span class="nf">parseGPOS</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">parseGSUBGPOS</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="s1">&#39;GPOS&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseAttachList"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseAttachList">[docs]</a><span class="k">def</span> <span class="nf">parseAttachList</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="n">points</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;attachment list&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">assert</span> <span class="n">glyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">points</span><span class="p">,</span> <span class="n">glyph</span>
			<span class="n">points</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildAttachList</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">font</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">())</span></div>

<div class="viewcode-block" id="parseCaretList"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseCaretList">[docs]</a><span class="k">def</span> <span class="nf">parseCaretList</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="n">carets</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;carets&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">assert</span> <span class="n">glyph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">carets</span><span class="p">,</span> <span class="n">glyph</span>
			<span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">thisCarets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
			<span class="k">assert</span> <span class="n">num</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisCarets</span><span class="p">),</span> <span class="n">line</span>
			<span class="n">carets</span><span class="p">[</span><span class="n">glyph</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisCarets</span>
	<span class="k">return</span> <span class="n">otl</span><span class="o">.</span><span class="n">buildLigCaretList</span><span class="p">(</span><span class="n">carets</span><span class="p">,</span> <span class="p">{},</span> <span class="n">font</span><span class="o">.</span><span class="n">getReverseGlyphMap</span><span class="p">())</span></div>

<div class="viewcode-block" id="makeMarkFilteringSets"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.makeMarkFilteringSets">[docs]</a><span class="k">def</span> <span class="nf">makeMarkFilteringSets</span><span class="p">(</span><span class="n">sets</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MarkGlyphSetsDef</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">MarkSetTableFormat</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">MarkSetCount</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkSetCount</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Coverage</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeCoverage</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">font</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="parseMarkFilteringSets"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseMarkFilteringSets">[docs]</a><span class="k">def</span> <span class="nf">parseMarkFilteringSets</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">with</span> <span class="n">lines</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="s1">&#39;set definition&#39;</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line</span>
			<span class="n">glyph</span> <span class="o">=</span> <span class="n">makeGlyph</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="c1"># TODO accept set names</span>
			<span class="n">st</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">st</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
				<span class="n">sets</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">sets</span><span class="p">[</span><span class="n">st</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">makeMarkFilteringSets</span><span class="p">(</span><span class="n">sets</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span></div>

<div class="viewcode-block" id="parseGDEF"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseGDEF">[docs]</a><span class="k">def</span> <span class="nf">parseGDEF</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="n">container</span> <span class="o">=</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">getTableClass</span><span class="p">(</span><span class="s1">&#39;GDEF&#39;</span><span class="p">)()</span>
	<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing GDEF&quot;</span><span class="p">)</span>
	<span class="bp">self</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GDEF</span><span class="p">()</span>
	<span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;class definition begin&#39;</span><span class="p">:</span>
			<span class="p">(</span><span class="s1">&#39;GlyphClassDef&#39;</span><span class="p">,</span>
			 <span class="k">lambda</span> <span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">:</span> <span class="n">parseClassDef</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">GlyphClassDef</span><span class="p">)),</span>
		<span class="s1">&#39;attachment list begin&#39;</span><span class="p">:</span>
			<span class="p">(</span><span class="s1">&#39;AttachList&#39;</span><span class="p">,</span> <span class="n">parseAttachList</span><span class="p">),</span>
		<span class="s1">&#39;carets begin&#39;</span><span class="p">:</span>
			<span class="p">(</span><span class="s1">&#39;LigCaretList&#39;</span><span class="p">,</span> <span class="n">parseCaretList</span><span class="p">),</span>
		<span class="s1">&#39;mark attachment class definition begin&#39;</span><span class="p">:</span>
			<span class="p">(</span><span class="s1">&#39;MarkAttachClassDef&#39;</span><span class="p">,</span>
			 <span class="k">lambda</span> <span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">:</span> <span class="n">parseClassDef</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">ot</span><span class="o">.</span><span class="n">MarkAttachClassDef</span><span class="p">)),</span>
		<span class="s1">&#39;markfilter set definition begin&#39;</span><span class="p">:</span>
			<span class="p">(</span><span class="s1">&#39;MarkGlyphSetsDef&#39;</span><span class="p">,</span> <span class="n">parseMarkFilteringSets</span><span class="p">),</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span><span class="n">parser</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
	<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">typ</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Skipping </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
			<span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="n">attr</span><span class="p">,</span><span class="n">parser</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
		<span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attr</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">parser</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">))</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="mh">0x00010000</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MarkGlyphSetsDef</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mh">0x00010002</span>
	<span class="n">container</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span>
	<span class="k">return</span> <span class="n">container</span></div>

<div class="viewcode-block" id="parseCmap"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseCmap">[docs]</a><span class="k">def</span> <span class="nf">parseCmap</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
	<span class="n">container</span> <span class="o">=</span> <span class="n">ttLib</span><span class="o">.</span><span class="n">getTableClass</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">)()</span>
	<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing cmap&quot;</span><span class="p">)</span>
	<span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">while</span> <span class="n">lines</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">lines</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;cmap subtable </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">))</span>
		<span class="n">platId</span><span class="p">,</span> <span class="n">encId</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="p">[</span>
			<span class="n">parseCmapId</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;platformID&#39;</span><span class="p">,</span> <span class="s1">&#39;encodingID&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">)]</span>
		<span class="n">table</span> <span class="o">=</span> <span class="n">cmap_classes</span><span class="p">[</span><span class="n">fmt</span><span class="p">](</span><span class="n">fmt</span><span class="p">)</span>
		<span class="n">table</span><span class="o">.</span><span class="n">platformID</span> <span class="o">=</span> <span class="n">platId</span>
		<span class="n">table</span><span class="o">.</span><span class="n">platEncID</span> <span class="o">=</span> <span class="n">encId</span>
		<span class="n">table</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">lang</span>
		<span class="n">table</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
		<span class="k">while</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;end subtable&#39;</span><span class="p">:</span>
			<span class="n">table</span><span class="o">.</span><span class="n">cmap</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
		<span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
	<span class="n">container</span><span class="o">.</span><span class="n">tableVersion</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">container</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
	<span class="k">return</span> <span class="n">container</span></div>

<div class="viewcode-block" id="parseCmapId"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseCmapId">[docs]</a><span class="k">def</span> <span class="nf">parseCmapId</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
	<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
	<span class="k">assert</span> <span class="n">field</span> <span class="o">==</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="parseTable"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.parseTable">[docs]</a><span class="k">def</span> <span class="nf">parseTable</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">tableTag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing table&quot;</span><span class="p">)</span>
	<span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">peeks</span><span class="p">()</span>
	<span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FontDame&#39;</span><span class="p">:</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">elif</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;Font Chef Table&#39;</span><span class="p">:</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">tableTag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">tableTag</span> <span class="o">=</span> <span class="n">tag</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="n">tableTag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">,</span> <span class="p">(</span><span class="n">tableTag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

	<span class="k">assert</span> <span class="n">tableTag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Don&#39;t know what table to parse and data doesn&#39;t specify&quot;</span>

	<span class="k">return</span> <span class="p">{</span>
		<span class="s1">&#39;GSUB&#39;</span><span class="p">:</span> <span class="n">parseGSUB</span><span class="p">,</span>
		<span class="s1">&#39;GPOS&#39;</span><span class="p">:</span> <span class="n">parseGPOS</span><span class="p">,</span>
		<span class="s1">&#39;GDEF&#39;</span><span class="p">:</span> <span class="n">parseGDEF</span><span class="p">,</span>
		<span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">parseCmap</span><span class="p">,</span>
		<span class="p">}[</span><span class="n">tableTag</span><span class="p">](</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tokenizer"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer">[docs]</a><span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
		<span class="c1"># TODO BytesIO / StringIO as needed?  also, figure out whether we work on bytes or unicode</span>
		<span class="n">lines</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span>

	<span class="k">def</span> <span class="nf">_next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
		<span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
			<span class="k">del</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;trailing tab found on line </span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">))</span>
			<span class="k">while</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
				<span class="k">del</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">line</span>

	<span class="k">def</span> <span class="nf">_next_nonempty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_line</span><span class="p">()</span>
			<span class="c1"># Skip comments and empty lines</span>
			<span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;%&#39;</span> <span class="ow">or</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">% s</span><span class="s1">ubtable&#39;</span><span class="p">):</span>
				<span class="k">return</span> <span class="n">line</span>

	<span class="k">def</span> <span class="nf">_next_buffered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">return</span> <span class="n">ret</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_nonempty</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_buffered</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">line</span>
			<span class="k">raise</span> <span class="ne">StopIteration</span>
		<span class="k">return</span> <span class="n">line</span>

<div class="viewcode-block" id="Tokenizer.next"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.next">[docs]</a>	<span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span></div>

<div class="viewcode-block" id="Tokenizer.peek"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.peek">[docs]</a>	<span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_nonempty</span><span class="p">()</span>
			<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
				<span class="k">return</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span></div>

<div class="viewcode-block" id="Tokenizer.peeks"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.peeks">[docs]</a>	<span class="k">def</span> <span class="nf">peeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">ret</span> <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,)</span></div>

<div class="viewcode-block" id="Tokenizer.between"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.between">[docs]</a>	<span class="nd">@contextmanager</span>
	<span class="k">def</span> <span class="nf">between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39; begin&#39;</span>
		<span class="n">end</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39; end&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">expectendswith</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
		<span class="k">yield</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39; end&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tokenizer.until"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.until">[docs]</a>	<span class="nd">@contextmanager</span>
	<span class="k">def</span> <span class="nf">until</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">:</span>
			<span class="n">tags</span> <span class="o">=</span> <span class="p">(</span><span class="n">tags</span><span class="p">,)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
		<span class="k">yield</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoppers</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">):]</span></div>

<div class="viewcode-block" id="Tokenizer.expect"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.expect">[docs]</a>	<span class="k">def</span> <span class="nf">expect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
		<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">assert</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Expected &#39;</span><span class="si">%s</span><span class="s2">&#39;, got &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="Tokenizer.expectendswith"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.Tokenizer.expectendswith">[docs]</a>	<span class="k">def</span> <span class="nf">expectendswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
		<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">assert</span> <span class="n">tag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s2">&quot;Expected &#39;*</span><span class="si">%s</span><span class="s2">&#39;, got &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">line</span></div></div>

<div class="viewcode-block" id="build"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.build">[docs]</a><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">tableTag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="n">lines</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">parseTable</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">tableTag</span><span class="o">=</span><span class="n">tableTag</span><span class="p">)</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../mtiLib.html#fontTools.mtiLib.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="kn">import</span> <span class="nn">sys</span>
	<span class="kn">from</span> <span class="nn">fontTools</span> <span class="k">import</span> <span class="n">configLogger</span>
	<span class="kn">from</span> <span class="nn">fontTools.misc.testTools</span> <span class="k">import</span> <span class="n">MockFont</span>

	<span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

	<span class="c1"># configure the library logger (for &gt;= WARNING)</span>
	<span class="n">configLogger</span><span class="p">()</span>
	<span class="c1"># comment this out to enable debug messages from mtiLib&#39;s logger</span>
	<span class="c1"># log.setLevel(logging.DEBUG)</span>

	<span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">font</span> <span class="o">=</span> <span class="n">MockFont</span><span class="p">()</span>

	<span class="n">tableTag</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">):</span>
		<span class="n">tableTag</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
		<span class="k">del</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
		<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="n">table</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">tableTag</span><span class="o">=</span><span class="n">tableTag</span><span class="p">)</span>
		<span class="n">blob</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">font</span><span class="p">)</span> <span class="c1"># Make sure it compiles</span>
		<span class="n">decompiled</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
		<span class="n">decompiled</span><span class="o">.</span><span class="n">decompile</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span> <span class="c1"># Make sure it decompiles!</span>

		<span class="c1">#continue</span>
		<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">xmlWriter</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">tableTag</span>
		<span class="n">writer</span> <span class="o">=</span> <span class="n">xmlWriter</span><span class="o">.</span><span class="n">XMLWriter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">begintag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
		<span class="c1">#table.toXML(writer, font)</span>
		<span class="n">decompiled</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">endtag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">sys</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>