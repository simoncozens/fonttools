

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fontTools.ufoLib &mdash; fontTools Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> fontTools
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../afmLib.html">afmLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agl.html">agl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cffLib/index.html">cffLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../colorLib/index.html">colorLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cu2qu/index.html">cu2qu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../designspaceLib/index.html">designspaceLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../encodings/index.html">encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../feaLib/index.html">feaLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../merge.html">merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/index.html">misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mtiLib.html">mtiLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../otlLib/index.html">otlLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pens/index.html">pens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subset/index.html">subset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svgLib/index.html">svgLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../t1Lib.html">t1Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ttLib/index.html">ttLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ttx.html">ttx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ufoLib/index.html">ufoLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unicode.html">unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unicodedata/index.html">unicodedata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../varLib/index.html">varLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voltLib.html">voltLib</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fontTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>fontTools.ufoLib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fontTools.ufoLib</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">fsdecode</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">fs</span>
<span class="kn">import</span> <span class="nn">fs.base</span>
<span class="kn">import</span> <span class="nn">fs.subfs</span>
<span class="kn">import</span> <span class="nn">fs.errors</span>
<span class="kn">import</span> <span class="nn">fs.copy</span>
<span class="kn">import</span> <span class="nn">fs.osfs</span>
<span class="kn">import</span> <span class="nn">fs.zipfs</span>
<span class="kn">import</span> <span class="nn">fs.tempfs</span>
<span class="kn">import</span> <span class="nn">fs.tools</span>
<span class="kn">from</span> <span class="nn">fontTools.misc.py23</span> <span class="k">import</span> <span class="n">tostr</span>
<span class="kn">from</span> <span class="nn">fontTools.misc</span> <span class="k">import</span> <span class="n">plistlib</span>
<span class="kn">from</span> <span class="nn">fontTools.ufoLib.validators</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fontTools.ufoLib.filenames</span> <span class="k">import</span> <span class="n">userNameToFileName</span>
<span class="kn">from</span> <span class="nn">fontTools.ufoLib.converters</span> <span class="k">import</span> <span class="n">convertUFO1OrUFO2KerningToUFO3Kerning</span>
<span class="kn">from</span> <span class="nn">fontTools.ufoLib.errors</span> <span class="k">import</span> <span class="n">UFOLibError</span>
<span class="kn">from</span> <span class="nn">fontTools.ufoLib.utils</span> <span class="k">import</span> <span class="n">numberTypes</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A library for importing .ufo files and their descendants.</span>
<span class="sd">Refer to http://unifiedfontobject.com for the UFO specification.</span>

<span class="sd">The UFOReader and UFOWriter classes support versions 1, 2 and 3</span>
<span class="sd">of the specification.</span>

<span class="sd">Sets that list the font info attribute names for the fontinfo.plist</span>
<span class="sd">formats are available for external use. These are:</span>
<span class="sd">	fontInfoAttributesVersion1</span>
<span class="sd">	fontInfoAttributesVersion2</span>
<span class="sd">	fontInfoAttributesVersion3</span>

<span class="sd">A set listing the fontinfo.plist attributes that were deprecated</span>
<span class="sd">in version 2 is available for external use:</span>
<span class="sd">	deprecatedFontInfoAttributesVersion2</span>

<span class="sd">Functions that do basic validation on values for fontinfo.plist</span>
<span class="sd">are available for external use. These are</span>
<span class="sd">	validateFontInfoVersion2ValueForAttribute</span>
<span class="sd">	validateFontInfoVersion3ValueForAttribute</span>

<span class="sd">Value conversion functions are available for converting</span>
<span class="sd">fontinfo.plist values between the possible format versions.</span>
<span class="sd">	convertFontInfoValueForAttributeFromVersion1ToVersion2</span>
<span class="sd">	convertFontInfoValueForAttributeFromVersion2ToVersion1</span>
<span class="sd">	convertFontInfoValueForAttributeFromVersion2ToVersion3</span>
<span class="sd">	convertFontInfoValueForAttributeFromVersion3ToVersion2</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s2">&quot;makeUFOPath&quot;</span><span class="p">,</span>
	<span class="s2">&quot;UFOLibError&quot;</span><span class="p">,</span>
	<span class="s2">&quot;UFOReader&quot;</span><span class="p">,</span>
	<span class="s2">&quot;UFOWriter&quot;</span><span class="p">,</span>
	<span class="s2">&quot;UFOReaderWriter&quot;</span><span class="p">,</span>
	<span class="s2">&quot;UFOFileStructure&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fontInfoAttributesVersion1&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fontInfoAttributesVersion2&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fontInfoAttributesVersion3&quot;</span><span class="p">,</span>
	<span class="s2">&quot;deprecatedFontInfoAttributesVersion2&quot;</span><span class="p">,</span>
	<span class="s2">&quot;validateFontInfoVersion2ValueForAttribute&quot;</span><span class="p">,</span>
	<span class="s2">&quot;validateFontInfoVersion3ValueForAttribute&quot;</span><span class="p">,</span>
	<span class="s2">&quot;convertFontInfoValueForAttributeFromVersion1ToVersion2&quot;</span><span class="p">,</span>
	<span class="s2">&quot;convertFontInfoValueForAttributeFromVersion2ToVersion1&quot;</span>
<span class="p">]</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;3.0.0&quot;</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># ---------</span>
<span class="c1"># Constants</span>
<span class="c1"># ---------</span>

<span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="o">=</span> <span class="s2">&quot;glyphs&quot;</span>
<span class="n">DATA_DIRNAME</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
<span class="n">IMAGES_DIRNAME</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span>
<span class="n">METAINFO_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;metainfo.plist&quot;</span>
<span class="n">FONTINFO_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;fontinfo.plist&quot;</span>
<span class="n">LIB_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;lib.plist&quot;</span>
<span class="n">GROUPS_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;groups.plist&quot;</span>
<span class="n">KERNING_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;kerning.plist&quot;</span>
<span class="n">FEATURES_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;features.fea&quot;</span>
<span class="n">LAYERCONTENTS_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;layercontents.plist&quot;</span>
<span class="n">LAYERINFO_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;layerinfo.plist&quot;</span>

<span class="n">DEFAULT_LAYER_NAME</span> <span class="o">=</span> <span class="s2">&quot;public.default&quot;</span>

<span class="n">supportedUFOFormatVersions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>


<div class="viewcode-block" id="UFOFileStructure"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOFileStructure">[docs]</a><span class="k">class</span> <span class="nc">UFOFileStructure</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
	<span class="n">ZIP</span> <span class="o">=</span> <span class="s2">&quot;zip&quot;</span>
	<span class="n">PACKAGE</span> <span class="o">=</span> <span class="s2">&quot;package&quot;</span></div>


<span class="c1"># --------------</span>
<span class="c1"># Shared Methods</span>
<span class="c1"># --------------</span>


<span class="k">class</span> <span class="nc">_UFOBaseIO</span><span class="p">:</span>

	<span class="k">def</span> <span class="nf">getFileModificationTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the modification time for the file at the given path, as a</span>
<span class="sd">		floating point number giving the number of seconds since the epoch.</span>
<span class="sd">		The path must be relative to the UFO path.</span>
<span class="sd">		Returns None if the file does not exist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">namespaces</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">modified</span>
		<span class="k">except</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">MissingInfoNamespace</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">):</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">_getPlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read a property list relative to the UFO filesystem&#39;s root.</span>
<span class="sd">		Raises UFOLibError if the file is missing and default is None,</span>
<span class="sd">		otherwise default is returned.</span>

<span class="sd">		The errors that could be raised during the reading of a plist are</span>
<span class="sd">		unpredictable and/or too large to list, so, a blind try: except:</span>
<span class="sd">		is done. If an exception occurs, a UFOLibError will be raised.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
					<span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; is missing on </span><span class="si">%s</span><span class="s2">. This file is required&quot;</span>
					<span class="o">%</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
				<span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">default</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="c1"># TODO(anthrotype): try to narrow this down a little</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
				<span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{fileName}</span><span class="s2">&#39; could not be read on </span><span class="si">{self.fs}</span><span class="s2">: </span><span class="si">{e}</span><span class="s2">&quot;</span>
			<span class="p">)</span>

	<span class="k">def</span> <span class="nf">_writePlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write a property list to a file relative to the UFO filesystem&#39;s root.</span>

<span class="sd">		Do this sort of atomically, making it harder to corrupt existing files,</span>
<span class="sd">		for example when plistlib encounters an error halfway during write.</span>
<span class="sd">		This also checks to see if text matches the text that is already in the</span>
<span class="sd">		file at path. If so, the file is not rewritten so that the modification</span>
<span class="sd">		date is preserved.</span>

<span class="sd">		The errors that could be raised during the writing of a plist are</span>
<span class="sd">		unpredictable and/or too large to list, so, a blind try: except: is done.</span>
<span class="sd">		If an exception occurs, a UFOLibError will be raised.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
					<span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; could not be written on </span><span class="si">%s</span><span class="s2"> because &quot;</span>
					<span class="s2">&quot;the data is not properly formatted: </span><span class="si">%s</span><span class="s2">&quot;</span>
					<span class="o">%</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
				<span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">readbytes</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
				<span class="k">return</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writebytes</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">openbin</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">plistlib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
						<span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; could not be written on </span><span class="si">%s</span><span class="s2"> because &quot;</span>
						<span class="s2">&quot;the data is not properly formatted: </span><span class="si">%s</span><span class="s2">&quot;</span>
						<span class="o">%</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
					<span class="p">)</span>


<span class="c1"># ----------</span>
<span class="c1"># UFO Reader</span>
<span class="c1"># ----------</span>

<div class="viewcode-block" id="UFOReader"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader">[docs]</a><span class="k">class</span> <span class="nc">UFOReader</span><span class="p">(</span><span class="n">_UFOBaseIO</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Read the various components of the .ufo.</span>

<span class="sd">	By default read data is validated. Set ``validate`` to</span>
<span class="sd">	``False`` to not validate the data.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;__fspath__&quot;</span><span class="p">):</span>  <span class="c1"># support os.PathLike objects</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">__fspath__</span><span class="p">()</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
			<span class="n">structure</span> <span class="o">=</span> <span class="n">_sniffFileStructure</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">ZIP</span><span class="p">:</span>
					<span class="n">parentFS</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">zipfs</span><span class="o">.</span><span class="n">ZipFS</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">parentFS</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">osfs</span><span class="o">.</span><span class="n">OSFS</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">CreateFailed</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;unable to open &#39;</span><span class="si">{path}</span><span class="s2">&#39;: </span><span class="si">{e}</span><span class="s2">&quot;</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">ZIP</span><span class="p">:</span>
				<span class="c1"># .ufoz zip files must contain a single root directory, with arbitrary</span>
				<span class="c1"># name, containing all the UFO files</span>
				<span class="n">rootDirs</span> <span class="o">=</span> <span class="p">[</span>
					<span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parentFS</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
					<span class="c1"># exclude macOS metadata contained in zip file</span>
					<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_dir</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;__MACOSX&quot;</span>
				<span class="p">]</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rootDirs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
					<span class="c1"># &#39;ClosingSubFS&#39; ensures that the parent zip file is closed when</span>
					<span class="c1"># its root subdirectory is closed</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">parentFS</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span>
						<span class="n">rootDirs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">subfs</span><span class="o">.</span><span class="n">ClosingSubFS</span>
					<span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
						<span class="s2">&quot;Expected exactly 1 root directory, found </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">rootDirs</span><span class="p">)</span>
					<span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># normal UFO &#39;packages&#39; are just a single folder</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">parentFS</span>
			<span class="c1"># when passed a path string, we make sure we close the newly opened fs</span>
			<span class="c1"># upon calling UFOReader.close method or context manager&#39;s __exit__</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_shouldClose</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_fileStructure</span> <span class="o">=</span> <span class="n">structure</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">FS</span><span class="p">):</span>
			<span class="n">filesystem</span> <span class="o">=</span> <span class="n">path</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">filesystem</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
			<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">FilesystemClosed</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;the filesystem &#39;</span><span class="si">%s</span><span class="s2">&#39; is closed&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">path</span> <span class="o">=</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">getsyspath</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">NoSysPath</span><span class="p">:</span>
				<span class="c1"># network or in-memory FS may not map to the local one</span>
				<span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filesystem</span><span class="p">)</span>
			<span class="c1"># when user passed an already initialized fs instance, it is her</span>
			<span class="c1"># responsibility to close it, thus UFOReader.close/__exit__ are no-op</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_shouldClose</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="c1"># default to a &#39;package&#39; structure</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_fileStructure</span> <span class="o">=</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">PACKAGE</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
				<span class="s2">&quot;Expected a path string or fs.base.FS object, found &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
				<span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
			<span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="n">validate</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">readMetaInfo</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span> <span class="o">=</span> <span class="kc">None</span>

	<span class="c1"># properties</span>

	<span class="k">def</span> <span class="nf">_get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="kn">import</span> <span class="nn">warnings</span>

		<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
			<span class="s2">&quot;The &#39;path&#39; attribute is deprecated; use the &#39;fs&#39; attribute instead&quot;</span><span class="p">,</span>
			<span class="ne">DeprecationWarning</span><span class="p">,</span>
			<span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
		<span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

	<span class="n">path</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_path</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The path of the UFO (DEPRECATED).&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_get_formatVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span>

	<span class="n">formatVersion</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_formatVersion</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The format version of the UFO. This is determined by reading metainfo.plist during __init__.&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_get_fileStructure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileStructure</span>

	<span class="n">fileStructure</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
		<span class="n">_get_fileStructure</span><span class="p">,</span>
		<span class="n">doc</span><span class="o">=</span><span class="p">(</span>
			<span class="s2">&quot;The file structure of the UFO: &quot;</span>
			<span class="s2">&quot;either UFOFileStructure.ZIP or UFOFileStructure.PACKAGE&quot;</span>
		<span class="p">)</span>
	<span class="p">)</span>

	<span class="c1"># up conversion</span>

	<span class="k">def</span> <span class="nf">_upConvertKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Up convert kerning and groups in UFO 1 and 2.</span>
<span class="sd">		The data will be held internally until each bit of data</span>
<span class="sd">		has been retrieved. The conversion of both must be done</span>
<span class="sd">		at once, so the raw data is cached and an error is raised</span>
<span class="sd">		if one bit of data becomes obsolete before it is called.</span>

<span class="sd">		``validate`` will validate the data.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">:</span>
			<span class="n">testKerning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readKerning</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">testKerning</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;originalKerning&quot;</span><span class="p">]:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The data in kerning.plist has been modified since it was converted to UFO 3 format.&quot;</span><span class="p">)</span>
			<span class="n">testGroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readGroups</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">testGroups</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;originalGroups&quot;</span><span class="p">]:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The data in groups.plist has been modified since it was converted to UFO 3 format.&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readGroups</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
				<span class="n">invalidFormatMessage</span> <span class="o">=</span> <span class="s2">&quot;groups.plist is not properly formatted.&quot;</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">groupName</span><span class="p">,</span> <span class="n">glyphList</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupName</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
					<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glyphList</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
					<span class="k">for</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="n">glyphList</span><span class="p">:</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
							<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
				<span class="n">kerning</span><span class="o">=</span><span class="p">{},</span>
				<span class="n">originalKerning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_readKerning</span><span class="p">(),</span>
				<span class="n">groups</span><span class="o">=</span><span class="p">{},</span>
				<span class="n">originalGroups</span><span class="o">=</span><span class="n">groups</span>
			<span class="p">)</span>
			<span class="c1"># convert kerning and groups</span>
			<span class="n">kerning</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">conversionMaps</span> <span class="o">=</span> <span class="n">convertUFO1OrUFO2KerningToUFO3Kerning</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;originalKerning&quot;</span><span class="p">],</span>
				<span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;originalGroups&quot;</span><span class="p">]),</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">getGlyphSet</span><span class="p">()</span>
			<span class="p">)</span>
			<span class="c1"># store</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;kerning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kerning</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;groups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">groups</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;groupRenameMaps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conversionMaps</span>

	<span class="c1"># support methods</span>

<div class="viewcode-block" id="UFOReader.readBytesFromPath"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readBytesFromPath">[docs]</a>	<span class="k">def</span> <span class="nf">readBytesFromPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the bytes in the file at the given path.</span>
<span class="sd">		The path must be relative to the UFO&#39;s filesystem root.</span>
<span class="sd">		Returns None if the file does not exist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">readbytes</span><span class="p">(</span><span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="UFOReader.getReadFileForPath"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getReadFileForPath">[docs]</a>	<span class="k">def</span> <span class="nf">getReadFileForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a file (or file-like) object for the file at the given path.</span>
<span class="sd">		The path must be relative to the UFO path.</span>
<span class="sd">		Returns None if the file does not exist.</span>
<span class="sd">		By default the file is opened in binary mode (reads bytes).</span>
<span class="sd">		If encoding is passed, the file is opened in text mode (reads str).</span>

<span class="sd">		Note: The caller is responsible for closing the open file.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">openbin</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span></div>
	<span class="c1"># metainfo.plist</span>

<div class="viewcode-block" id="UFOReader.readMetaInfo"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readMetaInfo">[docs]</a>	<span class="k">def</span> <span class="nf">readMetaInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read metainfo.plist. Only used for internal operations.</span>

<span class="sd">		``validate`` will validate the read data, by default it is set</span>
<span class="sd">		to the class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">METAINFO_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;metainfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
		<span class="n">formatVersion</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;formatVersion&quot;</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formatVersion</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
					<span class="s2">&quot;formatVersion must be specified as an integer in &#39;</span><span class="si">%s</span><span class="s2">&#39; on </span><span class="si">%s</span><span class="s2">&quot;</span>
					<span class="o">%</span> <span class="p">(</span><span class="n">METAINFO_FILENAME</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
				<span class="p">)</span>
			<span class="k">if</span> <span class="n">formatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supportedUFOFormatVersions</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
					<span class="s2">&quot;Unsupported UFO format (</span><span class="si">%d</span><span class="s2">) in &#39;</span><span class="si">%s</span><span class="s2">&#39; on </span><span class="si">%s</span><span class="s2">&quot;</span>
					<span class="o">%</span> <span class="p">(</span><span class="n">formatVersion</span><span class="p">,</span> <span class="n">METAINFO_FILENAME</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
				<span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span></div>

	<span class="c1"># groups.plist</span>

	<span class="k">def</span> <span class="nf">_readGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">GROUPS_FILENAME</span><span class="p">,</span> <span class="p">{})</span>

<div class="viewcode-block" id="UFOReader.readGroups"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readGroups">[docs]</a>	<span class="k">def</span> <span class="nf">readGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read groups.plist. Returns a dict.</span>
<span class="sd">		``validate`` will validate the read data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="c1"># handle up conversion</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertKerning</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;groups&quot;</span><span class="p">]</span>
		<span class="c1"># normal</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readGroups</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">groupsValidator</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">groups</span></div>

<div class="viewcode-block" id="UFOReader.getKerningGroupConversionRenameMaps"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getKerningGroupConversionRenameMaps">[docs]</a>	<span class="k">def</span> <span class="nf">getKerningGroupConversionRenameMaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get maps defining the renaming that was done during any</span>
<span class="sd">		needed kerning group conversion. This method returns a</span>
<span class="sd">		dictionary of this form:</span>

<span class="sd">			{</span>
<span class="sd">				&quot;side1&quot; : {&quot;old group name&quot; : &quot;new group name&quot;},</span>
<span class="sd">				&quot;side2&quot; : {&quot;old group name&quot; : &quot;new group name&quot;}</span>
<span class="sd">			}</span>

<span class="sd">		When no conversion has been performed, the side1 and side2</span>
<span class="sd">		dictionaries will be empty.</span>

<span class="sd">		``validate`` will validate the groups, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">side1</span><span class="o">=</span><span class="p">{},</span> <span class="n">side2</span><span class="o">=</span><span class="p">{})</span>
		<span class="c1"># use the public group reader to force the load and</span>
		<span class="c1"># conversion of the data if it hasn&#39;t happened yet.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">readGroups</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;groupRenameMaps&quot;</span><span class="p">]</span></div>

	<span class="c1"># fontinfo.plist</span>

	<span class="k">def</span> <span class="nf">_readInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">FONTINFO_FILENAME</span><span class="p">,</span> <span class="p">{})</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;fontinfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="UFOReader.readInfo"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readInfo">[docs]</a>	<span class="k">def</span> <span class="nf">readInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read fontinfo.plist. It requires an object that allows</span>
<span class="sd">		setting attributes with names that follow the fontinfo.plist</span>
<span class="sd">		version 3 specification. This will write the attributes</span>
<span class="sd">		defined in the file into the object.</span>

<span class="sd">		``validate`` will validate the read data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="n">infoDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readInfo</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
		<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="c1"># version 1</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion1</span><span class="p">:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">infoDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">infoDataToSet</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion1ToVersion2</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion2ToVersion3</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
		<span class="c1"># version 2</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataValidationDict</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fontInfoAttributesVersion2ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">infoDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">infoDataToSet</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion2ToVersion3</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
		<span class="c1"># version 3</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataValidationDict</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">infoDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">infoDataToSet</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="c1"># unsupported version</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NotImplementedError</span>
		<span class="c1"># validate data</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">validateInfoVersion3Data</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
		<span class="c1"># populate the object</span>
		<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="nb">setattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The supplied info object does not support setting a necessary attribute (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span></div>

	<span class="c1"># kerning.plist</span>

	<span class="k">def</span> <span class="nf">_readKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">KERNING_FILENAME</span><span class="p">,</span> <span class="p">{})</span>
		<span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="UFOReader.readKerning"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readKerning">[docs]</a>	<span class="k">def</span> <span class="nf">readKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read kerning.plist. Returns a dict.</span>

<span class="sd">		``validate`` will validate the kerning data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="c1"># handle up conversion</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertKerning</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
			<span class="n">kerningNested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s2">&quot;kerning&quot;</span><span class="p">]</span>
		<span class="c1"># normal</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">kerningNested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readKerning</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">kerningValidator</span><span class="p">(</span><span class="n">kerningNested</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="c1"># flatten</span>
		<span class="n">kerning</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">kerningNested</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">kerningNested</span><span class="p">[</span><span class="n">left</span><span class="p">]:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">kerningNested</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">right</span><span class="p">]</span>
				<span class="n">kerning</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="k">return</span> <span class="n">kerning</span></div>

	<span class="c1"># lib.plist</span>

<div class="viewcode-block" id="UFOReader.readLib"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readLib">[docs]</a>	<span class="k">def</span> <span class="nf">readLib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read lib.plist. Returns a dict.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">LIB_FILENAME</span><span class="p">,</span> <span class="p">{})</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">fontLibValidator</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span></div>

	<span class="c1"># features.fea</span>

<div class="viewcode-block" id="UFOReader.readFeatures"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readFeatures">[docs]</a>	<span class="k">def</span> <span class="nf">readFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read features.fea. Return a string.</span>
<span class="sd">		The returned string is empty if the file is missing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">FEATURES_FILENAME</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">return</span> <span class="s2">&quot;&quot;</span></div>

	<span class="c1"># glyph sets &amp; layers</span>

	<span class="k">def</span> <span class="nf">_readLayerContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Rebuild the layer contents list by checking what glyphsets</span>
<span class="sd">		are available on disk.</span>

<span class="sd">		``validate`` will validate the layer contents.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[(</span><span class="n">DEFAULT_LAYER_NAME</span><span class="p">,</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)]</span>
		<span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">LAYERCONTENTS_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">layerContentsValidator</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">contents</span>

<div class="viewcode-block" id="UFOReader.getLayerNames"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getLayerNames">[docs]</a>	<span class="k">def</span> <span class="nf">getLayerNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the ordered layer names from layercontents.plist.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
		<span class="n">layerNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">layerName</span> <span class="k">for</span> <span class="n">layerName</span><span class="p">,</span> <span class="n">directoryName</span> <span class="ow">in</span> <span class="n">layerContents</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">layerNames</span></div>

<div class="viewcode-block" id="UFOReader.getDefaultLayerName"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getDefaultLayerName">[docs]</a>	<span class="k">def</span> <span class="nf">getDefaultLayerName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the default layer name from layercontents.plist.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">layerName</span><span class="p">,</span> <span class="n">layerDirectory</span> <span class="ow">in</span> <span class="n">layerContents</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">layerDirectory</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">layerName</span>
		<span class="c1"># this will already have been raised during __init__</span>
		<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The default layer is not defined in layercontents.plist.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOReader.getGlyphSet"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">getGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validateRead</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validateWrite</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the GlyphSet associated with the</span>
<span class="sd">		glyphs directory mapped to layerName</span>
<span class="sd">		in the UFO. If layerName is not provided,</span>
<span class="sd">		the name retrieved with getDefaultLayerName</span>
<span class="sd">		will be used.</span>

<span class="sd">		``validateRead`` will validate the read data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		``validateWrite`` will validate the written data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="kn">from</span> <span class="nn">fontTools.ufoLib.glifLib</span> <span class="k">import</span> <span class="n">GlyphSet</span>

		<span class="k">if</span> <span class="n">validateRead</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validateRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="n">validateWrite</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validateWrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">layerName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultLayerName</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="n">validateRead</span><span class="p">)</span>
		<span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">(</span><span class="n">validateRead</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">storedLayerName</span><span class="p">,</span> <span class="n">storedLayerDirectory</span> <span class="ow">in</span> <span class="n">layerContents</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="o">==</span> <span class="n">storedLayerName</span><span class="p">:</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">storedLayerDirectory</span>
				<span class="k">break</span>
		<span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;No glyphs directory is mapped to </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">layerName</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">glyphSubFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
				<span class="n">f</span><span class="s2">&quot;No &#39;</span><span class="si">{directory}</span><span class="s2">&#39; directory for layer &#39;</span><span class="si">{layerName}</span><span class="s2">&#39;&quot;</span>
			<span class="p">)</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span>
			<span class="n">glyphSubFS</span><span class="p">,</span>
			<span class="n">ufoFormatVersion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">,</span>
			<span class="n">validateRead</span><span class="o">=</span><span class="n">validateRead</span><span class="p">,</span>
			<span class="n">validateWrite</span><span class="o">=</span><span class="n">validateWrite</span><span class="p">,</span>
		<span class="p">)</span></div>

<div class="viewcode-block" id="UFOReader.getCharacterMapping"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getCharacterMapping">[docs]</a>	<span class="k">def</span> <span class="nf">getCharacterMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a dictionary that maps unicode values (ints) to</span>
<span class="sd">		lists of glyph names.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="n">glyphSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlyphSet</span><span class="p">(</span><span class="n">layerName</span><span class="p">,</span> <span class="n">validateRead</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">validateWrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">allUnicodes</span> <span class="o">=</span> <span class="n">glyphSet</span><span class="o">.</span><span class="n">getUnicodes</span><span class="p">()</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">unicodes</span> <span class="ow">in</span> <span class="n">allUnicodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">unicodes</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">cmap</span><span class="p">:</span>
					<span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">cmap</span></div>

	<span class="c1"># /data</span>

<div class="viewcode-block" id="UFOReader.getDataDirectoryListing"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getDataDirectoryListing">[docs]</a>	<span class="k">def</span> <span class="nf">getDataDirectoryListing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a list of all files in the data directory.</span>
<span class="sd">		The returned paths will be relative to the UFO.</span>
<span class="sd">		This will not list directory names, only file names.</span>
<span class="sd">		Thus, empty directories will be skipped.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_dataFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span><span class="n">DATA_DIRNAME</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DirectoryExpected</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The UFO contains a </span><span class="se">\&quot;</span><span class="s2">data</span><span class="se">\&quot;</span><span class="s2"> file instead of a directory.&quot;</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="c1"># fs Walker.files method returns &quot;absolute&quot; paths (in terms of the</span>
			<span class="c1"># root of the &#39;data&#39; SubFS), so we strip the leading &#39;/&#39; to make</span>
			<span class="c1"># them relative</span>
			<span class="k">return</span> <span class="p">[</span>
				<span class="n">p</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataFS</span><span class="o">.</span><span class="n">walk</span><span class="o">.</span><span class="n">files</span><span class="p">()</span>
			<span class="p">]</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceError</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="UFOReader.getImageDirectoryListing"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.getImageDirectoryListing">[docs]</a>	<span class="k">def</span> <span class="nf">getImageDirectoryListing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a list of all image file names in</span>
<span class="sd">		the images directory. Each of the images will</span>
<span class="sd">		have been verified to have the PNG signature.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_imagesFS</span> <span class="o">=</span> <span class="n">imagesFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span><span class="n">IMAGES_DIRNAME</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DirectoryExpected</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The UFO contains an </span><span class="se">\&quot;</span><span class="s2">images</span><span class="se">\&quot;</span><span class="s2"> file instead of a directory.&quot;</span><span class="p">)</span>
		<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">imagesFS</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">:</span>
				<span class="c1"># silently skip this as version control</span>
				<span class="c1"># systems often have hidden directories</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
				<span class="k">with</span> <span class="n">imagesFS</span><span class="o">.</span><span class="n">openbin</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
					<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pngValidator</span><span class="p">(</span><span class="n">fileObj</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
					<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="UFOReader.readData"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readData">[docs]</a>	<span class="k">def</span> <span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return bytes for the file named &#39;fileName&#39; inside the &#39;data/&#39; directory.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">fileName</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">dataFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataFS</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># in case readData is called before getDataDirectoryListing</span>
				<span class="n">dataFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span><span class="n">DATA_DIRNAME</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">dataFS</span><span class="o">.</span><span class="n">readbytes</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No data file named &#39;</span><span class="si">{fileName}</span><span class="s2">&#39; on </span><span class="si">{self.fs}</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="UFOReader.readImage"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.readImage">[docs]</a>	<span class="k">def</span> <span class="nf">readImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return image data for the file named fileName.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Reading images is not allowed in UFO </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">fileName</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">imagesFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imagesFS</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># in case readImage is called before getImageDirectoryListing</span>
				<span class="n">imagesFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span><span class="n">IMAGES_DIRNAME</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">imagesFS</span><span class="o">.</span><span class="n">readbytes</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No image file named &#39;</span><span class="si">{fileName}</span><span class="s2">&#39; on </span><span class="si">{self.fs}</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pngValidator</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="UFOReader.close"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOReader.close">[docs]</a>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shouldClose</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

	<span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span>

	<span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># ----------</span>
<span class="c1"># UFO Writer</span>
<span class="c1"># ----------</span>

<div class="viewcode-block" id="UFOWriter"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter">[docs]</a><span class="k">class</span> <span class="nc">UFOWriter</span><span class="p">(</span><span class="n">UFOReader</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Write the various components of the .ufo.</span>

<span class="sd">	By default, the written data will be validated before writing. Set ``validate`` to</span>
<span class="sd">	``False`` if you do not want to validate the data. Validation can also be overriden</span>
<span class="sd">	on a per method level if desired.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
		<span class="bp">self</span><span class="p">,</span>
		<span class="n">path</span><span class="p">,</span>
		<span class="n">formatVersion</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
		<span class="n">fileCreator</span><span class="o">=</span><span class="s2">&quot;com.github.fonttools.ufoLib&quot;</span><span class="p">,</span>
		<span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
	<span class="p">):</span>
		<span class="k">if</span> <span class="n">formatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supportedUFOFormatVersions</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Unsupported UFO format (</span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">formatVersion</span><span class="p">)</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;__fspath__&quot;</span><span class="p">):</span>  <span class="c1"># support os.PathLike objects</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">__fspath__</span><span class="p">()</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
			<span class="c1"># normalize path by removing trailing or double slashes</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="n">havePreviousFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">havePreviousFile</span><span class="p">:</span>
				<span class="c1"># ensure we use the same structure as the destination</span>
				<span class="n">existingStructure</span> <span class="o">=</span> <span class="n">_sniffFileStructure</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">structure</span> <span class="o">=</span> <span class="n">UFOFileStructure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
					<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
							<span class="s2">&quot;Invalid or unsupported structure: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">structure</span>
						<span class="p">)</span>
					<span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">existingStructure</span><span class="p">:</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
							<span class="s2">&quot;A UFO with a different structure (</span><span class="si">%s</span><span class="s2">) already exists &quot;</span>
							<span class="s2">&quot;at the given path: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">existingStructure</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
						<span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">structure</span> <span class="o">=</span> <span class="n">existingStructure</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># if not exists, default to &#39;package&#39; structure</span>
				<span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">structure</span> <span class="o">=</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">PACKAGE</span>
				<span class="n">dirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">dirName</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirName</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
						<span class="s2">&quot;Cannot write to &#39;</span><span class="si">%s</span><span class="s2">&#39;: directory does not exist&quot;</span> <span class="o">%</span> <span class="n">path</span>
					<span class="p">)</span>
			<span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">ZIP</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">havePreviousFile</span><span class="p">:</span>
					<span class="c1"># we can&#39;t write a zip in-place, so we have to copy its</span>
					<span class="c1"># contents to a temporary location and work from there, then</span>
					<span class="c1"># upon closing UFOWriter we create the final zip file</span>
					<span class="n">parentFS</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">tempfs</span><span class="o">.</span><span class="n">TempFS</span><span class="p">()</span>
					<span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">zipfs</span><span class="o">.</span><span class="n">ZipFS</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">origFS</span><span class="p">:</span>
						<span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="o">.</span><span class="n">copy_fs</span><span class="p">(</span><span class="n">origFS</span><span class="p">,</span> <span class="n">parentFS</span><span class="p">)</span>
					<span class="c1"># if output path is an existing zip, we require that it contains</span>
					<span class="c1"># one, and only one, root directory (with arbitrary name), in turn</span>
					<span class="c1"># containing all the existing UFO contents</span>
					<span class="n">rootDirs</span> <span class="o">=</span> <span class="p">[</span>
						<span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parentFS</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
						<span class="c1"># exclude macOS metadata contained in zip file</span>
						<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_dir</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;__MACOSX&quot;</span>
					<span class="p">]</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rootDirs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
							<span class="s2">&quot;Expected exactly 1 root directory, found </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">rootDirs</span><span class="p">)</span>
						<span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="c1"># &#39;ClosingSubFS&#39; ensures that the parent filesystem is closed</span>
						<span class="c1"># when its root subdirectory is closed</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">parentFS</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span>
							<span class="n">rootDirs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">subfs</span><span class="o">.</span><span class="n">ClosingSubFS</span>
						<span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="c1"># if the output zip file didn&#39;t exist, we create the root folder;</span>
					<span class="c1"># we name it the same as input &#39;path&#39;, but with &#39;.ufo&#39; extension</span>
					<span class="n">rootDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.ufo&quot;</span>
					<span class="n">parentFS</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">zipfs</span><span class="o">.</span><span class="n">ZipFS</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
					<span class="n">parentFS</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">rootDir</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">parentFS</span><span class="o">.</span><span class="n">opendir</span><span class="p">(</span><span class="n">rootDir</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">subfs</span><span class="o">.</span><span class="n">ClosingSubFS</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">osfs</span><span class="o">.</span><span class="n">OSFS</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_fileStructure</span> <span class="o">=</span> <span class="n">structure</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span> <span class="o">=</span> <span class="n">havePreviousFile</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_shouldClose</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">FS</span><span class="p">):</span>
			<span class="n">filesystem</span> <span class="o">=</span> <span class="n">path</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">filesystem</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
			<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">FilesystemClosed</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;the filesystem &#39;</span><span class="si">%s</span><span class="s2">&#39; is closed&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">path</span> <span class="o">=</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">getsyspath</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">NoSysPath</span><span class="p">:</span>
				<span class="c1"># network or in-memory FS may not map to the local one</span>
				<span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filesystem</span><span class="p">)</span>
			<span class="c1"># if passed an FS object, always use &#39;package&#39; structure</span>
			<span class="k">if</span> <span class="n">structure</span> <span class="ow">and</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">PACKAGE</span><span class="p">:</span>
				<span class="kn">import</span> <span class="nn">warnings</span>

				<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
					<span class="s2">&quot;The &#39;structure&#39; argument is not used when input is an FS object&quot;</span><span class="p">,</span>
					<span class="ne">UserWarning</span><span class="p">,</span>
					<span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
				<span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_fileStructure</span> <span class="o">=</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">PACKAGE</span>
			<span class="c1"># if FS contains a &quot;metainfo.plist&quot;, we consider it non-empty</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span> <span class="o">=</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">METAINFO_FILENAME</span><span class="p">)</span>
			<span class="c1"># the user is responsible for closing the FS object</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_shouldClose</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
				<span class="s2">&quot;Expected a path string or fs object, found </span><span class="si">%s</span><span class="s2">&quot;</span>
				<span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
			<span class="p">)</span>

		<span class="c1"># establish some basic stuff</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_fileCreator</span> <span class="o">=</span> <span class="n">fileCreator</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_downConversionKerningData</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="n">validate</span>
		<span class="c1"># if the file already exists, get the format version.</span>
		<span class="c1"># this will be needed for up and down conversion.</span>
		<span class="n">previousFormatVersion</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="n">metaInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPlist</span><span class="p">(</span><span class="n">METAINFO_FILENAME</span><span class="p">)</span>
			<span class="n">previousFormatVersion</span> <span class="o">=</span> <span class="n">metaInfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;formatVersion&quot;</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">previousFormatVersion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">previousFormatVersion</span><span class="p">)</span>
			<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The existing metainfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">previousFormatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supportedUFOFormatVersions</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Unsupported UFO format (</span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">formatVersion</span><span class="p">)</span>
		<span class="c1"># catch down conversion</span>
		<span class="k">if</span> <span class="n">previousFormatVersion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">previousFormatVersion</span> <span class="o">&gt;</span> <span class="n">formatVersion</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The UFO located at this path is a higher version (</span><span class="si">%d</span><span class="s2">) than the version (</span><span class="si">%d</span><span class="s2">) that is trying to be written. This is not supported.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">previousFormatVersion</span><span class="p">,</span> <span class="n">formatVersion</span><span class="p">))</span>
		<span class="c1"># handle the layer contents</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="n">previousFormatVersion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">previousFormatVersion</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
			<span class="c1"># already exists</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">(</span><span class="n">validate</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># previous &lt; 3</span>
			<span class="c1"># imply the layer contents</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT_LAYER_NAME</span> <span class="p">:</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">}</span>
		<span class="c1"># write the new metainfo</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeMetaInfo</span><span class="p">()</span>

	<span class="c1"># properties</span>

	<span class="k">def</span> <span class="nf">_get_fileCreator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileCreator</span>

	<span class="n">fileCreator</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_fileCreator</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The file creator of the UFO. This is set into metainfo.plist during __init__.&quot;</span><span class="p">)</span>

	<span class="c1"># support methods for file system interaction</span>

<div class="viewcode-block" id="UFOWriter.copyFromReader"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.copyFromReader">[docs]</a>	<span class="k">def</span> <span class="nf">copyFromReader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">,</span> <span class="n">destPath</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Copy the sourcePath in the provided UFOReader to destPath</span>
<span class="sd">		in this writer. The paths must be relative. This works with</span>
<span class="sd">		both individual files and directories.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">UFOReader</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The reader must be an instance of UFOReader.&quot;</span><span class="p">)</span>
		<span class="n">sourcePath</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span>
		<span class="n">destPath</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">destPath</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">reader</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The reader does not have data located at </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">sourcePath</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destPath</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;A file named </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> already exists.&quot;</span> <span class="o">%</span> <span class="n">destPath</span><span class="p">)</span>
		<span class="c1"># create the destination directory if it doesn&#39;t exist</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">destPath</span><span class="p">),</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">reader</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">):</span>
			<span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="o">.</span><span class="n">copy_dir</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">destPath</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">destPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.writeBytesToPath"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeBytesToPath">[docs]</a>	<span class="k">def</span> <span class="nf">writeBytesToPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write bytes to a path relative to the UFO filesystem&#39;s root.</span>
<span class="sd">		If writing to an existing UFO, check to see if data matches the data</span>
<span class="sd">		that is already in the file at path; if so, the file is not rewritten</span>
<span class="sd">		so that the modification date is preserved.</span>
<span class="sd">		If needed, the directory tree for the given path will be built.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">readbytes</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
				<span class="k">return</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writebytes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">FileExpected</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;A directory exists at &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writebytes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.getFileObjectForPath"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.getFileObjectForPath">[docs]</a>	<span class="k">def</span> <span class="nf">getFileObjectForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a file (or file-like) object for the</span>
<span class="sd">		file at the given path. The path must be relative</span>
<span class="sd">		to the UFO path. Returns None if the file does</span>
<span class="sd">		not exist and the mode is &quot;r&quot; or &quot;rb.</span>
<span class="sd">		An encoding may be passed if the file is opened in text mode.</span>

<span class="sd">		Note: The caller is responsible for closing the open file.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="n">m</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
				<span class="c1"># XXX I think we should just let it raise. The docstring,</span>
				<span class="c1"># however, says that this returns None if mode is &#39;r&#39;</span>
				<span class="k">return</span> <span class="kc">None</span>
			<span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span> <span class="ow">or</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span> <span class="ow">or</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">UFOLibError</span><span class="p">(</span>
				<span class="n">f</span><span class="s2">&quot;unable to open &#39;</span><span class="si">{path}</span><span class="s2">&#39; on </span><span class="si">{self.fs}</span><span class="s2">: </span><span class="si">{e}</span><span class="s2">&quot;</span>
			<span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.removePath"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.removePath">[docs]</a>	<span class="k">def</span> <span class="nf">removePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">removeEmptyParents</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the file (or directory) at path. The path</span>
<span class="sd">		must be relative to the UFO.</span>
<span class="sd">		Raises UFOLibError if the path doesn&#39;t exist.</span>
<span class="sd">		If force=True, ignore non-existent paths.</span>
<span class="sd">		If the directory where &#39;path&#39; is located becomes empty, it will</span>
<span class="sd">		be automatically removed, unless &#39;removeEmptyParents&#39; is False.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">FileExpected</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">removetree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">fs</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ResourceNotFound</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
					<span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{path}</span><span class="s2">&#39; does not exist on </span><span class="si">{self.fs}</span><span class="s2">&quot;</span>
				<span class="p">)</span>
		<span class="k">if</span> <span class="n">removeEmptyParents</span><span class="p">:</span>
			<span class="n">parent</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
				<span class="n">fs</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">remove_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span></div>

	<span class="c1"># alias kept for backward compatibility with old API</span>
	<span class="n">removeFileForPath</span> <span class="o">=</span> <span class="n">removePath</span>

	<span class="c1"># UFO mod time</span>

<div class="viewcode-block" id="UFOWriter.setModificationTime"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.setModificationTime">[docs]</a>	<span class="k">def</span> <span class="nf">setModificationTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the UFO modification time to the current time.</span>
<span class="sd">		This is never called automatically. It is up to the</span>
<span class="sd">		caller to call this when finished working on the UFO.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
		<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1"># this may fail on some filesystems (e.g. SMB servers)</span>
				<span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to set modified time: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

	<span class="c1"># metainfo.plist</span>

	<span class="k">def</span> <span class="nf">_writeMetaInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">metaInfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
			<span class="n">creator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileCreator</span><span class="p">,</span>
			<span class="n">formatVersion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span>
		<span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">METAINFO_FILENAME</span><span class="p">,</span> <span class="n">metaInfo</span><span class="p">)</span>

	<span class="c1"># groups.plist</span>

<div class="viewcode-block" id="UFOWriter.setKerningGroupConversionRenameMaps"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.setKerningGroupConversionRenameMaps">[docs]</a>	<span class="k">def</span> <span class="nf">setKerningGroupConversionRenameMaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maps</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set maps defining the renaming that should be done</span>
<span class="sd">		when writing groups and kerning in UFO 1 and UFO 2.</span>
<span class="sd">		This will effectively undo the conversion done when</span>
<span class="sd">		UFOReader reads this data. The dictionary should have</span>
<span class="sd">		this form:</span>

<span class="sd">			{</span>
<span class="sd">				&quot;side1&quot; : {&quot;group name to use when writing&quot; : &quot;group name in data&quot;},</span>
<span class="sd">				&quot;side2&quot; : {&quot;group name to use when writing&quot; : &quot;group name in data&quot;}</span>
<span class="sd">			}</span>

<span class="sd">		This is the same form returned by UFOReader&#39;s</span>
<span class="sd">		getKerningGroupConversionRenameMaps method.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="c1"># XXX raise an error here</span>
		<span class="c1"># flip the dictionaries</span>
		<span class="n">remap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;side1&quot;</span><span class="p">,</span> <span class="s2">&quot;side2&quot;</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">writeName</span><span class="p">,</span> <span class="n">dataName</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="n">remap</span><span class="p">[</span><span class="n">dataName</span><span class="p">]</span> <span class="o">=</span> <span class="n">writeName</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_downConversionKerningData</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">groupRenameMap</span><span class="o">=</span><span class="n">remap</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.writeGroups"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeGroups">[docs]</a>	<span class="k">def</span> <span class="nf">writeGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write groups.plist. This method requires a</span>
<span class="sd">		dict of glyph groups as an argument.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="c1"># validate the data structure</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">groupsValidator</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="c1"># down convert</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downConversionKerningData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">remap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downConversionKerningData</span><span class="p">[</span><span class="s2">&quot;groupRenameMap&quot;</span><span class="p">]</span>
			<span class="n">remappedGroups</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="c1"># there are some edge cases here that are ignored:</span>
			<span class="c1"># 1. if a group is being renamed to a name that</span>
			<span class="c1">#    already exists, the existing group is always</span>
			<span class="c1">#    overwritten. (this is why there are two loops</span>
			<span class="c1">#    below.) there doesn&#39;t seem to be a logical</span>
			<span class="c1">#    solution to groups mismatching and overwriting</span>
			<span class="c1">#    with the specifiecd group seems like a better</span>
			<span class="c1">#    solution than throwing an error.</span>
			<span class="c1"># 2. if side 1 and side 2 groups are being renamed</span>
			<span class="c1">#    to the same group name there is no check to</span>
			<span class="c1">#    ensure that the contents are identical. that</span>
			<span class="c1">#    is left up to the caller.</span>
			<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">remap</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">remappedGroups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">contents</span>
			<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remap</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">name</span> <span class="o">=</span> <span class="n">remap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
				<span class="n">remappedGroups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">contents</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="n">remappedGroups</span>
		<span class="c1"># pack and write</span>
		<span class="n">groupsNew</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="n">groupsNew</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">groupsNew</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">GROUPS_FILENAME</span><span class="p">,</span> <span class="n">groupsNew</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">GROUPS_FILENAME</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeEmptyParents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

	<span class="c1"># fontinfo.plist</span>

<div class="viewcode-block" id="UFOWriter.writeInfo"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeInfo">[docs]</a>	<span class="k">def</span> <span class="nf">writeInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write info.plist. This method requires an object</span>
<span class="sd">		that supports getting attributes that follow the</span>
<span class="sd">		fontinfo.plist version 2 specification. Attributes</span>
<span class="sd">		will be taken from the given object and written</span>
<span class="sd">		into the file.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="c1"># gather version 3 data</span>
		<span class="n">infoData</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The supplied info object does not support getting a necessary attribute (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">infoData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="c1"># down convert data if necessary and validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
				<span class="n">infoData</span> <span class="o">=</span> <span class="n">validateInfoVersion3Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion3ToVersion2</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
				<span class="n">infoData</span> <span class="o">=</span> <span class="n">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion3ToVersion2</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
				<span class="n">infoData</span> <span class="o">=</span> <span class="n">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion2ToVersion1</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
		<span class="c1"># write file if there is anything to write</span>
		<span class="k">if</span> <span class="n">infoData</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">FONTINFO_FILENAME</span><span class="p">,</span> <span class="n">infoData</span><span class="p">)</span></div>

	<span class="c1"># kerning.plist</span>

<div class="viewcode-block" id="UFOWriter.writeKerning"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeKerning">[docs]</a>	<span class="k">def</span> <span class="nf">writeKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kerning</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write kerning.plist. This method requires a</span>
<span class="sd">		dict of kerning pairs as an argument.</span>

<span class="sd">		This performs basic structural validation of the kerning,</span>
<span class="sd">		but it does not check for compliance with the spec in</span>
<span class="sd">		regards to conflicting pairs. The assumption is that the</span>
<span class="sd">		kerning data being passed is standards compliant.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="c1"># validate the data structure</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">invalidFormatMessage</span> <span class="o">=</span> <span class="s2">&quot;The kerning is not properly formatted.&quot;</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">isDictEnough</span><span class="p">(</span><span class="n">kerning</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kerning</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">numberTypes</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
		<span class="c1"># down convert</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downConversionKerningData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">remap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downConversionKerningData</span><span class="p">[</span><span class="s2">&quot;groupRenameMap&quot;</span><span class="p">]</span>
			<span class="n">remappedKerning</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">side1</span><span class="p">,</span> <span class="n">side2</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kerning</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="n">side1</span> <span class="o">=</span> <span class="n">remap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">side1</span><span class="p">,</span> <span class="n">side1</span><span class="p">)</span>
				<span class="n">side2</span> <span class="o">=</span> <span class="n">remap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">side2</span><span class="p">,</span> <span class="n">side2</span><span class="p">)</span>
				<span class="n">remappedKerning</span><span class="p">[</span><span class="n">side1</span><span class="p">,</span> <span class="n">side2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
			<span class="n">kerning</span> <span class="o">=</span> <span class="n">remappedKerning</span>
		<span class="c1"># pack and write</span>
		<span class="n">kerningDict</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">kerning</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">kerning</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">left</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kerningDict</span><span class="p">:</span>
				<span class="n">kerningDict</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">kerningDict</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="k">if</span> <span class="n">kerningDict</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">KERNING_FILENAME</span><span class="p">,</span> <span class="n">kerningDict</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">KERNING_FILENAME</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeEmptyParents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

	<span class="c1"># lib.plist</span>

<div class="viewcode-block" id="UFOWriter.writeLib"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeLib">[docs]</a>	<span class="k">def</span> <span class="nf">writeLib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libDict</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write lib.plist. This method requires a</span>
<span class="sd">		lib dict as an argument.</span>

<span class="sd">		``validate`` will validate the data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">fontLibValidator</span><span class="p">(</span><span class="n">libDict</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">libDict</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">LIB_FILENAME</span><span class="p">,</span> <span class="n">libDict</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">LIB_FILENAME</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeEmptyParents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

	<span class="c1"># features.fea</span>

<div class="viewcode-block" id="UFOWriter.writeFeatures"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeFeatures">[docs]</a>	<span class="k">def</span> <span class="nf">writeFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write features.fea. This method requires a</span>
<span class="sd">		features string as an argument.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;features.fea is not allowed in UFO Format Version 1.&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The features are not text.&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">features</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">writeBytesToPath</span><span class="p">(</span><span class="n">FEATURES_FILENAME</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">FEATURES_FILENAME</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeEmptyParents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

	<span class="c1"># glyph sets &amp; layers</span>

<div class="viewcode-block" id="UFOWriter.writeLayerContents"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeLayerContents">[docs]</a>	<span class="k">def</span> <span class="nf">writeLayerContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerOrder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write the layercontents.plist file. This method  *must* be called</span>
<span class="sd">		after all glyph sets have been written.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="n">layerOrder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">newOrder</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="n">layerOrder</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">layerName</span> <span class="o">=</span> <span class="n">DEFAULT_LAYER_NAME</span>
				<span class="n">newOrder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
			<span class="n">layerOrder</span> <span class="o">=</span> <span class="n">newOrder</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">layerOrder</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">layerOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The layer order content does not match the glyph sets that have been created.&quot;</span><span class="p">)</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="p">[(</span><span class="n">layerName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">])</span> <span class="k">for</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="n">layerOrder</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">LAYERCONTENTS_FILENAME</span><span class="p">,</span> <span class="n">layerContents</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_findDirectoryForLayerName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="p">):</span>
		<span class="n">foundDirectory</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">existingLayerName</span><span class="p">,</span> <span class="n">directoryName</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">directoryName</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
				<span class="n">foundDirectory</span> <span class="o">=</span> <span class="n">directoryName</span>
				<span class="k">break</span>
			<span class="k">elif</span> <span class="n">existingLayerName</span> <span class="o">==</span> <span class="n">layerName</span><span class="p">:</span>
				<span class="n">foundDirectory</span> <span class="o">=</span> <span class="n">directoryName</span>
				<span class="k">break</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">foundDirectory</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Could not locate a glyph set directory for the layer named </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">layerName</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">foundDirectory</span>

<div class="viewcode-block" id="UFOWriter.getGlyphSet"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.getGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">getGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validateRead</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validateWrite</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the GlyphSet object associated with the</span>
<span class="sd">		appropriate glyph directory in the .ufo.</span>
<span class="sd">		If layerName is None, the default glyph set</span>
<span class="sd">		will be used. The defaultLayer flag indictes</span>
<span class="sd">		that the layer should be saved into the default</span>
<span class="sd">		glyphs directory.</span>

<span class="sd">		``validateRead`` will validate the read data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		``validateWrte`` will validate the written data, by default it is set to the</span>
<span class="sd">		class&#39;s validate value, can be overridden.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validateRead</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validateRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="n">validateWrite</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validateWrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="c1"># only default can be written in &lt; 3</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">defaultLayer</span> <span class="ow">or</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Only the default layer can be writen in UFO </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span><span class="p">)</span>
		<span class="c1"># locate a layer name when None has been given</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">existingLayerName</span><span class="p">,</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
					<span class="n">layerName</span> <span class="o">=</span> <span class="n">existingLayerName</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">layerName</span> <span class="o">=</span> <span class="n">DEFAULT_LAYER_NAME</span>
		<span class="k">elif</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;A layer name must be provided for non-default layers.&quot;</span><span class="p">)</span>
		<span class="c1"># move along to format specific writing</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGlyphSetFormatVersion1</span><span class="p">(</span><span class="n">validateRead</span><span class="p">,</span> <span class="n">validateWrite</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGlyphSetFormatVersion2</span><span class="p">(</span><span class="n">validateRead</span><span class="p">,</span> <span class="n">validateWrite</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGlyphSetFormatVersion3</span><span class="p">(</span><span class="n">validateRead</span><span class="p">,</span> <span class="n">validateWrite</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="n">layerName</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="n">defaultLayer</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_getGlyphSetFormatVersion1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validateRead</span><span class="p">,</span> <span class="n">validateWrite</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="kn">from</span> <span class="nn">fontTools.ufoLib.glifLib</span> <span class="k">import</span> <span class="n">GlyphSet</span>

		<span class="n">glyphSubFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span>
			<span class="n">glyphSubFS</span><span class="p">,</span>
			<span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">,</span>
			<span class="n">ufoFormatVersion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
			<span class="n">validateRead</span><span class="o">=</span><span class="n">validateRead</span><span class="p">,</span>
			<span class="n">validateWrite</span><span class="o">=</span><span class="n">validateWrite</span><span class="p">,</span>
		<span class="p">)</span>

	<span class="k">def</span> <span class="nf">_getGlyphSetFormatVersion2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validateRead</span><span class="p">,</span> <span class="n">validateWrite</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="kn">from</span> <span class="nn">fontTools.ufoLib.glifLib</span> <span class="k">import</span> <span class="n">GlyphSet</span>

		<span class="n">glyphSubFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span>
			<span class="n">glyphSubFS</span><span class="p">,</span>
			<span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">,</span>
			<span class="n">ufoFormatVersion</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
			<span class="n">validateRead</span><span class="o">=</span><span class="n">validateRead</span><span class="p">,</span>
			<span class="n">validateWrite</span><span class="o">=</span><span class="n">validateWrite</span><span class="p">,</span>
		<span class="p">)</span>

	<span class="k">def</span> <span class="nf">_getGlyphSetFormatVersion3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validateRead</span><span class="p">,</span> <span class="n">validateWrite</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="kn">from</span> <span class="nn">fontTools.ufoLib.glifLib</span> <span class="k">import</span> <span class="n">GlyphSet</span>

		<span class="c1"># if the default flag is on, make sure that the default in the file</span>
		<span class="c1"># matches the default being written. also make sure that this layer</span>
		<span class="c1"># name is not already linked to a non-default layer.</span>
		<span class="k">if</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">existingLayerName</span><span class="p">,</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">existingLayerName</span> <span class="o">!=</span> <span class="n">layerName</span><span class="p">:</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
							<span class="s2">&quot;Another layer (&#39;</span><span class="si">%s</span><span class="s2">&#39;) is already mapped to the default directory.&quot;</span>
							<span class="o">%</span> <span class="n">existingLayerName</span>
						<span class="p">)</span>
				<span class="k">elif</span> <span class="n">existingLayerName</span> <span class="o">==</span> <span class="n">layerName</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;The layer name is already mapped to a non-default layer.&quot;</span><span class="p">)</span>
		<span class="c1"># get an existing directory name</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">:</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span>
		<span class="c1"># get a  new directory name</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">defaultLayer</span><span class="p">:</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># not caching this could be slightly expensive,</span>
				<span class="c1"># but caching it will be cumbersome</span>
				<span class="n">existing</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">userNameToFileName</span><span class="p">(</span><span class="n">layerName</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="n">existing</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;glyphs.&quot;</span><span class="p">)</span>
		<span class="c1"># make the directory</span>
		<span class="n">glyphSubFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="c1"># store the mapping</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory</span>
		<span class="c1"># load the glyph set</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span>
			<span class="n">glyphSubFS</span><span class="p">,</span>
			<span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">,</span>
			<span class="n">ufoFormatVersion</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
			<span class="n">validateRead</span><span class="o">=</span><span class="n">validateRead</span><span class="p">,</span>
			<span class="n">validateWrite</span><span class="o">=</span><span class="n">validateWrite</span><span class="p">,</span>
		<span class="p">)</span>

<div class="viewcode-block" id="UFOWriter.renameGlyphSet"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.renameGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">renameGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="p">,</span> <span class="n">newLayerName</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Rename a glyph set.</span>

<span class="sd">		Note: if a GlyphSet object has already been retrieved for</span>
<span class="sd">		layerName, it is up to the caller to inform that object that</span>
<span class="sd">		the directory it represents has changed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="c1"># ignore renaming glyph sets for UFO1 UFO2</span>
			<span class="c1"># just write the data from the default layer</span>
			<span class="k">return</span>
		<span class="c1"># the new and old names can be the same</span>
		<span class="c1"># as long as the default is being switched</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="o">==</span> <span class="n">newLayerName</span><span class="p">:</span>
			<span class="c1"># if the default is off and the layer is already not the default, skip</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">!=</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">defaultLayer</span><span class="p">:</span>
				<span class="k">return</span>
			<span class="c1"># if the default is on and the layer is already the default, skip</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="ow">and</span> <span class="n">defaultLayer</span><span class="p">:</span>
				<span class="k">return</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># make sure the new layer name doesn&#39;t already exist</span>
			<span class="k">if</span> <span class="n">newLayerName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">newLayerName</span> <span class="o">=</span> <span class="n">DEFAULT_LAYER_NAME</span>
			<span class="k">if</span> <span class="n">newLayerName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;A layer named </span><span class="si">%s</span><span class="s2"> already exists.&quot;</span> <span class="o">%</span> <span class="n">newLayerName</span><span class="p">)</span>
			<span class="c1"># make sure the default layer doesn&#39;t already exist</span>
			<span class="k">if</span> <span class="n">defaultLayer</span> <span class="ow">and</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;A default layer already exists.&quot;</span><span class="p">)</span>
		<span class="c1"># get the paths</span>
		<span class="n">oldDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findDirectoryForLayerName</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="n">newDirectory</span> <span class="o">=</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">existing</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
			<span class="n">newDirectory</span> <span class="o">=</span> <span class="n">userNameToFileName</span><span class="p">(</span><span class="n">newLayerName</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="n">existing</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;glyphs.&quot;</span><span class="p">)</span>
		<span class="c1"># update the internal mapping</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">newLayerName</span><span class="p">]</span> <span class="o">=</span> <span class="n">newDirectory</span>
		<span class="c1"># do the file system copy</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">movedir</span><span class="p">(</span><span class="n">oldDirectory</span><span class="p">,</span> <span class="n">newDirectory</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.deleteGlyphSet"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.deleteGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">deleteGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the glyph set matching layerName.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="c1"># ignore deleting glyph sets for UFO1 UFO2 as there are no layers</span>
			<span class="c1"># just write the data from the default layer</span>
			<span class="k">return</span>
		<span class="n">foundDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findDirectoryForLayerName</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">foundDirectory</span><span class="p">,</span> <span class="n">removeEmptyParents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span></div>

<div class="viewcode-block" id="UFOWriter.writeData"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeData">[docs]</a>	<span class="k">def</span> <span class="nf">writeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write data to fileName in the &#39;data&#39; directory.</span>
<span class="sd">		The data must be a bytes string.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">writeBytesToPath</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{DATA_DIRNAME}</span><span class="s2">/{fsdecode(fileName)}&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.removeData"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.removeData">[docs]</a>	<span class="k">def</span> <span class="nf">removeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the file named fileName from the data directory.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{DATA_DIRNAME}</span><span class="s2">/{fsdecode(fileName)}&quot;</span><span class="p">)</span></div>

	<span class="c1"># /images</span>

<div class="viewcode-block" id="UFOWriter.writeImage"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.writeImage">[docs]</a>	<span class="k">def</span> <span class="nf">writeImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write data to fileName in the images directory.</span>
<span class="sd">		The data must be a valid PNG.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Images are not allowed in UFO </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">fileName</span> <span class="o">=</span> <span class="n">fsdecode</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pngValidator</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">writeBytesToPath</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{IMAGES_DIRNAME}</span><span class="s2">/</span><span class="si">{fileName}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.removeImage"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.removeImage">[docs]</a>	<span class="k">def</span> <span class="nf">removeImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># XXX remove unused &#39;validate&#39;?</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the file named fileName from the</span>
<span class="sd">		images directory.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Images are not allowed in UFO </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{IMAGES_DIRNAME}</span><span class="s2">/{fsdecode(fileName)}&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.copyImageFromReader"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.copyImageFromReader">[docs]</a>	<span class="k">def</span> <span class="nf">copyImageFromReader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">sourceFileName</span><span class="p">,</span> <span class="n">destFileName</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Copy the sourceFileName in the provided UFOReader to destFileName</span>
<span class="sd">		in this writer. This uses the most memory efficient method possible</span>
<span class="sd">		for copying the data possible.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Images are not allowed in UFO </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">sourcePath</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{IMAGES_DIRNAME}</span><span class="s2">/{fsdecode(sourceFileName)}&quot;</span>
		<span class="n">destPath</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{IMAGES_DIRNAME}</span><span class="s2">/{fsdecode(destFileName)}&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">copyFromReader</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">,</span> <span class="n">destPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="UFOWriter.close"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.UFOWriter.close">[docs]</a>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_havePreviousFile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileStructure</span> <span class="ow">is</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">ZIP</span><span class="p">:</span>
			<span class="c1"># if we are updating an existing zip file, we can now compress the</span>
			<span class="c1"># contents of the temporary filesystem in the destination path</span>
			<span class="n">rootDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.ufo&quot;</span>
			<span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">zipfs</span><span class="o">.</span><span class="n">ZipFS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">destFS</span><span class="p">:</span>
				<span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="o">.</span><span class="n">copy_fs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">destFS</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">rootDir</span><span class="p">))</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<span class="c1"># just an alias, makes it more explicit</span>
<span class="n">UFOReaderWriter</span> <span class="o">=</span> <span class="n">UFOWriter</span>


<span class="c1"># ----------------</span>
<span class="c1"># Helper Functions</span>
<span class="c1"># ----------------</span>


<span class="k">def</span> <span class="nf">_sniffFileStructure</span><span class="p">(</span><span class="n">ufo_path</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return UFOFileStructure.ZIP if the UFO at path &#39;ufo_path&#39; (str)</span>
<span class="sd">	is a zip file, else return UFOFileStructure.PACKAGE if &#39;ufo_path&#39; is a</span>
<span class="sd">	directory.</span>
<span class="sd">	Raise UFOLibError if it is a file with unknown structure, or if the path</span>
<span class="sd">	does not exist.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">ufo_path</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">ZIP</span>
	<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">ufo_path</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">UFOFileStructure</span><span class="o">.</span><span class="n">PACKAGE</span>
	<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ufo_path</span><span class="p">):</span>
		<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span>
			<span class="s2">&quot;The specified UFO does not have a known structure: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">ufo_path</span>
		<span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;No such file or directory: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">ufo_path</span><span class="p">)</span>


<div class="viewcode-block" id="makeUFOPath"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.makeUFOPath">[docs]</a><span class="k">def</span> <span class="nf">makeUFOPath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return a .ufo pathname.</span>

<span class="sd">	&gt;&gt;&gt; makeUFOPath(&quot;directory/something.ext&quot;) == (</span>
<span class="sd">	... 	os.path.join(&#39;directory&#39;, &#39;something.ufo&#39;))</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; makeUFOPath(&quot;directory/something.another.thing.ext&quot;) == (</span>
<span class="sd">	... 	os.path.join(&#39;directory&#39;, &#39;something.another.thing.ufo&#39;))</span>
<span class="sd">	True</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="nb">dir</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;ufo&quot;</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<span class="c1"># ----------------------</span>
<span class="c1"># fontinfo.plist Support</span>
<span class="c1"># ----------------------</span>

<span class="c1"># Version Validators</span>

<span class="c1"># There is no version 1 validator and there shouldn&#39;t be.</span>
<span class="c1"># The version 1 spec was very loose and there were numerous</span>
<span class="c1"># cases of invalid values.</span>

<div class="viewcode-block" id="validateFontInfoVersion2ValueForAttribute"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.validateFontInfoVersion2ValueForAttribute">[docs]</a><span class="k">def</span> <span class="nf">validateFontInfoVersion2ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for attribute</span>
<span class="sd">	following the UFO 2 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the value</span>
<span class="sd">	is of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">dataValidationDict</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion2ValueData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
	<span class="n">valueType</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
	<span class="n">validator</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;valueValidator&quot;</span><span class="p">)</span>
	<span class="n">valueOptions</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;valueOptions&quot;</span><span class="p">)</span>
	<span class="c1"># have specific options for the validator</span>
	<span class="k">if</span> <span class="n">valueOptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueOptions</span><span class="p">)</span>
	<span class="c1"># no specific options</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">validator</span> <span class="o">==</span> <span class="n">genericTypeValidator</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueType</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">isValidValue</span></div>

<span class="k">def</span> <span class="nf">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for infoData</span>
<span class="sd">	following the UFO 2 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the values</span>
<span class="sd">	are of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">validInfoData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">infoData</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validateFontInfoVersion2ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">isValidValue</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Invalid value for attribute </span><span class="si">{attr}</span><span class="s2"> (</span><span class="si">{value!r}</span><span class="s2">).&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">validInfoData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="n">validInfoData</span>

<div class="viewcode-block" id="validateFontInfoVersion3ValueForAttribute"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.validateFontInfoVersion3ValueForAttribute">[docs]</a><span class="k">def</span> <span class="nf">validateFontInfoVersion3ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for attribute</span>
<span class="sd">	following the UFO 3 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the value</span>
<span class="sd">	is of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">dataValidationDict</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion3ValueData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
	<span class="n">valueType</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
	<span class="n">validator</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;valueValidator&quot;</span><span class="p">)</span>
	<span class="n">valueOptions</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;valueOptions&quot;</span><span class="p">)</span>
	<span class="c1"># have specific options for the validator</span>
	<span class="k">if</span> <span class="n">valueOptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueOptions</span><span class="p">)</span>
	<span class="c1"># no specific options</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">validator</span> <span class="o">==</span> <span class="n">genericTypeValidator</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueType</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">isValidValue</span></div>

<span class="k">def</span> <span class="nf">validateInfoVersion3Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for infoData</span>
<span class="sd">	following the UFO 3 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the values</span>
<span class="sd">	are of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">validInfoData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">infoData</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validateFontInfoVersion3ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">isValidValue</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Invalid value for attribute </span><span class="si">{attr}</span><span class="s2"> (</span><span class="si">{value!r}</span><span class="s2">).&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">validInfoData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="n">validInfoData</span>

<span class="c1"># Value Options</span>

<span class="n">fontInfoOpenTypeHeadFlagsOptions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">fontInfoOpenTypeOS2SelectionOptions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">fontInfoOpenTypeOS2UnicodeRangesOptions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
<span class="n">fontInfoOpenTypeOS2CodePageRangesOptions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
<span class="n">fontInfoOpenTypeOS2TypeOptions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

<span class="c1"># Version Attribute Definitions</span>
<span class="c1"># This defines the attributes, types and, in some</span>
<span class="c1"># cases the possible values, that can exist is</span>
<span class="c1"># fontinfo.plist.</span>

<span class="n">fontInfoAttributesVersion1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;familyName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;styleName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fullName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fontName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;menuName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fontStyle&quot;</span><span class="p">,</span>
	<span class="s2">&quot;note&quot;</span><span class="p">,</span>
	<span class="s2">&quot;versionMajor&quot;</span><span class="p">,</span>
	<span class="s2">&quot;versionMinor&quot;</span><span class="p">,</span>
	<span class="s2">&quot;year&quot;</span><span class="p">,</span>
	<span class="s2">&quot;copyright&quot;</span><span class="p">,</span>
	<span class="s2">&quot;notice&quot;</span><span class="p">,</span>
	<span class="s2">&quot;trademark&quot;</span><span class="p">,</span>
	<span class="s2">&quot;license&quot;</span><span class="p">,</span>
	<span class="s2">&quot;licenseURL&quot;</span><span class="p">,</span>
	<span class="s2">&quot;createdBy&quot;</span><span class="p">,</span>
	<span class="s2">&quot;designer&quot;</span><span class="p">,</span>
	<span class="s2">&quot;designerURL&quot;</span><span class="p">,</span>
	<span class="s2">&quot;vendorURL&quot;</span><span class="p">,</span>
	<span class="s2">&quot;unitsPerEm&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ascender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;descender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;capHeight&quot;</span><span class="p">,</span>
	<span class="s2">&quot;xHeight&quot;</span><span class="p">,</span>
	<span class="s2">&quot;defaultWidth&quot;</span><span class="p">,</span>
	<span class="s2">&quot;slantAngle&quot;</span><span class="p">,</span>
	<span class="s2">&quot;italicAngle&quot;</span><span class="p">,</span>
	<span class="s2">&quot;widthName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;weightName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;weightValue&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fondName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;otFamilyName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;otStyleName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;otMacName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;msCharSet&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fondID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;uniqueID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ttVendor&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ttUniqueID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ttVersion&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">fontInfoAttributesVersion2ValueData</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;familyName&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;styleName&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;styleMapFamilyName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;styleMapStyleName&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoStyleMapStyleNameValidator</span><span class="p">),</span>
	<span class="s2">&quot;versionMajor&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;versionMinor&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;year&quot;</span>									<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;copyright&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;trademark&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;unitsPerEm&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;descender&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;xHeight&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;capHeight&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;ascender&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;italicAngle&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
	<span class="s2">&quot;note&quot;</span>									<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHeadCreated&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeHeadCreatedValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHeadLowestRecPPEM&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeHeadFlags&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeHeadFlagsOptions</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaAscender&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeHheaDescender&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeHheaLineGap&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeHheaCaretSlopeRise&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaCaretSlopeRun&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaCaretOffset&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeNameDesigner&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameDesignerURL&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameManufacturer&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameManufacturerURL&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameLicense&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameLicenseURL&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameVersion&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameUniqueID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameDescription&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNamePreferredFamilyName&quot;</span>		<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNamePreferredSubfamilyName&quot;</span>	<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameCompatibleFullName&quot;</span>		<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameSampleText&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameWWSFamilyName&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameWWSSubfamilyName&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2WidthClass&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2WidthClassValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2WeightClass&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2WeightClassValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2Selection&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2SelectionOptions</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2VendorID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2Panose&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoVersion2OpenTypeOS2PanoseValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2FamilyClass&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2FamilyClassValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2UnicodeRanges&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2UnicodeRangesOptions</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2CodePageRanges&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2CodePageRangesOptions</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2TypoAscender&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2TypoDescender&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2TypoLineGap&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2WinAscent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2WinDescent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2Type&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2TypeOptions</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SubscriptXSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SubscriptYSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SubscriptXOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SubscriptYOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptXSize&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptYSize&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptXOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptYOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2StrikeoutSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeOS2StrikeoutPosition&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeVheaVertTypoAscender&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeVheaVertTypoDescender&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeVheaVertTypoLineGap&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;openTypeVheaCaretSlopeRise&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeVheaCaretSlopeRun&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeVheaCaretOffset&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptFontName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;postscriptFullName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;postscriptSlantAngle&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptUniqueID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;postscriptUnderlineThickness&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptUnderlinePosition&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptIsFixedPitch&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
	<span class="s2">&quot;postscriptBlueValues&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptBluesValidator</span><span class="p">),</span>
	<span class="s2">&quot;postscriptOtherBlues&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptOtherBluesValidator</span><span class="p">),</span>
	<span class="s2">&quot;postscriptFamilyBlues&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptBluesValidator</span><span class="p">),</span>
	<span class="s2">&quot;postscriptFamilyOtherBlues&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptOtherBluesValidator</span><span class="p">),</span>
	<span class="s2">&quot;postscriptStemSnapH&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptStemsValidator</span><span class="p">),</span>
	<span class="s2">&quot;postscriptStemSnapV&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptStemsValidator</span><span class="p">),</span>
	<span class="s2">&quot;postscriptBlueFuzz&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptBlueShift&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptBlueScale&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptForceBold&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
	<span class="s2">&quot;postscriptDefaultWidthX&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptNominalWidthX&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s2">&quot;postscriptWeightName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;postscriptDefaultCharacter&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
	<span class="s2">&quot;postscriptWindowsCharacterSet&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptWindowsCharacterSetValidator</span><span class="p">),</span>
	<span class="s2">&quot;macintoshFONDFamilyID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;macintoshFONDName&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">fontInfoAttributesVersion2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fontInfoAttributesVersion2ValueData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">fontInfoAttributesVersion3ValueData</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fontInfoAttributesVersion2ValueData</span><span class="p">)</span>
<span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
	<span class="s2">&quot;versionMinor&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeIntValidator</span><span class="p">),</span>
	<span class="s2">&quot;unitsPerEm&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHeadLowestRecPPEM&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaAscender&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaDescender&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaLineGap&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeHheaCaretOffset&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2Panose&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoVersion3OpenTypeOS2PanoseValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2TypoAscender&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2TypoDescender&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2TypoLineGap&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2WinAscent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2WinDescent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SubscriptXSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SubscriptYSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SubscriptXOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SubscriptYOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptXSize&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptYSize&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptXOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2SuperscriptYOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2StrikeoutSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeOS2StrikeoutPosition&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeGaspRangeRecords&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;dictList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeGaspRangeRecordsValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeNameRecords&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;dictList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeNameRecordsValidator</span><span class="p">),</span>
	<span class="s2">&quot;openTypeVheaVertTypoAscender&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeVheaVertTypoDescender&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeVheaVertTypoLineGap&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;openTypeVheaCaretOffset&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s2">&quot;woffMajorVersion&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeIntValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMinorVersion&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeIntValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataUniqueID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataUniqueIDValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataVendor&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataVendorValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataCredits&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataCreditsValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataDescription&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataDescriptionValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataLicense&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataLicenseValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataCopyright&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataCopyrightValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataTrademark&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataTrademarkValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataLicensee&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataLicenseeValidator</span><span class="p">),</span>
	<span class="s2">&quot;woffMetadataExtensions&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataExtensionsValidator</span><span class="p">),</span>
	<span class="s2">&quot;guidelines&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">guidelinesValidator</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">fontInfoAttributesVersion3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># insert the type validator for all attrs that</span>
<span class="c1"># have no defined validator.</span>
<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataDict</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fontInfoAttributesVersion2ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
	<span class="k">if</span> <span class="s2">&quot;valueValidator&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataDict</span><span class="p">:</span>
		<span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;valueValidator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genericTypeValidator</span>

<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataDict</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
	<span class="k">if</span> <span class="s2">&quot;valueValidator&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataDict</span><span class="p">:</span>
		<span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;valueValidator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genericTypeValidator</span>

<span class="c1"># Version Conversion Support</span>
<span class="c1"># These are used from converting from version 1</span>
<span class="c1"># to version 2 or vice-versa.</span>

<span class="k">def</span> <span class="nf">_flipDict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
	<span class="n">flipped</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="n">flipped</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
	<span class="k">return</span> <span class="n">flipped</span>

<span class="n">fontInfoAttributesVersion1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;menuName&quot;</span>		<span class="p">:</span> <span class="s2">&quot;styleMapFamilyName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;designer&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameDesigner&quot;</span><span class="p">,</span>
	<span class="s2">&quot;designerURL&quot;</span>	<span class="p">:</span> <span class="s2">&quot;openTypeNameDesignerURL&quot;</span><span class="p">,</span>
	<span class="s2">&quot;createdBy&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameManufacturer&quot;</span><span class="p">,</span>
	<span class="s2">&quot;vendorURL&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameManufacturerURL&quot;</span><span class="p">,</span>
	<span class="s2">&quot;license&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameLicense&quot;</span><span class="p">,</span>
	<span class="s2">&quot;licenseURL&quot;</span>	<span class="p">:</span> <span class="s2">&quot;openTypeNameLicenseURL&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ttVersion&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameVersion&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ttUniqueID&quot;</span>	<span class="p">:</span> <span class="s2">&quot;openTypeNameUniqueID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;notice&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameDescription&quot;</span><span class="p">,</span>
	<span class="s2">&quot;otFamilyName&quot;</span>	<span class="p">:</span> <span class="s2">&quot;openTypeNamePreferredFamilyName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;otStyleName&quot;</span>	<span class="p">:</span> <span class="s2">&quot;openTypeNamePreferredSubfamilyName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;otMacName&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeNameCompatibleFullName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;weightName&quot;</span>	<span class="p">:</span> <span class="s2">&quot;postscriptWeightName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;weightValue&quot;</span>	<span class="p">:</span> <span class="s2">&quot;openTypeOS2WeightClass&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ttVendor&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeOS2VendorID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;uniqueID&quot;</span>		<span class="p">:</span> <span class="s2">&quot;postscriptUniqueID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fontName&quot;</span>		<span class="p">:</span> <span class="s2">&quot;postscriptFontName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fondID&quot;</span>		<span class="p">:</span> <span class="s2">&quot;macintoshFONDFamilyID&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fondName&quot;</span>		<span class="p">:</span> <span class="s2">&quot;macintoshFONDName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;defaultWidth&quot;</span>	<span class="p">:</span> <span class="s2">&quot;postscriptDefaultWidthX&quot;</span><span class="p">,</span>
	<span class="s2">&quot;slantAngle&quot;</span>	<span class="p">:</span> <span class="s2">&quot;postscriptSlantAngle&quot;</span><span class="p">,</span>
	<span class="s2">&quot;fullName&quot;</span>		<span class="p">:</span> <span class="s2">&quot;postscriptFullName&quot;</span><span class="p">,</span>
	<span class="c1"># require special value conversion</span>
	<span class="s2">&quot;fontStyle&quot;</span>		<span class="p">:</span> <span class="s2">&quot;styleMapStyleName&quot;</span><span class="p">,</span>
	<span class="s2">&quot;widthName&quot;</span>		<span class="p">:</span> <span class="s2">&quot;openTypeOS2WidthClass&quot;</span><span class="p">,</span>
	<span class="s2">&quot;msCharSet&quot;</span>		<span class="p">:</span> <span class="s2">&quot;postscriptWindowsCharacterSet&quot;</span>
<span class="p">}</span>
<span class="n">fontInfoAttributesVersion2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">fontInfoAttributesVersion1To2</span><span class="p">)</span>
<span class="n">deprecatedFontInfoAttributesVersion2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fontInfoAttributesVersion1To2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">_fontStyle1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">64</span> <span class="p">:</span> <span class="s2">&quot;regular&quot;</span><span class="p">,</span>
	<span class="mi">1</span>  <span class="p">:</span> <span class="s2">&quot;italic&quot;</span><span class="p">,</span>
	<span class="mi">32</span> <span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
	<span class="mi">33</span> <span class="p">:</span> <span class="s2">&quot;bold italic&quot;</span>
<span class="p">}</span>
<span class="n">_fontStyle2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">_fontStyle1To2</span><span class="p">)</span>
<span class="c1"># Some UFO 1 files have 0</span>
<span class="n">_fontStyle1To2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;regular&quot;</span>

<span class="n">_widthName1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;Ultra-condensed&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
	<span class="s2">&quot;Extra-condensed&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="s2">&quot;Condensed&quot;</span>		  <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
	<span class="s2">&quot;Semi-condensed&quot;</span>  <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
	<span class="s2">&quot;Medium (normal)&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
	<span class="s2">&quot;Semi-expanded&quot;</span>	  <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
	<span class="s2">&quot;Expanded&quot;</span>		  <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
	<span class="s2">&quot;Extra-expanded&quot;</span>  <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
	<span class="s2">&quot;Ultra-expanded&quot;</span>  <span class="p">:</span> <span class="mi">9</span>
<span class="p">}</span>
<span class="n">_widthName2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">_widthName1To2</span><span class="p">)</span>
<span class="c1"># FontLab&#39;s default width value is &quot;Normal&quot;.</span>
<span class="c1"># Many format version 1 UFOs will have this.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s2">&quot;Normal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># FontLab has an &quot;All&quot; width value. In UFO 1</span>
<span class="c1"># move this up to &quot;Normal&quot;.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># &quot;medium&quot; appears in a lot of UFO 1 files.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s2">&quot;medium&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># &quot;Medium&quot; appears in a lot of UFO 1 files.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s2">&quot;Medium&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">_msCharSet1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">0</span>	<span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
	<span class="mi">1</span>	<span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span>	<span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
	<span class="mi">77</span>	<span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
	<span class="mi">128</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
	<span class="mi">129</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
	<span class="mi">130</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
	<span class="mi">134</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
	<span class="mi">136</span> <span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
	<span class="mi">161</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
	<span class="mi">162</span> <span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
	<span class="mi">163</span> <span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
	<span class="mi">177</span> <span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
	<span class="mi">178</span> <span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
	<span class="mi">186</span> <span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
	<span class="mi">200</span> <span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
	<span class="mi">204</span> <span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
	<span class="mi">222</span> <span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
	<span class="mi">238</span> <span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
	<span class="mi">255</span> <span class="p">:</span> <span class="mi">20</span>
<span class="p">}</span>
<span class="n">_msCharSet2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">_msCharSet1To2</span><span class="p">)</span>

<span class="c1"># 1 &lt;-&gt; 2</span>

<div class="viewcode-block" id="convertFontInfoValueForAttributeFromVersion1ToVersion2"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.convertFontInfoValueForAttributeFromVersion1ToVersion2">[docs]</a><span class="k">def</span> <span class="nf">convertFontInfoValueForAttributeFromVersion1ToVersion2</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert value from version 1 to version 2 format.</span>
<span class="sd">	Returns the new attribute name and the converted value.</span>
<span class="sd">	If the value is None, None will be returned for the new value.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># convert floats to ints if possible</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;fontStyle&quot;</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">_fontStyle1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Cannot convert value (</span><span class="si">{value!r}</span><span class="s2">) for attribute </span><span class="si">{attr}</span><span class="s2">.&quot;</span><span class="p">)</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;widthName&quot;</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">_widthName1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Cannot convert value (</span><span class="si">{value!r}</span><span class="s2">) for attribute </span><span class="si">{attr}</span><span class="s2">.&quot;</span><span class="p">)</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;msCharSet&quot;</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">_msCharSet1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Cannot convert value (</span><span class="si">{value!r}</span><span class="s2">) for attribute </span><span class="si">{attr}</span><span class="s2">.&quot;</span><span class="p">)</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
	<span class="n">attr</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="convertFontInfoValueForAttributeFromVersion2ToVersion1"><a class="viewcode-back" href="../../ufoLib/index.html#fontTools.ufoLib.glifLib.convertFontInfoValueForAttributeFromVersion2ToVersion1">[docs]</a><span class="k">def</span> <span class="nf">convertFontInfoValueForAttributeFromVersion2ToVersion1</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert value from version 2 to version 1 format.</span>
<span class="sd">	Returns the new attribute name and the converted value.</span>
<span class="sd">	If the value is None, None will be returned for the new value.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;styleMapStyleName&quot;</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">_fontStyle2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;openTypeOS2WidthClass&quot;</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">_widthName2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;postscriptWindowsCharacterSet&quot;</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">_msCharSet2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="n">attr</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span></div>

<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion1ToVersion2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="c1"># FontLab gives -1 for the weightValue</span>
		<span class="c1"># for fonts wil no defined value. Many</span>
		<span class="c1"># format version 1 UFOs will have this.</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;weightValue&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">newAttr</span><span class="p">,</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">convertFontInfoValueForAttributeFromVersion1ToVersion2</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="c1"># skip if the attribute is not part of version 2</span>
		<span class="k">if</span> <span class="n">newAttr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion2</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="c1"># catch values that can&#39;t be converted</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Cannot convert value (</span><span class="si">{value!r}</span><span class="s2">) for attribute </span><span class="si">{newAttr}</span><span class="s2">.&quot;</span><span class="p">)</span>
		<span class="c1"># store</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">newAttr</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion2ToVersion1</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="n">newAttr</span><span class="p">,</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">convertFontInfoValueForAttributeFromVersion2ToVersion1</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="c1"># only take attributes that are registered for version 1</span>
		<span class="k">if</span> <span class="n">newAttr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion1</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="c1"># catch values that can&#39;t be converted</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Cannot convert value (</span><span class="si">{value!r}</span><span class="s2">) for attribute </span><span class="si">{newAttr}</span><span class="s2">.&quot;</span><span class="p">)</span>
		<span class="c1"># store</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">newAttr</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="c1"># 2 &lt;-&gt; 3</span>

<span class="n">_ufo2To3NonNegativeInt</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;versionMinor&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeHeadLowestRecPPEM&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2WinAscent&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2WinDescent&quot;</span>
<span class="p">}</span>
<span class="n">_ufo2To3NonNegativeIntOrFloat</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;unitsPerEm&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_ufo2To3FloatToInt</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s2">&quot;openTypeHeadLowestRecPPEM&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeHheaAscender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeHheaDescender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeHheaLineGap&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeHheaCaretOffset&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2TypoAscender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2TypoDescender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2TypoLineGap&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2WinAscent&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2WinDescent&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SubscriptXSize&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SubscriptYSize&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SubscriptXOffset&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SubscriptYOffset&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SuperscriptXSize&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SuperscriptYSize&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SuperscriptXOffset&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2SuperscriptYOffset&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2StrikeoutSize&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeOS2StrikeoutPosition&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeVheaVertTypoAscender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeVheaVertTypoDescender&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeVheaVertTypoLineGap&quot;</span><span class="p">,</span>
	<span class="s2">&quot;openTypeVheaCaretOffset&quot;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">convertFontInfoValueForAttributeFromVersion2ToVersion3</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert value from version 2 to version 3 format.</span>
<span class="sd">	Returns the new attribute name and the converted value.</span>
<span class="sd">	If the value is None, None will be returned for the new value.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">_ufo2To3FloatToInt</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Could not convert value for </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">_ufo2To3NonNegativeInt</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
		<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Could not convert value for </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">_ufo2To3NonNegativeIntOrFloat</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
		<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s2">&quot;Could not convert value for </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
			<span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
	<span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">convertFontInfoValueForAttributeFromVersion3ToVersion2</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert value from version 3 to version 2 format.</span>
<span class="sd">	Returns the new attribute name and the converted value.</span>
<span class="sd">	If the value is None, None will be returned for the new value.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion3ToVersion2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="n">newAttr</span><span class="p">,</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">convertFontInfoValueForAttributeFromVersion3ToVersion2</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">newAttr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion2</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">newAttr</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion2ToVersion3</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">convertFontInfoValueForAttributeFromVersion2ToVersion3</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">doctest</span>
	<span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Just van Rossum, Behdad Esfahbod, and the fontTools Authors. CC BY-SA 4.0

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>